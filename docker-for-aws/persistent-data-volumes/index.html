<!-- Page generated 2019-04-19 17:06:54 +0900 -->
<!-- relative link basehrefs -->

	
	
	
		
			
		
	
		
			
			


<!-- Logic for 'edit this button' -->


	

	

	

	

	

	

	

	

	


<!-- End of logic for 'edit this button' -->


<!DOCTYPE html>
<html lang="ja">

<head>
	<base href="https://matsuand.github.io/docs.docker.jp.onthefly/docker-for-aws/" />
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<style type="text/css">
		@charset "UTF-8";
		[ng\:cloak],
		[ng-cloak],
		[data-ng-cloak],
		[x-ng-cloak],
		.ng-cloak,
		.x-ng-cloak,
		.ng-hide:not(.ng-hide-animate) {
			display: none !important;
		}

		ng\:form {
			display: block;
		}
	</style>
	<script type="text/javascript">
	  !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="4.0.0";
	  analytics.load("IWj9D0UpZHZdZUZX9jl98PcpBFWBnBMy");
	  analytics.page();
	  }}();
	</script>
	
	<!-- favicon -->
	<link rel="icon" type="image/x-icon" href="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
	<meta name="msapplication-TileImage" content="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico">
	<link rel="apple-touch-icon" type="image/x-icon" href="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
	<meta property="og:image" content="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico"/>
	<!-- metadata -->
	<meta property="og:type" content="website"/>
	<meta property="og:updated_time" itemprop="dateUpdated" content="2019-04-19T17:06:54+09:00"/>
	<meta property="og:image" itemprop="image primaryImageOfPage" content="https://matsuand.github.io/docs.docker.jp.onthefly/images/docs@2x.png"/>
	<meta name="twitter:card" content="summary"/>
	<meta name="twitter:domain" content="docs.docker.jp"/>
	<meta name="twitter:site" content="@docker_docs"/>
	<meta name="twitter:url" content="https://twitter.com/docker_docs"/>
	<meta name="twitter:title" itemprop="title name" content="Docker for AWS persistent data volumes"/>
	<meta name="twitter:description" property="og:description" itemprop="description" content="What is Cloudstor? Cloudstor is a modern volume plugin built by Docker. It comes pre-installed and pre-configured in Docker swarms deployed through Docker for AWS. Docker swarm mode tasks and..." />
	<meta name="twitter:image:src" content="https://matsuand.github.io/docs.docker.jp.onthefly/images/docs@2x.png"/>
	<meta name="twitter:image:alt" content="Docker Documentation"/>
	<meta property="article:published_time" itemprop="datePublished" content="2019-04-19T17:06:54+09:00"/>

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="keywords" content="aws persistent data volumes">
	<link rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/bootstrap.min.css">
	<link id="pygments" rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/pygments/perldoc.css">
	<link id="pagestyle" rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/style.css">

	<!-- Go get "Open Sans" font from Google -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
	<!-- SEO stuff -->
	<title>Docker for AWS persistent data volumes | Docker Documentation</title>
<meta property="og:title" content="Docker for AWS persistent data volumes" />
<meta property="og:locale" content="ja_JP" />
<meta name="description" content="Persistent data volumes" />
<meta property="og:description" content="Persistent data volumes" />
<link rel="canonical" href="https://matsuand.github.io/docs.docker.jp.onthefly/docker-for-aws/persistent-data-volumes/" />
<meta property="og:url" content="https://matsuand.github.io/docs.docker.jp.onthefly/docker-for-aws/persistent-data-volumes/" />
<meta property="og:site_name" content="Docker Documentation" />
<script type="application/ld+json">
{"@context":"http://schema.org","@type":"WebPage","headline":"Docker for AWS persistent data volumes","description":"Persistent data volumes","url":"https://matsuand.github.io/docs.docker.jp.onthefly/docker-for-aws/persistent-data-volumes/"}</script>
	<!-- END SEO STUFF -->
	
	<script language="javascript">
	// Default to assuming this is an archive and hiding some stuff
	// See js/archive.js and js/docs.js for logic relating to this
	var isArchive = true;
	var dockerVersion = 'v18.09';
	</script>
</head>
<body ng-app="Docker" ng-controller="DockerController" class="colums">
	<header>
		 <nav class="nav-secondary navbar navbar-fixed-top">
    <!-- <div class="fan"></div> -->
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="https://matsuand.github.io/docs.docker.jp.onthefly/"><img class="logo" src="https://matsuand.github.io/docs.docker.jp.onthefly/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs"></a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="search-form" id="search-div" style="visibility: hidden">
    <form class="search-form form-inline ng-pristine ng-valid" /id="searchForm" action="/docs.docker.jp.onthefly/search/">
        <input class="search-field form-control ds-input" id="st-search-input" value="" name="q" placeholder="文書内検索" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteContainer">
            <div id="autocompleteResults"></div>
        </div>
        <!-- <button type="submit" class="search-submit btn btn-default">検索</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container">
    <div id="tabs">
        <ul class="tabs" id="jsTOCHorizontal">

        </ul>
    </div>
    <div class="ctrl-right hidden-xs hidden-sm">
        <a href="javascript:void(0)" id="menu-toggle"><i class="fa fa-indent" aria-hidden="true"></i></a>
        <div class="btn-group" style="visibility: hidden">
  <button type="button" class="btn btn-default dropdown-btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Docker v18.09 (current)        <span class="caret"></span>
  </button>
  <ul class="dropdown-menu">
    <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/edge/">Docker edge</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v18.03/">Docker v18.03</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.12/">Docker v17.12</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.09/">Docker v17.09</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.06/">Docker v17.06</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.03/">Docker v17.03</a></li>
  </ul>
</div>

    </div>
</div>

        </div>
    </div>
</nav>

	</header>

	<div class="wrapper right-open">
		<div class="container-fluid">
			<div class="row">
				<div class="col-body">
					<main class="col-content content">
						<section class="section">
							
								
							<h1>Docker for AWS persistent data volumes</h1>  <span class="reading-time" title="Estimated reading time">
  <span class="reading-time-label">読む時間の目安: </span>
  
  
    11 分
  
</span>

							
							
							
<h2 id="what-is-cloudstor">What is Cloudstor?</h2>

<p>Cloudstor is a modern volume plugin built by Docker. It comes pre-installed and
pre-configured in Docker swarms deployed through Docker for AWS. Docker swarm
mode tasks and regular Docker containers can use a volume created with
Cloudstor to mount a persistent data volume. In Docker for AWS, Cloudstor has
two <code class="highlighter-rouge">backing</code> options:</p>

<ul>
  <li><code class="highlighter-rouge">relocatable</code> data volumes are backed by EBS.</li>
  <li><code class="highlighter-rouge">shared</code> data volumes are backed by EFS.</li>
</ul>

<p>When you use the Docker CLI to create a swarm service along with the persistent
volumes used by the service tasks, you can create three different types of
persistent volumes:</p>

<ul>
  <li>Unique <code class="highlighter-rouge">relocatable</code> Cloudstor volumes mounted by each task in a swarm service.</li>
  <li>Global <code class="highlighter-rouge">shared</code> Cloudstor volumes mounted by all tasks in a swarm service.</li>
  <li>Unique <code class="highlighter-rouge">shared</code> Cloudstor volumes mounted by each task in a swarm service.</li>
</ul>

<p>Examples of each type of volume are described below.</p>

<h2 id="relocatable-cloudstor-volumes">Relocatable Cloudstor volumes</h2>

<p>Workloads running in a Docker service that require access to low latency/high
 IOPs persistent storage, such as a database engine, can use a <code class="highlighter-rouge">relocatable</code>
 Cloudstor volume backed by EBS. When you create the volume, you can specify the
 type of EBS volume appropriate for the workload (such as <code class="highlighter-rouge">gp2</code>, <code class="highlighter-rouge">io1</code>, <code class="highlighter-rouge">st1</code>,
 <code class="highlighter-rouge">sc1</code>). Each <code class="highlighter-rouge">relocatable</code> Cloudstor volume is backed by a single EBS volume.</p>

<p>If a swarm task using a <code class="highlighter-rouge">relocatable</code> Cloudstor volume gets rescheduled to
 another node within the same availability zone as the original node where the
 task was running, Cloudstor detaches the backing EBS volume from the original
 node and attaches it to the new target node automatically.</p>

<p>If the swarm task gets rescheduled to a node in a different availability zone,
 Cloudstor transfers the contents of the backing EBS volume to the destination
 availability zone using a snapshot, and cleans up the EBS volume in the
 original availability zone. To minimize the time necessary to create the
 snapshot to transfer data across availability zones, Cloudstor periodically
 takes snapshots of EBS volumes to ensure there is never a large number of
 writes that need to be transferred as part of the final snapshot when
 transferring the EBS volume across availability zones.</p>

<p>Typically the snapshot-based transfer process across availability zones takes
 between 2 and 5 minutes unless the work load is write-heavy. For extremely
 write-heavy workloads generating several GBs of fresh/new data every few
 minutes, the transfer may take longer than 5 minutes. The time required to
 snapshot and transfer increases sharply beyond 10 minutes if more than 20 GB of
 writes have been generated since the last snapshot interval. A swarm task is
 not started until the volume it mounts becomes available.</p>

<p>Sharing/mounting the same Cloudstor volume backed by EBS among multiple tasks
 is not a supported scenario and leads to data loss. If you need a Cloudstor
 volume to share data between tasks, choose the appropriate EFS backed <code class="highlighter-rouge">shared</code>
 volume option. Using a <code class="highlighter-rouge">relocatable</code> Cloudstor volume backed by EBS is
 supported on all AWS regions that support EBS. The default <code class="highlighter-rouge">backing</code> option is
 <code class="highlighter-rouge">relocatable</code> if EFS support is not selected during setup/installation or if
 EFS is not supported in a region.</p>

<h2 id="shared-cloudstor-volumes">Shared Cloudstor volumes</h2>

<p>When multiple swarm service tasks need to share data in a persistent storage
volume, you can use a <code class="highlighter-rouge">shared</code> Cloudstor volume backed by EFS. Such a volume and
its contents can be mounted by multiple swarm service tasks without the risk of
data loss, since EFS makes the data available to all swarm nodes over NFS.</p>

<p>When swarm tasks using a <code class="highlighter-rouge">shared</code> Cloudstor volume get rescheduled from one node
to another within the same or across different availability zones, the
persistent data backed by EFS volumes is always available. <code class="highlighter-rouge">shared</code> Cloudstor
volumes only work in those AWS regions where EFS is supported. If EFS
Support is selected during setup/installation, the default “backing” option for
Cloudstor volumes is set to <code class="highlighter-rouge">shared</code> so that EFS is used by default.</p>

<p><code class="highlighter-rouge">shared</code> Cloudstor volumes backed by EFS (or even EFS MaxIO) may not be ideal
for workloads that require very low latency and high IOPSs. For performance
details of EFS backed <code class="highlighter-rouge">shared</code> Cloudstor volumes, see <a href="http://docs.aws.amazon.com/efs/latest/ug/performance.html">the AWS performance
guidelines</a>.</p>

<h2 id="use-cloudstor">Use Cloudstor</h2>

<p>After initializing or joining a swarm on Docker for AWS, connect to any swarm
manager using SSH. Verify that the CloudStor plugin is already installed and
configured for the stack or resource group:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker plugin <span class="nb">ls

</span>ID                  NAME                        DESCRIPTION                       ENABLED
f416c95c0dcc        cloudstor:aws               cloud storage plugin <span class="k">for </span>Docker   <span class="nb">true</span>
</code></pre></div></div>

<p>The following examples show how to create swarm services that require data
persistence using the <code class="highlighter-rouge">--mount</code> flag and specifying Cloudstor as the volume
driver.</p>

<h3 id="share-the-same-volume-among-tasks-using-efs">Share the same volume among tasks using EFS</h3>

<p>In those regions where EFS is supported and EFS support is enabled during
deployment of the Cloud Formation template, you can use <code class="highlighter-rouge">shared</code> Cloudstor
volumes to share access to persistent data across all tasks in a swarm service
running in multiple nodes, as in the following example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker service create <span class="se">\</span>
  <span class="nt">--replicas</span> 5 <span class="se">\</span>
  <span class="nt">--name</span> ping1 <span class="se">\</span>
  <span class="nt">--mount</span> <span class="nb">type</span><span class="o">=</span>volume,volume-driver<span class="o">=</span>cloudstor:aws,source<span class="o">=</span>sharedvol1,destination<span class="o">=</span>/shareddata <span class="se">\</span>
  alpine ping docker.com
</code></pre></div></div>

<p>All replicas/tasks of the service <code class="highlighter-rouge">ping1</code> share the same persistent volume
<code class="highlighter-rouge">sharedvol1</code> mounted at <code class="highlighter-rouge">/shareddata</code> path within the container. Docker takes
care of interacting with the Cloudstor plugin to ensure that EFS is mounted on
all nodes in the swarm where service tasks are scheduled. Your application needs
to be designed to ensure that tasks do not write concurrently on the same file
at the same time, to protect against data corruption.</p>

<p>You can verify that the same volume is shared among all the tasks by logging
into one of the task containers, writing a file under <code class="highlighter-rouge">/shareddata/</code>, and
logging into another task container to verify that the file is available there
as well.</p>

<p>The only option available for EFS is <code class="highlighter-rouge">perfmode</code>. You can set <code class="highlighter-rouge">perfmode</code> to
<code class="highlighter-rouge">maxio</code> for high IO throughput:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker service create <span class="se">\</span>
  <span class="nt">--replicas</span> 5 <span class="se">\</span>
  <span class="nt">--name</span> ping3 <span class="se">\</span>
  <span class="nt">--mount</span> <span class="nb">type</span><span class="o">=</span>volume,volume-driver<span class="o">=</span>cloudstor:aws,source<span class="o">={{</span>.Service.Name<span class="o">}}</span>-<span class="o">{{</span>.Task.Slot<span class="o">}}</span><span class="nt">-vol5</span>,destination<span class="o">=</span>/mydata,volume-opt<span class="o">=</span><span class="nv">perfmode</span><span class="o">=</span>maxio <span class="se">\</span>
  alpine ping docker.com
</code></pre></div></div>

<p>You can also create <code class="highlighter-rouge">shared</code> Cloudstor volumes using the
<code class="highlighter-rouge">docker volume create</code> CLI:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker volume create <span class="nt">-d</span> <span class="s2">"cloudstor:aws"</span> <span class="nt">--opt</span> <span class="nv">backing</span><span class="o">=</span>shared mysharedvol1
</code></pre></div></div>

<h3 id="use-a-unique-volume-per-task-using-ebs">Use a unique volume per task using EBS</h3>

<p>If EBS is available and enabled, you can use a templatized notation with the
<code class="highlighter-rouge">docker service create</code> CLI to create and mount a unique <code class="highlighter-rouge">relocatable</code> Cloudstor
volume backed by a specified type of EBS for each task in a swarm service. New
EBS volumes typically take a few minutes to be created. Besides
<code class="highlighter-rouge">backing=relocatable</code>, the following volume options are available:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Option</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">size</code></td>
      <td style="text-align: left">Required parameter that indicates the size of the EBS volumes to create in GB.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ebstype</code></td>
      <td style="text-align: left">Optional parameter that indicates the type of the EBS volumes to create (<code class="highlighter-rouge">gp2</code>, <code class="highlighter-rouge">io1</code>, <code class="highlighter-rouge">st1</code>, <code class="highlighter-rouge">sc1</code>}. The default <code class="highlighter-rouge">ebstype</code> is Standard/Magnetic. For further details about EBS volume types, see the <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSVolumeTypes.html">EBS volume type documentation</a>.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">iops</code></td>
      <td style="text-align: left">Required if <code class="highlighter-rouge">ebstype</code> specified is <code class="highlighter-rouge">io1</code>, which enables provisioned IOPs. Needs to be in the appropriate range as required by EBS.</td>
    </tr>
  </tbody>
</table>

<p>Example usage:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker service create <span class="se">\</span>
  <span class="nt">--replicas</span> 5 <span class="se">\</span>
  <span class="nt">--name</span> ping3 <span class="se">\</span>
  <span class="nt">--mount</span> <span class="nb">type</span><span class="o">=</span>volume,volume-driver<span class="o">=</span>cloudstor:aws,source<span class="o">={{</span>.Service.Name<span class="o">}}</span>-<span class="o">{{</span>.Task.Slot<span class="o">}}</span><span class="nt">-vol</span>,destination<span class="o">=</span>/mydata,volume-opt<span class="o">=</span><span class="nv">backing</span><span class="o">=</span>relocatable,volume-opt<span class="o">=</span><span class="nv">size</span><span class="o">=</span>25,volume-opt<span class="o">=</span><span class="nv">ebstype</span><span class="o">=</span>gp2 <span class="se">\</span>
  alpine ping docker.com
</code></pre></div></div>

<p>The above example creates and mounts a distinct Cloudstor volume backed by 25 GB EBS
volumes of type <code class="highlighter-rouge">gp2</code> for each task of the <code class="highlighter-rouge">ping3</code> service. Each task mounts its
own volume at <code class="highlighter-rouge">/mydata/</code> and all files under that mountpoint are unique to the
task mounting the volume.</p>

<p>It is highly recommended that you use the <code class="highlighter-rouge">.Task.Slot</code> template to ensure that
task <code class="highlighter-rouge">N</code> always gets access to volume <code class="highlighter-rouge">N</code>, no matter which node it is executing
on/scheduled to. The total number of EBS volumes in the swarm should be kept
below <code class="highlighter-rouge">12 * (minimum number of nodes that are expected to be present at any
time)</code> to ensure that EC2 can properly attach EBS volumes to a node when another
node fails. Use EBS volumes only for those workloads where low latency and high
IOPs is absolutely necessary.</p>

<p>You can also create EBS backed volumes using the <code class="highlighter-rouge">docker volume create</code> CLI:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker volume create <span class="se">\</span>
  <span class="nt">-d</span> <span class="s2">"cloudstor:aws"</span> <span class="se">\</span>
  <span class="nt">--opt</span> <span class="nv">ebstype</span><span class="o">=</span>io1 <span class="se">\</span>
  <span class="nt">--opt</span> <span class="nv">size</span><span class="o">=</span>25 <span class="se">\</span>
  <span class="nt">--opt</span> <span class="nv">iops</span><span class="o">=</span>1000 <span class="se">\</span>
  <span class="nt">--opt</span> <span class="nv">backing</span><span class="o">=</span>relocatable <span class="se">\</span>
  mylocalvol1
</code></pre></div></div>

<p>Sharing the same <code class="highlighter-rouge">relocatable</code> Cloudstor volume across multiple tasks of a
service or across multiple independent containers is not supported when
<code class="highlighter-rouge">backing=relocatable</code> is specified. Attempting to do so results in IO errors.</p>

<h3 id="use-a-unique-volume-per-task-using-efs">Use a unique volume per task using EFS</h3>

<p>If EFS is available and enabled, you can use templatized notation to create and
mount a unique EFS-backed volume into each task of a service. This is useful if
you already have too many EBS volumes or want to reduce the amount of time it
takes to transfer volume data across availability zones.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker service create <span class="se">\</span>
  <span class="nt">--replicas</span> 5 <span class="se">\</span>
  <span class="nt">--name</span> ping2 <span class="se">\</span>
  <span class="nt">--mount</span> <span class="nb">type</span><span class="o">=</span>volume,volume-driver<span class="o">=</span>cloudstor:aws,source<span class="o">={{</span>.Service.Name<span class="o">}}</span>-<span class="o">{{</span>.Task.Slot<span class="o">}}</span><span class="nt">-vol</span>,destination<span class="o">=</span>/mydata <span class="se">\</span>
  alpine ping docker.com
</code></pre></div></div>

<p>Here, each task has mounted its own volume at <code class="highlighter-rouge">/mydata/</code> and the files under
that mountpoint are unique to that task.</p>

<p>When a task with only <code class="highlighter-rouge">shared</code> EFS volumes mounted is rescheduled on a different
node, Docker interacts with the Cloudstor plugin to create and mount the volume
corresponding to the task on the node where the task is rescheduled. Since data
on EFS is available to all swarm nodes and can be quickly mounted and accessed,
the rescheduling process for tasks using EFS-backed volumes typically takes a
few seconds, as compared to several minutes when using EBS.</p>

<p>It is highly recommended that you use the <code class="highlighter-rouge">.Task.Slot</code> template to ensure that
task <code class="highlighter-rouge">N</code> always gets access to volume <code class="highlighter-rouge">N</code> no matter which node it is executing
on/scheduled to.</p>

<h3 id="list-or-remove-volumes-created-by-cloudstor">List or remove volumes created by Cloudstor</h3>

<p>You can use <code class="highlighter-rouge">docker volume ls</code> on any node to enumerate all volumes created by
Cloudstor across the swarm.</p>

<p>You can use <code class="highlighter-rouge">docker volume rm [volume name]</code> to remove a Cloudstor volume from
any node. If you remove a volume from one node, make sure it is not being used
by another active node, since those tasks/containers in another node lose
access to their data.</p>

<p>Before deleting a Docker4AWS stack through CloudFormation, you should remove all
<code class="highlighter-rouge">relocatable</code> Cloudstor volumes using <code class="highlighter-rouge">docker volume rm</code> from within the stack.
EBS volumes corresponding to <code class="highlighter-rouge">relocatable</code> Cloudstor volumes are not
automatically deleted as part of the CloudFormation stack deletion. To list any
<code class="highlighter-rouge">relocatable</code> Cloudstor volumes and delete them after removing the Docker4AWS
stack where the volumes were created, go to the AWS portal or CLI and set a
filter with tag key set to <code class="highlighter-rouge">StackID</code> and the tag value set to the md5 hash of
the CloudFormation Stack ID (typical format:
<code class="highlighter-rouge">arn:aws:cloudformation:us-west-2:ID:stack/swarmname/GUID</code>).</p>

							<!-- tags -->
							
							
							
							<span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span style="vertical-align: 2px"><a href="https://matsuand.github.io/docs.docker.jp.onthefly/glossary/?term=aws persistent data volumes">aws persistent data volumes</a></span>
							
							<!-- link corrections -->
              <script language="JavaScript">
							var x = document.links.length;
							var baseHref = document.getElementsByTagName('base')[0].href
							for (i = 0; i < x; i++) {
							  var munged = false;
							  var thisHREF = document.links[i].href;
							  var originalURL = "/docker-for-aws/persistent-data-volumes/";
							  if (thisHREF.indexOf(baseHref + "#") > -1) {
							    // hash fix
							    //console.log('BEFORE: base:',baseHref,'thisHREF:',thisHREF,'originalURL:',originalURL);
							    thisHREF = originalURL + thisHREF.replace(baseHref, "");
							    //console.log('AFTER: base:',baseHref,'thisHREF:',thisHREF,'originalURL:',originalURL);
							  }
							  if ((thisHREF.indexOf(window.location.hostname) > -1 || thisHREF.indexOf('http') == -1) && document.links[i].className.indexOf("nomunge") < 0) {
							    munged = true;
							    thisHREF = thisHREF.replace(".md", "/").replace("/index/", "/");
							    document.links[i].setAttribute('href', thisHREF);
							  }
							}
							</script>
							
						  <div id="ratings-div" style="color:#b9c2cc; text-align: center; margin-top: 150px; visibility: hidden">
								<div id="pd_rating_holder_8453675"></div>
								<script type="text/javascript">
									PDRTJS_settings_8453675 = {
										"id": "8453675",
										"unique_id": "docker-for-aws/persistent-data-volumes.md",
										"title": "Docker for AWS persistent data volumes",
										"permalink": "https://github.com/docker/docker.github.io/blob/master/docker-for-aws/persistent-data-volumes.md"
									};
									(function(d, c, j) {
										if (!document.getElementById(j)) {
											var pd = d.createElement(c),
												s;
											pd.id = j;
											pd.src = ('https:' == document.location.protocol) ? 'https://polldaddy.com/js/rating/rating.js' : 'http://i0.poll.fm/js/rating/rating.js';
											s = document.getElementsByTagName(c)[0];
											s.parentNode.insertBefore(pd, s);
										}
									}(document, 'script', 'pd-rating-js'));
								</script>
							</div>
							
						</section>
					</main>
					<nav class="col-nav">
						<div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
						<div id="navbar" class="nav-sidebar">
    <ul class="nav" id="jsTOCLeftNav">
    </ul>
</div>

						</div>
					</nav>
					<div class="col-toc">
							<div class="sidebar hidden-xs hidden-sm">
							<div class="toc-nav">
								<div class="feedback-links">
									<ul>
										
										<li style="visibility: hidden"><a href="https://github.com/matsuand/docs.docker.jp/edit/v18.09.local/docker-for-aws/persistent-data-volumes.md"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> このページの編集</a></li>
										<li><a href="https://github.com/matsuand/docs.docker.jp/issues/new?body=File: [docker-for-aws/persistent-data-volumes.md](https://matsuand.github.io/docs.docker.jp.onthefly/docker-for-aws/persistent-data-volumes/)"
															class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> 文書変更のリクエスト</a></li>
										<li><a href="https://success.docker.com/support"><i class="fa fa-question" aria-hidden="true"></i> サポート依頼</a></li>
										<!-- toggle mode -->
										<li>
											<div class="toggle-mode">
												<div class="icon">
													<i class="fa fa-sun-o" aria-hidden="true"></i>
												</div>
												<div class="toggle-switch">
													<label class="switch">
														<input type="checkbox" id="switch-style">
														<div class="slider round"></div>
												</label>
												</div>
												<div class="icon">
													<i class="fa fa-moon-o" aria-hidden="true"></i>
												</div>
											</div>
										</li>
									</ul>
								</div>
								   
									<div id="side-toc-title">本ページ内</div>
									
<ul id="my_toc" class="inline_toc">
  <li><a href="#what-is-cloudstor" class="nomunge">What is Cloudstor?</a></li>
  <li><a href="#relocatable-cloudstor-volumes" class="nomunge">Relocatable Cloudstor volumes</a></li>
  <li><a href="#shared-cloudstor-volumes" class="nomunge">Shared Cloudstor volumes</a></li>
  <li><a href="#use-cloudstor" class="nomunge">Use Cloudstor</a>
    <ul>
      <li><a href="#share-the-same-volume-among-tasks-using-efs" class="nomunge">Share the same volume among tasks using EFS</a></li>
      <li><a href="#use-a-unique-volume-per-task-using-ebs" class="nomunge">Use a unique volume per task using EBS</a></li>
      <li><a href="#use-a-unique-volume-per-task-using-efs" class="nomunge">Use a unique volume per task using EFS</a></li>
      <li><a href="#list-or-remove-volumes-created-by-cloudstor" class="nomunge">List or remove volumes created by Cloudstor</a></li>
    </ul>
  </li>
</ul>


								</div>
								
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	
	<footer class="footer">
		  
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/what-docker">What is Docker</a></li>
                        <li><a href="https://www.docker.com/what-container">What is a Container</a></li>
                        <li><a href="https://www.docker.com/use-cases">Use Cases</a></li>
                        <li><a href="https://www.docker.com/customers">Customers</a></li>
                        <li><a href="https://www.docker.com/partners/partner-program">Partners</a></li>
                        <li class="break"><a href="https://www.docker.com/industry-government">For Government</a></li>
                        <li><a href="https://www.docker.com/company">About Docker</a></li>
                        <li><a href="https://www.docker.com/company/management">Management</a></li>
                        <li><a href="https://www.docker.com/company/news-and-press">Press &amp; News</a></li>
                        <li><a href="https://www.docker.com/careers">Careers</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/products/overview">Product</a></li>
                        <li><a href="https://www.docker.com/pricing">Pricing</a></li>
                        <li><a href="https://www.docker.com/docker-community">Community Edition</a></li>
                        <li class="break"><a href="https://www.docker.com/enterprise">Enterprise Edition </a></li>
                        <li><a href="https://www.docker.com/products/docker-datacenter">Docker Datacenter</a></li>
                        <li><a href="https://hub.docker.com/">Docker Hub</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/">Documentation</a></li>
                        <li><a href="https://www.docker.com/docker">Learn</a></li>
                        <li><a href="https://blog.docker.com" target="_blank">Blog</a></li>
                        <li><a href="https://engineering.docker.com" target="_blank">Engineering Blog</a></li>
                        <li><a href="https://training.docker.com/" target="_blank">Training</a></li>
                        <li><a href="https://success.docker.com/support">Support</a></li>
                        <li><a href="https://success.docker.com/kbase">Knowledge Base</a></li>
                        <li><a href="https://www.docker.com/products/resources">Resources</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/docker-community">Community</a></li>
                        <li><a href="https://www.docker.com/technologies/overview">Open Source</a></li>
                        <li><a href="https://www.docker.com/community/events">Events</a></li>
                        <li><a href="https://forums.docker.com/" target="_blank">Forums</a></li>
                        <li><a href="https://www.docker.com/community/docker-captains">Docker Captains</a></li>
                        <li><a href="https://www.docker.com/docker-community/scholarships">Scholarships</a></li>
                        <li><a href="https://blog.docker.com/curated/">Community News</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="http://status.docker.com/">Status</a></li>
                        <li><a href="https://www.docker.com/docker-security">Security</a></li>
                        <li><a href="https://www.docker.com/legal">Legal</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2019 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="http://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="http://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-google-plus"><a href="https://plus.google.com/u/0/communities/108146856671494713993">Google</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker/docker">Github</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-reddit"><a href="http://www.reddit.com/r/docker">Reddit</a></li>
                    <li class="fa fa-slideshare"><a href="http://www.slideshare.net/docker">Slideshare</a></li>
                </ul>
            </div>
        </div>
    </div>

	</footer>
	<link rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/github.css">
	
	<!-- <script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/anchorlinks.js"></script> -->
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/menu.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/jquery.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/bootstrap.min.js"></script>
	<!-- Always include the archive.js, but it doesn't do much unless we are an archive -->
	<script language="javascript">
	// Default to assuming this is an archive and hiding some stuff
	// See js/archive.js and js/docs.js for logic relating to this
	var isArchive = true;
	var dockerVersion = 'v18.09';
	// In archives, we need to know the page root and we get it from JEKYLL_ENV in the jekyll build command
	var jekyllEnv = 'development';
	// If unset (in non-archive branches), defaults to "development". In that case, reset it to empty
	if (jekyllEnv == 'development') {
		jekyllEnv = '';
	}
	var pageURL = jekyllEnv + '/docker-for-aws/persistent-data-volumes/';
	</script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/archive.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/stickyfill.min.js"></script>
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/metadata.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/glossary.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/collections_tocs.js"></script>
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/docs.js"></script>
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/toc.js"></script>
	<script language="javascript">
	jQuery(document).ready(function(){
				hookupTOCEvents();
			});
	</script>
</body>

</html>
