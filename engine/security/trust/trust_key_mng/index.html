<!-- Page generated 2020-04-29 22:26:41 +0900 -->
<!-- Logic for 'edit this button'


    

    

    

    

    

    

    

    

-->
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <style type="text/css">
        @charset "UTF-8";
        [ng\:cloak],
        [ng-cloak],
        [data-ng-cloak],
        [x-ng-cloak],
        .ng-cloak,
        .x-ng-cloak,
        .ng-hide:not(.ng-hide-animate) {
            display: none !important;
        }

        ng\:form {
            display: block;
        }
    </style>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-WL2QLG5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- favicon -->
    <link rel="icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
    <meta name="msapplication-TileImage" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico">
    <link rel="apple-touch-icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
    <meta property="og:image" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico"/>
    <!-- metadata -->
    <meta property="og:type" content="website"/>
    <meta property="og:updated_time" itemprop="dateUpdated" content="2020-04-29T22:26:41+09:00"/>
    <meta property="og:image" itemprop="image primaryImageOfPage" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:domain" content="docs.docker.com"/>
    <meta name="twitter:site" content="@docker_docs"/>
    <meta name="twitter:url" content="https://twitter.com/docker_docs"/>
    <meta name="twitter:title" itemprop="title name" content="Manage keys for content trust"/>
    <meta name="twitter:description" property="og:description" itemprop="description" content="Trust for an image tag is managed through the use of keys. Docker’s content trust makes use of five different types of keys: Key Description root key Root of content..." />
    <meta name="twitter:image:src" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
    <meta name="twitter:image:alt" content="Docker ドキュメント"/>
    <meta property="article:published_time" itemprop="datePublished" content="2020-04-29T22:26:41+09:00"/>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="trust, security, root,  keys, repository">
    <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/font-awesome.min.css">
    <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/bootstrap.min.css">
    <link id="pygments" rel="stylesheet" href="/docs.docker.jp.onthefly/css/pygments/perldoc.css">
    <link id="pagestyle" rel="stylesheet" href="/docs.docker.jp.onthefly/css/style.css">

    <!-- Go get "Open Sans" font from Google -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <!-- SEO stuff -->
    <title>Manage keys for content trust | Docker ドキュメント</title>
    <meta property="og:title" content="Manage keys for content trust" />
    <meta property="og:locale" content="ja_JP" />
    <meta name="description" content="Manage keys for content trust" />
    <meta property="og:description" content="Manage keys for content trust" />
    <link rel="canonical" href="/docs.docker.jp.onthefly/engine/security/trust/trust_key_mng/" />
    <meta property="og:url" content="https://matsuand.github.io/docs.docker.jp.onthefly/engine/security/trust/trust_key_mng/" />
    <meta property="og:site_name" content="Docker ドキュメント" />
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"WebPage","headline":"Manage keys for content trust","description":"Manage keys for content trust","url":"https://docs.docker.com/engine/security/trust/trust_key_mng/"}</script>
    <!-- END SEO STUFF -->
    
    <script>
    // Default to assuming this is an archive and hiding some stuff
    // See js/archive.js and js/docs.js for logic relating to this
    var isArchive = true;
    var dockerVersion = 'v19.03';
    </script>
</head>
<body ng-app="Docker" ng-controller="DockerController" class="colums">
    <header>
        
            <nav class="nav-secondary navbar navbar-fixed-top">
    <!-- <div class="fan"></div> -->
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="/docs.docker.jp.onthefly/"><img class="logo" src="/docs.docker.jp.onthefly/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs"></a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="search-form" id="search-div" style="visibility: hidden">
    <form class="search-form form-inline ng-pristine ng-valid" id="searchForm" action="https://matsuand.github.io/docs.docker.jp.onthefly/search/">
        <input class="search-field form-control ds-input" id="st-search-input" value="" name="q" placeholder="文書内検索" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteContainer">
            <div id="autocompleteResults"></div>
        </div>
        <!-- <button type="submit" class="search-submit btn btn-default">検索</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container">
    <div id="tabs">
        <ul class="tabs" id="jsTOCHorizontal">

        </ul>
    </div>
    <div class="ctrl-right hidden-xs hidden-sm">
        <a href="javascript:void(0)" id="menu-toggle"><i class="fa fa-indent" aria-hidden="true"></i></a>
        <div class="btn-group" style="visibility: hidden">
  <button type="button" class="btn btn-default dropdown-btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Docker v19.03 (最新)     <span class="caret"></span>
  </button>
  <ul class="dropdown-menu">
    <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v18.09/">Docker v18.09</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v18.03/">Docker v18.03</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.06/">Docker v17.06</a></li>
  </ul>
</div>

    </div>
</div>

        </div>
    </div>
</nav>

        
    </header>
    <div class="wrapper right-open">
        <div class="container-fluid">
            <div class="row">
                <div class="col-body">
                    <main class="col-content content">
                        <section class="section">
                            
                                
                            <h1>Manage keys for content trust</h1>  <span class="reading-time" title="Estimated reading time">
  <span class="reading-time-label">読む時間の目安: </span>
  
  
    4 分
  
</span>

                            
                            
                            <p>Trust for an image tag is managed through the use of keys. Docker’s content
trust makes use of five different types of keys:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Key</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">root key</td>
      <td style="text-align: left">Root of content trust for an image tag. When content trust is enabled, you create the root key once. Also known as the offline key, because it should be kept offline.</td>
    </tr>
    <tr>
      <td style="text-align: left">targets</td>
      <td style="text-align: left">This key allows you to sign image tags, to manage delegations including delegated keys or permitted delegation paths. Also known as the repository key, since this key determines what tags can be signed into an image repository.</td>
    </tr>
    <tr>
      <td style="text-align: left">snapshot</td>
      <td style="text-align: left">This key signs the current collection of image tags, preventing mix and match attacks.</td>
    </tr>
    <tr>
      <td style="text-align: left">timestamp</td>
      <td style="text-align: left">This key allows Docker image repositories to have freshness security guarantees without requiring periodic content refreshes on the client’s side.</td>
    </tr>
    <tr>
      <td style="text-align: left">delegation</td>
      <td style="text-align: left">Delegation keys are optional tagging keys and allow you to delegate signing image tags to other publishers without having to share your targets key.</td>
    </tr>
  </tbody>
</table>

<p>When doing a <code class="highlighter-rouge">docker push</code> with Content Trust enabled for the first time, the
root, targets, snapshot, and timestamp keys are generated automatically for
the image repository:</p>

<ul>
  <li>
    <p>The root and targets key are generated and stored locally client-side.</p>
  </li>
  <li>
    <p>The timestamp and snapshot keys are safely generated and stored in a signing server
  that is deployed alongside the Docker registry. These keys are generated in a backend
  service that isn’t directly exposed to the internet and are encrypted at rest.</p>
  </li>
</ul>

<p>Delegation keys are optional, and not generated as part of the normal <code class="highlighter-rouge">docker</code>
workflow.  They need to be
<a href="/docs.docker.jp.onthefly/engine/security/trust/trust_delegation/#creating-delegation-keys">manually generated and added to the repository</a>.</p>

<p><strong>Note</strong>: Prior to Docker Engine 1.11, the snapshot key was also generated and stored
locally client-side.
Use the Notary CLI to <a href="/docs.docker.jp.onthefly/notary/advanced_usage/#rotate-keys">manage your snapshot key locally again</a>
for repositories created with newer versions of Docker.</p>

<h2 id="choose-a-passphrase">Choose a passphrase</h2>

<p>The passphrases you chose for both the root key and your repository key should
be randomly generated and stored in a password manager. Having the repository key
allows users to sign image tags on a repository. Passphrases are used to encrypt
your keys at rest and ensure that a lost laptop or an unintended backup doesn’t
put the private key material at risk.</p>

<h2 id="back-up-your-keys">Back up your keys</h2>

<p>All the Docker trust keys are stored encrypted using the passphrase you provide
on creation. Even so, you should still take care of the location where you back them up.
Good practice is to create two encrypted USB keys.</p>

<p>It is very important that you back up your keys to a safe, secure location. Loss
of the repository key is recoverable; loss of the root key is not.</p>

<p>The Docker client stores the keys in the <code class="highlighter-rouge">~/.docker/trust/private</code> directory.
Before backing them up, you should <code class="highlighter-rouge">tar</code> them into an archive:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">umask </span>077<span class="p">;</span> <span class="nb">tar</span> <span class="nt">-zcvf</span> private_keys_backup.tar.gz ~/.docker/trust/private<span class="p">;</span> <span class="nb">umask </span>022
</code></pre></div></div>

<h2 id="hardware-storage-and-signing">Hardware storage and signing</h2>

<p>Docker Content Trust can store and sign with root keys from a Yubikey 4. The
Yubikey is prioritized over keys stored in the filesystem. When you initialize a
new repository with content trust, Docker Engine looks for a root key locally. If a
key is not found and the Yubikey 4 exists, Docker Engine creates a root key in the
Yubikey 4. Consult the <a href="/docs.docker.jp.onthefly/notary/advanced_usage/#use-a-yubikey">Notary documentation</a>
for more details.</p>

<p>Prior to Docker Engine 1.11, this feature was only in the experimental branch.</p>

<h2 id="lost-keys">Lost keys</h2>

<p>If a publisher loses keys it means losing the ability to sign trusted content for
your repositories.  If you lose a key, send an email to <a href="mailto:hub-support@docker.com">Docker Hub
Support</a> to reset the repository
state.</p>

<p>This loss also requires <strong>manual intervention</strong> from every consumer that pulled
the tagged image prior to the loss. Image consumers would get an error for
content that they already downloaded:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Warning: potential malicious behavior - trust data has insufficient signatures for remote repository docker.io/my/image: valid signatures did not meet threshold
</code></pre></div></div>

<p>To correct this, they need to download a new image tag that is signed with
the new key.</p>

<h2 id="related-information">Related information</h2>

<ul>
  <li><a href="/docs.docker.jp.onthefly/engine/security/trust/content_trust/">Content trust in Docker</a></li>
  <li><a href="/docs.docker.jp.onthefly/engine/security/trust/trust_automation/">Automation with content trust</a></li>
  <li><a href="/docs.docker.jp.onthefly/engine/security/trust/trust_delegation/">Delegations for content trust</a></li>
  <li><a href="/docs.docker.jp.onthefly/engine/security/trust/trust_sandbox/">Play in a content trust sandbox</a></li>
</ul>

                            <!-- tags -->
                            
                                <span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span style="vertical-align: 2px"><a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=trust">trust</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=security">security</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=root">root</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=keys">keys</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=repository">repository</a></span>
                                
                            
                            <div id="ratings-div" style="color:#b9c2cc; text-align: center; margin-top: 150px; visibility: hidden">
                                <div id="pd_rating_holder_8453675"></div>
                                <script type="text/javascript">
                                    PDRTJS_settings_8453675 = {
                                        "id": "8453675",
                                        "unique_id": "engine/security/trust/trust_key_mng.md",
                                        "title": "Manage keys for content trust",
                                        "permalink": "https://github.com/docker/docker.github.io/blob/master/engine/security/trust/trust_key_mng.md"
                                    };
                                    (function(d, c, j) {
                                        if (!document.getElementById(j)) {
                                            var pd = d.createElement(c),
                                                s;
                                            pd.id = j;
                                            pd.src = ('https:' == document.location.protocol) ? 'https://polldaddy.com/js/rating/rating.js' : 'http://i0.poll.fm/js/rating/rating.js';
                                            s = document.getElementsByTagName(c)[0];
                                            s.parentNode.insertBefore(pd, s);
                                        }
                                    }(document, 'script', 'pd-rating-js'));
                                </script>
                            </div>
                            
                        </section>
                    </main>
                    <nav class="col-nav">
                        <div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
                        <div id="navbar" class="nav-sidebar">
    <ul class="nav" id="jsTOCLeftNav">
    </ul>
</div>

                        </div>
                    </nav>
                    <div class="col-toc">
                        <div class="sidebar hidden-xs hidden-sm">
                            <div class="toc-nav">
                                <div class="feedback-links">
                                    <ul>
                                        
                                        <li style="visibility: hidden"><a href="https://github.com/matsuand/docs.docker.jp/edit/v19.03.local/engine/security/trust/trust_key_mng.md"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> このページの編集</a></li>
                                        <li><a href="https://github.com/docker/docker.github.io/issues/new?body=File: [engine/security/trust/trust_key_mng.md](https://docs.docker.com/engine/security/trust/trust_key_mng/)"
                                                            class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> 文書変更のリクエスト</a></li>
                                        <!-- toggle mode -->
                                        <li>
                                            <div class="toggle-mode">
                                                <div class="icon">
                                                    <i class="fa fa-sun-o" aria-hidden="true"></i>
                                                </div>
                                                <div class="toggle-switch">
                                                    <label class="switch">
                                                        <input type="checkbox" id="switch-style">
                                                        <div class="slider round"></div>
                                                </label>
                                                </div>
                                                <div class="icon">
                                                    <i class="fa fa-moon-o" aria-hidden="true"></i>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                                   
                                <div id="side-toc-title">本ページ内:</div>
                                    
<ul id="my_toc" class="inline_toc">
  <li><a href="#choose-a-passphrase" class="nomunge">Choose a passphrase</a></li>
  <li><a href="#back-up-your-keys" class="nomunge">Back up your keys</a></li>
  <li><a href="#hardware-storage-and-signing" class="nomunge">Hardware storage and signing</a></li>
  <li><a href="#lost-keys" class="nomunge">Lost keys</a></li>
  <li><a href="#related-information" class="nomunge">Related information</a></li>
</ul>


                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    
    <footer class="footer">
          
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/why-docker">Why Docker</a></b></li>
                        <li><a href="https://www.docker.com/what-container">What is a Container</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/overview">Products</a></b></li>
                        <li><a href="https://www.docker.com/products/docker-desktop">Docker Desktop</a></li>
                        <li><a href="https://www.docker.com/products/docker-hub">Docker Hub</a></li>
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Features</a></b></li>
                        <li><a href="https://www.docker.com/products/container-runtime">Container Runtime</a></li>
                        <li><a href="https://www.docker.com/products/developer-tools">Developer Tools</a></li>
                        <li><a href="https://www.docker.com/products/kubernetes">Kubernetes</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Developers</a></b></li>
                        <li><a href="https://www.docker.com/use-cases">Use Cases</a></li>
                        <li><a href="https://www.docker.com/play-with-docker">Play with Docker</a></li>
                        <li><a href="https://www.docker.com/docker-community">Community</a></li>
                        <li><a href="https://www.docker.com/open-source">Open Source</a></li>
                        <li><a href="https://www.docker.com/community/docker-captains">Docker Captains</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/company" target="_blank">Company</a></b></li>
                        <li><a href="https://www.docker.com/company">About Us</a></li>
                        <li><a href="https://www.docker.com/blog/" target="_blank">Blog</a></li>
                        <li><a href="https://www.docker.com/customers">Customers</a></li>
                        <li><a href="https://www.docker.com/partners">Partners</a></li>
                        <li><a href="https://www.docker.com/company/newsroom">Newsroom</a></li>
                        <li><a href="https://www.docker.com/careers">Careers</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact Us</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="http://status.docker.com/">Status</a></li>
                        <li><a href="https://www.docker.com/docker-security">Security</a></li>
                        <li><a href="https://www.docker.com/legal">Legal</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2013-2020 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="http://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="http://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker">GitHub</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-slideshare"><a href="https://www.slideshare.net/docker">Slideshare</a></li>
                    <li class="fa fa-reddit"><a href="https://www.reddit.com/r/docker">Reddit</a></li>
                </ul>
            </div>
        </div>
    </div>

    </footer>
    <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/github.css">
    
    <script defer src="/docs.docker.jp.onthefly/js/anchorlinks.js"></script>
    <script defer src="/docs.docker.jp.onthefly/js/menu.js"></script>
    <script src="/docs.docker.jp.onthefly/js/jquery.js"></script>
    <script src="/docs.docker.jp.onthefly/js/bootstrap.min.js"></script>
    <!-- Always include the archive.js, but it doesn't do much unless we are an archive -->
    <script>
    // Default to assuming this is an archive and hiding some stuff
    // See js/archive.js and js/docs.js for logic relating to this
    var isArchive = true;
    var dockerVersion = 'v19.03';
    // In archives, we need to know the page root and we get it from JEKYLL_ENV in the jekyll build command
    var jekyllEnv = 'development';
    // If unset (in non-archive branches), defaults to "development". In that case, reset it to empty
    if (jekyllEnv === 'development') {
        jekyllEnv = '';
    }
    var pageURL = jekyllEnv + '/engine/security/trust/trust_key_mng/';
    </script>
    <script src="/docs.docker.jp.onthefly/js/archive.js"></script>
    <script src="/docs.docker.jp.onthefly/js/stickyfill.min.js"></script>
    <script defer src="/docs.docker.jp.onthefly/js/metadata.js"></script>
    <script src="/docs.docker.jp.onthefly/js/glossary.js"></script>
    <script defer src="/docs.docker.jp.onthefly/js/docs.js"></script>
    <script defer src="/docs.docker.jp.onthefly/js/toc.js"></script>
    <script>
    jQuery(document).ready(function(){hookupTOCEvents();});
    </script>
</body>
</html>
