<!-- Page generated 2020-05-15 21:58:22 +0900 -->
<!-- Logic for 'edit this button'


    

    

    

    

    

    

    

    

-->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <style type="text/css">
      @charset "UTF-8";
      [ng\:cloak],
      [ng-cloak],
      [data-ng-cloak],
      [x-ng-cloak],
      .ng-cloak,
      .x-ng-cloak,
      .ng-hide:not(.ng-hide-animate) {
          display: none !important;
      }

      ng\:form {
          display: block;
      }
  </style>
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-WL2QLG5');</script>
  <!-- End Google Tag Manager -->
  
  <!-- favicon -->
  <link rel="icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
  <meta name="msapplication-TileImage" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico">
  <link rel="apple-touch-icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
  <meta property="og:image" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico"/>
  <!-- metadata -->
  <meta property="og:type" content="website"/>
  <meta property="og:updated_time" itemprop="dateUpdated" content="2020-05-15T21:58:22+09:00"/>
  <meta property="og:image" itemprop="image primaryImageOfPage" content="/images/docs@2x.png"/>
  <meta name="twitter:card" content="summary"/>
  <meta name="twitter:domain" content="docs.docker.com"/>
  <meta name="twitter:site" content="@docker_docs"/>
  <meta name="twitter:url" content="https://twitter.com/docker_docs"/>
  <meta name="twitter:title" itemprop="title name" content="Deploy the application"/>
  <meta name="twitter:description" property="og:description" itemprop="description" content="You’ve deployed the load balancer, the discovery backend, and a swarm cluster so now you can build and deploy the voting application itself. You do this by starting a number..." />
  <meta name="twitter:image:src" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
  <meta name="twitter:image:alt" content="Docker Documentation"/>
  <meta property="article:published_time" itemprop="datePublished" content="2020-05-15T21:58:22+09:00"/>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="docker, swarm, scale, voting, application, certificates">
  <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/font-awesome.min.css">
  <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/bootstrap.min.css">
  <link id="pygments" rel="stylesheet" href="/docs.docker.jp.onthefly/css/pygments/perldoc.css">
  <link id="pagestyle" rel="stylesheet" href="/docs.docker.jp.onthefly/css/style.css">

  <!-- Go get "Open Sans" font from Google -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
  <!-- SEO stuff -->
  <title>Deploy the application | Docker Documentation</title>
  <meta property="og:title" content="Deploy the application" />
  <meta property="og:locale" content="ja_JP" />
  <meta name="description" content="Try swarm at scale" />
  <meta property="og:description" content="Try swarm at scale" />
  <link rel="canonical" href="/swarm/swarm_at_scale/deploy-app/" />
  <meta property="og:url" content="https://docs.docker.com/swarm/swarm_at_scale/deploy-app/" />
  <meta property="og:site_name" content="Docker ドキュメント" />
  <script type="application/ld+json">{"@context":"http://schema.org","@type":"WebPage","headline":"Deploy the application","description":"Try swarm at scale","url":"https://docs.docker.com/swarm/swarm_at_scale/deploy-app/"}</script>
  <!-- END SEO STUFF -->
  
  <script>
  // Default to assuming this is an archive and hiding some stuff
  // See js/archive.js and js/docs.js for logic relating to this
  var isArchive = true;
  var dockerVersion = 'v19.03';
  </script>
</head>


    <body ng-app="Docker" ng-controller="DockerController" class="colums">
    <header>
        <nav class="nav-secondary navbar navbar-fixed-top">
    <!-- <div class="fan"></div> -->
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="/docs.docker.jp.onthefly/"><img class="logo" src="/docs.docker.jp.onthefly/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs"></a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="search-form" id="search-div" style="visibility: hidden">
    <form class="search-form form-inline ng-pristine ng-valid" id="searchForm" action="https://matsuand.github.io/docs.docker.jp.onthefly/search/">
        <input class="search-field form-control ds-input" id="st-search-input" value="" name="q" placeholder="文書内検索" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteContainer">
            <div id="autocompleteResults"></div>
        </div>
        <!-- <button type="submit" class="search-submit btn btn-default">検索</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container">
    <div id="tabs">
        <ul class="tabs" id="jsTOCHorizontal">

        </ul>
    </div>
    <div class="ctrl-right hidden-xs hidden-sm">
        <a href="javascript:void(0)" id="menu-toggle"><i class="fa fa-indent" aria-hidden="true"></i></a>
        <div class="btn-group" style="visibility: hidden">
  <button type="button" class="btn btn-default dropdown-btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Docker v19.03 (最新)     <span class="caret"></span>
  </button>
  <ul class="dropdown-menu">
    <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v18.09/">Docker v18.09</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v18.03/">Docker v18.03</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.06/">Docker v17.06</a></li>
  </ul>
</div>

    </div>
</div>

        </div>
    </div>
</nav>

    </header>
    <div class="wrapper right-open">
        <div class="container-fluid">
            <div class="row">
                <div class="col-body">
                    <main class="col-content content">
                        <section class="section">
                            
                            
                            <h1>Deploy the application</h1> 
                            <blockquote><p><strong>この文書は古いスタンドアロン版の Swarm に関するものです。</strong> ここではスタンドアロン版 Docker Swarm について説明しています。Docker 1.12 およびそれ以降においては、Docker Engine に対して<a href="/engine/swarm/">スウォームモード</a>が組み入れられました。たいていのユーザーは、統合されたスウォームモードを利用してください。これに関して読み進めるべきドキュメントは、<a href="/engine/swarm/swarm-tutorial/">スウォームモードをはじめよう</a>、<a href="/engine/swarm/#swarm-mode-cli-commands">スウォームモード CLI コマンド</a>、<a href="/get-started/">Docker ウォークスルー</a> です。スタンドアロン版の Docker Swarm は Docker Engine API や CLI コマンドには統合されていません。</p>
</blockquote>
                            
                            <span class="reading-time" title="Estimated reading time">
  <span class="reading-time-label">読む時間の目安: </span>
  
  
    10 分
  
</span>

                            
                            
                            <p>You’ve
<a href="/docs.docker.jp.onthefly/swarm/swarm_at_scale/deploy-infra/">deployed the load balancer, the discovery backend, and a swarm cluster</a>
so now you can build and deploy the voting application itself. You do this by
starting a number of “Dockerized applications” running in containers.</p>

<p>The diagram below shows the final application configuration including the overlay
container network, <code class="highlighter-rouge">voteapp</code>.</p>

<p><img src="/swarm/images/final-result.png" alt="Voteapp deployment overview" /></p>

<p>In this procedure you connect containers to this network. The <code class="highlighter-rouge">voteapp</code>
network is available to all Docker hosts using the Consul discovery backend.
Notice that the <code class="highlighter-rouge">interlock</code>, <code class="highlighter-rouge">nginx</code>, <code class="highlighter-rouge">consul</code>, and <code class="highlighter-rouge">swarm manager</code> containers
on are not part of the <code class="highlighter-rouge">voteapp</code> overlay container network.</p>

<h2 id="task-1-set-up-volume-and-network">Task 1. Set up volume and network</h2>

<p>This application relies on both an overlay container network and a container
volume. The Docker Engine provides these two features. Create them both
on the swarm manager instance.</p>

<ol>
  <li>
    <p>Direct your local environment to the swarm manager host.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">eval</span> <span class="k">$(</span>docker-machine env manager<span class="k">)</span>
</code></pre></div>    </div>

    <p>You can create the network on a cluster node and the network is visible on
 them all.</p>
  </li>
  <li>
    <p>Create the <code class="highlighter-rouge">voteapp</code> container network.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker network create <span class="nt">-d</span> overlay voteapp
</code></pre></div>    </div>
  </li>
  <li>
    <p>Switch to the db store.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">eval</span> <span class="k">$(</span>docker-machine env dbstore<span class="k">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Verify you can see the new network from the dbstore node.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker network <span class="nb">ls
</span>NETWORK ID          NAME                DRIVER
e952814f610a        voteapp             overlay
1f12c5e7bcc4        bridge              bridge
3ca38e887cd8        none                null
3da57c44586b        host                host
</code></pre></div>    </div>
  </li>
  <li>
    <p>Create a container volume called <code class="highlighter-rouge">db-data</code>.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker volume create <span class="nt">--name</span> db-data
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="task-2-start-the-containerized-microservices">Task 2. Start the containerized microservices</h2>

<p>At this point, you are ready to start the component microservices that make up
the application. Some of the application’s containers are launched from existing
images pulled directly from Docker Hub. Other containers are launched from
custom images you must build. The list below shows which containers use custom
images and which do not:</p>

<ul>
  <li>Load balancer container: stock image (<code class="highlighter-rouge">ehazlett/interlock</code>)</li>
  <li>Redis containers: stock image (official <code class="highlighter-rouge">redis</code> image)</li>
  <li>Postgres (PostgreSQL) containers: stock image (official <code class="highlighter-rouge">postgres</code> image)</li>
  <li>Web containers: custom built image</li>
  <li>Worker containers: custom built image</li>
  <li>Results containers: custom built image</li>
</ul>

<p>You can launch these containers from any host in the cluster using the commands
in this section. Each command includes a <code class="highlighter-rouge">-H </code>flag so that they execute against
the swarm manager.</p>

<p>The commands also all use the <code class="highlighter-rouge">-e</code> flag which is a Swarm constraint. The
constraint tells the manager to look for a node with a matching function label.
You set established the labels when you created the nodes. As you run each
command below, look for the value constraint.</p>

<ol>
  <li>
    <p>Start a Postgres database container.</p>

    <pre><code class="language-none">$ docker -H $(docker-machine ip manager):3376 run -t -d \
-v db-data:/var/lib/postgresql/data \
-e constraint:com.function==dbstore \
--net="voteapp" \
--name db postgres:9.4
</code></pre>
  </li>
  <li>
    <p>Start the Redis container.</p>

    <pre><code class="language-none">$ docker -H $(docker-machine ip manager):3376 run -t -d \
-p 6379:6379 \
-e constraint:com.function==dbstore \
--net="voteapp" \
--name redis redis
</code></pre>

    <p>The <code class="highlighter-rouge">redis</code> name is important so don’t change it.</p>
  </li>
  <li>
    <p>Start the worker application</p>

    <pre><code class="language-none">$ docker -H $(docker-machine ip manager):3376 run -t -d \
-e constraint:com.function==worker01 \
--net="voteapp" \
--net-alias=workers \
--name worker01 docker/example-voting-app-worker
</code></pre>
  </li>
  <li>
    <p>Start the results application.</p>

    <pre><code class="language-none">$ docker -H $(docker-machine ip manager):3376 run -t -d \
-p 80:80 \
--label=interlock.hostname=results \
--label=interlock.domain=myenterprise.example.com \
-e constraint:com.function==dbstore \
--net="voteapp" \
--name results-app docker/example-voting-app-result
</code></pre>
  </li>
  <li>
    <p>Start the voting application twice; once on each frontend node.</p>

    <pre><code class="language-none">$ docker -H $(docker-machine ip manager):3376 run -t -d \
-p 80:80 \
--label=interlock.hostname=vote \
--label=interlock.domain=myenterprise.example.com \
-e constraint:com.function==frontend01 \
--net="voteapp" \
--name voting-app01 docker/example-voting-app-vote
</code></pre>

    <p>And again on the other frontend node.</p>

    <pre><code class="language-none">$ docker -H $(docker-machine ip manager):3376 run -t -d \
-p 80:80 \
--label=interlock.hostname=vote \
--label=interlock.domain=myenterprise.example.com \
-e constraint:com.function==frontend02 \
--net="voteapp" \
--name voting-app02 docker/example-voting-app-vote
</code></pre>
  </li>
</ol>

<h2 id="task-3-check-your-work-and-update-etchosts">Task 3. Check your work and update /etc/hosts</h2>

<p>In this step, you check your work to make sure the Nginx configuration recorded
the containers correctly. Update your local system’s <code class="highlighter-rouge">/etc/hosts</code> file to
allow you to take advantage of the loadbalancer.</p>

<ol>
  <li>
    <p>Change to the <code class="highlighter-rouge">loadbalancer</code> node.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">eval</span> <span class="k">$(</span>docker-machine env loadbalancer<span class="k">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Check your work by reviewing the configuration of nginx.</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker container exec interlock cat /etc/conf/nginx.conf
... output snipped ...

upstream results.myenterprise.example.com {
    zone results.myenterprise.example.com_backend 64k;

    server 192.168.99.111:80;

}
server {
    listen 80;

    server_name results.myenterprise.example.com;

    location / {
        proxy_pass http://results.myenterprise.example.com;
    }
}
upstream vote.myenterprise.example.com {
    zone vote.myenterprise.example.com_backend 64k;

    server 192.168.99.109:80;
    server 192.168.99.108:80;

}
server {
    listen 80;

    server_name vote.myenterprise.example.com;

    location / {
        proxy_pass http://vote.myenterprise.example.com;
    }
}

include /etc/conf/conf.d/*.conf;
}
</code></pre></div>    </div>

    <p>The <code class="highlighter-rouge">http://vote.myenterprise.example.com</code> site configuration should point to either
 frontend node. Requests to <code class="highlighter-rouge">http://results.myenterprise.example.com</code> go just to the
 single <code class="highlighter-rouge">dbstore</code> node where the <code class="highlighter-rouge">example-voting-app-result</code> is running.</p>
  </li>
  <li>
    <p>On your local host, edit <code class="highlighter-rouge">/etc/hosts</code> file to add the resolution for both these
sites.</p>
  </li>
  <li>
    <p>Save and close the <code class="highlighter-rouge">/etc/hosts</code> file.</p>
  </li>
  <li>
    <p>Restart the <code class="highlighter-rouge">nginx</code> container.</p>

    <p>Manual restart is required because the current Interlock server is not forcing an
 Nginx configuration reload.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker restart nginx
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="task-4-test-the-application">Task 4. Test the application</h2>

<p>Now, you can test your application.</p>

<ol>
  <li>
    <p>Open a browser and navigate to the <code class="highlighter-rouge">http://vote.myenterprise.example.com</code> site.</p>

    <p>You should see something similar to the following:</p>

    <p><img src="/swarm/images/vote-app-test.png" alt="Voting page" /></p>
  </li>
  <li>Click on one of the two voting options.</li>
  <li>Navigate to the <code class="highlighter-rouge">http://results.myenterprise.example.com</code> site to see the results.</li>
  <li>
    <p>Try changing your vote.</p>

    <p>Both sides change as you switch your vote.</p>

    <p><img src="/swarm/images/votes.gif" alt="Voting and results page" /></p>
  </li>
</ol>

<h2 id="extra-credit-deployment-with-docker-compose">Extra Credit: Deployment with Docker Compose</h2>

<p>Up to this point, you’ve deployed each application container individually. This
can be cumbersome especially because there are several different containers and
starting them is order dependent. For example, that database should be running
before the worker.</p>

<p>Docker Compose let’s you define your microservice containers and their
dependencies in a Compose file. Then, you can use the Compose file to start all
the containers at once. This extra credit</p>

<ol>
  <li>
    <p>Before you begin, stop all the containers you started.</p>

    <p>a. Set the host to the manager.</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $ DOCKER_HOST=$(docker-machine ip manager):3376
</code></pre></div>    </div>

    <p>b. List all the application containers on the swarm.</p>

    <p>c. Stop and remove each container.</p>
  </li>
  <li>
    <p>Try to create Compose file on your own by reviewing the tasks in this tutorial.</p>

    <p><a href="/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/">The version 2 Compose file format</a>
 is the best to use. Translate each <code class="highlighter-rouge">docker run</code> command into a service
 in the <code class="highlighter-rouge">docker-compose.yml</code> file. For example,
 this command:</p>

    <pre><code class="language-none">$ docker -H $(docker-machine ip manager):3376 run -t -d \
-e constraint:com.function==worker01 \
--net="voteapp" \
--net-alias=workers \
--name worker01 docker/example-voting-app-worker
</code></pre>

    <p>Becomes this in a Compose file.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>worker:
  image: docker/example-voting-app-worker
  networks:
    voteapp:
      aliases:
      - workers
</code></pre></div>    </div>

    <p>In general, Compose starts services in reverse order they appear in the file.
 So, if you want a service to start before all the others, make it the last
 service in the file. This application relies on a volume and a network,
 declare those at the bottom of the file.</p>
  </li>
  <li>
    <p>Check your work against
<a href="/swarm/swarm_at_scale/docker-compose.yml" target="_blank" class="_">this file</a>.</p>
  </li>
  <li>
    <p>When you are satisfied, save the <code class="highlighter-rouge">docker-compose.yml</code> file to your system.</p>
  </li>
  <li>
    <p>Set <code class="highlighter-rouge">DOCKER_HOST</code> to the swarm manager.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ DOCKER_HOST</span><span class="o">=</span><span class="k">$(</span>docker-machine ip manager<span class="k">)</span>:3376
</code></pre></div>    </div>
  </li>
  <li>
    <p>In the same directory as your <code class="highlighter-rouge">docker-compose.yml</code> file, start the services.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker-compose up <span class="nt">-d</span>
Creating network <span class="s2">"scale_voteapp"</span> with the default driver
Creating volume <span class="s2">"scale_db-data"</span> with default driver
Pulling db <span class="o">(</span>postgres:9.4<span class="o">)</span>...
worker01: Pulling postgres:9.4... : downloaded
dbstore: Pulling postgres:9.4... : downloaded
frontend01: Pulling postgres:9.4... : downloaded
frontend02: Pulling postgres:9.4... : downloaded
Creating db
Pulling redis <span class="o">(</span>redis:latest<span class="o">)</span>...
dbstore: Pulling redis:latest... : downloaded
frontend01: Pulling redis:latest... : downloaded
frontend02: Pulling redis:latest... : downloaded
worker01: Pulling redis:latest... : downloaded
Creating redis
Pulling worker <span class="o">(</span>docker/example-voting-app-worker:latest<span class="o">)</span>...
dbstore: Pulling docker/example-voting-app-worker:latest... : downloaded
frontend01: Pulling docker/example-voting-app-worker:latest... : downloaded
frontend02: Pulling docker/example-voting-app-worker:latest... : downloaded
worker01: Pulling docker/example-voting-app-worker:latest... : downloaded
Creating scale_worker_1
Pulling voting-app <span class="o">(</span>docker/example-voting-app-vote:latest<span class="o">)</span>...
dbstore: Pulling docker/example-voting-app-vote:latest... : downloaded
frontend01: Pulling docker/example-voting-app-vote:latest... : downloaded
frontend02: Pulling docker/example-voting-app-vote:latest... : downloaded
worker01: Pulling docker/example-voting-app-vote:latest... : downloaded
Creating scale_voting-app_1
Pulling result-app <span class="o">(</span>docker/example-voting-app-result:latest<span class="o">)</span>...
dbstore: Pulling docker/example-voting-app-result:latest... : downloaded
frontend01: Pulling docker/example-voting-app-result:latest... : downloaded
frontend02: Pulling docker/example-voting-app-result:latest... : downloaded
worker01: Pulling docker/example-voting-app-result:latest... : downloaded
Creating scale_result-app_1
</code></pre></div>    </div>
  </li>
  <li>
    <p>Use the <code class="highlighter-rouge">docker ps</code> command to see the containers on the swarm cluster.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker <span class="nt">-H</span> <span class="k">$(</span>docker-machine ip manager<span class="k">)</span>:3376 ps
CONTAINER ID        IMAGE                                  COMMAND                  CREATED             STATUS              PORTS                            NAMES
b71555033caa        docker/example-voting-app-result   <span class="s2">"node server.js"</span>         6 seconds ago       Up 4 seconds        192.168.99.104:32774-&gt;80/tcp     frontend01/scale_result-app_1
cf29ea21475d        docker/example-voting-app-worker       <span class="s2">"/usr/lib/jvm/java-7-"</span>   6 seconds ago       Up 4 seconds                                         worker01/scale_worker_1
98414cd40ab9        redis                                  <span class="s2">"/entrypoint.sh redis"</span>   7 seconds ago       Up 5 seconds        192.168.99.105:32774-&gt;6379/tcp   frontend02/redis
1f214acb77ae        postgres:9.4                           <span class="s2">"/docker-entrypoint.s"</span>   7 seconds ago       Up 5 seconds        5432/tcp                         frontend01/db
1a4b8f7ce4a9        docker/example-voting-app-vote   <span class="s2">"python app.py"</span>          7 seconds ago       Up 5 seconds        192.168.99.107:32772-&gt;80/tcp     dbstore/scale_voting-app_1
</code></pre></div>    </div>

    <p>When you started the services manually, you had a
 <code class="highlighter-rouge">voting-app</code> instances running on two frontend servers. How many
 do you have now?</p>
  </li>
  <li>
    <p>Scale your application up by adding some <code class="highlighter-rouge">voting-app</code> instances.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker-compose scale voting-app<span class="o">=</span>3
Creating and starting 2 ... <span class="k">done
</span>Creating and starting 3 ... <span class="k">done</span>
</code></pre></div>    </div>

    <p>After you scale up, list the containers on the cluster again.</p>
  </li>
  <li>
    <p>Change to the <code class="highlighter-rouge">loadbalancer</code> node.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">eval</span> <span class="k">$(</span>docker-machine env loadbalancer<span class="k">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Restart the Nginx server.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker restart nginx
</code></pre></div>    </div>
  </li>
  <li>
    <p>Check your work again by visiting the <code class="highlighter-rouge">http://vote.myenterprise.example.com</code> and
<code class="highlighter-rouge">http://results.myenterprise.example.com</code> again.</p>
  </li>
  <li>
    <p>You can view the logs on an individual container.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker logs scale_voting-app_1
 <span class="k">*</span> Running on http://0.0.0.0:80/ <span class="o">(</span>Press CTRL+C to quit<span class="o">)</span>
 <span class="k">*</span> Restarting with stat
 <span class="k">*</span> Debugger is active!
 <span class="k">*</span> Debugger pin code: 285-809-660
192.168.99.103 - - <span class="o">[</span>11/Apr/2016 17:15:44] <span class="s2">"GET / HTTP/1.0"</span> 200 -
192.168.99.103 - - <span class="o">[</span>11/Apr/2016 17:15:44] <span class="s2">"GET /static/stylesheets/style.css HTTP/1.0"</span> 304 -
192.168.99.103 - - <span class="o">[</span>11/Apr/2016 17:15:45] <span class="s2">"GET /favicon.ico HTTP/1.0"</span> 404 -
192.168.99.103 - - <span class="o">[</span>11/Apr/2016 17:22:24] <span class="s2">"POST / HTTP/1.0"</span> 200 -
192.168.99.103 - - <span class="o">[</span>11/Apr/2016 17:23:37] <span class="s2">"POST / HTTP/1.0"</span> 200 -
192.168.99.103 - - <span class="o">[</span>11/Apr/2016 17:23:39] <span class="s2">"POST / HTTP/1.0"</span> 200 -
192.168.99.103 - - <span class="o">[</span>11/Apr/2016 17:23:40] <span class="s2">"POST / HTTP/1.0"</span> 200 -
192.168.99.103 - - <span class="o">[</span>11/Apr/2016 17:23:41] <span class="s2">"POST / HTTP/1.0"</span> 200 -
192.168.99.103 - - <span class="o">[</span>11/Apr/2016 17:23:43] <span class="s2">"POST / HTTP/1.0"</span> 200 -
192.168.99.103 - - <span class="o">[</span>11/Apr/2016 17:23:44] <span class="s2">"POST / HTTP/1.0"</span> 200 -
192.168.99.103 - - <span class="o">[</span>11/Apr/2016 17:23:46] <span class="s2">"POST / HTTP/1.0"</span> 200 -
</code></pre></div>    </div>
  </li>
</ol>

<p>This log shows the activity on one of the active voting application containers.</p>

<h2 id="next-steps">Next steps</h2>

<p>Congratulations. You have successfully walked through manually deploying a
microservice-based application to a swarm cluster. Of course, not every
deployment goes smoothly. Now that you’ve learned how to successfully deploy an
application at scale, you should learn what to consider when
<a href="/docs.docker.jp.onthefly/swarm/swarm_at_scale/troubleshoot/">troubleshooting large applications running on a swarm cluster</a>.</p>

                            <!-- tags -->
                            
                            <span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span
                                style="vertical-align: 2px"><a
                                    href="https://docs.docker.com/search/?q=docker">docker</a>, <a
                                    href="https://docs.docker.com/search/?q=swarm">swarm</a>, <a
                                    href="https://docs.docker.com/search/?q=scale">scale</a>, <a
                                    href="https://docs.docker.com/search/?q=voting">voting</a>, <a
                                    href="https://docs.docker.com/search/?q=application">application</a>, <a
                                    href="https://docs.docker.com/search/?q=certificates">certificates</a></span>
                            
                            
                            <div id="ratings-div"
                                style="color:#b9c2cc; text-align: center; margin-top: 150px; visibility: hidden">
                                <div id="pd_rating_holder_8453675"></div>
                                <script type="text/javascript">
                                    PDRTJS_settings_8453675 = {
                                        "id": "8453675",
                                        "unique_id": "swarm/swarm_at_scale/deploy-app.md",
                                        "title": "Deploy the application",
                                        "permalink": "https://github.com/docker/docker.github.io/blob/master/swarm/swarm_at_scale/deploy-app.md"
                                    };
                                    (function (d, c, j) {
                                        if (!document.getElementById(j)) {
                                            var pd = d.createElement(c),
                                                s;
                                            pd.id = j;
                                            pd.src = ('https:' == document.location.protocol) ? 'https://polldaddy.com/js/rating/rating.js' : 'http://i0.poll.fm/js/rating/rating.js';
                                            s = document.getElementsByTagName(c)[0];
                                            s.parentNode.insertBefore(pd, s);
                                        }
                                    }(document, 'script', 'pd-rating-js'));
                                </script>
                            </div>
                            
                        </section>
                    </main>
                    <nav class="col-nav">
                        <div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
                            <div id="navbar" class="nav-sidebar">
    <ul class="nav" id="jsTOCLeftNav">
    </ul>
</div>

                        </div>
                    </nav>
                    <div class="col-toc">
                        <div class="sidebar hidden-xs hidden-sm">
                            <div class="toc-nav">
                                <div class="feedback-links">
                                    <ul>
                                        
                                        <li style="visibility: hidden"><a href="https://github.com/docker/docker.github.io/edit/master/swarm/swarm_at_scale/deploy-app.md"><i
                                                    class="fa fa-pencil-square-o" aria-hidden="true"></i> Edit this
                                                page</a></li>
                                        <li><a href="https://github.com/docker/docker.github.io/issues/new?body=File: [swarm/swarm_at_scale/deploy-app.md](https://docs.docker.com/swarm/swarm_at_scale/deploy-app/)"
                                                class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> Request
                                                docs changes</a></li>
                                        <!-- toggle mode -->
                                        <li>
                                            <div class="toggle-mode">
                                                <div class="icon">
                                                    <i class="fa fa-sun-o" aria-hidden="true"></i>
                                                </div>
                                                <div class="toggle-switch">
                                                    <label class="switch">
                                                        <input type="checkbox" id="switch-style">
                                                        <div class="slider round"></div>
                                                    </label>
                                                </div>
                                                <div class="icon">
                                                    <i class="fa fa-moon-o" aria-hidden="true"></i>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                                
                                
                                
                                
                                <div id="side-toc-title">On this page:</div>
                                
<ul id="my_toc" class="inline_toc">
  <li><a href="#task-1-set-up-volume-and-network" class="nomunge">Task 1. Set up volume and network</a></li>
  <li><a href="#task-2-start-the-containerized-microservices" class="nomunge">Task 2. Start the containerized microservices</a></li>
  <li><a href="#task-3-check-your-work-and-update-etchosts" class="nomunge">Task 3. Check your work and update /etc/hosts</a></li>
  <li><a href="#task-4-test-the-application" class="nomunge">Task 4. Test the application</a></li>
  <li><a href="#extra-credit-deployment-with-docker-compose" class="nomunge">Extra Credit: Deployment with Docker Compose</a></li>
  <li><a href="#next-steps" class="nomunge">Next steps</a></li>
</ul>


                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    
    <footer class="footer">
          
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/why-docker">Why Docker</a></b></li>
                        <li><a href="https://www.docker.com/what-container">What is a Container</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/overview">Products</a></b></li>
                        <li><a href="https://www.docker.com/products/docker-desktop">Docker Desktop</a></li>
                        <li><a href="https://www.docker.com/products/docker-hub">Docker Hub</a></li>
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Features</a></b></li>
                        <li><a href="https://www.docker.com/products/container-runtime">Container Runtime</a></li>
                        <li><a href="https://www.docker.com/products/developer-tools">Developer Tools</a></li>
                        <li><a href="https://www.docker.com/products/kubernetes">Kubernetes</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Developers</a></b></li>
                        <li><a href="https://www.docker.com/use-cases">Use Cases</a></li>
                        <li><a href="https://www.docker.com/play-with-docker">Play with Docker</a></li>
                        <li><a href="https://www.docker.com/docker-community">Community</a></li>
                        <li><a href="https://www.docker.com/open-source">Open Source</a></li>
                        <li><a href="https://www.docker.com/community/docker-captains">Docker Captains</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/company" target="_blank">Company</a></b></li>
                        <li><a href="https://www.docker.com/company">About Us</a></li>
                        <li><a href="https://www.docker.com/blog/" target="_blank">Blog</a></li>
                        <li><a href="https://www.docker.com/customers">Customers</a></li>
                        <li><a href="https://www.docker.com/partners">Partners</a></li>
                        <li><a href="https://www.docker.com/company/newsroom">Newsroom</a></li>
                        <li><a href="https://www.docker.com/careers">Careers</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact Us</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="http://status.docker.com/">Status</a></li>
                        <li><a href="https://www.docker.com/docker-security">Security</a></li>
                        <li><a href="https://www.docker.com/legal">Legal</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2013-2020 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="http://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="http://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker">GitHub</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-slideshare"><a href="https://www.slideshare.net/docker">Slideshare</a></li>
                    <li class="fa fa-reddit"><a href="https://www.reddit.com/r/docker">Reddit</a></li>
                </ul>
            </div>
        </div>
    </div>

    </footer>
    <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/github.css">
    
    <script defer src="/docs.docker.jp.onthefly/js/anchorlinks.js"></script>
    <script defer src="/docs.docker.jp.onthefly/js/menu.js"></script>
    <script src="/docs.docker.jp.onthefly/js/jquery.js"></script>
    <script src="/docs.docker.jp.onthefly/js/bootstrap.min.js"></script>
    <!-- Always include the archive.js, but it doesn't do much unless we are an archive -->
    <script>
        // Default to assuming this is an archive and hiding some stuff
        // See js/archive.js and js/docs.js for logic relating to this
        var isArchive = true;
        var dockerVersion = 'v19.03';
        // In archives, we need to know the page root and we get it from JEKYLL_ENV in the jekyll build command
        var jekyllEnv = 'development';
        // If unset (in non-archive branches), defaults to "development". In that case, reset it to empty
        if (jekyllEnv === 'development') {
            jekyllEnv = '';
        }
        var pageURL = jekyllEnv + '/swarm/swarm_at_scale/deploy-app/';
    </script>
    <script src="/docs.docker.jp.onthefly/js/archive.js"></script>
    <script src="/docs.docker.jp.onthefly/js/stickyfill.min.js"></script>
    <script defer src="/docs.docker.jp.onthefly/js/metadata.js"></script>
    <script src="/docs.docker.jp.onthefly/js/glossary.js"></script>
    <script defer src="/docs.docker.jp.onthefly/js/docs.js"></script>
    <script defer src="/docs.docker.jp.onthefly/js/toc.js"></script>
    <script>
        jQuery(document).ready(function () { hookupTOCEvents(); });
    </script>
</body>


</html>
