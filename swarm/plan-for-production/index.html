<!-- Page generated 2019-11-16 14:25:28 +0900 -->
<!-- relative link basehrefs -->

	
	
	
		
			
		
	
		
			
			


<!-- Logic for 'edit this button' -->


	

	

	

	

	

	

	

	

	


<!-- End of logic for 'edit this button' -->


<!DOCTYPE html>
<html lang="ja">

<head>
	<base href="https://matsuand.github.io/docs.docker.jp.onthefly/swarm/" />
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<style type="text/css">
		@charset "UTF-8";
		[ng\:cloak],
		[ng-cloak],
		[data-ng-cloak],
		[x-ng-cloak],
		.ng-cloak,
		.x-ng-cloak,
		.ng-hide:not(.ng-hide-animate) {
			display: none !important;
		}

		ng\:form {
			display: block;
		}
	</style>
	<!-- Google Tag Manager -->
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-WL2QLG5');</script>
	<!-- End Google Tag Manager -->
	
	<!-- favicon -->
	<link rel="icon" type="image/x-icon" href="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
	<meta name="msapplication-TileImage" content="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico">
	<link rel="apple-touch-icon" type="image/x-icon" href="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
	<meta property="og:image" content="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico"/>
	<!-- metadata -->
	<meta property="og:type" content="website"/>
	<meta property="og:updated_time" itemprop="dateUpdated" content="2019-11-16T14:25:28+09:00"/>
	<meta property="og:image" itemprop="image primaryImageOfPage" content="https://matsuand.github.io/docs.docker.jp.onthefly/images/docs@2x.png"/>
	<meta name="twitter:card" content="summary"/>
	<meta name="twitter:domain" content="docs.docker.jp"/>
	<meta name="twitter:site" content="@docker_docs"/>
	<meta name="twitter:url" content="https://twitter.com/docker_docs"/>
	<meta name="twitter:title" itemprop="title name" content="Plan for Swarm in production"/>
	<meta name="twitter:description" property="og:description" itemprop="description" content="This article provides guidance to help you plan, deploy, and manage Docker swarm clusters in business critical production environments. The following high level topics are covered: Security High Availability Performance..." />
	<meta name="twitter:image:src" content="https://matsuand.github.io/docs.docker.jp.onthefly/images/docs@2x.png"/>
	<meta name="twitter:image:alt" content="Docker ドキュメント"/>
	<meta property="article:published_time" itemprop="datePublished" content="2019-11-16T14:25:28+09:00"/>

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="keywords" content="docker, swarm, scale, voting, application, plan">
	<link rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/bootstrap.min.css">
	<link id="pygments" rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/pygments/perldoc.css">
	<link id="pagestyle" rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/style.css">

	<!-- Go get "Open Sans" font from Google -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
	<!-- SEO stuff -->
	<title>Plan for Swarm in production | Docker ドキュメント</title>
<meta property="og:title" content="Plan for Swarm in production" />
<meta property="og:locale" content="ja_JP" />
<meta name="description" content="Plan for Swarm in production" />
<meta property="og:description" content="Plan for Swarm in production" />
<link rel="canonical" href="https://matsuand.github.io/docs.docker.jp.onthefly/swarm/plan-for-production/" />
<meta property="og:url" content="https://matsuand.github.io/docs.docker.jp.onthefly/swarm/plan-for-production/" />
<meta property="og:site_name" content="Docker ドキュメント" />
<script type="application/ld+json">
{"@context":"http://schema.org","@type":"WebPage","headline":"Plan for Swarm in production","description":"Plan for Swarm in production","url":"https://matsuand.github.io/docs.docker.jp.onthefly/swarm/plan-for-production/"}</script>
	<!-- END SEO STUFF -->
	<meta name="robots" content="noindex" />
	<script language="javascript">
	// Default to assuming this is an archive and hiding some stuff
	// See js/archive.js and js/docs.js for logic relating to this
	var isArchive = true;
	var dockerVersion = 'v19.03';
	</script>
</head>
<body ng-app="Docker" ng-controller="DockerController" class="colums">
	<header>
		 <nav class="nav-secondary navbar navbar-fixed-top">
    <!-- <div class="fan"></div> -->
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="https://matsuand.github.io/docs.docker.jp.onthefly/"><img class="logo" src="https://matsuand.github.io/docs.docker.jp.onthefly/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs"></a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="search-form" id="search-div" style="visibility: hidden">
    <form class="search-form form-inline ng-pristine ng-valid" id="searchForm" action="https://matsuand.github.io/docs.docker.jp.onthefly/search/">
        <input class="search-field form-control ds-input" id="st-search-input" value="" name="q" placeholder="文書内検索" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteContainer">
            <div id="autocompleteResults"></div>
        </div>
        <!-- <button type="submit" class="search-submit btn btn-default">検索</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container">
    <div id="tabs">
        <ul class="tabs" id="jsTOCHorizontal">

        </ul>
    </div>
    <div class="ctrl-right hidden-xs hidden-sm">
        <a href="javascript:void(0)" id="menu-toggle"><i class="fa fa-indent" aria-hidden="true"></i></a>
        <div class="btn-group" style="visibility: hidden">
  <button type="button" class="btn btn-default dropdown-btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Docker v19.03 (current)         <span class="caret"></span>
  </button>
  <ul class="dropdown-menu">
    <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/edge/">Docker edge</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v18.09/">Docker v18.09</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v18.03/">Docker v18.03</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.12/">Docker v17.12</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.09/">Docker v17.09</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.06/">Docker v17.06</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.03/">Docker v17.03</a></li>
  </ul>
</div>

    </div>
</div>

        </div>
    </div>
</nav>

	</header>

	<div class="wrapper right-open">
		<div class="container-fluid">
			<div class="row">
				<div class="col-body">
					<main class="col-content content">
						<section class="section">
							
								
							<h1>Plan for Swarm in production</h1> 
							<blockquote><p><strong>この文書は古いスタンドアロン版の Swarm に関するものです。</strong> ここではスタンドアロン版 Docker Swarm について説明しています。Docker 1.12 およびそれ以降においては、Docker Engine に対して<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/swarm/">スウォームモード</a>が組み入れられました。たいていのユーザーは、統合されたスウォームモードを利用してください。これに関して読み進めるべきドキュメントは、<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/swarm/swarm-tutorial/">スウォームモードをはじめよう</a>、<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/swarm/index.md#swarm-mode-cli-commands">スウォームモード CLI コマンド</a>、<a href="https://matsuand.github.io/docs.docker.jp.onthefly/get-started/">Docker ウォークスルー</a> です。スタンドアロン版の Docker Swarm は Docker Engine API や CLI コマンドには統合されていません。</p>
</blockquote> <span class="reading-time" title="Estimated reading time">
  <span class="reading-time-label">読む時間の目安: </span>
  
  
    14 分
  
</span>

							
							
							<p>This article provides guidance to help you plan, deploy, and manage Docker
swarm clusters in business critical production environments. The following high
 level topics are covered:</p>

<ul>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/swarm/plan-for-production/#security">Security</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/swarm/plan-for-production/#high-availability">High Availability</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/swarm/plan-for-production/#performance">Performance</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/swarm/plan-for-production/#cluster-ownership">Cluster ownership</a></li>
</ul>

<h2 id="security">Security</h2>

<p>There are many aspects to securing a Docker Swarm cluster. This section covers:</p>

<ul>
  <li>Authentication using TLS</li>
  <li>Network access control</li>
</ul>

<p>These topics are not exhaustive. They form part of a wider security architecture
that includes: security patching, strong password policies, role based access
control, technologies such as SELinux and AppArmor, strict auditing, and more.</p>

<h3 id="configure-swarm-for-tls">Configure Swarm for TLS</h3>

<p>All nodes in a swarm cluster must bind their Docker Engine daemons to a network
port. This brings with it all of the usual network related security
implications such as man-in-the-middle attacks. These risks are compounded when
 the network in question is untrusted such as the internet. To mitigate these
risks, Swarm and the Engine support Transport Layer Security (TLS) for
authentication.</p>

<p>The Engine daemons, including the swarm manager, that are configured to use TLS
only accepts commands from Docker Engine clients that sign their
communications. Engine and Swarm support external 3rd party Certificate
Authorities (CA) as well as internal corporate CAs.</p>

<p>The default Engine and Swarm ports for TLS are:</p>

<ul>
  <li>Engine daemon: 2376/tcp</li>
  <li>Swarm manager: 3376/tcp</li>
</ul>

<p>For more information on configuring Swarm for TLS, see the <a href="https://matsuand.github.io/docs.docker.jp.onthefly/swarm/secure-swarm-tls/">Overview Docker Swarm with TLS</a> page.</p>

<h3 id="network-access-control">Network access control</h3>

<p>Production networks are complex, and usually locked down so that only allowed
traffic can flow on the network. The list below shows the network ports and protocols
that the different components of a Swam cluster listen on. You should use these to
configure your firewalls and other network access control lists.</p>

<ul>
  <li><strong>Swarm manager.</strong>
    <ul>
      <li><strong>Inbound 80/tcp (HTTP)</strong>. This allows <code class="highlighter-rouge">docker pull</code> commands to work. If you plan to pull images from Docker Hub, you must allow Internet connections through port 80.</li>
      <li><strong>Inbound 2375/tcp</strong>. This allows Docker Engine CLI commands direct to the Engine daemon.</li>
      <li><strong>Inbound 3375/tcp</strong>. This allows Engine CLI commands to the swarm manager.</li>
      <li><strong>Inbound 22/tcp</strong>. This allows remote management via SSH.</li>
    </ul>
  </li>
  <li><strong>Service Discovery</strong>:
    <ul>
      <li><strong>Inbound 80/tcp (HTTP)</strong>. This allows <code class="highlighter-rouge">docker pull</code> commands to work. If you plan to pull images from Docker Hub, you must allow Internet connections through port 80.</li>
      <li><strong>Inbound <em>Discovery service port</em></strong>. This needs setting to the port that the backend discovery service listens on (consul, etcd, or zookeeper).</li>
      <li><strong>Inbound 22/tcp</strong>. This allows remote management via SSH.</li>
    </ul>
  </li>
  <li><strong>Swarm nodes</strong>:
    <ul>
      <li><strong>Inbound 80/tcp (HTTP)</strong>. This allows <code class="highlighter-rouge">docker pull</code> commands to work. If you plan to pull images from Docker Hub, you must allow Internet connections through port 80.</li>
      <li><strong>Inbound 2375/tcp</strong>. This allows Engine CLI commands direct to the Docker daemon.</li>
      <li><strong>Inbound 22/tcp</strong>. This allows remote management via SSH.</li>
    </ul>
  </li>
  <li><strong>Custom, cross-host container networks</strong>:
    <ul>
      <li><strong>Inbound 7946/tcp</strong> Allows for discovering other container networks.</li>
      <li><strong>Inbound 7946/udp</strong> Allows for discovering other container networks.</li>
      <li><strong>Inbound <code class="highlighter-rouge">&lt;store-port&gt;</code>/tcp</strong> Network key-value store service port.</li>
      <li><strong>4789/udp</strong> For the container overlay network.</li>
      <li><strong>ESP packets</strong> For encrypted overlay networks.</li>
    </ul>
  </li>
</ul>

<p>If your firewalls and other network devices are connection state aware, they
allow responses to established TCP connections. If your devices are not
state aware, you need to open up ephemeral ports from 32768-65535. For
added security you can configure the ephemeral port rules to only allow
connections from interfaces on known swarm devices.</p>

<p>If your swarm cluster is configured for TLS, replace <code class="highlighter-rouge">2375</code> with <code class="highlighter-rouge">2376</code>, and
<code class="highlighter-rouge">3375</code> with <code class="highlighter-rouge">3376</code>.</p>

<p>The ports listed above are just for swarm cluster operations such as cluster
creation, cluster management, and scheduling of containers against the cluster.
 You may need to open additional network ports for application-related
communications.</p>

<p>It is possible for different components of a swarm cluster to exist on separate
networks. For example, many organizations operate separate management and
production networks. Some Docker Engine clients may exist on a management
network, while swarm managers, discovery service instances, and nodes might
exist on one or more production networks. To offset against network failures,
you can deploy swarm managers, discovery services, and nodes across multiple
production networks. In all of these cases you can use the list of ports above
to assist the work of your network infrastructure teams to efficiently and
securely configure your network.</p>

<h2 id="high-availability-ha">High Availability (HA)</h2>

<p>All production environments should be highly available, meaning they are
continuously operational over long periods of time. To achieve high
availability, an environment must survive failures of its individual
component parts.</p>

<p>The following sections discuss some technologies and best practices that can
enable you to build resilient, highly-available swarm clusters. You can then use
these cluster to run your most demanding production applications and workloads.</p>

<h3 id="swarm-manager-ha">Swarm manager HA</h3>

<p>The swarm manager is responsible for accepting all commands coming in to a swarm
cluster, and scheduling resources against the cluster. If the swarm manager
becomes unavailable, some cluster operations cannot be performed until the swarm
manager becomes available again. This is unacceptable in large-scale business
critical scenarios.</p>

<p>Swarm provides HA features to mitigate against possible failures of the swarm
manager. You can use Swarm’s HA feature to configure multiple swarm managers for
a single cluster. These swarm managers operate in an active/passive formation
with a single swarm manager being the <em>primary</em>, and all others being
<em>secondaries</em>.</p>

<p>Swarm secondary managers operate as <em>warm standby’s</em>, meaning they run in the
background of the primary swarm manager. The secondary swarm managers are online
and accept commands issued to the cluster, just as the primary swarm manager.
However, any commands received by the secondaries are forwarded to the primary
where they are executed. Should the primary swarm manager fail, a new primary is
elected from the surviving secondaries.</p>

<p>When creating HA swarm managers, you should take care to distribute them over as
many <em>failure domains</em> as possible. A failure domain is a network section that
can be negatively affected if a critical device or service experiences problems.
For example, if your cluster is running in the Ireland Region of Amazon Web
Services (eu-west-1) and you configure three swarm managers (1 x primary, 2 x
secondary), you should place one in each availability zone as shown below.</p>

<p><img src="https://matsuand.github.io/docs.docker.jp.onthefly/engine/swarm/images/swarm-high-availability.png" alt="Swarm managers spread across availability zones" /></p>

<p>In this configuration, the swarm cluster can survive the loss of any two
availability zones. For your applications to survive such failures, they must be
architected across as many failure domains as well.</p>

<p>For swarm clusters serving high-demand, line-of-business applications, you
should have 3 or more swarm managers. This configuration allows you to take one
manager down for maintenance, suffer an unexpected failure, and still continue
to manage and operate the cluster.</p>

<h3 id="discovery-service-ha">Discovery service HA</h3>

<p>The discovery service is a key component of a swarm cluster. If the discovery
service becomes unavailable, this can prevent certain cluster operations. For
example, without a working discovery service, operations such as adding new
nodes to the cluster and making queries against the cluster configuration fail.
This is not acceptable in business critical production environments.</p>

<p>Swarm supports four backend discovery services:</p>

<ul>
  <li>Hosted (not for production use)</li>
  <li>Consul</li>
  <li>etcd</li>
  <li>Zookeeper</li>
</ul>

<p>Consul, etcd, and Zookeeper are all suitable for production, and should be
configured for high availability. You should use each service’s existing tools
and best practices to configure these for HA.</p>

<p>For swarm clusters serving high-demand, line-of-business applications, it is
recommended to have 5 or more discovery service instances. This due to the
replication/HA technologies they use (such as Paxos/Raft) requiring a strong
quorum. Having 5 instances allows you to take one down for maintenance, suffer
an unexpected failure, and still maintain a strong quorum.</p>

<p>When creating a highly available swarm discovery service, you should take care
to distribute each discovery service instance over as many failure domains as
possible. For example, if your cluster is running in the Ireland Region of
Amazon Web Services (eu-west-1) and you configure three discovery service
 instances, you should place one in each availability zone.</p>

<p>The diagram below shows a swarm cluster configured for HA. It has three swarm
managers and three discovery service instances spread over three failure
domains (availability zones). It also has swarm nodes balanced across all three
 failure domains. The loss of two availability zones in the configuration shown
 below does not cause the swarm cluster to go down.</p>

<p><img src="https://matsuand.github.io/docs.docker.jp.onthefly/engine/swarm/images/swarm-discovery-service.png" alt="Swarm cluster configured for HA" /></p>

<p>It is possible to share the same Consul, etcd, or Zookeeper containers between
the swarm discovery and Engine container networks. However, for best
performance and availability you should deploy dedicated instances – a
discovery instance for Swarm and another for your container networks.</p>

<h3 id="multiple-clouds">Multiple clouds</h3>

<p>You can architect and build swarm clusters that stretch across multiple cloud
providers, and even across public cloud and on premises infrastructures. The
diagram below shows an example swarm cluster stretched across AWS and Azure.</p>

<p><img src="https://matsuand.github.io/docs.docker.jp.onthefly/engine/swarm/images/swarm-multiple-clouds.png" alt="Swarm cluster stretched across AWS and Azure" /></p>

<p>While such architectures may appear to provide the ultimate in availability,
there are several factors to consider. Network latency can be problematic, as
can partitioning. As such, you should seriously consider technologies that
provide reliable, high speed, low latency connections into these cloud
platforms – technologies such as AWS Direct Connect and Azure
ExpressRoute.</p>

<p>If you are considering a production deployment across multiple infrastructures
like this, make sure you have good test coverage over your entire system.</p>

<h3 id="isolated-production-environments">Isolated production environments</h3>

<p>It is possible to run multiple environments, such as development, staging, and
production, on a single swarm cluster. You accomplish this by tagging swarm
nodes and using constraints to filter containers onto nodes tagged as
<code class="highlighter-rouge">production</code> or <code class="highlighter-rouge">staging</code> etc. However, this is not recommended. The recommended
approach is to air-gap production environments, especially high performance
business critical production environments.</p>

<p>For example, many companies not only deploy dedicated isolated infrastructures
for production – such as networks, storage, compute and other systems.
They also deploy separate management systems and policies. This results in
things like users having separate accounts for logging on to production systems
etc. In these types of environments, it is mandatory to deploy dedicated
production swarm clusters that operate on the production hardware infrastructure
and follow thorough production management, monitoring, audit and other policies.</p>

<h3 id="operating-system-selection">Operating system selection</h3>

<p>You should give careful consideration to the operating system that your Swarm
infrastructure relies on. This consideration is vital for production
environments.</p>

<p>It is not unusual for a company to use one operating system in development
environments, and a different one in production. A common example of this is to
use CentOS in development environments, but then to use Red Hat Enterprise Linux
(RHEL) in production. This decision is often a balance between cost and support.
CentOS Linux can be downloaded and used for free, but commercial support options
are few and far between. Whereas RHEL has an associated support and license
cost, but comes with world class commercial support from Red Hat.</p>

<p>When choosing the production operating system to use with your swarm clusters,
choose one that closely matches what you have used in development and staging
environments. Although containers abstract much of the underlying OS, some
features have configuration requirements. For example, to use Docker container
networking with Docker Engine 1.10 or higher, your host must have a Linux kernel
that is version 3.10 or higher. Refer to the change logs to understand the
requirements for a particular version of Docker Engine or Swarm.</p>

<p>You should also consider procedures and channels for deploying and potentially
patching your production operating systems.</p>

<h2 id="performance">Performance</h2>

<p>Performance is critical in environments that support business critical line of
business applications. The following sections discuss some technologies and
best practices that can help you build high performance swarm clusters.</p>

<h3 id="container-networks">Container networks</h3>

<p>Docker Engine container networks are overlay networks and can be created across
multiple Engine hosts. For this reason, a container network requires a key-value
(KV) store to maintain network configuration and state. This KV store can be
shared in common with the one used by the swarm cluster discovery service.
However, for best performance and fault isolation, you should deploy individual
KV store instances for container networks and swarm discovery. This is
especially so in demanding business critical production environments.</p>

<p>Beginning with Docker Engine 1.9, Docker container networks require specific
Linux kernel versions. Higher kernel versions are usually preferred, but carry
an increased risk of instability because of the newness of the kernel. Where
possible, use a kernel version that is already approved for use in your
production environment. If you can not use a 3.10 or higher Linux kernel version
for production, you should begin the process of approving a newer kernel as
early as possible.</p>

<h3 id="scheduling-strategies">Scheduling strategies</h3>

<!-- NIGEL: This reads like an explanation of specific scheduling strategies rather than guidance on which strategy to pick for production or with consideration of a production architecture choice.  For example, is spread a problem in a multiple clouds or random not good for XXX type application for YYY reason?

Or perhaps there is nothing to consider when it comes to scheduling strategy and network / HA architecture, application, os choice etc. that good?

-->

<p>Scheduling strategies are how Swarm decides which nodes in a cluster to start
containers on. Swarm supports the following strategies:</p>

<ul>
  <li>spread</li>
  <li>binpack</li>
  <li>random (not for production use)</li>
</ul>

<p>You can also write your own.</p>

<p><strong>Spread</strong> is the default strategy. It attempts to balance the number of
containers evenly across all nodes in the cluster. This is a good choice for
high performance clusters, as it spreads container workload across all
resources in the cluster. These resources include CPU, RAM, storage, and
network bandwidth.</p>

<p>If your swarm nodes are balanced across multiple failure domains, the spread
strategy evenly balance containers across those failure domains. However,
spread on its own is not aware of the roles of any of those containers, so has
no intelligence to spread multiple instances of the same service across failure
domains. To achieve this you should use tags and constraints.</p>

<p>The <strong>binpack</strong> strategy runs as many containers as possible on a node,
effectively filling it up, before scheduling containers on the next node.</p>

<p>This means that binpack does not use all cluster resources until the cluster
fills up. As a result, applications running on swarm clusters that operate the
binpack strategy might not perform as well as those that operate the spread
strategy. However, binpack is a good choice for minimizing infrastructure
requirements and cost. For example, imagine you have a 10-node cluster where
each node has 16 CPUs and 128GB of RAM. However, your container workload across
 the entire cluster is only using the equivalent of 6 CPUs and 64GB RAM. The
spread strategy would balance containers across all nodes in the cluster.
However, the binpack strategy would fit all containers on a single node,
potentially allowing you turn off the additional nodes and save on cost.</p>

<h2 id="ownership-of-swarm-clusters">Ownership of Swarm clusters</h2>

<p>The question of ownership is vital in production environments. It is therefore
vital that you consider and agree on all of the following when planning,
documenting, and deploying your production swarm clusters.</p>

<ul>
  <li>Whose budget does the production swarm infrastructure come out of?</li>
  <li>Who owns the accounts that can administer and manage the production swarm
cluster?</li>
  <li>Who is responsible for monitoring the production swarm infrastructure?</li>
  <li>Who is responsible for patching and upgrading the production swarm
infrastructure?</li>
  <li>On-call responsibilities and escalation procedures?</li>
</ul>

<p>The above is not a complete list, and the answers to the questions vary
depending on how your organization’s and team’s are structured. Some companies
are along way down the DevOps route, while others are not. Whatever situation
your company is in, it is important that you factor all of the above into the
planning, deployment, and ongoing management of your production swarm clusters.</p>

<h2 id="related-information">Related information</h2>

<ul>
  <li><a href="swarm_at_scale/index.md">Try Swarm at scale</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/swarm/networking/">Swarm and container networks</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/swarm/multi-manager-setup/">High availability in Docker Swarm</a></li>
  <li><a href="https://www.docker.com/products/docker-datacenter">Docker Data Center</a></li>
</ul>

							<!-- tags -->
							
							
							
							<span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span style="vertical-align: 2px"><a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=docker">docker</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=swarm">swarm</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=scale">scale</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=voting">voting</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=application">application</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=plan">plan</a></span>
							
							<!-- link corrections -->
              <script language="JavaScript">
							var x = document.links.length;
							var baseHref = document.getElementsByTagName('base')[0].href
							for (i = 0; i < x; i++) {
							  var munged = false;
							  var thisHREF = document.links[i].href;
							  var originalURL = "/swarm/plan-for-production/";
							  if (thisHREF.indexOf(baseHref + "#") > -1) {
							    // hash fix
							    //console.log('BEFORE: base:',baseHref,'thisHREF:',thisHREF,'originalURL:',originalURL);
							    thisHREF = originalURL + thisHREF.replace(baseHref, "");
							    //console.log('AFTER: base:',baseHref,'thisHREF:',thisHREF,'originalURL:',originalURL);
							  }
							  if ((thisHREF.indexOf(window.location.hostname) > -1 || thisHREF.indexOf('http') == -1) && document.links[i].className.indexOf("nomunge") < 0) {
							    munged = true;
							    thisHREF = thisHREF.replace(".md", "/").replace("/index/", "/");
							    document.links[i].setAttribute('href', thisHREF);
							  }
							}
							</script>
							
						  <div id="ratings-div" style="color:#b9c2cc; text-align: center; margin-top: 150px; visibility: hidden">
								<div id="pd_rating_holder_8453675"></div>
								<script type="text/javascript">
									PDRTJS_settings_8453675 = {
										"id": "8453675",
										"unique_id": "swarm/plan-for-production.md",
										"title": "Plan for Swarm in production",
										"permalink": "https://github.com/docker/docker.github.io/blob/master/swarm/plan-for-production.md"
									};
									(function(d, c, j) {
										if (!document.getElementById(j)) {
											var pd = d.createElement(c),
												s;
											pd.id = j;
											pd.src = ('https:' == document.location.protocol) ? 'https://polldaddy.com/js/rating/rating.js' : 'http://i0.poll.fm/js/rating/rating.js';
											s = document.getElementsByTagName(c)[0];
											s.parentNode.insertBefore(pd, s);
										}
									}(document, 'script', 'pd-rating-js'));
								</script>
							</div>
							
						</section>
					</main>
					<nav class="col-nav">
						<div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
						<div id="navbar" class="nav-sidebar">
    <ul class="nav" id="jsTOCLeftNav">
    </ul>
</div>

						</div>
					</nav>
					<div class="col-toc">
							<div class="sidebar hidden-xs hidden-sm">
							<div class="toc-nav">
								<div class="feedback-links">
									<ul>
										
										<li style="visibility: hidden"><a href="https://github.com/matsuand/docs.docker.jp/edit/v19.03.local/swarm/plan-for-production.md"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> このページの編集</a></li>
										<li><a href="https://github.com/matsuand/docs.docker.jp.onthefly/issues/new?body=File: [swarm/plan-for-production.md](https://matsuand.github.io/docs.docker.jp.onthefly/swarm/plan-for-production/)"
															class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> 文書変更のリクエスト</a></li>
										<li><a href="https://success.docker.com/support"><i class="fa fa-question" aria-hidden="true"></i> サポート依頼</a></li>
										<!-- toggle mode -->
										<li>
											<div class="toggle-mode">
												<div class="icon">
													<i class="fa fa-sun-o" aria-hidden="true"></i>
												</div>
												<div class="toggle-switch">
													<label class="switch">
														<input type="checkbox" id="switch-style">
														<div class="slider round"></div>
												</label>
												</div>
												<div class="icon">
													<i class="fa fa-moon-o" aria-hidden="true"></i>
												</div>
											</div>
										</li>
									</ul>
								</div>
								   
									<div id="side-toc-title">本ページ内</div>
									
<ul id="my_toc" class="inline_toc">
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/plan-for-production.md#security" class="nomunge">Security</a>
    <ul>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/plan-for-production.md#configure-swarm-for-tls" class="nomunge">Configure Swarm for TLS</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/plan-for-production.md#network-access-control" class="nomunge">Network access control</a></li>
    </ul>
  </li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/plan-for-production.md#high-availability-ha" class="nomunge">High Availability (HA)</a>
    <ul>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/plan-for-production.md#swarm-manager-ha" class="nomunge">Swarm manager HA</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/plan-for-production.md#discovery-service-ha" class="nomunge">Discovery service HA</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/plan-for-production.md#multiple-clouds" class="nomunge">Multiple clouds</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/plan-for-production.md#isolated-production-environments" class="nomunge">Isolated production environments</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/plan-for-production.md#operating-system-selection" class="nomunge">Operating system selection</a></li>
    </ul>
  </li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/plan-for-production.md#performance" class="nomunge">Performance</a>
    <ul>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/plan-for-production.md#container-networks" class="nomunge">Container networks</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/plan-for-production.md#scheduling-strategies" class="nomunge">Scheduling strategies</a></li>
    </ul>
  </li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/plan-for-production.md#ownership-of-swarm-clusters" class="nomunge">Ownership of Swarm clusters</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/plan-for-production.md#related-information" class="nomunge">Related information</a></li>
</ul>


								</div>
								
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	
	<footer class="footer">
		  
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/what-docker">What is Docker</a></li>
                        <li><a href="https://www.docker.com/what-container">What is a Container</a></li>
                        <li><a href="https://www.docker.com/use-cases">Use Cases</a></li>
                        <li><a href="https://www.docker.com/customers">Customers</a></li>
                        <li><a href="https://www.docker.com/partners/partner-program">Partners</a></li>
                        <li class="break"><a href="https://www.docker.com/industry-government">For Government</a></li>
                        <li><a href="https://www.docker.com/company">About Docker</a></li>
                        <li><a href="https://www.docker.com/company/management">Management</a></li>
                        <li><a href="https://www.docker.com/company/news-and-press">Press &amp; News</a></li>
                        <li><a href="https://www.docker.com/careers">Careers</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/products/overview">Product</a></li>
                        <li><a href="https://www.docker.com/pricing">Pricing</a></li>
                        <li><a href="https://www.docker.com/docker-community">Community Edition</a></li>
                        <li class="break"><a href="https://www.docker.com/enterprise">Enterprise Edition </a></li>
                        <li><a href="https://www.docker.com/products/docker-datacenter">Docker Datacenter</a></li>
                        <li><a href="https://hub.docker.com/">Docker Hub</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/">Documentation</a></li>
                        <li><a href="https://www.docker.com/docker">Learn</a></li>
                        <li><a href="https://blog.docker.com" target="_blank">Blog</a></li>
                        <li><a href="https://engineering.docker.com" target="_blank">Engineering Blog</a></li>
                        <li><a href="https://training.docker.com/" target="_blank">Training</a></li>
                        <li><a href="https://success.docker.com/support">Support</a></li>
                        <li><a href="https://success.docker.com/kbase">Knowledge Base</a></li>
                        <li><a href="https://www.docker.com/products/resources">Resources</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/docker-community">Community</a></li>
                        <li><a href="https://www.docker.com/technologies/overview">Open Source</a></li>
                        <li><a href="https://www.docker.com/community/events">Events</a></li>
                        <li><a href="https://forums.docker.com/" target="_blank">Forums</a></li>
                        <li><a href="https://www.docker.com/community/docker-captains">Docker Captains</a></li>
                        <li><a href="https://www.docker.com/docker-community/scholarships">Scholarships</a></li>
                        <li><a href="https://blog.docker.com/curated/">Community News</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="http://status.docker.com/">Status</a></li>
                        <li><a href="https://www.docker.com/docker-security">Security</a></li>
                        <li><a href="https://www.docker.com/legal">Legal</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2019 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="http://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="http://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker">GitHub</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-reddit"><a href="http://www.reddit.com/r/docker">Reddit</a></li>
                    <li class="fa fa-slideshare"><a href="http://www.slideshare.net/docker">Slideshare</a></li>
                </ul>
            </div>
        </div>
    </div>

	</footer>
	<link rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/github.css">
	
	<!-- <script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/anchorlinks.js"></script> -->
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/menu.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/jquery.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/bootstrap.min.js"></script>
	<!-- Always include the archive.js, but it doesn't do much unless we are an archive -->
	<script language="javascript">
	// Default to assuming this is an archive and hiding some stuff
	// See js/archive.js and js/docs.js for logic relating to this
	var isArchive = true;
	var dockerVersion = 'v19.03';
	// In archives, we need to know the page root and we get it from JEKYLL_ENV in the jekyll build command
	var jekyllEnv = 'development';
	// If unset (in non-archive branches), defaults to "development". In that case, reset it to empty
	if (jekyllEnv == 'development') {
		jekyllEnv = '';
	}
	var pageURL = jekyllEnv + '/swarm/plan-for-production/';
	</script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/archive.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/stickyfill.min.js"></script>
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/metadata.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/glossary.js"></script>
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/docs.js"></script>
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/toc.js"></script>
	<script language="javascript">
	jQuery(document).ready(function(){
				hookupTOCEvents();
			});
	</script>
</body>

</html>
