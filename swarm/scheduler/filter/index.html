<!-- Page generated 2019-07-25 21:37:13 +0900 -->
<!-- relative link basehrefs -->

	
	
	
		
			
		
	
		
			
		
	
		
			
			


<!-- Logic for 'edit this button' -->


	

	

	

	

	

	

	

	

	


<!-- End of logic for 'edit this button' -->


<!DOCTYPE html>
<html lang="ja">

<head>
	<base href="https://matsuand.github.io/docs.docker.jp.onthefly/swarm/scheduler/" />
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<style type="text/css">
		@charset "UTF-8";
		[ng\:cloak],
		[ng-cloak],
		[data-ng-cloak],
		[x-ng-cloak],
		.ng-cloak,
		.x-ng-cloak,
		.ng-hide:not(.ng-hide-animate) {
			display: none !important;
		}

		ng\:form {
			display: block;
		}
	</style>
	<script type="text/javascript">
	  !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="4.0.0";
	  analytics.load("IWj9D0UpZHZdZUZX9jl98PcpBFWBnBMy");
	  analytics.page();
	  }}();
	</script>
	
	<!-- favicon -->
	<link rel="icon" type="image/x-icon" href="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
	<meta name="msapplication-TileImage" content="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico">
	<link rel="apple-touch-icon" type="image/x-icon" href="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
	<meta property="og:image" content="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico"/>
	<!-- metadata -->
	<meta property="og:type" content="website"/>
	<meta property="og:updated_time" itemprop="dateUpdated" content="2019-07-25T21:37:13+09:00"/>
	<meta property="og:image" itemprop="image primaryImageOfPage" content="https://matsuand.github.io/docs.docker.jp.onthefly/images/docs@2x.png"/>
	<meta name="twitter:card" content="summary"/>
	<meta name="twitter:domain" content="docs.docker.jp"/>
	<meta name="twitter:site" content="@docker_docs"/>
	<meta name="twitter:url" content="https://twitter.com/docker_docs"/>
	<meta name="twitter:title" itemprop="title name" content="Swarm フィルター"/>
	<meta name="twitter:description" property="og:description" itemprop="description" content="フィルターは、コンテナーが生成、実行された際に、Docker Swarm のスケジューラーがどのノードを用いるかを指示します。 Configure the available filters Filters are divided into two categories, node filters and container configuration filters. Node filters operate on characteristics of the Docker host or on..." />
	<meta name="twitter:image:src" content="https://matsuand.github.io/docs.docker.jp.onthefly/images/docs@2x.png"/>
	<meta name="twitter:image:alt" content="Docker Documentation"/>
	<meta property="article:published_time" itemprop="datePublished" content="2019-07-25T21:37:13+09:00"/>

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="keywords" content="docker, swarm, clustering, filters">
	<link rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/bootstrap.min.css">
	<link id="pygments" rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/pygments/perldoc.css">
	<link id="pagestyle" rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/style.css">

	<!-- Go get "Open Sans" font from Google -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
	<!-- SEO stuff -->
	<title>Swarm フィルター | Docker Documentation</title>
<meta property="og:title" content="Swarm フィルター" />
<meta property="og:locale" content="ja_JP" />
<meta name="description" content="Swarm フィルター。" />
<meta property="og:description" content="Swarm フィルター。" />
<link rel="canonical" href="https://matsuand.github.io/docs.docker.jp.onthefly/swarm/scheduler/filter/" />
<meta property="og:url" content="https://matsuand.github.io/docs.docker.jp.onthefly/swarm/scheduler/filter/" />
<meta property="og:site_name" content="Docker Documentation" />
<script type="application/ld+json">
{"@context":"http://schema.org","@type":"WebPage","headline":"Swarm フィルター","description":"Swarm フィルター。","url":"https://matsuand.github.io/docs.docker.jp.onthefly/swarm/scheduler/filter/"}</script>
	<!-- END SEO STUFF -->
	<meta name="robots" content="noindex" />
	<script language="javascript">
	// Default to assuming this is an archive and hiding some stuff
	// See js/archive.js and js/docs.js for logic relating to this
	var isArchive = true;
	var dockerVersion = 'v19.03';
	</script>
</head>
<body ng-app="Docker" ng-controller="DockerController" class="colums">
	<header>
		 <nav class="nav-secondary navbar navbar-fixed-top">
    <!-- <div class="fan"></div> -->
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="https://matsuand.github.io/docs.docker.jp.onthefly/"><img class="logo" src="https://matsuand.github.io/docs.docker.jp.onthefly/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs"></a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="search-form" id="search-div" style="visibility: hidden">
    <form class="search-form form-inline ng-pristine ng-valid" id="searchForm" action="https://matsuand.github.io/docs.docker.jp.onthefly/search/">
        <input class="search-field form-control ds-input" id="st-search-input" value="" name="q" placeholder="文書内検索" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteContainer">
            <div id="autocompleteResults"></div>
        </div>
        <!-- <button type="submit" class="search-submit btn btn-default">検索</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container">
    <div id="tabs">
        <ul class="tabs" id="jsTOCHorizontal">

        </ul>
    </div>
    <div class="ctrl-right hidden-xs hidden-sm">
        <a href="javascript:void(0)" id="menu-toggle"><i class="fa fa-indent" aria-hidden="true"></i></a>
        <div class="btn-group" style="visibility: hidden">
  <button type="button" class="btn btn-default dropdown-btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Docker v19.03 (current)         <span class="caret"></span>
  </button>
  <ul class="dropdown-menu">
    <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/edge/">Docker edge</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v18.09/">Docker v18.09</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v18.03/">Docker v18.03</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.12/">Docker v17.12</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.09/">Docker v17.09</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.06/">Docker v17.06</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.03/">Docker v17.03</a></li>
  </ul>
</div>

    </div>
</div>

        </div>
    </div>
</nav>

	</header>

	<div class="wrapper right-open">
		<div class="container-fluid">
			<div class="row">
				<div class="col-body">
					<main class="col-content content">
						<section class="section">
							
								
							<h1>Swarm フィルター</h1> 
							<blockquote><p><strong>この文書は古いスタンドアロン版の Swarm に関するものです。</strong> ここではスタンドアロン版 Docker Swarm について説明しています。Docker 1.12 およびそれ以降においては、Docker Engine に対して<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/swarm/">スウォームモード</a>が組み入れられました。たいていのユーザーは、統合されたスウォームモードを利用してください。これに関して読み進めるべきドキュメントは、<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/swarm/swarm-tutorial/">スウォームモードをはじめよう</a>、<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/swarm/index.md#swarm-mode-cli-commands">スウォームモード CLI コマンド</a>、<a href="https://matsuand.github.io/docs.docker.jp.onthefly/get-started/">Docker ウォークスルー</a> です。スタンドアロン版の Docker Swarm は Docker Engine API や CLI コマンドには統合されていません。</p>
</blockquote> <span class="reading-time" title="Estimated reading time">
  <span class="reading-time-label">読む時間の目安: </span>
  
  
    18 分
  
</span>

							
							
							
<p>フィルターは、コンテナーが生成、実行された際に、Docker Swarm のスケジューラーがどのノードを用いるかを指示します。</p>

<h2 id="configure-the-available-filters">Configure the available filters</h2>

<p>Filters are divided into two categories, node filters and container configuration
filters. Node filters operate on characteristics of the Docker host or on the
configuration of the Docker daemon. Container configuration filters operate on
characteristics of containers, or on the availability of images on a host.</p>

<p>Each filter has a name that identifies it. The node filters are:</p>

<ul>
  <li><code class="highlighter-rouge">constraint</code></li>
  <li><code class="highlighter-rouge">health</code></li>
  <li><code class="highlighter-rouge">containerslots</code></li>
</ul>

<p>The container configuration filters are:</p>

<ul>
  <li><code class="highlighter-rouge">affinity</code></li>
  <li><code class="highlighter-rouge">dependency</code></li>
  <li><code class="highlighter-rouge">port</code></li>
</ul>

<p>When you start a Swarm manager with the <code class="highlighter-rouge">swarm manage</code> command, all the filters
are enabled. If you want to limit the filters available to your Swarm, specify a subset
of filters by passing the <code class="highlighter-rouge">--filter</code> flag and the name:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>swarm manage <span class="nt">--filter</span><span class="o">=</span>health <span class="nt">--filter</span><span class="o">=</span>dependency
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong>: Container configuration filters match all containers, including stopped
containers, when applying the filter. To release a node used by a container, you
must remove the container from the node.</p>
</blockquote>

<h2 id="node-filters">Node filters</h2>

<p>When creating a container or building an image, you use a <code class="highlighter-rouge">constraint</code> or
<code class="highlighter-rouge">health</code> filter to select a subset of nodes to consider for scheduling.
If a node in Swarm cluster has a label with key <code class="highlighter-rouge">containerslots</code>
and a number-value, Swarm does not launch more containers than the given number.</p>

<h3 id="use-a-constraint-filter">Use a constraint filter</h3>

<p>Node constraints can refer to Docker’s default tags or to custom labels. Default
tags are sourced from <code class="highlighter-rouge">docker info</code>. Often, they relate to properties of the Docker
host. Currently, the default tags include:</p>

<ul>
  <li><code class="highlighter-rouge">node</code> to refer to the node by ID or name</li>
  <li><code class="highlighter-rouge">storagedriver</code></li>
  <li><code class="highlighter-rouge">executiondriver</code></li>
  <li><code class="highlighter-rouge">kernelversion</code></li>
  <li><code class="highlighter-rouge">operatingsystem</code></li>
</ul>

<p>Custom node labels you apply when you start the <code class="highlighter-rouge">docker daemon</code>, for example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker daemon <span class="nt">--label</span> com.example.environment<span class="o">=</span><span class="s2">"production"</span> <span class="nt">--label</span> com.example.storage<span class="o">=</span><span class="s2">"ssd"</span>
</code></pre></div></div>

<p>Then, when you start a container on the cluster, you can set constraints using
these default tags or custom labels. The Swarm scheduler looks for matching node
on the cluster and starts the container there. This approach has several
practical applications:</p>

<ul>
  <li>Schedule based on specific host properties, for example, <code class="highlighter-rouge">storage=ssd</code> schedules
containers on specific hardware.</li>
  <li>Force containers to run in a given location, for example <code class="highlighter-rouge">region=us-east</code>.</li>
  <li>Create logical cluster partitions by splitting a cluster into
sub-clusters with different properties, for example <code class="highlighter-rouge">environment=production</code>.</li>
</ul>

<h4 id="example-node-constraints">Example node constraints</h4>

<p>To specify custom label for a node, pass a list of <code class="highlighter-rouge">--label</code>
options at <code class="highlighter-rouge">docker</code> startup time. For instance, to start <code class="highlighter-rouge">node-1</code> with the
<code class="highlighter-rouge">storage=ssd</code> label:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker daemon <span class="nt">--label</span> <span class="nv">storage</span><span class="o">=</span>ssd
<span class="nv">$ </span>swarm join <span class="nt">--advertise</span><span class="o">=</span>192.168.0.42:2375 token://XXXXXXXXXXXXXXXXXX
</code></pre></div></div>

<p>You might start a different <code class="highlighter-rouge">node-2</code> with <code class="highlighter-rouge">storage=disk</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker daemon <span class="nt">--label</span> <span class="nv">storage</span><span class="o">=</span>disk
<span class="nv">$ </span>swarm join <span class="nt">--advertise</span><span class="o">=</span>192.168.0.43:2375 token://XXXXXXXXXXXXXXXXXX
</code></pre></div></div>

<p>Once the nodes are joined to a cluster, the Swarm manager pulls their respective
tags. Moving forward, the manager takes the tags into account when scheduling
new containers.</p>

<p>Continuing the previous example, assuming your cluster with <code class="highlighter-rouge">node-1</code> and
<code class="highlighter-rouge">node-2</code>, you can run a MySQL server container on the cluster. When you run the
container, you can use a <code class="highlighter-rouge">constraint</code> to ensure the database gets good I/O
performance. You do this by filtering for nodes with flash drives:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt;  run <span class="nt">-d</span> <span class="nt">-P</span> <span class="nt">-e</span> constraint:storage<span class="o">==</span>ssd <span class="nt">--name</span> db mysql
f8b693db9cd6

<span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt;  ps
CONTAINER ID        IMAGE               COMMAND             CREATED                  STATUS              PORTS                           NAMES
f8b693db9cd6        mysql:latest        <span class="s2">"mysqld"</span>            Less than a second ago   running             192.168.0.42:49178-&gt;3306/tcp    node-1/db
</code></pre></div></div>

<p>In this example, the manager selected all nodes that met the <code class="highlighter-rouge">storage=ssd</code>
constraint and applied resource management on top of them. Only <code class="highlighter-rouge">node-1</code> was
selected because it’s the only host running flash.</p>

<p>Suppose you want to run an Nginx frontend in a cluster. In this case, you wouldn’t want flash drives because the frontend mostly writes logs to disk.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; run <span class="nt">-d</span> <span class="nt">-P</span> <span class="nt">-e</span> constraint:storage<span class="o">==</span>disk <span class="nt">--name</span> frontend nginx
963841b138d8

<span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; ps
CONTAINER ID        IMAGE               COMMAND             CREATED                  STATUS              PORTS                           NAMES
963841b138d8        nginx:latest        <span class="s2">"nginx"</span>             Less than a second ago   running             192.168.0.43:49177-&gt;80/tcp      node-2/frontend
f8b693db9cd6        mysql:latest        <span class="s2">"mysqld"</span>            Up About a minute        running             192.168.0.42:49178-&gt;3306/tcp    node-1/db
</code></pre></div></div>

<p>The scheduler selected <code class="highlighter-rouge">node-2</code> since it was started with the <code class="highlighter-rouge">storage=disk</code> label.</p>

<p>Finally, build args can be used to apply node constraints to a <code class="highlighter-rouge">docker build</code>.
This example shows how to avoid flash drives.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mkdir sinatra
<span class="nv">$ </span><span class="nb">cd </span>sinatra
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"FROM ubuntu:14.04"</span> <span class="o">&gt;</span> Dockerfile
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"RUN apt-get update &amp;&amp; apt-get install -y ruby ruby-dev"</span> <span class="o">&gt;&gt;</span> Dockerfile
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"RUN gem install sinatra"</span> <span class="o">&gt;&gt;</span> Dockerfile
<span class="nv">$ </span>docker build <span class="nt">--build-arg</span><span class="o">=</span>constraint:storage<span class="o">==</span>disk <span class="nt">-t</span> ouruser/sinatra:v2 <span class="nb">.</span>
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM ubuntu:14.04
 <span class="nt">---</span><span class="o">&gt;</span> a5a467fddcb8
Step 2 : RUN apt-get update <span class="o">&amp;&amp;</span> apt-get install <span class="nt">-y</span> ruby ruby-dev
 <span class="nt">---</span><span class="o">&gt;</span> Running <span class="k">in </span>26c9fbc55aeb
 <span class="nt">---</span><span class="o">&gt;</span> 30681ef95fff
Removing intermediate container 26c9fbc55aeb
Step 3 : RUN gem install sinatra
 <span class="nt">---</span><span class="o">&gt;</span> Running <span class="k">in </span>68671d4a17b0
 <span class="nt">---</span><span class="o">&gt;</span> cd70495a1514
Removing intermediate container 68671d4a17b0
Successfully built cd70495a1514

<span class="nv">$ </span>docker image <span class="nb">ls
</span>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
dockerswarm/swarm   manager             8c2c56438951        2 days ago          795.7 MB
ouruser/sinatra     v2                  cd70495a1514        35 seconds ago      318.7 MB
ubuntu              14.04               a5a467fddcb8        11 days ago         187.9 MB
</code></pre></div></div>

<h3 id="use-the-health-filter">Use the health filter</h3>

<p>The node <code class="highlighter-rouge">health</code> filter prevents the scheduler from running containers
on unhealthy nodes. A node is considered unhealthy if the node is down or it
can’t communicate with the cluster store.</p>

<h3 id="use-the-containerslots-filter">Use the containerslots filter</h3>

<p>You may give your Docker nodes the containerslots label</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker daemon <span class="nt">--label</span> <span class="nv">containerslots</span><span class="o">=</span>3
</code></pre></div></div>

<p>Swarm runs up to 3 containers at this node, if all nodes are “full”,
an error is thrown indicating no suitable node can be found.
If the value cannot be cast to an integer number or is not present,
there is no limit on container number.</p>

<h2 id="container-filters">コンテナーフィルター</h2>

<p>コンテナーを生成する際には、以下の三種類のコンテナーフィルターを用いることができます。</p>

<ul>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/swarm/scheduler/filter/#use-an-affinity-filter"><code class="highlighter-rouge">affinity</code></a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/swarm/scheduler/filter/#use-a-dependency-filter"><code class="highlighter-rouge">dependency</code></a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/swarm/scheduler/filter/#use-a-port-filter"><code class="highlighter-rouge">port</code></a></li>
</ul>

<h3 id="use-an-affinity-filter">affinity フィルターの利用</h3>

<p>Use an <code class="highlighter-rouge">affinity</code> filter to create “attractions” between containers. For
example, you can run a container and instruct Swarm to schedule it next to
another container based on these affinities:</p>

<ul>
  <li>コンテナー名または ID</li>
  <li>ホスト上のイメージ</li>
  <li>コンテナーに適用されているカスタムラベル</li>
</ul>

<p>These affinities ensure that containers run on the same network node
— without you having to know what each node is running.</p>

<h4 id="example-name-affinity">Example name affinity</h4>

<p>You can schedule a new container to run next to another based on a container
name or ID. For example, you can start a container called <code class="highlighter-rouge">frontend</code> running
<code class="highlighter-rouge">nginx</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt;  run <span class="nt">-d</span> <span class="nt">-p</span> 80:80 <span class="nt">--name</span> frontend nginx
 87c4376856a8


<span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; ps
CONTAINER ID        IMAGE               COMMAND             CREATED                  STATUS              PORTS                           NAMES
87c4376856a8        nginx:latest        <span class="s2">"nginx"</span>             Less than a second ago   running             192.168.0.42:80-&gt;80/tcp         node-1/frontend
</code></pre></div></div>

<p>Then, using <code class="highlighter-rouge">-e affinity:container==frontend</code> value to schedule a second
container to locate and run next to the container named <code class="highlighter-rouge">frontend</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; run <span class="nt">-d</span> <span class="nt">--name</span> logger <span class="nt">-e</span> affinity:container<span class="o">==</span>frontend logger
 87c4376856a8

<span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; ps
CONTAINER ID        IMAGE               COMMAND             CREATED                  STATUS              PORTS                           NAMES
87c4376856a8        nginx:latest        <span class="s2">"nginx"</span>             Less than a second ago   running             192.168.0.42:80-&gt;80/tcp         node-1/frontend
963841b138d8        logger:latest       <span class="s2">"logger"</span>            Less than a second ago   running                                             node-1/logger
</code></pre></div></div>

<p>Because of <code class="highlighter-rouge">name</code> affinity, the <code class="highlighter-rouge">logger</code> container ends up on <code class="highlighter-rouge">node-1</code> along
with the <code class="highlighter-rouge">frontend</code> container. Instead of the <code class="highlighter-rouge">frontend</code> name you could have
supplied its ID as follows:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; run <span class="nt">-d</span> <span class="nt">--name</span> logger <span class="nt">-e</span> affinity:container<span class="o">==</span>87c4376856a8
</code></pre></div></div>

<h4 id="example-image-affinity">Example image affinity</h4>

<p>You can schedule a container to run only on nodes where a specific image is
already pulled. For example, suppose you pull a <code class="highlighter-rouge">redis</code> image to two hosts and a
<code class="highlighter-rouge">mysql</code> image to a third.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker <span class="nt">-H</span> node-1:2375 pull redis
<span class="nv">$ </span>docker <span class="nt">-H</span> node-2:2375 pull mysql
<span class="nv">$ </span>docker <span class="nt">-H</span> node-3:2375 pull redis
</code></pre></div></div>

<p><code class="highlighter-rouge">node-1</code> と <code class="highlighter-rouge">node-3</code> だけが <code class="highlighter-rouge">redis</code> イメージを持ちます。
Specify a <code class="highlighter-rouge">-e
affinity:image==redis</code> filter to schedule several additional containers to run
on these nodes.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; run <span class="nt">-d</span> <span class="nt">--name</span> redis1 <span class="nt">-e</span> affinity:image<span class="o">==</span>redis redis
<span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; run <span class="nt">-d</span> <span class="nt">--name</span> redis2 <span class="nt">-e</span> affinity:image<span class="o">==</span>redis redis
<span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; run <span class="nt">-d</span> <span class="nt">--name</span> redis3 <span class="nt">-e</span> affinity:image<span class="o">==</span>redis redis
<span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; run <span class="nt">-d</span> <span class="nt">--name</span> redis4 <span class="nt">-e</span> affinity:image<span class="o">==</span>redis redis
<span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; run <span class="nt">-d</span> <span class="nt">--name</span> redis5 <span class="nt">-e</span> affinity:image<span class="o">==</span>redis redis
<span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; run <span class="nt">-d</span> <span class="nt">--name</span> redis6 <span class="nt">-e</span> affinity:image<span class="o">==</span>redis redis
<span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; run <span class="nt">-d</span> <span class="nt">--name</span> redis7 <span class="nt">-e</span> affinity:image<span class="o">==</span>redis redis
<span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; run <span class="nt">-d</span> <span class="nt">--name</span> redis8 <span class="nt">-e</span> affinity:image<span class="o">==</span>redis redis

<span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; ps
CONTAINER ID        IMAGE               COMMAND             CREATED                  STATUS              PORTS                           NAMES
87c4376856a8        redis:latest        <span class="s2">"redis"</span>             Less than a second ago   running                                             node-1/redis1
1212386856a8        redis:latest        <span class="s2">"redis"</span>             Less than a second ago   running                                             node-1/redis2
87c4376639a8        redis:latest        <span class="s2">"redis"</span>             Less than a second ago   running                                             node-3/redis3
1234376856a8        redis:latest        <span class="s2">"redis"</span>             Less than a second ago   running                                             node-1/redis4
86c2136253a8        redis:latest        <span class="s2">"redis"</span>             Less than a second ago   running                                             node-3/redis5
87c3236856a8        redis:latest        <span class="s2">"redis"</span>             Less than a second ago   running                                             node-3/redis6
87c4376856a8        redis:latest        <span class="s2">"redis"</span>             Less than a second ago   running                                             node-3/redis7
963841b138d8        redis:latest        <span class="s2">"redis"</span>             Less than a second ago   running                                             node-1/redis8
</code></pre></div></div>

<p>ここで分かるように、コンテナーのスケジュールは <code class="highlighter-rouge">redis</code> イメージを持つノードにおいてのみ行われました。
イメージ名でなくイメージ ID を使ってイメージを指定することもできます。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker image <span class="nb">ls
</span>REPOSITORY                         TAG                       IMAGE ID            CREATED             VIRTUAL SIZE
redis                              latest                    06a1f75304ba        2 days ago          111.1 MB

<span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; run <span class="nt">-d</span> <span class="nt">--name</span> redis1 <span class="nt">-e</span> affinity:image<span class="o">==</span>06a1f75304ba redis
</code></pre></div></div>

<h4 id="example-label-affinity">Example label affinity</h4>

<p>A label affinity allows you to filter based on a custom container label. For
example, you can run a <code class="highlighter-rouge">nginx</code> container and apply the
<code class="highlighter-rouge">com.example.type=frontend</code> custom label.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; run <span class="nt">-d</span> <span class="nt">-p</span> 80:80 <span class="nt">--label</span> com.example.type<span class="o">=</span>frontend nginx
 87c4376856a8

<span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; ps  <span class="nt">--filter</span> <span class="s2">"label=com.example.type=frontend"</span>
CONTAINER ID        IMAGE               COMMAND             CREATED                  STATUS              PORTS                           NAMES
87c4376856a8        nginx:latest        <span class="s2">"nginx"</span>             Less than a second ago   running             192.168.0.42:80-&gt;80/tcp         node-1/trusting_yonath
</code></pre></div></div>

<p>Then, use <code class="highlighter-rouge">-e affinity:com.example.type==frontend</code> to schedule a container next
to the container with the <code class="highlighter-rouge">com.example.type==frontend</code> label.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; run <span class="nt">-d</span> <span class="nt">-e</span> affinity:com.example.type<span class="o">==</span>frontend logger
 87c4376856a8

<span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; ps
CONTAINER ID        IMAGE               COMMAND             CREATED                  STATUS              PORTS                           NAMES
87c4376856a8        nginx:latest        <span class="s2">"nginx"</span>             Less than a second ago   running             192.168.0.42:80-&gt;80/tcp         node-1/trusting_yonath
963841b138d8        logger:latest       <span class="s2">"logger"</span>            Less than a second ago   running                                             node-1/happy_hawking
</code></pre></div></div>

<p>The <code class="highlighter-rouge">logger</code> container ends up on <code class="highlighter-rouge">node-1</code> because its affinity with the
<code class="highlighter-rouge">com.example.type==frontend</code> label.</p>

<h3 id="use-a-dependency-filter">Use a dependency filter</h3>

<p>A container dependency filter co-schedules dependent containers on the same node.
Currently, dependencies are declared as follows:</p>

<ul>
  <li><code class="highlighter-rouge">--volumes-from=dependency</code> (shared volumes)</li>
  <li><code class="highlighter-rouge">--link=dependency:alias</code> (links)</li>
  <li><code class="highlighter-rouge">--net=container:dependency</code> (shared network stacks)</li>
</ul>

<p>Swarm attempts to co-locate the dependent container on the same node. If it
cannot be done (because the dependent container doesn’t exist, or because the
node doesn’t have enough resources), it prevents the container creation.</p>

<p>The combination of multiple dependencies are honored if possible. For
instance, if you specify <code class="highlighter-rouge">--volumes-from=A --net=container:B</code>, the scheduler
attempts to co-locate the container on the same node as <code class="highlighter-rouge">A</code> and <code class="highlighter-rouge">B</code>. If those
containers are running on different nodes, Swarm does not schedule the container.</p>

<h3 id="use-a-port-filter">Use a port filter</h3>

<p>When the <code class="highlighter-rouge">port</code> filter is enabled, a container’s port configuration is used as a
unique constraint. Docker Swarm selects a node where a particular port is
available and unoccupied by another container or process. Required ports may be
specified by mapping a host port, or using the host networking and exposing a
port using the container configuration.</p>

<h4 id="example-in-bridge-mode">Example in bridge mode</h4>

<p>By default, containers run on Docker’s bridge network. To use the <code class="highlighter-rouge">port</code> filter
with the bridge network, you run a container as follows.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; run <span class="nt">-d</span> <span class="nt">-p</span> 80:80 nginx
87c4376856a8

<span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; ps
CONTAINER ID    IMAGE               COMMAND         PORTS                       NAMES
87c4376856a8    nginx:latest        <span class="s2">"nginx"</span>         192.168.0.42:80-&gt;80/tcp     node-1/prickly_engelbart
</code></pre></div></div>

<p>Docker Swarm selects a node where port <code class="highlighter-rouge">80</code> is available and unoccupied by another
container or process, in this case <code class="highlighter-rouge">node-1</code>. Attempting to run another container
that uses the host port <code class="highlighter-rouge">80</code> results in Swarm selecting a different node,
because port <code class="highlighter-rouge">80</code> is already occupied on <code class="highlighter-rouge">node-1</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; run <span class="nt">-d</span> <span class="nt">-p</span> 80:80 nginx
963841b138d8

<span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; ps
CONTAINER ID        IMAGE          COMMAND        PORTS                           NAMES
963841b138d8        nginx:latest   <span class="s2">"nginx"</span>        192.168.0.43:80-&gt;80/tcp         node-2/dreamy_turing
87c4376856a8        nginx:latest   <span class="s2">"nginx"</span>        192.168.0.42:80-&gt;80/tcp         node-1/prickly_engelbart
</code></pre></div></div>

<p>Again, repeating the same command results in the selection of <code class="highlighter-rouge">node-3</code>,
since port <code class="highlighter-rouge">80</code> is neither available on <code class="highlighter-rouge">node-1</code> nor <code class="highlighter-rouge">node-2</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; run <span class="nt">-d</span> <span class="nt">-p</span> 80:80 nginx
963841b138d8

<span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; ps
CONTAINER ID   IMAGE               COMMAND        PORTS                           NAMES
f8b693db9cd6   nginx:latest        <span class="s2">"nginx"</span>        192.168.0.44:80-&gt;80/tcp         node-3/stoic_albattani
963841b138d8   nginx:latest        <span class="s2">"nginx"</span>        192.168.0.43:80-&gt;80/tcp         node-2/dreamy_turing
87c4376856a8   nginx:latest        <span class="s2">"nginx"</span>        192.168.0.42:80-&gt;80/tcp         node-1/prickly_engelbart
</code></pre></div></div>

<p>Finally, Docker Swarm refuses to run another container that requires port
<code class="highlighter-rouge">80</code>, because it is not available on any node in the cluster:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; run <span class="nt">-d</span> <span class="nt">-p</span> 80:80 nginx
2014/10/29 00:33:20 Error response from daemon: no resources available to schedule container
</code></pre></div></div>

<p>Each container occupies port <code class="highlighter-rouge">80</code> on its residing node when the container
is created and releases the port when the container is deleted. A container in <code class="highlighter-rouge">exited</code>
state still owns the port. If <code class="highlighter-rouge">prickly_engelbart</code> on <code class="highlighter-rouge">node-1</code> is stopped but not
deleted, trying to start another container on <code class="highlighter-rouge">node-1</code> that requires port <code class="highlighter-rouge">80</code> would fail
because port <code class="highlighter-rouge">80</code> is associated with <code class="highlighter-rouge">prickly_engelbart</code>. To increase running
instances of nginx, you can either restart <code class="highlighter-rouge">prickly_engelbart</code>, or start another container
after deleting <code class="highlighter-rouge">prickly_englbart</code>.</p>

<h4 id="node-port-filter-with-host-networking">Node port filter with host networking</h4>

<p>A container running with <code class="highlighter-rouge">--net=host</code> differs from the default
<code class="highlighter-rouge">bridge</code> mode as the <code class="highlighter-rouge">host</code> mode does not perform any port binding. Instead,
host mode requires that you explicitly expose one or more port numbers. You
expose a port using <code class="highlighter-rouge">EXPOSE</code> in the <code class="highlighter-rouge">Dockerfile</code> or <code class="highlighter-rouge">--expose</code> on the command
line. Swarm makes use of this information in conjunction with the <code class="highlighter-rouge">host</code> mode to
choose an available node for a new container.</p>

<p>For example, the following commands start <code class="highlighter-rouge">nginx</code> on 3-node cluster.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; run <span class="nt">-d</span> <span class="nt">--expose</span><span class="o">=</span>80 <span class="nt">--net</span><span class="o">=</span>host nginx
640297cb29a7
<span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; run <span class="nt">-d</span> <span class="nt">--expose</span><span class="o">=</span>80 <span class="nt">--net</span><span class="o">=</span>host nginx
7ecf562b1b3f
<span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; run <span class="nt">-d</span> <span class="nt">--expose</span><span class="o">=</span>80 <span class="nt">--net</span><span class="o">=</span>host nginx
09a92f582bc2
</code></pre></div></div>

<p>Port binding information is not available through the <code class="highlighter-rouge">docker ps</code> command because
all the nodes were started with the <code class="highlighter-rouge">host</code> network.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; ps
CONTAINER ID        IMAGE               COMMAND                CREATED                  STATUS              PORTS               NAMES
640297cb29a7        nginx:1             <span class="s2">"nginx -g 'daemon of   Less than a second ago   Up 30 seconds                           box3/furious_heisenberg
7ecf562b1b3f        nginx:1             "</span>nginx <span class="nt">-g</span> <span class="s1">'daemon of   Less than a second ago   Up 28 seconds                           box2/ecstatic_meitner
09a92f582bc2        nginx:1             "nginx -g '</span>daemon of   46 seconds ago           Up 27 seconds                           box1/mad_goldstine
</code></pre></div></div>

<p>Swarm refuses the operation when trying to instantiate the 4th container.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span> docker tcp://&lt;manager_ip:manager_port&gt; run <span class="nt">-d</span> <span class="nt">--expose</span><span class="o">=</span>80 <span class="nt">--net</span><span class="o">=</span>host nginx
FATA[0000] Error response from daemon: unable to find a node with port 80/tcp available <span class="k">in </span>the Host mode
</code></pre></div></div>

<p>However, port binding to the different value, for example <code class="highlighter-rouge">81</code>, is still allowed.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span> docker tcp://&lt;manager_ip:manager_port&gt; run <span class="nt">-d</span> <span class="nt">-p</span> 81:80 nginx:latest
832f42819adc
<span class="nv">$ </span> docker tcp://&lt;manager_ip:manager_port&gt; ps
CONTAINER ID        IMAGE               COMMAND                CREATED                  STATUS                  PORTS                                 NAMES
832f42819adc        nginx:1             <span class="s2">"nginx -g 'daemon of   Less than a second ago   Up Less than a second   443/tcp, 192.168.136.136:81-&gt;80/tcp   box3/thirsty_hawking
640297cb29a7        nginx:1             "</span>nginx <span class="nt">-g</span> <span class="s1">'daemon of   8 seconds ago            Up About a minute                                             box3/furious_heisenberg
7ecf562b1b3f        nginx:1             "nginx -g '</span>daemon of   13 seconds ago           Up About a minute                                             box2/ecstatic_meitner
09a92f582bc2        nginx:1             <span class="s2">"nginx -g 'daemon of   About a minute ago       Up About a minute                                             box1/mad_goldstine
</span></code></pre></div></div>

<h2 id="how-to-write-filter-expressions">How to write filter expressions</h2>

<p>To apply a node <code class="highlighter-rouge">constraint</code> or container <code class="highlighter-rouge">affinity</code> filters you must set
environment variables on the container using filter expressions, for example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker tcp://&lt;manager_ip:manager_port&gt; run <span class="nt">-d</span> <span class="nt">--name</span> redis1 <span class="nt">-e</span> affinity:image<span class="o">==</span>~redis redis
</code></pre></div></div>

<p>Each expression must be in the form:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;filter-type&gt;:&lt;key&gt;&lt;operator&gt;&lt;value&gt;
</code></pre></div></div>

<p>The <code class="highlighter-rouge">&lt;filter-type&gt;</code> is either the <code class="highlighter-rouge">affinity</code> or the <code class="highlighter-rouge">constraint</code> keyword. It
identifies the type filter you intend to use.</p>

<p>The <code class="highlighter-rouge">&lt;key&gt;</code> is an alpha-numeric and must start with a letter or underscore. The
<code class="highlighter-rouge">&lt;key&gt;</code> corresponds to one of the following:</p>

<ul>
  <li>the <code class="highlighter-rouge">container</code> keyword</li>
  <li>the <code class="highlighter-rouge">node</code> keyword</li>
  <li>a default tag (node constraints)</li>
  <li>a custom metadata label (nodes or containers).</li>
</ul>

<p>The <code class="highlighter-rouge">&lt;operator&gt; </code>is either <code class="highlighter-rouge">==</code> or <code class="highlighter-rouge">!=</code>. By default, expression operators are
hard enforced. If an expression is not met exactly , the manager does not
schedule the container. You can use a <code class="highlighter-rouge">~</code>(tilde) to create a “soft” expression.
The scheduler tries to match a soft expression. If the expression is not met,
the scheduler discards the filter and schedules the container according to the
scheduler’s strategy.</p>

<p>The <code class="highlighter-rouge">&lt;value&gt;</code> is an alpha-numeric string, dots, hyphens, and underscores making
up one of the following:</p>

<ul>
  <li>A globbing pattern, for example, <code class="highlighter-rouge">abc*</code>.</li>
  <li>A regular expression in the form of <code class="highlighter-rouge">/regexp/</code>. See
<a href="https://github.com/google/re2/wiki/Syntax">re2 syntax</a> for the supported
regex syntax.</li>
</ul>

<p>The following examples illustrate some possible expressions:</p>

<ul>
  <li><code class="highlighter-rouge">constraint:node==node1</code> matches node <code class="highlighter-rouge">node1</code>.</li>
  <li><code class="highlighter-rouge">constraint:node!=node1</code> matches all nodes, except <code class="highlighter-rouge">node1</code>.</li>
  <li><code class="highlighter-rouge">constraint:region!=us*</code> matches all nodes outside with a <code class="highlighter-rouge">region</code> tag prefixed with <code class="highlighter-rouge">us</code>.</li>
  <li><code class="highlighter-rouge">constraint:node==/node[12]/</code> matches nodes <code class="highlighter-rouge">node1</code> and <code class="highlighter-rouge">node2</code>.</li>
  <li><code class="highlighter-rouge">constraint:node==/node\d/</code> matches all nodes with <code class="highlighter-rouge">node</code> + 1 digit.</li>
  <li><code class="highlighter-rouge">constraint:node!=/node-[01]/</code> matches all nodes, except <code class="highlighter-rouge">node-0</code> and <code class="highlighter-rouge">node-1</code>.</li>
  <li><code class="highlighter-rouge">constraint:node!=/foo\[bar\]/</code> matches all nodes, except <code class="highlighter-rouge">foo[bar]</code>. You can see the use of escape characters here.</li>
  <li><code class="highlighter-rouge">constraint:node==/(?i)node1/</code> matches node <code class="highlighter-rouge">node1</code> case-insensitive. So <code class="highlighter-rouge">NoDe1</code> or <code class="highlighter-rouge">NODE1</code> also match.</li>
  <li><code class="highlighter-rouge">affinity:image==~redis</code> tries to match for nodes running container with a <code class="highlighter-rouge">redis</code> image.</li>
  <li><code class="highlighter-rouge">constraint:region==~us*</code> searches for nodes in the cluster belonging to the <code class="highlighter-rouge">us</code> region.</li>
  <li><code class="highlighter-rouge">affinity:container!=~redis*</code> schedules a new <code class="highlighter-rouge">redis5</code> container to a node
without a container that satisfies <code class="highlighter-rouge">redis*</code>.</li>
</ul>

<h2 id="related-information">Related information</h2>

<ul>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/swarm/">Docker Swarm overview</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/swarm/discovery/">Discovery options</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/swarm/scheduler/strategy/">Scheduler strategies</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/swarm/swarm-api/">Swarm API</a></li>
</ul>

							<!-- tags -->
							
							
							
							<span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span style="vertical-align: 2px"><a href="https://matsuand.github.io/docs.docker.jp.onthefly/glossary/?term=docker">docker</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/glossary/?term=swarm">swarm</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/glossary/?term=clustering">clustering</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/glossary/?term=filters">filters</a></span>
							
							<!-- link corrections -->
              <script language="JavaScript">
							var x = document.links.length;
							var baseHref = document.getElementsByTagName('base')[0].href
							for (i = 0; i < x; i++) {
							  var munged = false;
							  var thisHREF = document.links[i].href;
							  var originalURL = "/swarm/scheduler/filter/";
							  if (thisHREF.indexOf(baseHref + "#") > -1) {
							    // hash fix
							    //console.log('BEFORE: base:',baseHref,'thisHREF:',thisHREF,'originalURL:',originalURL);
							    thisHREF = originalURL + thisHREF.replace(baseHref, "");
							    //console.log('AFTER: base:',baseHref,'thisHREF:',thisHREF,'originalURL:',originalURL);
							  }
							  if ((thisHREF.indexOf(window.location.hostname) > -1 || thisHREF.indexOf('http') == -1) && document.links[i].className.indexOf("nomunge") < 0) {
							    munged = true;
							    thisHREF = thisHREF.replace(".md", "/").replace("/index/", "/");
							    document.links[i].setAttribute('href', thisHREF);
							  }
							}
							</script>
							
						  <div id="ratings-div" style="color:#b9c2cc; text-align: center; margin-top: 150px; visibility: hidden">
								<div id="pd_rating_holder_8453675"></div>
								<script type="text/javascript">
									PDRTJS_settings_8453675 = {
										"id": "8453675",
										"unique_id": "swarm/scheduler/filter.md",
										"title": "Swarm フィルター",
										"permalink": "https://github.com/docker/docker.github.io/blob/master/swarm/scheduler/filter.md"
									};
									(function(d, c, j) {
										if (!document.getElementById(j)) {
											var pd = d.createElement(c),
												s;
											pd.id = j;
											pd.src = ('https:' == document.location.protocol) ? 'https://polldaddy.com/js/rating/rating.js' : 'http://i0.poll.fm/js/rating/rating.js';
											s = document.getElementsByTagName(c)[0];
											s.parentNode.insertBefore(pd, s);
										}
									}(document, 'script', 'pd-rating-js'));
								</script>
							</div>
							
						</section>
					</main>
					<nav class="col-nav">
						<div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
						<div id="navbar" class="nav-sidebar">
    <ul class="nav" id="jsTOCLeftNav">
    </ul>
</div>

						</div>
					</nav>
					<div class="col-toc">
							<div class="sidebar hidden-xs hidden-sm">
							<div class="toc-nav">
								<div class="feedback-links">
									<ul>
										
										<li style="visibility: hidden"><a href="https://github.com/matsuand/docs.docker.jp/edit/v19.03.local/swarm/scheduler/filter.md"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> このページの編集</a></li>
										<li><a href="https://github.com/matsuand/docs.docker.jp.onthefly/issues/new?body=File: [swarm/scheduler/filter.md](https://matsuand.github.io/docs.docker.jp.onthefly/swarm/scheduler/filter/)"
															class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> 文書変更のリクエスト</a></li>
										<li><a href="https://success.docker.com/support"><i class="fa fa-question" aria-hidden="true"></i> サポート依頼</a></li>
										<!-- toggle mode -->
										<li>
											<div class="toggle-mode">
												<div class="icon">
													<i class="fa fa-sun-o" aria-hidden="true"></i>
												</div>
												<div class="toggle-switch">
													<label class="switch">
														<input type="checkbox" id="switch-style">
														<div class="slider round"></div>
												</label>
												</div>
												<div class="icon">
													<i class="fa fa-moon-o" aria-hidden="true"></i>
												</div>
											</div>
										</li>
									</ul>
								</div>
								   
									<div id="side-toc-title">本ページ内</div>
									
<ul id="my_toc" class="inline_toc">
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/filter.md#configure-the-available-filters" class="nomunge">Configure the available filters</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/filter.md#node-filters" class="nomunge">Node filters</a>
    <ul>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/filter.md#use-a-constraint-filter" class="nomunge">Use a constraint filter</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/filter.md#use-the-health-filter" class="nomunge">Use the health filter</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/filter.md#use-the-containerslots-filter" class="nomunge">Use the containerslots filter</a></li>
    </ul>
  </li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/filter.md#container-filters" class="nomunge">コンテナーフィルター</a>
    <ul>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/filter.md#use-an-affinity-filter" class="nomunge">affinity フィルターの利用</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/filter.md#use-a-dependency-filter" class="nomunge">Use a dependency filter</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/filter.md#use-a-port-filter" class="nomunge">Use a port filter</a></li>
    </ul>
  </li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/filter.md#how-to-write-filter-expressions" class="nomunge">How to write filter expressions</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/filter.md#related-information" class="nomunge">Related information</a></li>
</ul>


								</div>
								
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	
	<footer class="footer">
		  
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/what-docker">What is Docker</a></li>
                        <li><a href="https://www.docker.com/what-container">What is a Container</a></li>
                        <li><a href="https://www.docker.com/use-cases">Use Cases</a></li>
                        <li><a href="https://www.docker.com/customers">Customers</a></li>
                        <li><a href="https://www.docker.com/partners/partner-program">Partners</a></li>
                        <li class="break"><a href="https://www.docker.com/industry-government">For Government</a></li>
                        <li><a href="https://www.docker.com/company">About Docker</a></li>
                        <li><a href="https://www.docker.com/company/management">Management</a></li>
                        <li><a href="https://www.docker.com/company/news-and-press">Press &amp; News</a></li>
                        <li><a href="https://www.docker.com/careers">Careers</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/products/overview">Product</a></li>
                        <li><a href="https://www.docker.com/pricing">Pricing</a></li>
                        <li><a href="https://www.docker.com/docker-community">Community Edition</a></li>
                        <li class="break"><a href="https://www.docker.com/enterprise">Enterprise Edition </a></li>
                        <li><a href="https://www.docker.com/products/docker-datacenter">Docker Datacenter</a></li>
                        <li><a href="https://hub.docker.com/">Docker Hub</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/">Documentation</a></li>
                        <li><a href="https://www.docker.com/docker">Learn</a></li>
                        <li><a href="https://blog.docker.com" target="_blank">Blog</a></li>
                        <li><a href="https://engineering.docker.com" target="_blank">Engineering Blog</a></li>
                        <li><a href="https://training.docker.com/" target="_blank">Training</a></li>
                        <li><a href="https://success.docker.com/support">Support</a></li>
                        <li><a href="https://success.docker.com/kbase">Knowledge Base</a></li>
                        <li><a href="https://www.docker.com/products/resources">Resources</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/docker-community">Community</a></li>
                        <li><a href="https://www.docker.com/technologies/overview">Open Source</a></li>
                        <li><a href="https://www.docker.com/community/events">Events</a></li>
                        <li><a href="https://forums.docker.com/" target="_blank">Forums</a></li>
                        <li><a href="https://www.docker.com/community/docker-captains">Docker Captains</a></li>
                        <li><a href="https://www.docker.com/docker-community/scholarships">Scholarships</a></li>
                        <li><a href="https://blog.docker.com/curated/">Community News</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="http://status.docker.com/">Status</a></li>
                        <li><a href="https://www.docker.com/docker-security">Security</a></li>
                        <li><a href="https://www.docker.com/legal">Legal</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2019 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="http://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="http://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker">GitHub</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-reddit"><a href="http://www.reddit.com/r/docker">Reddit</a></li>
                    <li class="fa fa-slideshare"><a href="http://www.slideshare.net/docker">Slideshare</a></li>
                </ul>
            </div>
        </div>
    </div>

	</footer>
	<link rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/github.css">
	
	<!-- <script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/anchorlinks.js"></script> -->
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/menu.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/jquery.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/bootstrap.min.js"></script>
	<!-- Always include the archive.js, but it doesn't do much unless we are an archive -->
	<script language="javascript">
	// Default to assuming this is an archive and hiding some stuff
	// See js/archive.js and js/docs.js for logic relating to this
	var isArchive = true;
	var dockerVersion = 'v19.03';
	// In archives, we need to know the page root and we get it from JEKYLL_ENV in the jekyll build command
	var jekyllEnv = 'development';
	// If unset (in non-archive branches), defaults to "development". In that case, reset it to empty
	if (jekyllEnv == 'development') {
		jekyllEnv = '';
	}
	var pageURL = jekyllEnv + '/swarm/scheduler/filter/';
	</script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/archive.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/stickyfill.min.js"></script>
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/metadata.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/glossary.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/collections_tocs.js"></script>
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/docs.js"></script>
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/toc.js"></script>
	<script language="javascript">
	jQuery(document).ready(function(){
				hookupTOCEvents();
			});
	</script>
</body>

</html>
