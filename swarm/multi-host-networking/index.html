<!-- Page generated 2020-05-15 21:58:22 +0900 -->
<!-- Logic for 'edit this button'


    

    

    

    

    

    

    

    

-->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <style type="text/css">
      @charset "UTF-8";
      [ng\:cloak],
      [ng-cloak],
      [data-ng-cloak],
      [x-ng-cloak],
      .ng-cloak,
      .x-ng-cloak,
      .ng-hide:not(.ng-hide-animate) {
          display: none !important;
      }

      ng\:form {
          display: block;
      }
  </style>
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-WL2QLG5');</script>
  <!-- End Google Tag Manager -->
  
  <!-- favicon -->
  <link rel="icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
  <meta name="msapplication-TileImage" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico">
  <link rel="apple-touch-icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
  <meta property="og:image" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico"/>
  <!-- metadata -->
  <meta property="og:type" content="website"/>
  <meta property="og:updated_time" itemprop="dateUpdated" content="2020-05-15T21:58:22+09:00"/>
  <meta property="og:image" itemprop="image primaryImageOfPage" content="/images/docs@2x.png"/>
  <meta name="twitter:card" content="summary"/>
  <meta name="twitter:domain" content="docs.docker.com"/>
  <meta name="twitter:site" content="@docker_docs"/>
  <meta name="twitter:url" content="https://twitter.com/docker_docs"/>
  <meta name="twitter:title" itemprop="title name" content="Multi-host networking with standalone swarms"/>
  <meta name="twitter:description" property="og:description" itemprop="description" content="Standalone swarm only! This article only applies to users who need to use a standalone swarm with Docker, as opposed to swarm mode. Standalone swarms (sometimes known as Swarm Classic)..." />
  <meta name="twitter:image:src" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
  <meta name="twitter:image:alt" content="Docker Documentation"/>
  <meta property="article:published_time" itemprop="datePublished" content="2020-05-15T21:58:22+09:00"/>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="Examples, Usage, network, docker, documentation, user guide, multihost, cluster">
  <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/font-awesome.min.css">
  <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/bootstrap.min.css">
  <link id="pygments" rel="stylesheet" href="/docs.docker.jp.onthefly/css/pygments/perldoc.css">
  <link id="pagestyle" rel="stylesheet" href="/docs.docker.jp.onthefly/css/style.css">

  <!-- Go get "Open Sans" font from Google -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
  <!-- SEO stuff -->
  <title>Multi-host networking with standalone swarms | Docker Documentation</title>
  <meta property="og:title" content="Multi-host networking with standalone swarms" />
  <meta property="og:locale" content="ja_JP" />
  <meta name="description" content="Use overlay for multi-host networking" />
  <meta property="og:description" content="Use overlay for multi-host networking" />
  <link rel="canonical" href="/swarm/multi-host-networking/" />
  <meta property="og:url" content="https://docs.docker.com/swarm/multi-host-networking/" />
  <meta property="og:site_name" content="Docker ドキュメント" />
  <script type="application/ld+json">{"@context":"http://schema.org","@type":"WebPage","headline":"Multi-host networking with standalone swarms","description":"Use overlay for multi-host networking","url":"https://docs.docker.com/swarm/multi-host-networking/"}</script>
  <!-- END SEO STUFF -->
  
  <script>
  // Default to assuming this is an archive and hiding some stuff
  // See js/archive.js and js/docs.js for logic relating to this
  var isArchive = true;
  var dockerVersion = 'v19.03';
  </script>
</head>


    <body ng-app="Docker" ng-controller="DockerController" class="colums">
    <header>
        <nav class="nav-secondary navbar navbar-fixed-top">
    <!-- <div class="fan"></div> -->
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="/docs.docker.jp.onthefly/"><img class="logo" src="/docs.docker.jp.onthefly/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs"></a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="search-form" id="search-div" style="visibility: hidden">
    <form class="search-form form-inline ng-pristine ng-valid" id="searchForm" action="https://matsuand.github.io/docs.docker.jp.onthefly/search/">
        <input class="search-field form-control ds-input" id="st-search-input" value="" name="q" placeholder="文書内検索" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteContainer">
            <div id="autocompleteResults"></div>
        </div>
        <!-- <button type="submit" class="search-submit btn btn-default">検索</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container">
    <div id="tabs">
        <ul class="tabs" id="jsTOCHorizontal">

        </ul>
    </div>
    <div class="ctrl-right hidden-xs hidden-sm">
        <a href="javascript:void(0)" id="menu-toggle"><i class="fa fa-indent" aria-hidden="true"></i></a>
        <div class="btn-group" style="visibility: hidden">
  <button type="button" class="btn btn-default dropdown-btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Docker v19.03 (最新)     <span class="caret"></span>
  </button>
  <ul class="dropdown-menu">
    <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v18.09/">Docker v18.09</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v18.03/">Docker v18.03</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.06/">Docker v17.06</a></li>
  </ul>
</div>

    </div>
</div>

        </div>
    </div>
</nav>

    </header>
    <div class="wrapper right-open">
        <div class="container-fluid">
            <div class="row">
                <div class="col-body">
                    <main class="col-content content">
                        <section class="section">
                            
                            
                            <h1>Multi-host networking with standalone swarms</h1> 
                            <blockquote><p><strong>この文書は古いスタンドアロン版の Swarm に関するものです。</strong> ここではスタンドアロン版 Docker Swarm について説明しています。Docker 1.12 およびそれ以降においては、Docker Engine に対して<a href="/engine/swarm/">スウォームモード</a>が組み入れられました。たいていのユーザーは、統合されたスウォームモードを利用してください。これに関して読み進めるべきドキュメントは、<a href="/engine/swarm/swarm-tutorial/">スウォームモードをはじめよう</a>、<a href="/engine/swarm/#swarm-mode-cli-commands">スウォームモード CLI コマンド</a>、<a href="/get-started/">Docker ウォークスルー</a> です。スタンドアロン版の Docker Swarm は Docker Engine API や CLI コマンドには統合されていません。</p>
</blockquote>
                            
                            <span class="reading-time" title="Estimated reading time">
  <span class="reading-time-label">読む時間の目安: </span>
  
  
    11 分
  
</span>

                            
                            
                            <h2 id="standalone-swarm-only">Standalone swarm only!</h2>

<p>This article only applies to users who need to use a standalone swarm with
Docker, as opposed to swarm mode. Standalone swarms (sometimes known as Swarm
Classic) rely on an external key-value store to store networking information.
Docker swarm mode stores networking information in the Raft logs on the swarm
managers. If you use swarm mode, see
<a href="/docs.docker.jp.onthefly/engine/swarm/networking/">swarm mode networking</a> instead of this article.</p>

<p>If you are using standalone swarms, this article may be useful
to you. This article uses an example to explain the basics of creating a
multi-host network using a standalone swarm and the <code class="highlighter-rouge">overlay</code> network driver.
Unlike <code class="highlighter-rouge">bridge</code> networks, overlay networks require some pre-existing conditions
before you can create one:</p>

<h2 id="overlay-networking-with-an-external-key-value-store">Overlay networking with an external key-value store</h2>

<p>To use Docker with an external key-value store, you need the following:</p>

<ul>
  <li>Access to the key-value store. Docker supports Consul, Etcd, and ZooKeeper
(Distributed store) key-value stores. This example uses Consul.</li>
  <li>A cluster of hosts with connectivity to the key-value store.</li>
  <li>Docker running on each host in the cluster.</li>
  <li>Hosts within the cluster must have unique hostnames because the key-value
store uses the hostnames to identify cluster members.</li>
</ul>

<p>Docker Machine and Docker Swarm are not mandatory to experience Docker
multi-host networking with a key-value store. However, this example uses them to
illustrate how they are integrated. You use Machine to create both the
key-value store server and the host cluster using a standalone swarm.</p>

<blockquote>
  <p><strong>Note</strong>: These examples are not relevant to Docker running in swarm mode and
do not work in such a configuration.</p>
</blockquote>

<h3 id="prerequisites">Prerequisites</h3>

<p>Before you begin, make sure you have a system on your network with the latest
version of Docker and Docker Machine installed. The example also relies
on VirtualBox. If you installed on a Mac or Windows with Docker Toolbox, you
have all of these installed already.</p>

<p>If you have not already done so, make sure you upgrade Docker and Docker
Machine to the latest versions.</p>

<h3 id="set-up-a-key-value-store">Set up a key-value store</h3>

<p>An overlay network requires a key-value store. The key-value store holds
information about the network state which includes discovery, networks,
endpoints, IP addresses, and more. Docker supports Consul, Etcd, and ZooKeeper
key-value stores. This example uses Consul.</p>

<ol>
  <li>
    <p>Log into a system prepared with Docker and Docker Machine installed.</p>
  </li>
  <li>
    <p>Provision a VirtualBox machine called <code class="highlighter-rouge">mh-keystore</code>.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker-machine create <span class="nt">-d</span> virtualbox mh-keystore
</code></pre></div>    </div>

    <p>When you provision a new machine, the process adds Docker to the
host. This means rather than installing Consul manually, you can create an
instance using the <a href="https://hub.docker.com/_/consul/">consul image from Docker
Hub</a>. You do this in the next step.</p>
  </li>
  <li>
    <p>Set your local environment to the <code class="highlighter-rouge">mh-keystore</code> machine.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span> <span class="nb">eval</span> <span class="s2">"</span><span class="k">$(</span>docker-machine env mh-keystore<span class="k">)</span><span class="s2">"</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Start a <code class="highlighter-rouge">consul</code> container running on the <code class="highlighter-rouge">mh-keystore</code> Docker machine.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span> docker run <span class="nt">-d</span> <span class="se">\</span>
  <span class="nt">--name</span> consul <span class="se">\</span>
  <span class="nt">-p</span> <span class="s2">"8500:8500"</span> <span class="se">\</span>
  <span class="nt">-h</span> <span class="s2">"consul"</span> <span class="se">\</span>
  consul agent <span class="nt">-server</span> <span class="nt">-bootstrap</span> <span class="nt">-client</span> <span class="s2">"0.0.0.0"</span>
</code></pre></div>    </div>

    <p>The client starts a <code class="highlighter-rouge">consul</code> image running in the
<code class="highlighter-rouge">mh-keystore</code> Docker machine. The server is called <code class="highlighter-rouge">consul</code> and is
listening on port <code class="highlighter-rouge">8500</code>.</p>
  </li>
  <li>
    <p>Run the <code class="highlighter-rouge">docker ps</code> command to see the <code class="highlighter-rouge">consul</code> container.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker ps

CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                                      NAMES
a47492d6c4d1        consul              <span class="s2">"docker-entrypoint..."</span>   2 seconds ago       Up 1 second         8300-8302/tcp, 8301-8302/udp, 8600/tcp, 8600/udp, 0.0.0.0:8500-&gt;8500/tcp   consul
</code></pre></div>    </div>
  </li>
</ol>

<p>Keep your terminal open and move on to
<a href="#create-a-swarm-cluster">Create a swarm cluster</a>.</p>

<h3 id="create-a-swarm-cluster">Create a swarm cluster</h3>

<p>In this step, you use <code class="highlighter-rouge">docker-machine</code> to provision the hosts for your network.
You don’t actually create the network yet. You create several
Docker machines in VirtualBox. One of the machines acts as the swarm manager
and you create that first. As you create each host, you pass the Docker
daemon on that machine options that are needed by the <code class="highlighter-rouge">overlay</code> network driver.</p>

<blockquote>
  <p><strong>Note</strong>: This creates a standalone swarm cluster, rather than using Docker
in swarm mode. These examples are not relevant to Docker running in swarm mode
and do not work in such a configuration.</p>
</blockquote>

<ol>
  <li>
    <p>Create a swarm manager.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker-machine create <span class="se">\</span>
<span class="nt">-d</span> virtualbox <span class="se">\</span>
<span class="nt">--swarm</span> <span class="nt">--swarm-master</span> <span class="se">\</span>
<span class="nt">--swarm-discovery</span><span class="o">=</span><span class="s2">"consul://</span><span class="k">$(</span>docker-machine ip mh-keystore<span class="k">)</span><span class="s2">:8500"</span> <span class="se">\</span>
<span class="nt">--engine-opt</span><span class="o">=</span><span class="s2">"cluster-store=consul://</span><span class="k">$(</span>docker-machine ip mh-keystore<span class="k">)</span><span class="s2">:8500"</span> <span class="se">\</span>
<span class="nt">--engine-opt</span><span class="o">=</span><span class="s2">"cluster-advertise=eth1:2376"</span> <span class="se">\</span>
mhs-demo0
</code></pre></div>    </div>

    <p>At creation time, you supply the Docker daemon with the <code class="highlighter-rouge">--cluster-store</code>
option. This option tells the Engine the location of the key-value store for
the <code class="highlighter-rouge">overlay</code> network. The bash expansion <code class="highlighter-rouge">$(docker-machine ip mh-keystore)</code>
resolves to the IP address of the Consul server you created in “STEP 1”. The
<code class="highlighter-rouge">--cluster-advertise</code> option advertises the machine on the network.</p>
  </li>
  <li>
    <p>Create another host and add it to the swarm.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker-machine create <span class="nt">-d</span> virtualbox <span class="se">\</span>
  <span class="nt">--swarm</span> <span class="se">\</span>
  <span class="nt">--swarm-discovery</span><span class="o">=</span><span class="s2">"consul://</span><span class="k">$(</span>docker-machine ip mh-keystore<span class="k">)</span><span class="s2">:8500"</span> <span class="se">\</span>
  <span class="nt">--engine-opt</span><span class="o">=</span><span class="s2">"cluster-store=consul://</span><span class="k">$(</span>docker-machine ip mh-keystore<span class="k">)</span><span class="s2">:8500"</span> <span class="se">\</span>
  <span class="nt">--engine-opt</span><span class="o">=</span><span class="s2">"cluster-advertise=eth1:2376"</span> <span class="se">\</span>
  mhs-demo1
</code></pre></div>    </div>
  </li>
  <li>
    <p>List your Docker machines to confirm they are all up and running.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker-machine <span class="nb">ls

</span>NAME         ACTIVE   DRIVER       STATE     URL                         SWARM
default      -        virtualbox   Running   tcp://192.168.99.100:2376
mh-keystore  <span class="k">*</span>        virtualbox   Running   tcp://192.168.99.103:2376
mhs-demo0    -        virtualbox   Running   tcp://192.168.99.104:2376   mhs-demo0 <span class="o">(</span>master<span class="o">)</span>
mhs-demo1    -        virtualbox   Running   tcp://192.168.99.105:2376   mhs-demo0
</code></pre></div>    </div>
  </li>
</ol>

<p>At this point you have a set of hosts running on your network. You are ready to
create a multi-host network for containers using these hosts.</p>

<p>Leave your terminal open and go on to
<a href="#create-the-overlay-network">Create the overlay network</a>.</p>

<h3 id="create-the-overlay-network">Create the overlay network</h3>

<p>To create an overlay network:</p>

<ol>
  <li>
    <p>Set your docker environment to the swarm manager.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">eval</span> <span class="k">$(</span>docker-machine env <span class="nt">--swarm</span> mhs-demo0<span class="k">)</span>
</code></pre></div>    </div>

    <p>Using the <code class="highlighter-rouge">--swarm</code> flag with <code class="highlighter-rouge">docker-machine</code> restricts the <code class="highlighter-rouge">docker</code>
commands to swarm information alone.</p>
  </li>
  <li>
    <p>Use the <code class="highlighter-rouge">docker info</code> command to view the swarm.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker info

Containers: 3
Images: 2
Role: primary
Strategy: spread
Filters: affinity, health, constraint, port, dependency
Nodes: 2
mhs-demo0: 192.168.99.104:2376
└ Containers: 2
└ Reserved CPUs: 0 / 1
└ Reserved Memory: 0 B / 1.021 GiB
└ Labels: <span class="nv">executiondriver</span><span class="o">=</span>native-0.2, <span class="nv">kernelversion</span><span class="o">=</span>4.1.10-boot2docker, <span class="nv">operatingsystem</span><span class="o">=</span>Boot2Docker 1.9.0 <span class="o">(</span>TCL 6.4<span class="o">)</span><span class="p">;</span> master : 4187d2c - Wed Oct 14 14:00:28 UTC 2015, <span class="nv">provider</span><span class="o">=</span>virtualbox, <span class="nv">storagedriver</span><span class="o">=</span>aufs
mhs-demo1: 192.168.99.105:2376
└ Containers: 1
└ Reserved CPUs: 0 / 1
└ Reserved Memory: 0 B / 1.021 GiB
└ Labels: <span class="nv">executiondriver</span><span class="o">=</span>native-0.2, <span class="nv">kernelversion</span><span class="o">=</span>4.1.10-boot2docker, <span class="nv">operatingsystem</span><span class="o">=</span>Boot2Docker 1.9.0 <span class="o">(</span>TCL 6.4<span class="o">)</span><span class="p">;</span> master : 4187d2c - Wed Oct 14 14:00:28 UTC 2015, <span class="nv">provider</span><span class="o">=</span>virtualbox, <span class="nv">storagedriver</span><span class="o">=</span>aufs
CPUs: 2
Total Memory: 2.043 GiB
Name: 30438ece0915
</code></pre></div>    </div>

    <p>This output shows that you are running three containers and two images on
the manager.</p>
  </li>
  <li>
    <p>Create your <code class="highlighter-rouge">overlay</code> network.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker network create <span class="nt">--driver</span> overlay <span class="nt">--subnet</span><span class="o">=</span>10.0.9.0/24 my-net
</code></pre></div>    </div>

    <p>You only need to create the network on a single host in the cluster. In this
case, you used the swarm manager but you could easily have run it on any
host in the swarm.</p>

    <blockquote>
      <p><strong>Note</strong>: It is highly recommended to use the <code class="highlighter-rouge">--subnet</code> option when creating
a network. If the <code class="highlighter-rouge">--subnet</code> is not specified, Docker automatically
chooses and assigns a subnet for the network and it could overlap with another subnet
in your infrastructure that is not managed by Docker. Such overlaps can cause
connectivity issues or failures when containers are connected to that network.</p>
    </blockquote>
  </li>
  <li>
    <p>Check that the network exists:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker network <span class="nb">ls

</span>NETWORK ID          NAME                DRIVER
412c2496d0eb        mhs-demo1/host      host
dd51763e6dd2        mhs-demo0/bridge    bridge
6b07d0be843f        my-net              overlay
b4234109bd9b        mhs-demo0/none      null
1aeead6dd890        mhs-demo0/host      host
d0bb78cbe7bd        mhs-demo1/bridge    bridge
1c0eb8f69ebb        mhs-demo1/none      null
</code></pre></div>    </div>

    <p>Since you are in the swarm manager environment, you see all the networks on all
the swarm participants: the default networks on each Docker daemon and the single overlay
network. Each network has a unique ID and a namespaced name.</p>
  </li>
  <li>
    <p>Switch to each swarm agent in turn and list the networks.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">eval</span> <span class="k">$(</span>docker-machine env mhs-demo0<span class="k">)</span>

<span class="nv">$ </span>docker network <span class="nb">ls

</span>NETWORK ID          NAME                DRIVER
6b07d0be843f        my-net              overlay
dd51763e6dd2        bridge              bridge
b4234109bd9b        none                null
1aeead6dd890        host                host


<span class="nv">$ </span><span class="nb">eval</span> <span class="k">$(</span>docker-machine env mhs-demo1<span class="k">)</span>

<span class="nv">$ </span>docker network <span class="nb">ls

</span>NETWORK ID          NAME                DRIVER
d0bb78cbe7bd        bridge              bridge
1c0eb8f69ebb        none                null
412c2496d0eb        host                host
6b07d0be843f        my-net              overlay
</code></pre></div>    </div>
  </li>
</ol>

<p>Both agents report they have the <code class="highlighter-rouge">my-net</code> network with the <code class="highlighter-rouge">6b07d0be843f</code> ID.
You now have a multi-host container network running!</p>

<h3 id="run-an-application-on-your-network">Run an application on your network</h3>

<p>Once your network is created, you can start a container on any of the hosts and
it automatically is part of the network.</p>

<ol>
  <li>
    <p>Set your environment to the swarm manager.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">eval</span> <span class="k">$(</span>docker-machine env <span class="nt">--swarm</span> mhs-demo0<span class="k">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Start an Nginx web server on the <code class="highlighter-rouge">mhs-demo0</code> instance.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">-itd</span> <span class="se">\</span>
  <span class="nt">--name</span><span class="o">=</span>web <span class="se">\</span>
  <span class="nt">--network</span><span class="o">=</span>my-net <span class="se">\</span>
  <span class="nt">--env</span><span class="o">=</span><span class="s2">"constraint:node==mhs-demo0"</span> <span class="se">\</span>
  nginx:alpine
</code></pre></div>    </div>
  </li>
  <li>
    <p>Run a <code class="highlighter-rouge">busybox</code> instance on the <code class="highlighter-rouge">mhs-demo1</code> instance and get the contents of
the Nginx server’s home page.</p>

    <pre><code class="language-none">$ docker run -it --rm \
  --network=my-net \
  --env="constraint:node==mhs-demo1" \
  busybox wget -O- http://web

Unable to find image 'busybox:latest' locally
latest: Pulling from library/busybox
ab2b8a86ca6c: Pull complete
2c5ac3f849df: Pull complete
Digest: sha256:5551dbdfc48d66734d0f01cafee0952cb6e8eeecd1e2492240bf2fd9640c2279
Status: Downloaded newer image for busybox:latest
Connecting to web (10.0.9.2:80)
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Welcome to nginx!&lt;/title&gt;
&lt;style&gt;
body {
    width: 35em;
    margin: 0 auto;
    font-family: Tahoma, Verdana, Arial, sans-serif;
}
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
&lt;p&gt;If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.&lt;/p&gt;

&lt;p&gt;For online documentation and support, refer to
&lt;a href="http://nginx.org/"&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
Commercial support is available at
&lt;a href="http://nginx.com/"&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
-                    100% |*******************************|   612   0:00:00 ETA
</code></pre>
  </li>
</ol>

<h3 id="check-external-connectivity">Check external connectivity</h3>

<p>As you’ve seen, Docker’s built-in overlay network driver provides out-of-the-box
connectivity between the containers on multiple hosts within the same network.
Additionally, containers connected to the multi-host network are automatically
connected to the <code class="highlighter-rouge">docker_gwbridge</code> network. This network allows the containers
to have external connectivity outside of their cluster.</p>

<ol>
  <li>
    <p>Change your environment to the swarm agent.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">eval</span> <span class="k">$(</span>docker-machine env mhs-demo1<span class="k">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>View the <code class="highlighter-rouge">docker_gwbridge</code> network, by listing the networks.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker network <span class="nb">ls

</span>NETWORK ID          NAME                DRIVER
6b07d0be843f        my-net              overlay
dd51763e6dd2        bridge              bridge
b4234109bd9b        none                null
1aeead6dd890        host                host
e1dbd5dff8be        docker_gwbridge     bridge
</code></pre></div>    </div>
  </li>
  <li>
    <p>Repeat steps 1 and 2 on the swarm manager.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">eval</span> <span class="k">$(</span>docker-machine env mhs-demo0<span class="k">)</span>

<span class="nv">$ </span>docker network <span class="nb">ls

</span>NETWORK ID          NAME                DRIVER
6b07d0be843f        my-net              overlay
d0bb78cbe7bd        bridge              bridge
1c0eb8f69ebb        none                null
412c2496d0eb        host                host
97102a22e8d2        docker_gwbridge     bridge
</code></pre></div>    </div>
  </li>
  <li>
    <p>Check the Nginx container’s network interfaces.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker container <span class="nb">exec </span>web ip addr

1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default
link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
inet 127.0.0.1/8 scope host lo
    valid_lft forever preferred_lft forever
inet6 ::1/128 scope host
    valid_lft forever preferred_lft forever
22: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue state UP group default
link/ether 02:42:0a:00:09:03 brd ff:ff:ff:ff:ff:ff
inet 10.0.9.2/24 scope global eth0
    valid_lft forever preferred_lft forever
inet6 fe80::42:aff:fe00:903/64 scope link
    valid_lft forever preferred_lft forever
24: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default
link/ether 02:42:ac:12:00:02 brd ff:ff:ff:ff:ff:ff
inet 172.18.0.2/16 scope global eth1
    valid_lft forever preferred_lft forever
inet6 fe80::42:acff:fe12:2/64 scope link
    valid_lft forever preferred_lft forever
</code></pre></div>    </div>
  </li>
</ol>

<p>The <code class="highlighter-rouge">eth0</code> interface represents the container interface that is connected to
   the <code class="highlighter-rouge">my-net</code> overlay network. While the <code class="highlighter-rouge">eth1</code> interface represents the
   container interface that is connected to the <code class="highlighter-rouge">docker_gwbridge</code> network.</p>

<h2 id="use-docker-compose-with-swarm-classic">Use Docker Compose with swarm classic</h2>

<p>Refer to the Networking feature introduced in
<a href="/docs.docker.jp.onthefly/compose/networking/">Compose V2 format</a>
and execute the multi-host networking scenario in the swarm cluster used above.</p>

<h2 id="next-steps">Next steps</h2>

<ul>
  <li><a href="/docs.docker.jp.onthefly/network/">Networking overview</a></li>
  <li><a href="/docs.docker.jp.onthefly/network/overlay/">Overlay networks</a></li>
</ul>

                            <!-- tags -->
                            
                            <span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span
                                style="vertical-align: 2px"><a
                                    href="https://docs.docker.com/search/?q=Examples">Examples</a>, <a
                                    href="https://docs.docker.com/search/?q=Usage">Usage</a>, <a
                                    href="https://docs.docker.com/search/?q=network">network</a>, <a
                                    href="https://docs.docker.com/search/?q=docker">docker</a>, <a
                                    href="https://docs.docker.com/search/?q=documentation">documentation</a>, <a
                                    href="https://docs.docker.com/search/?q=user guide">user guide</a>, <a
                                    href="https://docs.docker.com/search/?q=multihost">multihost</a>, <a
                                    href="https://docs.docker.com/search/?q=cluster">cluster</a></span>
                            
                            
                            <div id="ratings-div"
                                style="color:#b9c2cc; text-align: center; margin-top: 150px; visibility: hidden">
                                <div id="pd_rating_holder_8453675"></div>
                                <script type="text/javascript">
                                    PDRTJS_settings_8453675 = {
                                        "id": "8453675",
                                        "unique_id": "swarm/multi-host-networking.md",
                                        "title": "Multi-host networking with standalone swarms",
                                        "permalink": "https://github.com/docker/docker.github.io/blob/master/swarm/multi-host-networking.md"
                                    };
                                    (function (d, c, j) {
                                        if (!document.getElementById(j)) {
                                            var pd = d.createElement(c),
                                                s;
                                            pd.id = j;
                                            pd.src = ('https:' == document.location.protocol) ? 'https://polldaddy.com/js/rating/rating.js' : 'http://i0.poll.fm/js/rating/rating.js';
                                            s = document.getElementsByTagName(c)[0];
                                            s.parentNode.insertBefore(pd, s);
                                        }
                                    }(document, 'script', 'pd-rating-js'));
                                </script>
                            </div>
                            
                        </section>
                    </main>
                    <nav class="col-nav">
                        <div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
                            <div id="navbar" class="nav-sidebar">
    <ul class="nav" id="jsTOCLeftNav">
    </ul>
</div>

                        </div>
                    </nav>
                    <div class="col-toc">
                        <div class="sidebar hidden-xs hidden-sm">
                            <div class="toc-nav">
                                <div class="feedback-links">
                                    <ul>
                                        
                                        <li style="visibility: hidden"><a href="https://github.com/docker/docker.github.io/edit/master/swarm/multi-host-networking.md"><i
                                                    class="fa fa-pencil-square-o" aria-hidden="true"></i> Edit this
                                                page</a></li>
                                        <li><a href="https://github.com/docker/docker.github.io/issues/new?body=File: [swarm/multi-host-networking.md](https://docs.docker.com/swarm/multi-host-networking/)"
                                                class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> Request
                                                docs changes</a></li>
                                        <!-- toggle mode -->
                                        <li>
                                            <div class="toggle-mode">
                                                <div class="icon">
                                                    <i class="fa fa-sun-o" aria-hidden="true"></i>
                                                </div>
                                                <div class="toggle-switch">
                                                    <label class="switch">
                                                        <input type="checkbox" id="switch-style">
                                                        <div class="slider round"></div>
                                                    </label>
                                                </div>
                                                <div class="icon">
                                                    <i class="fa fa-moon-o" aria-hidden="true"></i>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                                
                                
                                
                                
                                <div id="side-toc-title">On this page:</div>
                                
<ul id="my_toc" class="inline_toc">
  <li><a href="#standalone-swarm-only" class="nomunge">Standalone swarm only!</a></li>
  <li><a href="#overlay-networking-with-an-external-key-value-store" class="nomunge">Overlay networking with an external key-value store</a>
    <ul>
      <li><a href="#prerequisites" class="nomunge">Prerequisites</a></li>
      <li><a href="#set-up-a-key-value-store" class="nomunge">Set up a key-value store</a></li>
      <li><a href="#create-a-swarm-cluster" class="nomunge">Create a swarm cluster</a></li>
      <li><a href="#create-the-overlay-network" class="nomunge">Create the overlay network</a></li>
      <li><a href="#run-an-application-on-your-network" class="nomunge">Run an application on your network</a></li>
      <li><a href="#check-external-connectivity" class="nomunge">Check external connectivity</a></li>
    </ul>
  </li>
  <li><a href="#use-docker-compose-with-swarm-classic" class="nomunge">Use Docker Compose with swarm classic</a></li>
  <li><a href="#next-steps" class="nomunge">Next steps</a></li>
</ul>


                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    
    <footer class="footer">
          
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/why-docker">Why Docker</a></b></li>
                        <li><a href="https://www.docker.com/what-container">What is a Container</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/overview">Products</a></b></li>
                        <li><a href="https://www.docker.com/products/docker-desktop">Docker Desktop</a></li>
                        <li><a href="https://www.docker.com/products/docker-hub">Docker Hub</a></li>
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Features</a></b></li>
                        <li><a href="https://www.docker.com/products/container-runtime">Container Runtime</a></li>
                        <li><a href="https://www.docker.com/products/developer-tools">Developer Tools</a></li>
                        <li><a href="https://www.docker.com/products/kubernetes">Kubernetes</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Developers</a></b></li>
                        <li><a href="https://www.docker.com/use-cases">Use Cases</a></li>
                        <li><a href="https://www.docker.com/play-with-docker">Play with Docker</a></li>
                        <li><a href="https://www.docker.com/docker-community">Community</a></li>
                        <li><a href="https://www.docker.com/open-source">Open Source</a></li>
                        <li><a href="https://www.docker.com/community/docker-captains">Docker Captains</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/company" target="_blank">Company</a></b></li>
                        <li><a href="https://www.docker.com/company">About Us</a></li>
                        <li><a href="https://www.docker.com/blog/" target="_blank">Blog</a></li>
                        <li><a href="https://www.docker.com/customers">Customers</a></li>
                        <li><a href="https://www.docker.com/partners">Partners</a></li>
                        <li><a href="https://www.docker.com/company/newsroom">Newsroom</a></li>
                        <li><a href="https://www.docker.com/careers">Careers</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact Us</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="http://status.docker.com/">Status</a></li>
                        <li><a href="https://www.docker.com/docker-security">Security</a></li>
                        <li><a href="https://www.docker.com/legal">Legal</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2013-2020 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="http://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="http://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker">GitHub</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-slideshare"><a href="https://www.slideshare.net/docker">Slideshare</a></li>
                    <li class="fa fa-reddit"><a href="https://www.reddit.com/r/docker">Reddit</a></li>
                </ul>
            </div>
        </div>
    </div>

    </footer>
    <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/github.css">
    
    <script defer src="/docs.docker.jp.onthefly/js/anchorlinks.js"></script>
    <script defer src="/docs.docker.jp.onthefly/js/menu.js"></script>
    <script src="/docs.docker.jp.onthefly/js/jquery.js"></script>
    <script src="/docs.docker.jp.onthefly/js/bootstrap.min.js"></script>
    <!-- Always include the archive.js, but it doesn't do much unless we are an archive -->
    <script>
        // Default to assuming this is an archive and hiding some stuff
        // See js/archive.js and js/docs.js for logic relating to this
        var isArchive = true;
        var dockerVersion = 'v19.03';
        // In archives, we need to know the page root and we get it from JEKYLL_ENV in the jekyll build command
        var jekyllEnv = 'development';
        // If unset (in non-archive branches), defaults to "development". In that case, reset it to empty
        if (jekyllEnv === 'development') {
            jekyllEnv = '';
        }
        var pageURL = jekyllEnv + '/swarm/multi-host-networking/';
    </script>
    <script src="/docs.docker.jp.onthefly/js/archive.js"></script>
    <script src="/docs.docker.jp.onthefly/js/stickyfill.min.js"></script>
    <script defer src="/docs.docker.jp.onthefly/js/metadata.js"></script>
    <script src="/docs.docker.jp.onthefly/js/glossary.js"></script>
    <script defer src="/docs.docker.jp.onthefly/js/docs.js"></script>
    <script defer src="/docs.docker.jp.onthefly/js/toc.js"></script>
    <script>
        jQuery(document).ready(function () { hookupTOCEvents(); });
    </script>
</body>


</html>
