<!-- Page generated 2020-05-04 22:52:55 +0900 -->
<!-- Logic for 'edit this button'


    

    

    

    

    

    

    

    

-->
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <style type="text/css">
        @charset "UTF-8";
        [ng\:cloak],
        [ng-cloak],
        [data-ng-cloak],
        [x-ng-cloak],
        .ng-cloak,
        .x-ng-cloak,
        .ng-hide:not(.ng-hide-animate) {
            display: none !important;
        }

        ng\:form {
            display: block;
        }
    </style>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-WL2QLG5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- favicon -->
    <link rel="icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
    <meta name="msapplication-TileImage" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico">
    <link rel="apple-touch-icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
    <meta property="og:image" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico"/>
    <!-- metadata -->
    <meta property="og:type" content="website"/>
    <meta property="og:updated_time" itemprop="dateUpdated" content="2020-05-04T22:52:55+09:00"/>
    <meta property="og:image" itemprop="image primaryImageOfPage" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:domain" content="docs.docker.com"/>
    <meta name="twitter:site" content="@docker_docs"/>
    <meta name="twitter:url" content="https://twitter.com/docker_docs"/>
    <meta name="twitter:title" itemprop="title name" content="Back up Docker Swarm"/>
    <meta name="twitter:description" property="og:description" itemprop="description" content="Docker manager nodes store the swarm state and manager logs in the /var/lib/docker/swarm/ directory. Swarm raft logs contain crucial information for re-creating Swarm specific resources, including services, secrets, configurations and..." />
    <meta name="twitter:image:src" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
    <meta name="twitter:image:alt" content="Docker ドキュメント"/>
    <meta property="article:published_time" itemprop="datePublished" content="2020-05-04T22:52:55+09:00"/>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="enterprise, backup, swarm">
    <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/font-awesome.min.css">
    <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/bootstrap.min.css">
    <link id="pygments" rel="stylesheet" href="/docs.docker.jp.onthefly/css/pygments/perldoc.css">
    <link id="pagestyle" rel="stylesheet" href="/docs.docker.jp.onthefly/css/style.css">

    <!-- Go get "Open Sans" font from Google -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <!-- SEO stuff -->
    <title>Back up Docker Swarm | Docker ドキュメント</title>
    <meta property="og:title" content="Back up Docker Swarm" />
    <meta property="og:locale" content="ja_JP" />
    <meta name="description" content="Learn how to create a backup of Docker Swarm" />
    <meta property="og:description" content="Learn how to create a backup of Docker Swarm" />
    <link rel="canonical" href="/docs.docker.jp.onthefly/ee/admin/backup/back-up-swarm/" />
    <meta property="og:url" content="https://matsuand.github.io/docs.docker.jp.onthefly/ee/admin/backup/back-up-swarm/" />
    <meta property="og:site_name" content="Docker ドキュメント" />
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"WebPage","headline":"Back up Docker Swarm","description":"Learn how to create a backup of Docker Swarm","url":"https://docs.docker.com/ee/admin/backup/back-up-swarm/"}</script>
    <!-- END SEO STUFF -->
    
    <script>
    // Default to assuming this is an archive and hiding some stuff
    // See js/archive.js and js/docs.js for logic relating to this
    var isArchive = true;
    var dockerVersion = 'v19.03';
    </script>
</head>
<body ng-app="Docker" ng-controller="DockerController" class="colums">
    <header>
        
            <nav class="nav-secondary navbar navbar-fixed-top">
    <!-- <div class="fan"></div> -->
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="/docs.docker.jp.onthefly/"><img class="logo" src="/docs.docker.jp.onthefly/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs"></a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="search-form" id="search-div" style="visibility: hidden">
    <form class="search-form form-inline ng-pristine ng-valid" id="searchForm" action="https://matsuand.github.io/docs.docker.jp.onthefly/search/">
        <input class="search-field form-control ds-input" id="st-search-input" value="" name="q" placeholder="文書内検索" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteContainer">
            <div id="autocompleteResults"></div>
        </div>
        <!-- <button type="submit" class="search-submit btn btn-default">検索</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container">
    <div id="tabs">
        <ul class="tabs" id="jsTOCHorizontal">

        </ul>
    </div>
    <div class="ctrl-right hidden-xs hidden-sm">
        <a href="javascript:void(0)" id="menu-toggle"><i class="fa fa-indent" aria-hidden="true"></i></a>
        <div class="btn-group" style="visibility: hidden">
  <button type="button" class="btn btn-default dropdown-btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Docker v19.03 (最新)     <span class="caret"></span>
  </button>
  <ul class="dropdown-menu">
    <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v18.09/">Docker v18.09</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v18.03/">Docker v18.03</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.06/">Docker v17.06</a></li>
  </ul>
</div>

    </div>
</div>

        </div>
    </div>
</nav>

        
    </header>
    <div class="wrapper right-open">
        <div class="container-fluid">
            <div class="row">
                <div class="col-body">
                    <main class="col-content content">
                        <section class="section">
                            
                                
                            <h1>Back up Docker Swarm</h1>  <span class="reading-time" title="Estimated reading time">
  <span class="reading-time-label">読む時間の目安: </span>
  
  
    3 分
  
</span>

                            
                            
                            <p>Docker manager nodes store the swarm state and manager logs in the <code class="highlighter-rouge">/var/lib/docker/swarm/</code> directory. Swarm raft logs contain crucial information for re-creating Swarm specific resources, including services, secrets, configurations and node cryptographic identity. In 1.13 and higher, this data includes the keys used to encrypt the raft logs. Without these keys, you cannot restore the swarm.</p>

<p>You must perform a manual backup on each manager node, because logs contain node IP address information and are not transferable to other nodes. If you do not backup the raft logs, you cannot verify workloads or Swarm resource provisioning after restoring the cluster.</p>

<blockquote>
  <p>You can avoid performing Swarm backup by storing stacks, services definitions, secrets, and networks definitions in a <em>Source Code Management</em> or <em>Config Management</em> tool.</p>
</blockquote>

<h2 id="swarm-backup-contents">Swarm backup contents</h2>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Data</th>
      <th style="text-align: left">Description</th>
      <th style="text-align: left">Backed up</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Raft keys</td>
      <td style="text-align: left">Used to encrypt communication among Swarm nodes and to encrypt and decrypt Raft logs</td>
      <td style="text-align: left">yes</td>
    </tr>
    <tr>
      <td style="text-align: left">Membership</td>
      <td style="text-align: left">List of the nodes in the cluster</td>
      <td style="text-align: left">yes</td>
    </tr>
    <tr>
      <td style="text-align: left">Services</td>
      <td style="text-align: left">Stacks and services stored in Swarm-mode</td>
      <td style="text-align: left">yes</td>
    </tr>
    <tr>
      <td style="text-align: left">Networks (overlay)</td>
      <td style="text-align: left">The overlay networks created on the cluster</td>
      <td style="text-align: left">yes</td>
    </tr>
    <tr>
      <td style="text-align: left">Configs</td>
      <td style="text-align: left">The configs created in the cluster</td>
      <td style="text-align: left">yes</td>
    </tr>
    <tr>
      <td style="text-align: left">Secrets</td>
      <td style="text-align: left">Secrets saved in the cluster</td>
      <td style="text-align: left">yes</td>
    </tr>
    <tr>
      <td style="text-align: left">Swarm unlock key</td>
      <td style="text-align: left"><strong>Must be saved on a password manager !</strong></td>
      <td style="text-align: left">no</td>
    </tr>
  </tbody>
</table>

<h2 id="procedure">Procedure</h2>

<ol>
  <li>
    <p>Retrieve your Swarm unlock key if <code class="highlighter-rouge">auto-lock</code> is enabled to be able
to restore the swarm from backup. Retrieve the unlock key if necessary and
store it in a safe location. If you are unsure, read
<a href="/docs.docker.jp.onthefly/engine/swarm/swarm_manager_locking/">Lock your swarm to protect its encryption key</a>.</p>
  </li>
  <li>
    <p>Because you must stop the engine of the manager node before performing the backup, having three manager
nodes is recommended for high availability (HA). For a cluster to be operational, a majority of managers
must be online. If less than 3 managers exists, the cluster is unavailable during the backup.</p>

    <blockquote>
      <p><strong>Note</strong>: During the time that a manager is shut down, your swarm is more vulnerable to
losing the quorum if further nodes are lost. A loss of quorum means that the swarm is unavailabile
until quorum is recovered. Quorum is only recovered when more than 50% of the nodes are again available.
If you regularly take down managers to do backups, consider running a 5-manager swarm, so that you
can lose an additional manager while the backup is running without disrupting services.</p>
    </blockquote>
  </li>
  <li>
    <p>Select a manager node. Try not to select the leader in order to avoid a new election inside the cluster:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker node ls -f "role=manager" | tail -n+2 | grep -vi leader
</code></pre></div>    </div>
    <blockquote>
      <p>Optional: Store the Docker version in a variable for easy addition to your backup name.</p>
    </blockquote>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ENGINE=$(docker version -f '{{.Server.Version}}')
</code></pre></div>    </div>
  </li>
  <li>
    <p>Stop the Docker Engine on the manager before backing up the data, so that no data is changed during the backup:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl stop docker
</code></pre></div>    </div>
  </li>
  <li>
    <p>Back up the entire <code class="highlighter-rouge">/var/lib/docker/swarm</code> folder:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> tar cvzf "/tmp/swarm-${ENGINE}-$(hostname -s)-$(date +%s%z).tgz" /var/lib/docker/swarm/
</code></pre></div>    </div>

    <p>Note: <em>You can decode the Unix epoch in the filename by typing <code class="highlighter-rouge">date -d @timestamp</code>.</em>  For example:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>date -d @1531166143
Mon Jul  9 19:55:43 UTC 2018
</code></pre></div>    </div>
  </li>
  <li>
    <p>Restart the manager Docker Engine:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl start docker
</code></pre></div>    </div>
  </li>
  <li>
    <p>Except for step 1, repeat the previous steps for each manager node.</p>
  </li>
</ol>

<h3 id="where-to-go-next">Where to go next</h3>

<ul>
  <li><a href="/docs.docker.jp.onthefly/ee/admin/backup/back-up-ucp/">Back up UCP</a></li>
</ul>


                            <!-- tags -->
                            
                                <span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span style="vertical-align: 2px"><a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=enterprise">enterprise</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=backup">backup</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=swarm">swarm</a></span>
                                
                            
                            <div id="ratings-div" style="color:#b9c2cc; text-align: center; margin-top: 150px; visibility: hidden">
                                <div id="pd_rating_holder_8453675"></div>
                                <script type="text/javascript">
                                    PDRTJS_settings_8453675 = {
                                        "id": "8453675",
                                        "unique_id": "ee/admin/backup/back-up-swarm.md",
                                        "title": "Back up Docker Swarm",
                                        "permalink": "https://github.com/docker/docker.github.io/blob/master/ee/admin/backup/back-up-swarm.md"
                                    };
                                    (function(d, c, j) {
                                        if (!document.getElementById(j)) {
                                            var pd = d.createElement(c),
                                                s;
                                            pd.id = j;
                                            pd.src = ('https:' == document.location.protocol) ? 'https://polldaddy.com/js/rating/rating.js' : 'http://i0.poll.fm/js/rating/rating.js';
                                            s = document.getElementsByTagName(c)[0];
                                            s.parentNode.insertBefore(pd, s);
                                        }
                                    }(document, 'script', 'pd-rating-js'));
                                </script>
                            </div>
                            
                        </section>
                    </main>
                    <nav class="col-nav">
                        <div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
                        <div id="navbar" class="nav-sidebar">
    <ul class="nav" id="jsTOCLeftNav">
    </ul>
</div>

                        </div>
                    </nav>
                    <div class="col-toc">
                        <div class="sidebar hidden-xs hidden-sm">
                            <div class="toc-nav">
                                <div class="feedback-links">
                                    <ul>
                                        
                                        <li style="visibility: hidden"><a href="https://github.com/matsuand/docs.docker.jp/edit/v19.03.local/ee/admin/backup/back-up-swarm.md"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> このページの編集</a></li>
                                        <li><a href="https://github.com/docker/docker.github.io/issues/new?body=File: [ee/admin/backup/back-up-swarm.md](https://docs.docker.com/ee/admin/backup/back-up-swarm/)"
                                                            class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> 文書変更のリクエスト</a></li>
                                        <!-- toggle mode -->
                                        <li>
                                            <div class="toggle-mode">
                                                <div class="icon">
                                                    <i class="fa fa-sun-o" aria-hidden="true"></i>
                                                </div>
                                                <div class="toggle-switch">
                                                    <label class="switch">
                                                        <input type="checkbox" id="switch-style">
                                                        <div class="slider round"></div>
                                                </label>
                                                </div>
                                                <div class="icon">
                                                    <i class="fa fa-moon-o" aria-hidden="true"></i>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                                   
                                <div id="side-toc-title">本ページ内:</div>
                                    
<ul id="my_toc" class="inline_toc">
  <li><a href="#swarm-backup-contents" class="nomunge">Swarm backup contents</a></li>
  <li><a href="#procedure" class="nomunge">Procedure</a>
    <ul>
      <li><a href="#where-to-go-next" class="nomunge">Where to go next</a></li>
    </ul>
  </li>
</ul>


                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    
    <footer class="footer">
          
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/why-docker">Why Docker</a></b></li>
                        <li><a href="https://www.docker.com/what-container">What is a Container</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/overview">Products</a></b></li>
                        <li><a href="https://www.docker.com/products/docker-desktop">Docker Desktop</a></li>
                        <li><a href="https://www.docker.com/products/docker-hub">Docker Hub</a></li>
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Features</a></b></li>
                        <li><a href="https://www.docker.com/products/container-runtime">Container Runtime</a></li>
                        <li><a href="https://www.docker.com/products/developer-tools">Developer Tools</a></li>
                        <li><a href="https://www.docker.com/products/kubernetes">Kubernetes</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Developers</a></b></li>
                        <li><a href="https://www.docker.com/use-cases">Use Cases</a></li>
                        <li><a href="https://www.docker.com/play-with-docker">Play with Docker</a></li>
                        <li><a href="https://www.docker.com/docker-community">Community</a></li>
                        <li><a href="https://www.docker.com/open-source">Open Source</a></li>
                        <li><a href="https://www.docker.com/community/docker-captains">Docker Captains</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/company" target="_blank">Company</a></b></li>
                        <li><a href="https://www.docker.com/company">About Us</a></li>
                        <li><a href="https://www.docker.com/blog/" target="_blank">Blog</a></li>
                        <li><a href="https://www.docker.com/customers">Customers</a></li>
                        <li><a href="https://www.docker.com/partners">Partners</a></li>
                        <li><a href="https://www.docker.com/company/newsroom">Newsroom</a></li>
                        <li><a href="https://www.docker.com/careers">Careers</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact Us</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="http://status.docker.com/">Status</a></li>
                        <li><a href="https://www.docker.com/docker-security">Security</a></li>
                        <li><a href="https://www.docker.com/legal">Legal</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2013-2020 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="http://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="http://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker">GitHub</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-slideshare"><a href="https://www.slideshare.net/docker">Slideshare</a></li>
                    <li class="fa fa-reddit"><a href="https://www.reddit.com/r/docker">Reddit</a></li>
                </ul>
            </div>
        </div>
    </div>

    </footer>
    <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/github.css">
    
    <script defer src="/docs.docker.jp.onthefly/js/anchorlinks.js"></script>
    <script defer src="/docs.docker.jp.onthefly/js/menu.js"></script>
    <script src="/docs.docker.jp.onthefly/js/jquery.js"></script>
    <script src="/docs.docker.jp.onthefly/js/bootstrap.min.js"></script>
    <!-- Always include the archive.js, but it doesn't do much unless we are an archive -->
    <script>
    // Default to assuming this is an archive and hiding some stuff
    // See js/archive.js and js/docs.js for logic relating to this
    var isArchive = true;
    var dockerVersion = 'v19.03';
    // In archives, we need to know the page root and we get it from JEKYLL_ENV in the jekyll build command
    var jekyllEnv = 'development';
    // If unset (in non-archive branches), defaults to "development". In that case, reset it to empty
    if (jekyllEnv === 'development') {
        jekyllEnv = '';
    }
    var pageURL = jekyllEnv + '/ee/admin/backup/back-up-swarm/';
    </script>
    <script src="/docs.docker.jp.onthefly/js/archive.js"></script>
    <script src="/docs.docker.jp.onthefly/js/stickyfill.min.js"></script>
    <script defer src="/docs.docker.jp.onthefly/js/metadata.js"></script>
    <script src="/docs.docker.jp.onthefly/js/glossary.js"></script>
    <script defer src="/docs.docker.jp.onthefly/js/docs.js"></script>
    <script defer src="/docs.docker.jp.onthefly/js/toc.js"></script>
    <script>
    jQuery(document).ready(function(){hookupTOCEvents();});
    </script>
</body>
</html>
