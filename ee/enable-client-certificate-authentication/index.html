<!-- Page generated 2020-04-13 12:18:52 +0900 -->
<!-- relative link basehrefs -->

	
	
	
		
			
		
	
		
			
			


<!-- Logic for 'edit this button' -->


	

	

	

	

	

	

	

	


<!-- End of logic for 'edit this button' -->


<!DOCTYPE html>
<html lang="ja">

<head>
	<base href="/docs.docker.jp.onthefly/ee/" />
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<style type="text/css">
		@charset "UTF-8";
		[ng\:cloak],
		[ng-cloak],
		[data-ng-cloak],
		[x-ng-cloak],
		.ng-cloak,
		.x-ng-cloak,
		.ng-hide:not(.ng-hide-animate) {
			display: none !important;
		}

		ng\:form {
			display: block;
		}
	</style>
	<!-- Google Tag Manager -->
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-WL2QLG5');</script>
	<!-- End Google Tag Manager -->
	
	<!-- favicon -->
	<link rel="icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
	<meta name="msapplication-TileImage" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico">
	<link rel="apple-touch-icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
	<meta property="og:image" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico"/>
	<!-- metadata -->
	<meta property="og:type" content="website"/>
	<meta property="og:updated_time" itemprop="dateUpdated" content="2020-04-13T12:18:52+09:00"/>
	<meta property="og:image" itemprop="image primaryImageOfPage" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
	<meta name="twitter:card" content="summary"/>
	<meta name="twitter:domain" content="docs.docker.jp"/>
	<meta name="twitter:site" content="@docker_docs"/>
	<meta name="twitter:url" content="https://twitter.com/docker_docs"/>
	<meta name="twitter:title" itemprop="title name" content="Enable authentication using TLS client certificates"/>
	<meta name="twitter:description" property="og:description" itemprop="description" content="Overview In many organizations, authenticating to systems with a username and password combination is either restricted or outright prohibited. With Docker Enterprise 3.0, UCP’s CLI client certificate-based authentication has been..." />
	<meta name="twitter:image:src" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
	<meta name="twitter:image:alt" content="Docker ドキュメント"/>
	<meta property="article:published_time" itemprop="datePublished" content="2020-04-13T12:18:52+09:00"/>

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="keywords" content="PKI, Client Certificates, Passwordless Authentication, Docker Enterprise, UCP, DTR, UCP PKI, DTR PKI">
	<link rel="stylesheet" href="/docs.docker.jp.onthefly/css/font-awesome.min.css">
	<link rel="stylesheet" href="/docs.docker.jp.onthefly/css/bootstrap.min.css">
	<link id="pygments" rel="stylesheet" href="/docs.docker.jp.onthefly/css/pygments/perldoc.css">
	<link id="pagestyle" rel="stylesheet" href="/docs.docker.jp.onthefly/css/style.css">

	<!-- Go get "Open Sans" font from Google -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
	<!-- SEO stuff -->
	<title>Enable authentication using TLS client certificates | Docker ドキュメント</title>
<meta property="og:title" content="Enable authentication using TLS client certificates" />
<meta property="og:locale" content="ja_JP" />
<meta name="description" content="Learn how to enable user authentication via client certificates from your own public key infrastructure (PKI)." />
<meta property="og:description" content="Learn how to enable user authentication via client certificates from your own public key infrastructure (PKI)." />
<link rel="canonical" href="/docs.docker.jp.onthefly/ee/enable-client-certificate-authentication/" />
<meta property="og:url" content="https://matsuand.github.io/docs.docker.jp.onthefly/ee/enable-client-certificate-authentication/" />
<meta property="og:site_name" content="Docker ドキュメント" />
<script type="application/ld+json">
{"@context":"http://schema.org","@type":"WebPage","headline":"Enable authentication using TLS client certificates","description":"Learn how to enable user authentication via client certificates from your own public key infrastructure (PKI).","url":"https://matsuand.github.io/docs.docker.jp.onthefly/ee/enable-client-certificate-authentication/"}</script>
	<!-- END SEO STUFF -->
	
	<script language="javascript">
	// Default to assuming this is an archive and hiding some stuff
	// See js/archive.js and js/docs.js for logic relating to this
	var isArchive = true;
	var dockerVersion = 'v19.03';
	</script>
</head>
<body ng-app="Docker" ng-controller="DockerController" class="colums">
	<header>
		 <nav class="nav-secondary navbar navbar-fixed-top">
    <!-- <div class="fan"></div> -->
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="/docs.docker.jp.onthefly/"><img class="logo" src="/docs.docker.jp.onthefly/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs"></a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="search-form" id="search-div" style="visibility: hidden">
    <form class="search-form form-inline ng-pristine ng-valid" id="searchForm" action="/docs.docker.jp.onthefly/search/">
        <input class="search-field form-control ds-input" id="st-search-input" value="" name="q" placeholder="文書内検索" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteContainer">
            <div id="autocompleteResults"></div>
        </div>
        <!-- <button type="submit" class="search-submit btn btn-default">検索</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container">
    <div id="tabs">
        <ul class="tabs" id="jsTOCHorizontal">

        </ul>
    </div>
    <div class="ctrl-right hidden-xs hidden-sm">
        <a href="javascript:void(0)" id="menu-toggle"><i class="fa fa-indent" aria-hidden="true"></i></a>
        <div class="btn-group" style="visibility: hidden">
  <button type="button" class="btn btn-default dropdown-btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Docker v19.03 (current)     <span class="caret"></span>
  </button>
  <ul class="dropdown-menu">
    <li><a href="/docs.docker.jp.onthefly/v18.09/">Docker v18.09</a></li><li><a href="/docs.docker.jp.onthefly/v18.03/">Docker v18.03</a></li><li><a href="/docs.docker.jp.onthefly/v17.06/">Docker v17.06</a></li>
  </ul>
</div>

    </div>
</div>

        </div>
    </div>
</nav>

	</header>

	<div class="wrapper right-open">
		<div class="container-fluid">
			<div class="row">
				<div class="col-body">
					<main class="col-content content">
						<section class="section">
							
								
							<h1>Enable authentication using TLS client certificates</h1>  <span class="reading-time" title="Estimated reading time">
  <span class="reading-time-label">読む時間の目安: </span>
  
  
    10 分
  
</span>

							
							
							<h2 id="overview">Overview</h2>

<p>In many organizations, authenticating to systems with a username and password combination is either restricted or outright prohibited. With Docker Enterprise 3.0, UCP’s <a href="/docs.docker.jp.onthefly/ee/ucp/user-access/cli/">CLI client certificate-based authentication</a> has been extended to the web user interface (web UI). DTR has also been enhanced to work with UCP’s internally generated client bundles for client certificate-based authentication. If you have an external public key infrastructure (PKI) system, you can manage user authentication using a pool of X.509 client certificates in lieu of usernames and passwords.</p>

<h2 id="benefits">Benefits</h2>

<p>The following table outlines existing and added capabilities when using client certificates — both internal to UCP and issued by an external certificate authority (CA) — for authentication.</p>

<table>
  <thead>
    <tr>
      <th>Operation</th>
      <th>Benefit</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="/docs.docker.jp.onthefly/enable-client-certificate-authentication.md#ucp--dtr-browser-authentication">UCP browser authentication</a></td>
      <td>Previously, UCP client bundles enabled communication between a local Docker client and UCP without the need of a username and password. Importing your client certificates into the browser extends this capability to the UCP web UI.</td>
    </tr>
    <tr>
      <td><a href="/docs.docker.jp.onthefly/enable-client-certificate-authentication.md#ucp--dtr-browser-authentication">DTR browser authentication</a></td>
      <td>You can bypass the login page for the DTR web UI when you use TLS client certificates as a DTR authentication method.</td>
    </tr>
    <tr>
      <td><a href="/docs.docker.jp.onthefly/enable-client-certificate-authentication.md#image-pulls-and-pushes-to-dtr">Image pulls and pushes to DTR</a></td>
      <td>You can update Docker engine with a client certificate for image pulls and pushes to DTR without the need for <code class="highlighter-rouge">docker login</code>.</td>
    </tr>
    <tr>
      <td><a href="/docs.docker.jp.onthefly/enable-client-certificate-authentication.md#image-signing">Image signing</a></td>
      <td>You can use client certificates to sign images that you push to DTR. Depending on which you configure to talk to DTR, the certificate files need to be located in certain directories. Alternatively, you can enable system-wide trust of your custom root certificates.</td>
    </tr>
    <tr>
      <td><a href="/docs.docker.jp.onthefly/enable-client-certificate-authentication.md#dtr-api-access">DTR API access</a></td>
      <td>You can use TLS client certificates in lieu of your user credentials to access the DTR API.</td>
    </tr>
    <tr>
      <td><a href="/docs.docker.jp.onthefly/enable-client-certificate-authentication.md#notary-cli-operations-with-dtr">Notary CLI operations with DTR</a></td>
      <td>You can set your DTR as the remote trust server location and pass the certificate flags directly to the Notary CLI to access your DTR repositories.</td>
    </tr>
  </tbody>
</table>

<h2 id="limitations">Limitations</h2>

<ul>
  <li>The security of client certificates issued by your organization’s PKI is outside of UCP’s control. UCP administrators are responsible for instructing their users on how to authenticate via client certificates.</li>
  <li>Username and password authentication cannot be disabled.</li>
  <li>If client certificates have been configured, they will be used for
all <code class="highlighter-rouge">docker push</code> and <code class="highlighter-rouge">docker pull</code> operations for <em>all users</em> of the same
machine.</li>
  <li>Docker Enterprise 3.0 does not check certificate revocation lists (CRLs) or Online Certificate Status Protocol (OCSP) for revoked certificates.</li>
</ul>

<h2 id="ucp--dtr-browser-authentication">UCP / DTR browser authentication</h2>

<p>The following instructions apply to UCP and DTR administrators. For non-admin users, contact your administrator for details on your PKI’s client certificate configuration.</p>

<p>To bypass the browser login pages and hide the logout buttons for both UCP and DTR, follow the steps below.</p>

<ol>
  <li>
    <p>Add your organization’s root CA certificates <a href="/docs.docker.jp.onthefly/ee/ucp/admin/configure/use-your-own-tls-certificates/#configure-ucp-to-use-your-own-tls-certificates-and-keys">via the UCP web UI</a> or <a href="https://success.docker.com/article/how-do-i-provide-an-externally-generated-security-certificate-during-the-ucp-command-line-installation">via the CLI installation command</a>.</p>

    <p>For testing purposes, you can download an <a href="/docs.docker.jp.onthefly/ee/ucp/user-access/cli/#download-client-certificates">admin client bundle</a> from UCP and <a href="/docs.docker.jp.onthefly/enable-client-certificate-authentication.md#convert-your-client-certificates-to-a-PKCS12-file">convert the client certificates to <code class="highlighter-rouge">pkcs12</code></a></p>
  </li>
  <li>
    <p>Download UCP’s <code class="highlighter-rouge">ca.pem</code> from <code class="highlighter-rouge">https://&lt;ucp-url&gt;/ca</code> either in the browser or via <code class="highlighter-rouge">curl</code>. When using <code class="highlighter-rouge">curl</code>, redirect the response output to a file.
  <code class="highlighter-rouge">curl -sk https://&lt;ucp-url&gt;/ca -o ca.pem</code></p>
  </li>
  <li>
    <p>Enable client certificate authentication for DTR. If previously installed, reconfigure DTR with your UCP hostname’s root CA certificate. This will be your organization’s root certificate(s) appended to UCP’s internal root CA certificates.</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  docker run --rm -it docker/dtr:2.7.0 reconfigure --debug --ucp-url \
   &lt;ucp-url&gt; --ucp-username &lt;ucp_admin_user&gt; --ucp-password \ &lt;ucp_admin_password&gt; --enable-client-cert-auth
   --client-cert-auth-ca "$(cat ca.pem)"
</code></pre></div>    </div>

    <p>See <a href="/docs.docker.jp.onthefly/reference/dtr/2.7/cli/install/">DTR installation</a> and <a href="/docs.docker.jp.onthefly/reference/dtr/2.7/cli/reconfigure/">DTR reconfiguration</a> CLI reference pages for an explanation of the different options.</p>
  </li>
  <li>
    <p>Import the PKCS12 file into <a href="/docs.docker.jp.onthefly/enable-client-certificate-authentication.md#pkcs12-file-browser-import">the browser</a> or <a href="https://www.digicert.com/ssl-support/p12-import-export-mac-mavericks-server.htm#import_certificate">Keychain Access</a> if you’re running macOS.</p>
  </li>
</ol>

<h3 id="client-certificate-to-pkcs12-file-conversion">Client certificate to PKCS12 file conversion</h3>

<p>From the command line, switch to the directory of your client bundle and run the following command to convert the client bundle public and private key pair to a <code class="highlighter-rouge">.p12</code> file.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  openssl pkcs12 <span class="nt">-export</span> <span class="nt">-out</span> cert.p12 <span class="nt">-inkey</span> key.pem <span class="nt">-in</span> cert.pem
</code></pre></div></div>

<p>Create with a simple password, you will be prompted for it when you import the certificate into the browser or Mac’s Keychain Access.</p>

<h3 id="pkcs12-file-browser-import">PKCS12 file browser import</h3>

<p>Instructions on how to import a certificate into a web browser vary according to your platform, OS, preferred browser and browser version. As a general rule, refer to one of the following how-to articles:</p>
<ul>
  <li><strong><em>Firefox</em></strong>:
https://www.sslsupportdesk.com/how-to-import-a-certificate-into-firefox/</li>
  <li><strong><em>Chrome</em></strong>:
https://www.comodo.com/support/products/authentication_certs/setup/win_chrome.php</li>
  <li><strong><em>Internet Explorer</em></strong>:
https://www.comodo.com/support/products/authentication_certs/setup/ie7.php</li>
</ul>

<h2 id="image-pulls-and-pushes-to-dtr">Image pulls and pushes to DTR</h2>

<p>For pulling and pushing images to your DTR (with client certificate authentication method enabled) without performing a <code class="highlighter-rouge">docker login</code>, do the following:</p>

<ol>
  <li>
    <p>Create a directory for your DTR public address or FQDN (Fully Qualified Domain Name) within your operating system’s TLS certificate directory.</p>
  </li>
  <li>
    <p>As a <a href="https://en.wikipedia.org/wiki/Superuser">superuser</a>, copy the private key (<code class="highlighter-rouge">client.pem</code>) and certificate (<code class="highlighter-rouge">client.cert</code>) to the machine you are using for pulling and pushing to DTR without doing a <code class="highlighter-rouge">docker login</code>. Note that the filenames must match.</p>
  </li>
  <li>
    <p>Obtain the CA certificate from your DTR server, <code class="highlighter-rouge">ca.crt</code> from <code class="highlighter-rouge">https://&lt;dtrurl&gt;/ca</code>, and copy <code class="highlighter-rouge">ca.crt</code> to your operating system’s TLS certificate directory so that your machine’s Docker Engine will trust DTR. For Linux, this is <code class="highlighter-rouge">/etc/docker/certs.d/&lt;dtrurl&gt;/</code>. On Docker for Mac, this is <code class="highlighter-rouge">/&lt;home_directory&gt;/certs.d/&lt;dtr_fqdn&gt;/</code>.</p>

    <p>This is a convenient alternative to, for Ubuntu as an example, adding the DTR server certificate to <code class="highlighter-rouge">/etc/ca-certs</code> and running <code class="highlighter-rouge">update-ca-certificates</code>.</p>
    <pre><code class="language-curl">  curl -k https://&lt;dtr&gt;/ca -o ca.crt
</code></pre>

    <p>On Ubuntu</p>
    <pre><code class="language-`bash"> cp ca.crt /etc/ca-certs
</code></pre>
  </li>
  <li>
    <p>Restart the Docker daemon for the changes to take effect. See <a href="/docs.docker.jp.onthefly/ee/dtr/user/access-dtr/#configure-your-host">Configure your host</a> for different ways to restart the Docker daemon.</p>
  </li>
</ol>

<h3 id="add-your-dtr-server-ca-certificate-to-system-level">Add your DTR server CA certificate to system level</h3>

<p>You have the option to add your DTR server CA certificate to your system’s trusted root certificate pool. This is MacOS Keychain or <code class="highlighter-rouge">/etc/ca-certificates/</code> on Ubuntu. Note that you will have to remove the certificate if your DTR public address changes.</p>

<h3 id="reference-guides">Reference guides</h3>

<ul>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/security/certificates/">Docker Engine</a></li>
  <li>Docker Desktop
    <ul>
      <li><a href="/docs.docker.jp.onthefly/ee/desktop/user/mac-user/#add-tls-certificates">Enterprise for Mac</a></li>
      <li><a href="/docs.docker.jp.onthefly/ee/desktop/user/windows-user/#adding-tls-certificates">Enterprise for Windows</a></li>
      <li><a href="/docs.docker.jp.onthefly/docker-for-mac/#add-tls-certificates">Community for Mac</a></li>
      <li><a href="/docs.docker.jp.onthefly/docker-for-windows/faqs/#certificates">Community for Windows</a></li>
    </ul>
  </li>
</ul>

<p>Note: The above configuration means that Docker Engine will use the same client certificate for all pulls and pushes to DTR for <strong><em>all users</em></strong> of the same machine.</p>

<h2 id="image-signing">Image signing</h2>

<p>DTR provides the Notary service for using Docker Content Trust (DCT) out of the box.</p>

<table style="width:100%;">
<colgroup>
<col style="width: 35%" />
<col style="width: 30%" />
<col style="width: 35%" />
</colgroup>
<thead>
<tr class="night">
<th>Implementation</th>
<th>Component Pairing</th>
<th>Settings</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="/docs.docker.jp.onthefly/engine/security/trust/content_trust/#signing-images-with-docker-content-trust">Sign with <code>docker trust sign</code></a></td>
<td><ul>
<li>Docker Engine - Enterprise 18.03 or higher</li>
<li>Docker Engine - Community 17.12 or higher</li>
</ul></td>
<td>Copy <code>ca.crt</code> from <code>https://&lt;dtr-external-url&gt;/ca</code> to:
<ul>
<li>Linux: <code>/etc/docker/certs.d/</code></li>
<li>Mac: <code>&lt;home_directory&gt;/.docker/certs.d/</code></li>
</ul></td>
</tr>
<tr class="even">
<td><a href="/docs.docker.jp.onthefly/engine/security/trust/content_trust/#runtime-enforcement-with-docker-content-trust">Enforce signature or hash verification on the Docker client</a></td>
<td><ul>
<li>Docker Engine - Enterprise 17.06 or higher</li>
<li>Docker Engine - Community 17.06 or higher</li>
</ul></td>
<td><code>export DOCKER_CONTENT_TRUST=1</code> to enable content trust on the Docker client. Copy <code>ca.crt</code> from <code>https://&lt;dtr-external-url&gt;/ca</code> to <code>/&lt;home_directory&gt;/.docker/tls/</code> on Linux and macOS. <code>docker push</code> will sign your images.</td>

</tr>
<tr class="odd">
<td><a href="/docs.docker.jp.onthefly/ee/dtr/user/manage-images/sign-images/">Sign images that UCP can trust</a></td>
<td><ul>
<li>Docker Engine - Enterprise 17.06 or higher</li>
<li>Docker UCP 2.2 or higher</li>
</ul></td>
<td>Configure UCP to <a href="/docs.docker.jp.onthefly/ee/ucp/admin/configure/run-only-the-images-you-trust/#configure-ucp">run only signed images</a>. See <a href="/docs.docker.jp.onthefly/ee/dtr/user/manage-images/">Sign an image</a> for detailed steps.</td>
</tr>
</tbody>
</table>

<h2 id="dtr-api-access">DTR API access</h2>

<p>With <code class="highlighter-rouge">curl</code>, you can interact with the DTR
API by passing a public certificate and private key pair instead of
your DTR username and password/authentication token.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">--cert</span> cert.pem <span class="nt">--key</span> key.pem  <span class="nt">-X</span> GET <span class="se">\</span>
<span class="s2">"https://&lt;dtr-external-url&gt;/api/v0/repositories?pageSize=10&amp;count=false"</span> <span class="se">\</span>
<span class="nt">-H</span> <span class="s2">"accept:application/json"</span>
</code></pre></div></div>

<p>In the above example, <code class="highlighter-rouge">cert.pem</code> contains the public certificate and <code class="highlighter-rouge">key.pem</code>
contains the private key. For non-admin users, you can generate a client bundle from UCP or contact your administrator for your public and private key pair.</p>

<p>For Mac-specific quirks, see <a href="/docs.docker.jp.onthefly/enable-client-certificate-authentication.md#curl-on-certain-macos-versions">curl on certain macOS versions</a>.</p>

<h2 id="notary-cli-operations-with-dtr">Notary CLI operations with DTR</h2>

<p>For establishing mutual trust between the Notary client and your trusted registry (DTR) using the Notary CLI, place your TLS client certificates in <code class="highlighter-rouge">&lt;home_directory&gt;/.docker/tls/&lt;dtr-external-url&gt;/</code> as <code class="highlighter-rouge">client.cert</code> and <code class="highlighter-rouge">client.key</code>. Note that the filenames must match. Pass the FQDN or publicly accessible IP address of your registry along with the TLS client certificate options to the Notary client. To get started, see <a href="/docs.docker.jp.onthefly/notary/advanced_usage/">Use the Notary client for advanced users</a>.</p>

<blockquote>
  <h3 id="self-signed-dtr-server-certificate">Self-signed DTR server certificate</h3>

  <p>Also place <code class="highlighter-rouge">ca.crt</code> in <code class="highlighter-rouge">&lt;home_directory&gt;/.docker/tls/&lt;dtr-external-url&gt;/</code> when you’re using a self-signed server certificate for DTR.</p>
</blockquote>

<h2 id="troubleshooting-tips">Troubleshooting tips</h2>

<h3 id="dtr-authentication-via-client-certificates">DTR authentication via client Certificates</h3>

<p>Hit your DTR’s <code class="highlighter-rouge">basic_info</code> endpoint via <code class="highlighter-rouge">curl</code>:</p>

<pre><code class="language-curl">curl --cert cert.pem --key key.pem -X GET "https://&lt;dtr-external-url&gt;/basic_info"
</code></pre>

<p>If successfully configured, you should see <code class="highlighter-rouge">TLSClientCertificate</code> listed as the <code class="highlighter-rouge">AuthnMethod</code> in the JSON response.</p>

<h4 id="example-response">Example Response</h4>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
</span><span class="s2">"CurrentVersion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2.7.0"</span><span class="p">,</span><span class="w">
</span><span class="s2">"User"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"admin"</span><span class="p">,</span><span class="w">
</span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"30f53dd2-763b-430d-bafb-dfa361279b9c"</span><span class="p">,</span><span class="w">
</span><span class="s2">"fullName"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
</span><span class="s2">"isOrg"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
</span><span class="s2">"isAdmin"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
</span><span class="s2">"isActive"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
</span><span class="s2">"isImported"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="p">},</span><span class="w">
</span><span class="s2">"IsAdmin"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
</span><span class="s2">"AuthnMethod"</span><span class="p">:</span><span class="w"> </span><span class="s2">"TLSClientCertificate"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="dtr-as-an-insecure-registry">DTR as an insecure registry</h3>

<p>Avoid adding DTR to Docker Engine’s list of insecure registries as a workaround. This has the side effect of disabling the use of TLS certificates.</p>

<h3 id="dtr-server-certificate-errors">DTR server certificate errors</h3>

<h4 id="example-error">Example Error</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error response from daemon: Get https://35.165.223.150/v2/: x509: certificate is valid <span class="k">for </span>172.17.0.1, not 35.165.223.150
</code></pre></div></div>

<ul>
  <li>
    <p>On the web UI, make sure to add the IP address or the FQDN associated with your custom TLS certificate under <strong>System &gt; General &gt; Domains &amp; Proxies</strong>.</p>
  </li>
  <li>
    <p>From the command line interface, <a href="/docs.docker.jp.onthefly/reference/dtr/2.7/cli/reconfigure/">reconfigure DTR</a> with the <code class="highlighter-rouge">--dtr-external-url</code> option and the associated PEM files for your certificate.</p>
  </li>
</ul>

<h3 id="intermediate-certificates">Intermediate certificates</h3>

<p>For chain of trust which includes intermediate certificates, you may optionally add those certificates when installing or reconfiguring DTR with <code class="highlighter-rouge">--enable-client-cert-auth</code> and <code class="highlighter-rouge">--client-cert-auth-ca</code>. You can do so by combining all of the certificates into a single PEM file.</p>

<h3 id="curl-on-certain-macos-versions">curl on certain macOS versions</h3>

<p>Some versions of macOS include <code class="highlighter-rouge">curl</code> which only accepts <code class="highlighter-rouge">.p12</code> files and specifically requires a <code class="highlighter-rouge">./</code> prefix in front of the file name if running <code class="highlighter-rouge">curl</code> from the same directory as the <code class="highlighter-rouge">.p12</code> file:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl --cert ./client.p12  -X GET \
"https://&lt;dtr-external-url&gt;/api/v0/repositories?pageSize=10&amp;count=false" \
-H "accept:application/json"
</code></pre></div></div>

							<!-- tags -->
							
							<span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span style="vertical-align: 2px"><a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=PKI">PKI</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=Client Certificates">Client Certificates</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=Passwordless Authentication">Passwordless Authentication</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=Docker Enterprise">Docker Enterprise</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=UCP">UCP</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=DTR">DTR</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=UCP PKI">UCP PKI</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=DTR PKI">DTR PKI</a></span>
							
							<!-- link corrections -->
              <script language="JavaScript">
							var x = document.links.length;
							var baseHref = document.getElementsByTagName('base')[0].href
							for (i = 0; i < x; i++) {
							  var munged = false;
							  var thisHREF = document.links[i].href;
							  var originalURL = "/ee/enable-client-certificate-authentication/";
							  if (thisHREF.indexOf(baseHref + "#") > -1) {
							    // hash fix
							    //console.log('BEFORE: base:',baseHref,'thisHREF:',thisHREF,'originalURL:',originalURL);
							    thisHREF = originalURL + thisHREF.replace(baseHref, "");
							    //console.log('AFTER: base:',baseHref,'thisHREF:',thisHREF,'originalURL:',originalURL);
							  }
							  if ((thisHREF.indexOf(window.location.hostname) > -1 || thisHREF.indexOf('http') == -1) && document.links[i].className.indexOf("nomunge") < 0) {
							    munged = true;
							    thisHREF = thisHREF.replace(".md", "/").replace("/index/", "/");
							    document.links[i].setAttribute('href', thisHREF);
							  }
							}
							</script>
							
						  <div id="ratings-div" style="color:#b9c2cc; text-align: center; margin-top: 150px; visibility: hidden">
								<div id="pd_rating_holder_8453675"></div>
								<script type="text/javascript">
									PDRTJS_settings_8453675 = {
										"id": "8453675",
										"unique_id": "ee/enable-client-certificate-authentication.md",
										"title": "Enable authentication using TLS client certificates",
										"permalink": "https://github.com/docker/docker.github.io/blob/master/ee/enable-client-certificate-authentication.md"
									};
									(function(d, c, j) {
										if (!document.getElementById(j)) {
											var pd = d.createElement(c),
												s;
											pd.id = j;
											pd.src = ('https:' == document.location.protocol) ? 'https://polldaddy.com/js/rating/rating.js' : 'http://i0.poll.fm/js/rating/rating.js';
											s = document.getElementsByTagName(c)[0];
											s.parentNode.insertBefore(pd, s);
										}
									}(document, 'script', 'pd-rating-js'));
								</script>
							</div>
							
						</section>
					</main>
					<nav class="col-nav">
						<div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
						<div id="navbar" class="nav-sidebar">
    <ul class="nav" id="jsTOCLeftNav">
    </ul>
</div>

						</div>
					</nav>
					<div class="col-toc">
							<div class="sidebar hidden-xs hidden-sm">
							<div class="toc-nav">
								<div class="feedback-links">
									<ul>
										
										<li style="visibility: hidden"><a href="https://github.com/matsuand/docs.docker.jp/edit/v19.03.local/ee/enable-client-certificate-authentication.md"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> このページの編集</a></li>
										<li><a href="https://github.com/matsuand/docs.docker.jp.onthefly/issues/new?body=File: [ee/enable-client-certificate-authentication.md](https://matsuand.github.io/docs.docker.jp.onthefly/ee/enable-client-certificate-authentication/)"
															class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> 文書変更のリクエスト</a></li>
										<!-- toggle mode -->
										<li>
											<div class="toggle-mode">
												<div class="icon">
													<i class="fa fa-sun-o" aria-hidden="true"></i>
												</div>
												<div class="toggle-switch">
													<label class="switch">
														<input type="checkbox" id="switch-style">
														<div class="slider round"></div>
												</label>
												</div>
												<div class="icon">
													<i class="fa fa-moon-o" aria-hidden="true"></i>
												</div>
											</div>
										</li>
									</ul>
								</div>
								   
									<div id="side-toc-title">本ページ内</div>
									
<ul id="my_toc" class="inline_toc">
  <li><a href="/docs.docker.jp.onthefly/enable-client-certificate-authentication.md#overview" class="nomunge">Overview</a></li>
  <li><a href="/docs.docker.jp.onthefly/enable-client-certificate-authentication.md#benefits" class="nomunge">Benefits</a></li>
  <li><a href="/docs.docker.jp.onthefly/enable-client-certificate-authentication.md#limitations" class="nomunge">Limitations</a></li>
  <li><a href="/docs.docker.jp.onthefly/enable-client-certificate-authentication.md#ucp--dtr-browser-authentication" class="nomunge">UCP / DTR browser authentication</a>
    <ul>
      <li><a href="/docs.docker.jp.onthefly/enable-client-certificate-authentication.md#client-certificate-to-pkcs12-file-conversion" class="nomunge">Client certificate to PKCS12 file conversion</a></li>
      <li><a href="/docs.docker.jp.onthefly/enable-client-certificate-authentication.md#pkcs12-file-browser-import" class="nomunge">PKCS12 file browser import</a></li>
    </ul>
  </li>
  <li><a href="/docs.docker.jp.onthefly/enable-client-certificate-authentication.md#image-pulls-and-pushes-to-dtr" class="nomunge">Image pulls and pushes to DTR</a>
    <ul>
      <li><a href="/docs.docker.jp.onthefly/enable-client-certificate-authentication.md#add-your-dtr-server-ca-certificate-to-system-level" class="nomunge">Add your DTR server CA certificate to system level</a></li>
      <li><a href="/docs.docker.jp.onthefly/enable-client-certificate-authentication.md#reference-guides" class="nomunge">Reference guides</a></li>
    </ul>
  </li>
  <li><a href="/docs.docker.jp.onthefly/enable-client-certificate-authentication.md#image-signing" class="nomunge">Image signing</a></li>
  <li><a href="/docs.docker.jp.onthefly/enable-client-certificate-authentication.md#dtr-api-access" class="nomunge">DTR API access</a></li>
  <li><a href="/docs.docker.jp.onthefly/enable-client-certificate-authentication.md#notary-cli-operations-with-dtr" class="nomunge">Notary CLI operations with DTR</a>
    <ul>
      <li><a href="/docs.docker.jp.onthefly/enable-client-certificate-authentication.md#self-signed-dtr-server-certificate" class="nomunge">Self-signed DTR server certificate</a></li>
    </ul>
  </li>
  <li><a href="/docs.docker.jp.onthefly/enable-client-certificate-authentication.md#troubleshooting-tips" class="nomunge">Troubleshooting tips</a>
    <ul>
      <li><a href="/docs.docker.jp.onthefly/enable-client-certificate-authentication.md#dtr-authentication-via-client-certificates" class="nomunge">DTR authentication via client Certificates</a></li>
      <li><a href="/docs.docker.jp.onthefly/enable-client-certificate-authentication.md#dtr-as-an-insecure-registry" class="nomunge">DTR as an insecure registry</a></li>
      <li><a href="/docs.docker.jp.onthefly/enable-client-certificate-authentication.md#dtr-server-certificate-errors" class="nomunge">DTR server certificate errors</a></li>
      <li><a href="/docs.docker.jp.onthefly/enable-client-certificate-authentication.md#intermediate-certificates" class="nomunge">Intermediate certificates</a></li>
      <li><a href="/docs.docker.jp.onthefly/enable-client-certificate-authentication.md#curl-on-certain-macos-versions" class="nomunge">curl on certain macOS versions</a></li>
    </ul>
  </li>
</ul>


								</div>
								
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	
	<footer class="footer">
		  
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/why-docker">Why Docker</a></b></li>
                        <li><a href="https://www.docker.com/what-container">What is a Container</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/overview">Products</a></b></li>
                        <li><a href="https://www.docker.com/products/docker-desktop">Docker Desktop</a></li>
                        <li><a href="https://www.docker.com/products/docker-hub">Docker Hub</a></li>
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Features</a></b></li>
                        <li><a href="https://www.docker.com/products/container-runtime">Container Runtime</a></li>
                        <li><a href="https://www.docker.com/products/developer-tools">Developer Tools</a></li>
                        <li><a href="https://www.docker.com/products/kubernetes">Kubernetes</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Developers</a></b></li>
                        <li><a href="https://www.docker.com/use-cases">Use Cases</a></li>
                        <li><a href="https://www.docker.com/play-with-docker">Play with Docker</a></li>
                        <li><a href="https://www.docker.com/docker-community">Community</a></li>
                        <li><a href="https://www.docker.com/open-source">Open Source</a></li>
                        <li><a href="https://www.docker.com/community/docker-captains">Docker Captains</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/company" target="_blank">Company</a></b></li>
                        <li><a href="https://www.docker.com/company">About Us</a></li>
                        <li><a href="https://www.docker.com/blog/" target="_blank">Blog</a></li>
                        <li><a href="https://www.docker.com/customers">Customers</a></li>
                        <li><a href="https://www.docker.com/partners">Partners</a></li>
                        <li><a href="https://www.docker.com/company/newsroom">Newsroom</a></li>
                        <li><a href="https://www.docker.com/careers">Careers</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact Us</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="http://status.docker.com/">Status</a></li>
                        <li><a href="https://www.docker.com/docker-security">Security</a></li>
                        <li><a href="https://www.docker.com/legal">Legal</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2013-2020 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="http://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="http://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker">GitHub</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-slideshare"><a href="https://www.slideshare.net/docker">Slideshare</a></li>
                    <li class="fa fa-reddit"><a href="https://www.reddit.com/r/docker">Reddit</a></li>
                </ul>
            </div>
        </div>
    </div>

	</footer>
	<link rel="stylesheet" href="/docs.docker.jp.onthefly/css/github.css">
	
	<script defer src="/docs.docker.jp.onthefly/js/anchorlinks.js"></script>
	<script defer src="/docs.docker.jp.onthefly/js/menu.js"></script>
	<script src="/docs.docker.jp.onthefly/js/jquery.js"></script>
	<script src="/docs.docker.jp.onthefly/js/bootstrap.min.js"></script>
	<!-- Always include the archive.js, but it doesn't do much unless we are an archive -->
	<script language="javascript">
	// Default to assuming this is an archive and hiding some stuff
	// See js/archive.js and js/docs.js for logic relating to this
	var isArchive = true;
	var dockerVersion = 'v19.03';
	// In archives, we need to know the page root and we get it from JEKYLL_ENV in the jekyll build command
	var jekyllEnv = 'development';
	// If unset (in non-archive branches), defaults to "development". In that case, reset it to empty
	if (jekyllEnv == 'development') {
		jekyllEnv = '';
	}
	var pageURL = jekyllEnv + '/ee/enable-client-certificate-authentication/';
	</script>
	<script src="/docs.docker.jp.onthefly/js/archive.js"></script>
	<script src="/docs.docker.jp.onthefly/js/stickyfill.min.js"></script>
	<script defer src="/docs.docker.jp.onthefly/js/metadata.js"></script>
	<script src="/docs.docker.jp.onthefly/js/glossary.js"></script>
	<script defer src="/docs.docker.jp.onthefly/js/docs.js"></script>
	<script defer src="/docs.docker.jp.onthefly/js/toc.js"></script>
	<script language="javascript">
	jQuery(document).ready(function(){
				hookupTOCEvents();
			});
	</script>
</body>

</html>
