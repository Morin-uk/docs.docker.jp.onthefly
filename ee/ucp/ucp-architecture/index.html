<!-- Page generated 2020-03-27 18:38:29 +0900 -->
<!-- relative link basehrefs -->

	
	
	
		
			
		
	
		
			
		
	
		
			
			


<!-- Logic for 'edit this button' -->


	

	

	

	

	

	

	

	

	


<!-- End of logic for 'edit this button' -->


<!DOCTYPE html>
<html lang="ja">

<head>
	<base href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/" />
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<style type="text/css">
		@charset "UTF-8";
		[ng\:cloak],
		[ng-cloak],
		[data-ng-cloak],
		[x-ng-cloak],
		.ng-cloak,
		.x-ng-cloak,
		.ng-hide:not(.ng-hide-animate) {
			display: none !important;
		}

		ng\:form {
			display: block;
		}
	</style>
	<!-- Google Tag Manager -->
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-WL2QLG5');</script>
	<!-- End Google Tag Manager -->
	
	<!-- favicon -->
	<link rel="icon" type="image/x-icon" href="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
	<meta name="msapplication-TileImage" content="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico">
	<link rel="apple-touch-icon" type="image/x-icon" href="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
	<meta property="og:image" content="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico"/>
	<!-- metadata -->
	<meta property="og:type" content="website"/>
	<meta property="og:updated_time" itemprop="dateUpdated" content="2020-03-27T18:38:29+09:00"/>
	<meta property="og:image" itemprop="image primaryImageOfPage" content="https://matsuand.github.io/docs.docker.jp.onthefly/images/docs@2x.png"/>
	<meta name="twitter:card" content="summary"/>
	<meta name="twitter:domain" content="docs.docker.jp"/>
	<meta name="twitter:site" content="@docker_docs"/>
	<meta name="twitter:url" content="https://twitter.com/docker_docs"/>
	<meta name="twitter:title" itemprop="title name" content="UCP アーキテクチャー"/>
	<meta name="twitter:description" property="og:description" itemprop="description" content="This topic applies to Docker Enterprise. The Docker Enterprise platform business, including products, customers, and employees, has been acquired by Mirantis, inc., effective 13-November-2019. For more information on the acquisition..." />
	<meta name="twitter:image:src" content="https://matsuand.github.io/docs.docker.jp.onthefly/images/docs@2x.png"/>
	<meta name="twitter:image:alt" content="Docker ドキュメント"/>
	<meta property="article:published_time" itemprop="datePublished" content="2020-03-27T18:38:29+09:00"/>

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="keywords" content="ucp, architecture">
	<link rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/bootstrap.min.css">
	<link id="pygments" rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/pygments/perldoc.css">
	<link id="pagestyle" rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/style.css">

	<!-- Go get "Open Sans" font from Google -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
	<!-- SEO stuff -->
	<title>UCP アーキテクチャー | Docker ドキュメント</title>
<meta property="og:title" content="UCP アーキテクチャー" />
<meta property="og:locale" content="ja_JP" />
<meta name="description" content="Docker Universal Control Plane について学ぶ。" />
<meta property="og:description" content="Docker Universal Control Plane について学ぶ。" />
<link rel="canonical" href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/ucp-architecture/" />
<meta property="og:url" content="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/ucp-architecture/" />
<meta property="og:site_name" content="Docker ドキュメント" />
<script type="application/ld+json">
{"@context":"http://schema.org","@type":"WebPage","headline":"UCP アーキテクチャー","description":"Docker Universal Control Plane について学ぶ。","url":"https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/ucp-architecture/"}</script>
	<!-- END SEO STUFF -->
	
	<script language="javascript">
	// Default to assuming this is an archive and hiding some stuff
	// See js/archive.js and js/docs.js for logic relating to this
	var isArchive = true;
	var dockerVersion = 'v19.03';
	</script>
</head>
<body ng-app="Docker" ng-controller="DockerController" class="colums">
	<header>
		 <nav class="nav-secondary navbar navbar-fixed-top">
    <!-- <div class="fan"></div> -->
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="https://matsuand.github.io/docs.docker.jp.onthefly/"><img class="logo" src="https://matsuand.github.io/docs.docker.jp.onthefly/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs"></a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="search-form" id="search-div" style="visibility: hidden">
    <form class="search-form form-inline ng-pristine ng-valid" id="searchForm" action="/docs.docker.jp.onthefly/search/">
        <input class="search-field form-control ds-input" id="st-search-input" value="" name="q" placeholder="文書内検索" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteContainer">
            <div id="autocompleteResults"></div>
        </div>
        <!-- <button type="submit" class="search-submit btn btn-default">検索</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container">
    <div id="tabs">
        <ul class="tabs" id="jsTOCHorizontal">

        </ul>
    </div>
    <div class="ctrl-right hidden-xs hidden-sm">
        <a href="javascript:void(0)" id="menu-toggle"><i class="fa fa-indent" aria-hidden="true"></i></a>
        <div class="btn-group" style="visibility: hidden">
  <button type="button" class="btn btn-default dropdown-btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Docker v19.03 (current)     <span class="caret"></span>
  </button>
  <ul class="dropdown-menu">
    <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v18.09/">Docker v18.09</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v18.03/">Docker v18.03</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.06/">Docker v17.06</a></li>
  </ul>
</div>

    </div>
</div>

        </div>
    </div>
</nav>

	</header>

	<div class="wrapper right-open">
		<div class="container-fluid">
			<div class="row">
				<div class="col-body">
					<main class="col-content content">
						<section class="section">
							
								
							<h1>UCP アーキテクチャー</h1>  <span class="reading-time" title="Estimated reading time">
  <span class="reading-time-label">読む時間の目安: </span>
  
  
    11 分
  
</span>

							
							
							<blockquote>
  <!-- This text will be included on all Docker pages that document Enterprise products, features, and technologies that are transitioning to Mirantis. -->
  <p>This topic applies to Docker Enterprise.</p>

  <p>The Docker Enterprise platform business, including products, customers, and employees, has been acquired by Mirantis, inc., effective 13-November-2019. For more information on the acquisition and how it may affect you and your business, refer to the <a href="https://www.docker.com/faq-for-docker-enterprise-customers-and-partners">Docker Enterprise Customer FAQ</a>.</p>
</blockquote>

<p>Docker Universal Control Plane (UCP) は <a href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/index.md">Docker Enterprise Edition</a> 上に稼動する、コンテナー化されたアプリケーションです。
Docker Enterprise Edition 機能の拡張によって、デプロイや設定を単純化し、アプリケーションの規模に応じて監視を行えるようにします。</p>

<p>UCP はまたロールベースアクセス制御（role-based access control; RBAC）により Docker を保護します。
Docker クラスターに対しては承認されたユーザーしか、アプリケーションへの変更とデプロイができないようにします。</p>

<p><img src="images/ucp-architecture-1.svg" alt="" class="with-border" /></p>

<p>UCP のインスタンスをデプロイすると、開発者や IT オペレーターは Docker Engine との直接の対話は行わない形になります。
それにかわって UCP とのやり取りとなります。
ただし UCP は標準的な Docker API を公開しているため、すべての操作はわかりやすいものになっています。
Docker CLI クライアントや Docker Compose などを通じて、すでに慣れ親しんできたツール類を利用していくことができます。</p>

<h2 id="under-the-hood">Under the hood</h2>

<p>UCP は Docker が提供するクラスター機能やオーケストレーション機能を活用しています。</p>

<p><img src="images/ucp-architecture-2.svg" alt="" class="with-border" /></p>

<p>スウォームというものはノードの集まりであって、そのノードはすべて同一の Docker クラスター内にあるものです。
Docker スウォーム内の <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/swarm/key-concepts.md">ノード</a> は 2 つあるモード、つまりマネージャーかワーカーのいずれかにより動作します。
UCP をインストールする際にノードがまだ起動していなかった場合は、ノードはスウォームモード内にて起動するように設定されます。</p>

<p>UCP をデプロイすると、グローバルなスケジュールサービス <code class="highlighter-rouge">ucp-agent</code> が起動します。
このサービスは起動中のノードを監視したり、UCP サービスの起動、停止を行ったりします。
このサービスは <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/swarm/key-concepts.md">マネージャーあるいはワーカーノード</a> において起動されます。</p>

<p>ノード別に以下のようになります。</p>

<ul>
  <li><strong>マネージャー</strong>： <code class="highlighter-rouge">ucp-agent</code> サービスはすべての UCP コンポーネント提供を自動的に開始します。
UCP の ウェブ UI 画面や UCP が利用するデータストアが含まれます。
<code class="highlighter-rouge">ucp-agent</code> はこれらの機能を、ノード上の <a href="https://matsuand.github.io/docs.docker.jp.onthefly/ucp-architecture.md#ucp-components-in-manager-nodes">複数コンテナーのデプロイ</a> によって実現します。
ノードをマネージャーに格上げすると、UCP は自動的に高可用性と耐障害性を持つことになります。</li>
  <li><strong>ワーカー</strong>： ワーカーノードの <code class="highlighter-rouge">ucp-agent</code> サービスは、プロキシーサービスの提供を開始します。
そのノード上においては、承認されたユーザーと他の UCP サービスが Docker コマンドを実行できるようになります。
<code class="highlighter-rouge">ucp-agent</code> は <a href="https://matsuand.github.io/docs.docker.jp.onthefly/ucp-architecture.md#ucp-components-in-worker-nodes">コンテナーのサブセット</a> をワーカーノード上にデプロイします。</li>
</ul>

<h2 id="ucp-internal-components">UCP 内部コマンド</h2>

<p>UCP コンポーネントの中心に位置するのが <code class="highlighter-rouge">ucp-agent</code> というグローバルなスケジュールサービスです。
ノード上に UCP をインストールするか、あるいはすでに UCP により管理されているスウォーム上にノードを追加すると、そのノード上に <code class="highlighter-rouge">ucp-agent</code> サービスが稼動し始めます。</p>

<p>このサービスが起動すると、コンテナー内に他の UCP コンポーネントをデプロイし、継続して起動させます。
ノード上にデプロイされる UCP コンポーネントは、そのノードがマネージャーなのかワーカーなのかによって変わります。</p>

<blockquote>
  <p>メモ</p>

  <p>OS 固有の命名として UCP コンポーネント名において、ノードのオペレーティングシステムに応じたものがあります。
たとえば Windows においてコンポーネント <code class="highlighter-rouge">ucp-agent</code> は <code class="highlighter-rouge">ucp-agent-win</code> となっています。
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/admin/install/architecture-specific-images/">アーキテクチャー固有のイメージについて学ぶ</a> を参照してください。</p>
</blockquote>

<h3 id="ucp-components-in-manager-nodes">マネージャーノードにおける UCP コンポーネント</h3>

<p>マネージャーノードは UCP の全サービスを起動します。
ウェブ UI 画面があり、また UCP の状態を保持するデータストアがあります。
以下の表は、マネージャーノード上にて起動する UCP サービスを示します。</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">UCP コンポーネント</th>
      <th style="text-align: left">内容説明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">k8s_calico-kube-controllers</code></td>
      <td style="text-align: left">A cluster-scoped Kubernetes controller used to coordinate Calico networking. Runs on one manager node only.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">k8s_calico-node</code></td>
      <td style="text-align: left">The Calico node agent, which coordinates networking fabric according to the cluster-wide Calico configuration. Part of the <code class="highlighter-rouge">calico-node</code> daemonset. Runs on all nodes. Configure the container network interface (CNI) plugin by using the <code class="highlighter-rouge">--cni-installer-url</code> flag. If this flag isn’t set, UCP uses Calico as the default CNI plugin.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">k8s_install-cni_calico-node</code></td>
      <td style="text-align: left">A container that’s responsible for installing the Calico CNI plugin binaries and configuration on each host. Part of the <code class="highlighter-rouge">calico-node</code> daemonset. Runs on all nodes.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">k8s_POD_calico-node</code></td>
      <td style="text-align: left">Pause container for the <code class="highlighter-rouge">calico-node</code> pod.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">k8s_POD_calico-kube-controllers</code></td>
      <td style="text-align: left">Pause container for the <code class="highlighter-rouge">calico-kube-controllers</code> pod.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">k8s_POD_compose</code></td>
      <td style="text-align: left">Pause container for the <code class="highlighter-rouge">compose</code> pod.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">k8s_POD_kube-dns</code></td>
      <td style="text-align: left">Pause container for the <code class="highlighter-rouge">kube-dns</code> pod.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">k8s_ucp-dnsmasq-nanny</code></td>
      <td style="text-align: left">A dnsmasq instance used in the Kubernetes DNS Service. Part of the <code class="highlighter-rouge">kube-dns</code> deployment. Runs on one manager node only.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">k8s_ucp-kube-compose</code></td>
      <td style="text-align: left">A custom Kubernetes resource component that’s responsible for translating Compose files into Kubernetes constructs. Part of the <code class="highlighter-rouge">compose</code> deployment. Runs on one manager node only.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">k8s_ucp-kube-dns</code></td>
      <td style="text-align: left">The main Kubernetes DNS Service, used by pods to <a href="https://v1-11.docs.kubernetes.io/docs/concepts/services-networking/dns-pod-service/">resolve service names</a>. Part of the <code class="highlighter-rouge">kube-dns</code> deployment. Runs on one manager node only. Provides service discovery for Kubernetes services and pods. A set of three containers deployed via Kubernetes as a single pod.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">k8s_ucp-kubedns-sidecar</code></td>
      <td style="text-align: left">Health checking and metrics daemon of the Kubernetes DNS Service. Part of the <code class="highlighter-rouge">kube-dns</code> deployment. Runs on one manager node only.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-agent</code></td>
      <td style="text-align: left">Monitors the node and ensures the right UCP services are running.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-auth-api</code></td>
      <td style="text-align: left">The centralized service for identity and authentication used by UCP and DTR.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-auth-store</code></td>
      <td style="text-align: left">Stores authentication configurations and data for users, organizations, and teams.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-auth-worker</code></td>
      <td style="text-align: left">Performs scheduled LDAP synchronizations and cleans authentication and authorization data.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-client-root-ca</code></td>
      <td style="text-align: left">A certificate authority to sign client bundles.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-cluster-root-ca</code></td>
      <td style="text-align: left">A certificate authority used for TLS communication between UCP components.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-controller</code></td>
      <td style="text-align: left">The UCP web server.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-dsinfo</code></td>
      <td style="text-align: left">Docker system information collection script to assist with troubleshooting.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-interlock</code></td>
      <td style="text-align: left">Monitors swarm workloads configured to use Layer 7 routing. Only runs when you enable Layer 7 routing.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-interlock-proxy</code></td>
      <td style="text-align: left">A service that provides load balancing and proxying for swarm workloads. Only runs when you enable Layer 7 routing.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-kube-apiserver</code></td>
      <td style="text-align: left">A master component that serves the Kubernetes API. It persists its state in <code class="highlighter-rouge">etcd</code> directly, and all other components communicate with the API server directly. The Kubernetes API server is configured to encrypt Secrets using AES-CBC with a 256-bit key.<sup id="fnref:1"><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ucp-architecture.md#fn:1" class="footnote">1</a></sup></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-kube-controller-manager</code></td>
      <td style="text-align: left">A master component that manages the desired state of controllers and other Kubernetes objects. It monitors the API server and performs background tasks when needed.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-kubelet</code></td>
      <td style="text-align: left">The Kubernetes node agent running on every node, which is responsible for running Kubernetes pods, reporting the health of the node, and monitoring resource usage.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-kube-proxy</code></td>
      <td style="text-align: left">The networking proxy running on every node, which enables pods to contact Kubernetes services and other pods, via cluster IP addresses.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-kube-scheduler</code></td>
      <td style="text-align: left">A master component that handles scheduling of pods. It communicates with the API server only to obtain workloads that need to be scheduled.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-kv</code></td>
      <td style="text-align: left">Used to store the UCP configurations. Don’t use it in your applications, since it’s for internal use only. Also used by Kubernetes components.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-metrics</code></td>
      <td style="text-align: left">Used to collect and process metrics for a node, like the disk space available.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-proxy</code></td>
      <td style="text-align: left">A TLS proxy. It allows secure access to the local Docker Engine to UCP components.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-reconcile</code></td>
      <td style="text-align: left">When <code class="highlighter-rouge">ucp-agent</code> detects that the node is not running the right UCP components, it starts the ucp-reconcile container to converge the node to its desired state. It is expected for the ucp-reconcile container to remain in an exited state when the node is healthy.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-swarm-manager</code></td>
      <td style="text-align: left">Used to provide backwards-compatibility with Docker Swarm.</td>
    </tr>
  </tbody>
</table>

<h3 id="ucp-components-in-worker-nodes">ワーカーノードにおける UCP コンポーネント</h3>

<p>Applications run on worker nodes. The following table shows the UCP services running on worker nodes.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">UCP コンポーネント</th>
      <th style="text-align: left">内容説明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">k8s_calico-node</code></td>
      <td style="text-align: left">The Calico node agent, which coordinates networking fabric according to the cluster-wide Calico configuration. Part of the <code class="highlighter-rouge">calico-node</code> daemonset. Runs on all nodes.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">k8s_install-cni_calico-node</code></td>
      <td style="text-align: left">A container that’s responsible for installing the Calico CNI plugin binaries and configuration on each host. Part of the <code class="highlighter-rouge">calico-node</code> daemonset. Runs on all nodes.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">k8s_POD_calico-node</code></td>
      <td style="text-align: left">Pause container for the Calico-node pod. By default, this container is hidden, but you can see it by running <code class="highlighter-rouge">docker ps -a</code>.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-agent</code></td>
      <td style="text-align: left">Monitors the node and ensures the right UCP services are running</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-interlock-extension</code></td>
      <td style="text-align: left">Helper service that reconfigures the ucp-interlock-proxy service based on the swarm workloads that are running.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-interlock-proxy</code></td>
      <td style="text-align: left">A service that provides load balancing and proxying for swarm workloads. Only runs when you enable Layer 7 routing.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-dsinfo</code></td>
      <td style="text-align: left">Docker system information collection script to assist with troubleshooting.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-kubelet</code></td>
      <td style="text-align: left">The kubernetes node agent running on every node, which is responsible for running Kubernetes pods, reporting the health of the node, and monitoring resource usage.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-kube-proxy</code></td>
      <td style="text-align: left">The networking proxy running on every node, which enables pods to contact Kubernetes services and other pods, via cluster IP addresses.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-reconcile</code></td>
      <td style="text-align: left">When <code class="highlighter-rouge">ucp-agent</code> detects that the node is not running the right UCP components, it starts the <code class="highlighter-rouge">ucp-reconcile</code> container to converge the node to its desired state. It is expected for the <code class="highlighter-rouge">ucp-reconcile</code> container to remain in an exited state when the node is healthy.</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-proxy</code></td>
      <td style="text-align: left">A TLS proxy. It allows secure access to the local Docker Engine to UCP components.</td>
    </tr>
  </tbody>
</table>

<h2 id="pause-containers">Pause containers</h2>

<p>Every pod in Kubernetes has a <em>pause</em> container, which is an “empty” container
that bootstraps the pod to establish all of the namespaces. Pause containers
hold the cgroups, reservations, and namespaces of a pod before its individual
containers are created. The pause container’s image is always present, so the
allocation of the pod’s resources is instantaneous.</p>

<p>By default, pause containers are hidden, but you can see them by running
<code class="highlighter-rouge">docker ps -a</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker ps -a | grep -I pause

8c9707885bf6        dockereng/ucp-pause:3.0.0-6d332d3        "/pause"                 47 hours ago        Up 47 hours                                                                                               k8s_POD_calico-kube-controllers-559f6948dc-5c84l_kube-system_d00e5130-1bf4-11e8-b426-0242ac110011_0
258da23abbf5        dockereng/ucp-pause:3.0.0-6d332d3        "/pause"                 47 hours ago        Up 47 hours                                                                                               k8s_POD_kube-dns-6d46d84946-tqpzr_kube-system_d63acec6-1bf4-11e8-b426-0242ac110011_0
2e27b5d31a06        dockereng/ucp-pause:3.0.0-6d332d3        "/pause"                 47 hours ago        Up 47 hours                                                                                               k8s_POD_compose-698cf787f9-dxs29_kube-system_d5866b3c-1bf4-11e8-b426-0242ac110011_0
5d96dff73458        dockereng/ucp-pause:3.0.0-6d332d3        "/pause"                 47 hours ago        Up 47 hours                                                                                               k8s_POD_calico-node-4fjgv_kube-system_d043a0ea-1bf4-11e8-b426-0242ac110011_0
</code></pre></div></div>

<h2 id="volumes-used-by-ucp">Volumes used by UCP</h2>

<p>UCP uses the following named volumes to persist data in all nodes where it runs.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Volume name</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-auth-api-certs</code></td>
      <td style="text-align: left">Certificate and keys for the authentication and authorization service</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-auth-store-certs</code></td>
      <td style="text-align: left">Certificate and keys for the authentication and authorization store</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-auth-store-data</code></td>
      <td style="text-align: left">Data of the authentication and authorization store, replicated across managers</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-auth-worker-certs</code></td>
      <td style="text-align: left">Certificate and keys for authentication worker</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-auth-worker-data</code></td>
      <td style="text-align: left">Data of the authentication worker</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-client-root-ca</code></td>
      <td style="text-align: left">Root key material for the UCP root CA that issues client certificates</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-cluster-root-ca</code></td>
      <td style="text-align: left">Root key material for the UCP root CA that issues certificates for swarm members</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-controller-client-certs</code></td>
      <td style="text-align: left">Certificate and keys used by the UCP web server to communicate with other UCP components</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-controller-server-certs</code></td>
      <td style="text-align: left">Certificate and keys for the UCP web server running in the node</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-kv</code></td>
      <td style="text-align: left">UCP configuration data, replicated across managers</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-kv-certs</code></td>
      <td style="text-align: left">Certificates and keys for the key-value store</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-metrics-data</code></td>
      <td style="text-align: left">Monitoring data gathered by UCP</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-metrics-inventory</code></td>
      <td style="text-align: left">Configuration file used by the ucp-metrics service</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">ucp-node-certs</code></td>
      <td style="text-align: left">Certificate and keys for node communication</td>
    </tr>
  </tbody>
</table>

<p>You can customize the volume driver used for these volumes, by creating
the volumes before installing UCP. During the installation, UCP checks which
volumes don’t exist in the node, and creates them using the default volume
driver.</p>

<p>By default, the data for these volumes can be found at
<code class="highlighter-rouge">/var/lib/docker/volumes/&lt;volume-name&gt;/_data</code>.</p>

<h2 id="configurations-used-by-ucp">UCP にて用いられる設定</h2>

<p>The following table shows the configurations used by UCP.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">設定名</th>
      <th style="text-align: left">内容説明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">com.docker.interlock.extension</code></td>
      <td style="text-align: left">Configuration for the Interlock extension service that monitors and configures the proxy service</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">com.docker.interlock.proxy</code></td>
      <td style="text-align: left">Configuration for the service responsible for handling user requests and routing them</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">com.docker.license</code></td>
      <td style="text-align: left">The Docker EE license</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">com.docker.ucp.interlock.conf</code></td>
      <td style="text-align: left">Configuration for the core Interlock service</td>
    </tr>
  </tbody>
</table>

<h2 id="how-you-interact-with-ucp">UCP の操作方法</h2>

<p>UCP を操作する方法は 2 とおりあります。
ウェブ UI 画面と CLI です。</p>

<p>You can use the UCP web UI to manage your swarm, grant and revoke user
permissions, deploy, configure, manage, and monitor your applications.</p>

<p><img src="images/ucp-architecture-3.svg" alt="" class="with-border" /></p>

<p>UCP also exposes the standard Docker API, so you can continue using existing
tools like the Docker CLI client. Since UCP secures your cluster with RBAC, you need to configure your Docker CLI client and other client
tools to authenticate your requests using
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/user-access/">client certificates</a> that you can download
from your UCP profile page.</p>

<h2 id="where-to-go-next">Where to go next</h2>

<ul>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/admin/install/system-requirements/">System requirements</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/admin/install/plan-installation/">Plan your installation</a></li>
</ul>
<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>Known limitations: the encryption key is never rotated, and the encryption key is stored in a file on disk on manager nodes. <a href="https://matsuand.github.io/docs.docker.jp.onthefly/ucp-architecture.md#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

							<!-- tags -->
							
							
							
							<span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span style="vertical-align: 2px"><a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=ucp">ucp</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=architecture">architecture</a></span>
							
							<!-- link corrections -->
              <script language="JavaScript">
							var x = document.links.length;
							var baseHref = document.getElementsByTagName('base')[0].href
							for (i = 0; i < x; i++) {
							  var munged = false;
							  var thisHREF = document.links[i].href;
							  var originalURL = "/ee/ucp/ucp-architecture/";
							  if (thisHREF.indexOf(baseHref + "#") > -1) {
							    // hash fix
							    //console.log('BEFORE: base:',baseHref,'thisHREF:',thisHREF,'originalURL:',originalURL);
							    thisHREF = originalURL + thisHREF.replace(baseHref, "");
							    //console.log('AFTER: base:',baseHref,'thisHREF:',thisHREF,'originalURL:',originalURL);
							  }
							  if ((thisHREF.indexOf(window.location.hostname) > -1 || thisHREF.indexOf('http') == -1) && document.links[i].className.indexOf("nomunge") < 0) {
							    munged = true;
							    thisHREF = thisHREF.replace(".md", "/").replace("/index/", "/");
							    document.links[i].setAttribute('href', thisHREF);
							  }
							}
							</script>
							
						  <div id="ratings-div" style="color:#b9c2cc; text-align: center; margin-top: 150px; visibility: hidden">
								<div id="pd_rating_holder_8453675"></div>
								<script type="text/javascript">
									PDRTJS_settings_8453675 = {
										"id": "8453675",
										"unique_id": "ee/ucp/ucp-architecture.md",
										"title": "UCP アーキテクチャー",
										"permalink": "https://github.com/docker/docker.github.io/blob/master/ee/ucp/ucp-architecture.md"
									};
									(function(d, c, j) {
										if (!document.getElementById(j)) {
											var pd = d.createElement(c),
												s;
											pd.id = j;
											pd.src = ('https:' == document.location.protocol) ? 'https://polldaddy.com/js/rating/rating.js' : 'http://i0.poll.fm/js/rating/rating.js';
											s = document.getElementsByTagName(c)[0];
											s.parentNode.insertBefore(pd, s);
										}
									}(document, 'script', 'pd-rating-js'));
								</script>
							</div>
							
						</section>
					</main>
					<nav class="col-nav">
						<div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
						<div id="navbar" class="nav-sidebar">
    <ul class="nav" id="jsTOCLeftNav">
    </ul>
</div>

						</div>
					</nav>
					<div class="col-toc">
							<div class="sidebar hidden-xs hidden-sm">
							<div class="toc-nav">
								<div class="feedback-links">
									<ul>
										
										<li style="visibility: hidden"><a href="https://github.com/matsuand/docs.docker.jp/edit/v19.03.local/ee/ucp/ucp-architecture.md"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> このページの編集</a></li>
										<li><a href="https://github.com/matsuand/docs.docker.jp.onthefly/issues/new?body=File: [ee/ucp/ucp-architecture.md](https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/ucp-architecture/)"
															class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> 文書変更のリクエスト</a></li>
										<li><a href="https://success.docker.com/support"><i class="fa fa-question" aria-hidden="true"></i> サポート依頼</a></li>
										<!-- toggle mode -->
										<li>
											<div class="toggle-mode">
												<div class="icon">
													<i class="fa fa-sun-o" aria-hidden="true"></i>
												</div>
												<div class="toggle-switch">
													<label class="switch">
														<input type="checkbox" id="switch-style">
														<div class="slider round"></div>
												</label>
												</div>
												<div class="icon">
													<i class="fa fa-moon-o" aria-hidden="true"></i>
												</div>
											</div>
										</li>
									</ul>
								</div>
								   
									<div id="side-toc-title">本ページ内</div>
									
<ul id="my_toc" class="inline_toc">
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ucp-architecture.md#under-the-hood" class="nomunge">Under the hood</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ucp-architecture.md#ucp-internal-components" class="nomunge">UCP 内部コマンド</a>
    <ul>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ucp-architecture.md#ucp-components-in-manager-nodes" class="nomunge">マネージャーノードにおける UCP コンポーネント</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ucp-architecture.md#ucp-components-in-worker-nodes" class="nomunge">ワーカーノードにおける UCP コンポーネント</a></li>
    </ul>
  </li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ucp-architecture.md#pause-containers" class="nomunge">Pause containers</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ucp-architecture.md#volumes-used-by-ucp" class="nomunge">Volumes used by UCP</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ucp-architecture.md#configurations-used-by-ucp" class="nomunge">UCP にて用いられる設定</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ucp-architecture.md#how-you-interact-with-ucp" class="nomunge">UCP の操作方法</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ucp-architecture.md#where-to-go-next" class="nomunge">Where to go next</a></li>
</ul>


								</div>
								
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	
	<footer class="footer">
		  
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/what-docker">What is Docker</a></li>
                        <li><a href="https://www.docker.com/what-container">What is a Container</a></li>
                        <li><a href="https://www.docker.com/use-cases">Use Cases</a></li>
                        <li><a href="https://www.docker.com/customers">Customers</a></li>
                        <li><a href="https://www.docker.com/partners/partner-program">Partners</a></li>
                        <li class="break"><a href="https://www.docker.com/industry-government">For Government</a></li>
                        <li><a href="https://www.docker.com/company">About Docker</a></li>
                        <li><a href="https://www.docker.com/company/management">Management</a></li>
                        <li><a href="https://www.docker.com/company/news-and-press">Press &amp; News</a></li>
                        <li><a href="https://www.docker.com/careers">Careers</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/products/overview">Product</a></li>
                        <li><a href="https://www.docker.com/pricing">Pricing</a></li>
                        <li><a href="https://www.docker.com/docker-community">Community Edition</a></li>
                        <li class="break"><a href="https://www.docker.com/enterprise">Enterprise Edition </a></li>
                        <li><a href="https://www.docker.com/products/docker-datacenter">Docker Datacenter</a></li>
                        <li><a href="https://hub.docker.com/">Docker Hub</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/">Documentation</a></li>
                        <li><a href="https://www.docker.com/docker">Learn</a></li>
                        <li><a href="https://blog.docker.com" target="_blank">Blog</a></li>
                        <li><a href="https://engineering.docker.com" target="_blank">Engineering Blog</a></li>
                        <li><a href="https://training.docker.com/" target="_blank">Training</a></li>
                        <li><a href="https://success.docker.com/support">Support</a></li>
                        <li><a href="https://success.docker.com/kbase">Knowledge Base</a></li>
                        <li><a href="https://www.docker.com/products/resources">Resources</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/docker-community">Community</a></li>
                        <li><a href="https://www.docker.com/technologies/overview">Open Source</a></li>
                        <li><a href="https://www.docker.com/community/events">Events</a></li>
                        <li><a href="https://forums.docker.com/" target="_blank">Forums</a></li>
                        <li><a href="https://www.docker.com/community/docker-captains">Docker Captains</a></li>
                        <li><a href="https://www.docker.com/docker-community/scholarships">Scholarships</a></li>
                        <li><a href="https://blog.docker.com/curated/">Community News</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="http://status.docker.com/">Status</a></li>
                        <li><a href="https://www.docker.com/docker-security">Security</a></li>
                        <li><a href="https://www.docker.com/legal">Legal</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2019 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="http://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="http://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker">GitHub</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-reddit"><a href="http://www.reddit.com/r/docker">Reddit</a></li>
                    <li class="fa fa-slideshare"><a href="http://www.slideshare.net/docker">Slideshare</a></li>
                </ul>
            </div>
        </div>
    </div>

	</footer>
	<link rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/github.css">
	
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/anchorlinks.js"></script>
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/menu.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/jquery.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/bootstrap.min.js"></script>
	<!-- Always include the archive.js, but it doesn't do much unless we are an archive -->
	<script language="javascript">
	// Default to assuming this is an archive and hiding some stuff
	// See js/archive.js and js/docs.js for logic relating to this
	var isArchive = true;
	var dockerVersion = 'v19.03';
	// In archives, we need to know the page root and we get it from JEKYLL_ENV in the jekyll build command
	var jekyllEnv = 'development';
	// If unset (in non-archive branches), defaults to "development". In that case, reset it to empty
	if (jekyllEnv == 'development') {
		jekyllEnv = '';
	}
	var pageURL = jekyllEnv + '/ee/ucp/ucp-architecture/';
	</script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/archive.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/stickyfill.min.js"></script>
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/metadata.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/glossary.js"></script>
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/docs.js"></script>
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/toc.js"></script>
	<script language="javascript">
	jQuery(document).ready(function(){
				hookupTOCEvents();
			});
	</script>
</body>

</html>
