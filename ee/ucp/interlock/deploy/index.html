<!-- Page generated 2019-05-23 10:30:18 +0900 -->
<!-- relative link basehrefs -->

	


<!-- Logic for 'edit this button' -->


	

	

	

	

	

	

	

	

	


<!-- End of logic for 'edit this button' -->


<!DOCTYPE html>
<html lang="ja">

<head>
	<base href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/interlock/deploy/" />
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<style type="text/css">
		@charset "UTF-8";
		[ng\:cloak],
		[ng-cloak],
		[data-ng-cloak],
		[x-ng-cloak],
		.ng-cloak,
		.x-ng-cloak,
		.ng-hide:not(.ng-hide-animate) {
			display: none !important;
		}

		ng\:form {
			display: block;
		}
	</style>
	<script type="text/javascript">
	  !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="4.0.0";
	  analytics.load("IWj9D0UpZHZdZUZX9jl98PcpBFWBnBMy");
	  analytics.page();
	  }}();
	</script>
	
	<!-- favicon -->
	<link rel="icon" type="image/x-icon" href="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
	<meta name="msapplication-TileImage" content="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico">
	<link rel="apple-touch-icon" type="image/x-icon" href="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
	<meta property="og:image" content="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico"/>
	<!-- metadata -->
	<meta property="og:type" content="website"/>
	<meta property="og:updated_time" itemprop="dateUpdated" content="2019-05-23T10:30:18+09:00"/>
	<meta property="og:image" itemprop="image primaryImageOfPage" content="https://matsuand.github.io/docs.docker.jp.onthefly/images/docs@2x.png"/>
	<meta name="twitter:card" content="summary"/>
	<meta name="twitter:domain" content="docs.docker.jp"/>
	<meta name="twitter:site" content="@docker_docs"/>
	<meta name="twitter:url" content="https://twitter.com/docker_docs"/>
	<meta name="twitter:title" itemprop="title name" content="Deploy a layer 7 routing solution"/>
	<meta name="twitter:description" property="og:description" itemprop="description" content="This topic covers deploying a layer 7 routing solution into a Docker Swarm to route traffic to Swarm services. Layer 7 routing is also referred to as an HTTP routing..." />
	<meta name="twitter:image:src" content="https://matsuand.github.io/docs.docker.jp.onthefly/images/docs@2x.png"/>
	<meta name="twitter:image:alt" content="Docker Documentation"/>
	<meta property="article:published_time" itemprop="datePublished" content="2019-05-23T10:30:18+09:00"/>

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="keywords" content="routing, proxy, interlock">
	<link rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/bootstrap.min.css">
	<link id="pygments" rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/pygments/perldoc.css">
	<link id="pagestyle" rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/style.css">

	<!-- Go get "Open Sans" font from Google -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
	<!-- SEO stuff -->
	<title>Deploy a layer 7 routing solution | Docker Documentation</title>
<meta property="og:title" content="Deploy a layer 7 routing solution" />
<meta property="og:locale" content="ja_JP" />
<meta name="description" content="Learn the deployment steps for the UCP layer 7 routing solution" />
<meta property="og:description" content="Learn the deployment steps for the UCP layer 7 routing solution" />
<link rel="canonical" href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/interlock/deploy/" />
<meta property="og:url" content="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/interlock/deploy/" />
<meta property="og:site_name" content="Docker Documentation" />
<script type="application/ld+json">
{"@context":"http://schema.org","@type":"WebPage","headline":"Deploy a layer 7 routing solution","description":"Learn the deployment steps for the UCP layer 7 routing solution","url":"https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/interlock/deploy/"}</script>
	<!-- END SEO STUFF -->
	
	<script language="javascript">
	// Default to assuming this is an archive and hiding some stuff
	// See js/archive.js and js/docs.js for logic relating to this
	var isArchive = true;
	var dockerVersion = 'v18.09';
	</script>
</head>
<body ng-app="Docker" ng-controller="DockerController" class="colums">
	<header>
		 <nav class="nav-secondary navbar navbar-fixed-top">
    <!-- <div class="fan"></div> -->
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="https://matsuand.github.io/docs.docker.jp.onthefly/"><img class="logo" src="https://matsuand.github.io/docs.docker.jp.onthefly/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs"></a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="search-form" id="search-div" style="visibility: hidden">
    <form class="search-form form-inline ng-pristine ng-valid" /id="searchForm" action="/docs.docker.jp.onthefly/search/">
        <input class="search-field form-control ds-input" id="st-search-input" value="" name="q" placeholder="文書内検索" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteContainer">
            <div id="autocompleteResults"></div>
        </div>
        <!-- <button type="submit" class="search-submit btn btn-default">検索</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container">
    <div id="tabs">
        <ul class="tabs" id="jsTOCHorizontal">

        </ul>
    </div>
    <div class="ctrl-right hidden-xs hidden-sm">
        <a href="javascript:void(0)" id="menu-toggle"><i class="fa fa-indent" aria-hidden="true"></i></a>
        <div class="btn-group" style="visibility: hidden">
  <button type="button" class="btn btn-default dropdown-btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Docker v18.09 (current)        <span class="caret"></span>
  </button>
  <ul class="dropdown-menu">
    <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/edge/">Docker edge</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v18.03/">Docker v18.03</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.12/">Docker v17.12</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.09/">Docker v17.09</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.06/">Docker v17.06</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.03/">Docker v17.03</a></li>
  </ul>
</div>

    </div>
</div>

        </div>
    </div>
</nav>

	</header>

	<div class="wrapper right-open">
		<div class="container-fluid">
			<div class="row">
				<div class="col-body">
					<main class="col-content content">
						<section class="section">
							
								
							<h1>Deploy a layer 7 routing solution</h1>  <span class="reading-time" title="Estimated reading time">
  <span class="reading-time-label">読む時間の目安: </span>
  
  
    6 分
  
</span>

							
							
							<p>This topic covers deploying a layer 7 routing solution into a Docker Swarm to route traffic to Swarm services. Layer 7 routing is also referred to as an HTTP routing mesh.</p>

<ul>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/interlock/deploy/#prerequisites">Prerequisites</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/interlock/deploy/#enable-layer-7-routing-via-ucp">Enable layer 7 routing via UCP</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/interlock/deploy/#enable-layer-7-routing-manually">Enable layer 7 routing manually</a>
    <ul>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/interlock/deploy/#work-with-the-core-service-configuration-file">Work with the core service configuration file</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/interlock/deploy/#create-a-dedicated-network-for-interlock-and-extensions">Create a dedicated network for Interlock and extensions</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/interlock/deploy/#create-the-interlock-service">Create the Interlock service</a></li>
    </ul>
  </li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/interlock/deploy/#next-steps">Next steps</a></li>
</ul>

<h2 id="prerequisites">Prerequisites</h2>

<ul>
  <li><a href="https://www.docker.com">Docker</a> version 17.06 or later</li>
  <li>Docker must be running in <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/swarm/">Swarm mode</a></li>
  <li>Internet access (see <a href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/interlock/deploy/offline-install/">Offline installation</a> for installing without internet access)</li>
</ul>

<h2 id="enable-layer-7-routing-via-ucp">Enable layer 7 routing via UCP</h2>

<p>By default, layer 7 routing is disabled, so you must first
enable this service from the UCP web UI.</p>

<ol>
  <li>Log in to the UCP web UI as an administrator.</li>
  <li>Navigate to <strong>Admin Settings</strong></li>
  <li>Select <strong>Layer 7 Routing</strong> and then select <strong>Enable Layer 7 Routing</strong></li>
</ol>

<p><img src="../../images/interlock-install-4.png" alt="http routing mesh" class="with-border" /></p>

<p>By default, the routing mesh service listens on port 8080 for HTTP and port
8443 for HTTPS. Change the ports if you already have services that are using
them.</p>

<p>When 7 routing is enabled:</p>

<ol>
  <li>UCP creates the <code class="highlighter-rouge">ucp-interlock</code> overlay network.</li>
  <li>UCP deploys the <code class="highlighter-rouge">ucp-interlock</code> service and attaches it both to the Docker
socket and the overlay network that was created. This allows the Interlock
service to use the Docker API. That’s also the reason why this service needs to
run on a manger node.</li>
  <li>The <code class="highlighter-rouge">ucp-interlock</code> service starts the <code class="highlighter-rouge">ucp-interlock-extension</code> service
and attaches it to the <code class="highlighter-rouge">ucp-interlock</code> network. This allows both services
to communicate.</li>
  <li>The <code class="highlighter-rouge">ucp-interlock-extension</code> generates a configuration to be used by
the proxy service. By default the proxy service is NGINX, so this service
generates a standard NGINX configuration.
( Is this valid here????) UCP creates the <code class="highlighter-rouge">com.docker.ucp.interlock.conf-1</code> configuration file and uses it to configure all
the internal components of this service.</li>
  <li>The <code class="highlighter-rouge">ucp-interlock</code> service takes the proxy configuration and uses it to
start the <code class="highlighter-rouge">ucp-interlock-proxy</code> service.</li>
</ol>

<p>At this point everything is ready for you to start using the layer 7 routing
service with your swarm workloads.</p>

<p>The following code sample provides a default UCP configuration (this will be created automatically when enabling Interlock as per section <a href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/interlock/deploy/#enable-layer-7-routing">Enable layer 7 routing</a>):</p>

<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">ListenAddr</span> <span class="p">=</span> <span class="s">":8080"</span>
<span class="py">DockerURL</span> <span class="p">=</span> <span class="s">"unix:///var/run/docker.sock"</span>
<span class="py">AllowInsecure</span> <span class="p">=</span> <span class="kc">false</span>
<span class="py">PollInterval</span> <span class="p">=</span> <span class="s">"3s"</span>

<span class="nn">[Extensions]</span>
  <span class="nn">[Extensions.default]</span>
    <span class="py">Image</span> <span class="p">=</span> <span class="s">"docker/ucp-interlock-extension:3.1.7"</span>
    <span class="py">ServiceName</span> <span class="p">=</span> <span class="s">"ucp-interlock-extension"</span>
    <span class="py">Args</span> <span class="p">=</span> <span class="p">[]</span>
    <span class="py">Constraints</span> <span class="p">=</span> <span class="p">[</span><span class="s">"node.labels.com.docker.ucp.orchestrator.swarm==true"</span><span class="p">,</span> <span class="s">"node.platform.os==linux"</span><span class="p">]</span>
    <span class="py">ProxyImage</span> <span class="p">=</span> <span class="s">"docker/ucp-interlock-proxy:3.1.7"</span>
    <span class="py">ProxyServiceName</span> <span class="p">=</span> <span class="s">"ucp-interlock-proxy"</span>
    <span class="py">ProxyConfigPath</span> <span class="p">=</span> <span class="s">"/etc/nginx/nginx.conf"</span>
    <span class="py">ProxyReplicas</span> <span class="p">=</span> <span class="mi">2</span>
    <span class="py">ProxyStopSignal</span> <span class="p">=</span> <span class="s">"SIGQUIT"</span>
    <span class="py">ProxyStopGracePeriod</span> <span class="p">=</span> <span class="s">"5s"</span>
    <span class="py">ProxyConstraints</span> <span class="p">=</span> <span class="p">[</span><span class="s">"node.labels.com.docker.ucp.orchestrator.swarm==true"</span><span class="p">,</span> <span class="s">"node.platform.os==linux"</span><span class="p">]</span>
    <span class="py">PublishMode</span> <span class="p">=</span> <span class="s">"ingress"</span>
    <span class="py">PublishedPort</span> <span class="p">=</span> <span class="mi">8080</span>
    <span class="py">TargetPort</span> <span class="p">=</span> <span class="mi">80</span>
    <span class="py">PublishedSSLPort</span> <span class="p">=</span> <span class="mi">8443</span>
    <span class="py">TargetSSLPort</span> <span class="p">=</span> <span class="mi">443</span>
    <span class="nn">[Extensions.default.Labels]</span>
      <span class="py">"com.docker.ucp.InstanceID"</span> <span class="p">=</span> <span class="s">"fewho8k85kyc6iqypvvdh3ntm"</span>
    <span class="nn">[Extensions.default.ContainerLabels]</span>
      <span class="py">"com.docker.ucp.InstanceID"</span> <span class="p">=</span> <span class="s">"fewho8k85kyc6iqypvvdh3ntm"</span>
    <span class="nn">[Extensions.default.ProxyLabels]</span>
      <span class="py">"com.docker.ucp.InstanceID"</span> <span class="p">=</span> <span class="s">"fewho8k85kyc6iqypvvdh3ntm"</span>
    <span class="nn">[Extensions.default.ProxyContainerLabels]</span>
      <span class="py">"com.docker.ucp.InstanceID"</span> <span class="p">=</span> <span class="s">"fewho8k85kyc6iqypvvdh3ntm"</span>
    <span class="nn">[Extensions.default.Config]</span>
      <span class="py">Version</span> <span class="p">=</span> <span class="s">""</span>
      <span class="py">User</span> <span class="p">=</span> <span class="s">"nginx"</span>
      <span class="py">PidPath</span> <span class="p">=</span> <span class="s">"/var/run/proxy.pid"</span>
      <span class="py">MaxConnections</span> <span class="p">=</span> <span class="mi">1024</span>
      <span class="py">ConnectTimeout</span> <span class="p">=</span> <span class="mi">600</span>
      <span class="py">SendTimeout</span> <span class="p">=</span> <span class="mi">600</span>
      <span class="py">ReadTimeout</span> <span class="p">=</span> <span class="mi">600</span>
      <span class="py">IPHash</span> <span class="p">=</span> <span class="kc">false</span>
      <span class="py">AdminUser</span> <span class="p">=</span> <span class="s">""</span>
      <span class="py">AdminPass</span> <span class="p">=</span> <span class="s">""</span>
      <span class="py">SSLOpts</span> <span class="p">=</span> <span class="s">""</span>
      <span class="py">SSLDefaultDHParam</span> <span class="p">=</span> <span class="mi">1024</span>
      <span class="py">SSLDefaultDHParamPath</span> <span class="p">=</span> <span class="s">""</span>
      <span class="py">SSLVerify</span> <span class="p">=</span> <span class="s">"required"</span>
      <span class="py">WorkerProcesses</span> <span class="p">=</span> <span class="mi">1</span>
      <span class="py">RLimitNoFile</span> <span class="p">=</span> <span class="mi">65535</span>
      <span class="py">SSLCiphers</span> <span class="p">=</span> <span class="s">"HIGH:!aNULL:!MD5"</span>
      <span class="py">SSLProtocols</span> <span class="p">=</span> <span class="s">"TLSv1.2"</span>
      <span class="py">AccessLogPath</span> <span class="p">=</span> <span class="s">"/dev/stdout"</span>
      <span class="py">ErrorLogPath</span> <span class="p">=</span> <span class="s">"/dev/stdout"</span>
      <span class="py">MainLogFormat</span> <span class="p">=</span> <span class="s">"'$remote_addr - $remote_user [$time_local] </span><span class="se">\"</span><span class="s">$request</span><span class="se">\"</span><span class="s"> '</span><span class="se">\n\t\t</span><span class="s">    '$status $body_bytes_sent </span><span class="se">\"</span><span class="s">$http_referer</span><span class="se">\"</span><span class="s"> '</span><span class="se">\n\t\t</span><span class="s">    '</span><span class="se">\"</span><span class="s">$http_user_agent</span><span class="se">\"</span><span class="s"> </span><span class="se">\"</span><span class="s">$http_x_forwarded_for</span><span class="se">\"</span><span class="s">';"</span>
      <span class="py">TraceLogFormat</span> <span class="p">=</span> <span class="s">"'$remote_addr - $remote_user [$time_local] </span><span class="se">\"</span><span class="s">$request</span><span class="se">\"</span><span class="s"> $status '</span><span class="se">\n\t\t</span><span class="s">    '$body_bytes_sent </span><span class="se">\"</span><span class="s">$http_referer</span><span class="se">\"</span><span class="s"> </span><span class="se">\"</span><span class="s">$http_user_agent</span><span class="se">\"</span><span class="s"> '</span><span class="se">\n\t\t</span><span class="s">    '</span><span class="se">\"</span><span class="s">$http_x_forwarded_for</span><span class="se">\"</span><span class="s"> $request_id $msec $request_time '</span><span class="se">\n\t\t</span><span class="s">    '$upstream_connect_time $upstream_header_time $upstream_response_time';"</span>
      <span class="py">KeepaliveTimeout</span> <span class="p">=</span> <span class="s">"75s"</span>
      <span class="py">ClientMaxBodySize</span> <span class="p">=</span> <span class="s">"32m"</span>
      <span class="py">ClientBodyBufferSize</span> <span class="p">=</span> <span class="s">"8k"</span>
      <span class="py">ClientHeaderBufferSize</span> <span class="p">=</span> <span class="s">"1k"</span>
      <span class="py">LargeClientHeaderBuffers</span> <span class="p">=</span> <span class="s">"4 8k"</span>
      <span class="py">ClientBodyTimeout</span> <span class="p">=</span> <span class="s">"60s"</span>
      <span class="py">UnderscoresInHeaders</span> <span class="p">=</span> <span class="kc">false</span>
      <span class="py">HideInfoHeaders</span> <span class="p">=</span> <span class="kc">false</span>
</code></pre></div></div>

<h2 id="enable-layer-7-routing-manually">Enable layer 7 routing manually</h2>

<p>Interlock can also be enabled from the command line by following the below sections.</p>

<h3 id="work-with-the-core-service-configuration-file">Work with the core service configuration file</h3>

<p>Interlock uses the TOML file for the core service configuration. The following example utilizes Swarm deployment and recovery features by creating a Docker Config object:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$&gt;</span> <span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh"> | docker config create service.interlock.conf -
ListenAddr = ":8080"
DockerURL = "unix:///var/run/docker.sock"
PollInterval = "3s"

[Extensions]
  [Extensions.default]
    Image = "docker/ucp-interlock-extension:3.1.7"
    Args = ["-D"]
    ProxyImage = "docker/ucp-interlock-proxy:3.1.7"
    ProxyArgs = []
    ProxyConfigPath = "/etc/nginx/nginx.conf"
    ProxyReplicas = 1
    ProxyStopGracePeriod = "3s"
    ServiceCluster = ""
    PublishMode = "ingress"
    PublishedPort = 8080
    TargetPort = 80
    PublishedSSLPort = 8443
    TargetSSLPort = 443
    [Extensions.default.Config]
      User = "nginx"
      PidPath = "/var/run/proxy.pid"
      WorkerProcesses = 1
      RlimitNoFile = 65535
      MaxConnections = 2048
</span><span class="no">EOF
</span>oqkvv1asncf6p2axhx41vylgt
</code></pre></div></div>

<h3 id="create-a-dedicated-network-for-interlock-and-extensions">Create a dedicated network for Interlock and extensions</h3>

<p>Next, create a dedicated network for Interlock and the extensions:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$&gt;</span> docker network create <span class="nt">-d</span> overlay interlock
</code></pre></div></div>

<h3 id="create-the-interlock-service">Create the Interlock service</h3>

<p>Now you can create the Interlock service. Note the requirement to constrain to a manager. The
Interlock core service must have access to a Swarm manager, however the extension and proxy services
are recommended to run on workers.  See the <a href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/interlock/deploy/production/">Production</a> section for more information
on setting up for an production environment.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$&gt;</span> docker service create <span class="se">\</span>
    <span class="nt">--name</span> interlock <span class="se">\</span>
    <span class="nt">--mount</span> <span class="nv">src</span><span class="o">=</span>/var/run/docker.sock,dst<span class="o">=</span>/var/run/docker.sock,type<span class="o">=</span><span class="nb">bind</span> <span class="se">\</span>
    <span class="nt">--network</span> interlock <span class="se">\</span>
    <span class="nt">--constraint</span> node.role<span class="o">==</span>manager <span class="se">\</span>
    <span class="nt">--config</span> <span class="nv">src</span><span class="o">=</span>service.interlock.conf,target<span class="o">=</span>/config.toml <span class="se">\</span>
    docker/ucp-interlock:3.1.7 <span class="nt">-D</span> run <span class="nt">-c</span> /config.toml
sjpgq7h621exno6svdnsvpv9z
</code></pre></div></div>

<p>At this point, there should be three (3) services created: one for the Interlock service,
one for the extension service, and one for the proxy service:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$&gt;</span> docker service <span class="nb">ls
</span>ID                  NAME                MODE                REPLICAS            IMAGE                                                       PORTS
lheajcskcbby        modest_raman        replicated          1/1                 nginx:alpine                                                <span class="k">*</span>:80-&gt;80/tcp <span class="k">*</span>:443-&gt;443/tcp
oxjvqc6gxf91        keen_clarke         replicated          1/1                 docker/ucp-interlock-extension:3.1.7
sjpgq7h621ex        interlock           replicated          1/1                 docker/ucp-interlock:3.1.7
</code></pre></div></div>

<p>The Interlock traffic layer is now deployed.</p>

<h2 id="next-steps">Next steps</h2>

<ul>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/interlock/config/">Configure Interlock</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/interlock/usage/">Deploy applications</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/interlock/deploy/production/">Production deployment information</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/interlock/deploy/offline-install/">Offline installation</a></li>
</ul>

							<!-- tags -->
							
							
							
							<span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span style="vertical-align: 2px"><a href="https://matsuand.github.io/docs.docker.jp.onthefly/glossary/?term=routing">routing</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/glossary/?term=proxy">proxy</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/glossary/?term=interlock">interlock</a></span>
							
							<!-- link corrections -->
              <script language="JavaScript">
							var x = document.links.length;
							var baseHref = document.getElementsByTagName('base')[0].href
							for (i = 0; i < x; i++) {
							  var munged = false;
							  var thisHREF = document.links[i].href;
							  var originalURL = "/ee/ucp/interlock/deploy/";
							  if (thisHREF.indexOf(baseHref + "#") > -1) {
							    // hash fix
							    //console.log('BEFORE: base:',baseHref,'thisHREF:',thisHREF,'originalURL:',originalURL);
							    thisHREF = originalURL + thisHREF.replace(baseHref, "");
							    //console.log('AFTER: base:',baseHref,'thisHREF:',thisHREF,'originalURL:',originalURL);
							  }
							  if ((thisHREF.indexOf(window.location.hostname) > -1 || thisHREF.indexOf('http') == -1) && document.links[i].className.indexOf("nomunge") < 0) {
							    munged = true;
							    thisHREF = thisHREF.replace(".md", "/").replace("/index/", "/");
							    document.links[i].setAttribute('href', thisHREF);
							  }
							}
							</script>
							
						  <div id="ratings-div" style="color:#b9c2cc; text-align: center; margin-top: 150px; visibility: hidden">
								<div id="pd_rating_holder_8453675"></div>
								<script type="text/javascript">
									PDRTJS_settings_8453675 = {
										"id": "8453675",
										"unique_id": "ee/ucp/interlock/deploy/index.md",
										"title": "Deploy a layer 7 routing solution",
										"permalink": "https://github.com/docker/docker.github.io/blob/master/ee/ucp/interlock/deploy/index.md"
									};
									(function(d, c, j) {
										if (!document.getElementById(j)) {
											var pd = d.createElement(c),
												s;
											pd.id = j;
											pd.src = ('https:' == document.location.protocol) ? 'https://polldaddy.com/js/rating/rating.js' : 'http://i0.poll.fm/js/rating/rating.js';
											s = document.getElementsByTagName(c)[0];
											s.parentNode.insertBefore(pd, s);
										}
									}(document, 'script', 'pd-rating-js'));
								</script>
							</div>
							
						</section>
					</main>
					<nav class="col-nav">
						<div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
						<div id="navbar" class="nav-sidebar">
    <ul class="nav" id="jsTOCLeftNav">
    </ul>
</div>

						</div>
					</nav>
					<div class="col-toc">
							<div class="sidebar hidden-xs hidden-sm">
							<div class="toc-nav">
								<div class="feedback-links">
									<ul>
										
										<li style="visibility: hidden"><a href="https://github.com/matsuand/docs.docker.jp/edit/v18.09.local/ee/ucp/interlock/deploy/index.md"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> このページの編集</a></li>
										<li><a href="https://github.com/matsuand/docs.docker.jp.onthefly/issues/new?body=File: [ee/ucp/interlock/deploy/index.md](https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/interlock/deploy/)"
															class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> 文書変更のリクエスト</a></li>
										<li><a href="https://success.docker.com/support"><i class="fa fa-question" aria-hidden="true"></i> サポート依頼</a></li>
										<!-- toggle mode -->
										<li>
											<div class="toggle-mode">
												<div class="icon">
													<i class="fa fa-sun-o" aria-hidden="true"></i>
												</div>
												<div class="toggle-switch">
													<label class="switch">
														<input type="checkbox" id="switch-style">
														<div class="slider round"></div>
												</label>
												</div>
												<div class="icon">
													<i class="fa fa-moon-o" aria-hidden="true"></i>
												</div>
											</div>
										</li>
									</ul>
								</div>
								   
									<div id="side-toc-title">本ページ内</div>
									
<ul id="my_toc" class="inline_toc">
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/interlock/deploy/#prerequisites" class="nomunge">Prerequisites</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/interlock/deploy/#enable-layer-7-routing-via-ucp" class="nomunge">Enable layer 7 routing via UCP</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/interlock/deploy/#enable-layer-7-routing-manually" class="nomunge">Enable layer 7 routing manually</a>
    <ul>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/interlock/deploy/#work-with-the-core-service-configuration-file" class="nomunge">Work with the core service configuration file</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/interlock/deploy/#create-a-dedicated-network-for-interlock-and-extensions" class="nomunge">Create a dedicated network for Interlock and extensions</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/interlock/deploy/#create-the-interlock-service" class="nomunge">Create the Interlock service</a></li>
    </ul>
  </li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/ee/ucp/interlock/deploy/#next-steps" class="nomunge">Next steps</a></li>
</ul>


								</div>
								
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	
	<footer class="footer">
		  
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/what-docker">What is Docker</a></li>
                        <li><a href="https://www.docker.com/what-container">What is a Container</a></li>
                        <li><a href="https://www.docker.com/use-cases">Use Cases</a></li>
                        <li><a href="https://www.docker.com/customers">Customers</a></li>
                        <li><a href="https://www.docker.com/partners/partner-program">Partners</a></li>
                        <li class="break"><a href="https://www.docker.com/industry-government">For Government</a></li>
                        <li><a href="https://www.docker.com/company">About Docker</a></li>
                        <li><a href="https://www.docker.com/company/management">Management</a></li>
                        <li><a href="https://www.docker.com/company/news-and-press">Press &amp; News</a></li>
                        <li><a href="https://www.docker.com/careers">Careers</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/products/overview">Product</a></li>
                        <li><a href="https://www.docker.com/pricing">Pricing</a></li>
                        <li><a href="https://www.docker.com/docker-community">Community Edition</a></li>
                        <li class="break"><a href="https://www.docker.com/enterprise">Enterprise Edition </a></li>
                        <li><a href="https://www.docker.com/products/docker-datacenter">Docker Datacenter</a></li>
                        <li><a href="https://hub.docker.com/">Docker Hub</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/">Documentation</a></li>
                        <li><a href="https://www.docker.com/docker">Learn</a></li>
                        <li><a href="https://blog.docker.com" target="_blank">Blog</a></li>
                        <li><a href="https://engineering.docker.com" target="_blank">Engineering Blog</a></li>
                        <li><a href="https://training.docker.com/" target="_blank">Training</a></li>
                        <li><a href="https://success.docker.com/support">Support</a></li>
                        <li><a href="https://success.docker.com/kbase">Knowledge Base</a></li>
                        <li><a href="https://www.docker.com/products/resources">Resources</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/docker-community">Community</a></li>
                        <li><a href="https://www.docker.com/technologies/overview">Open Source</a></li>
                        <li><a href="https://www.docker.com/community/events">Events</a></li>
                        <li><a href="https://forums.docker.com/" target="_blank">Forums</a></li>
                        <li><a href="https://www.docker.com/community/docker-captains">Docker Captains</a></li>
                        <li><a href="https://www.docker.com/docker-community/scholarships">Scholarships</a></li>
                        <li><a href="https://blog.docker.com/curated/">Community News</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="http://status.docker.com/">Status</a></li>
                        <li><a href="https://www.docker.com/docker-security">Security</a></li>
                        <li><a href="https://www.docker.com/legal">Legal</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2019 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="http://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="http://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker">GitHub</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-reddit"><a href="http://www.reddit.com/r/docker">Reddit</a></li>
                    <li class="fa fa-slideshare"><a href="http://www.slideshare.net/docker">Slideshare</a></li>
                </ul>
            </div>
        </div>
    </div>

	</footer>
	<link rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/github.css">
	
	<!-- <script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/anchorlinks.js"></script> -->
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/menu.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/jquery.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/bootstrap.min.js"></script>
	<!-- Always include the archive.js, but it doesn't do much unless we are an archive -->
	<script language="javascript">
	// Default to assuming this is an archive and hiding some stuff
	// See js/archive.js and js/docs.js for logic relating to this
	var isArchive = true;
	var dockerVersion = 'v18.09';
	// In archives, we need to know the page root and we get it from JEKYLL_ENV in the jekyll build command
	var jekyllEnv = 'development';
	// If unset (in non-archive branches), defaults to "development". In that case, reset it to empty
	if (jekyllEnv == 'development') {
		jekyllEnv = '';
	}
	var pageURL = jekyllEnv + '/ee/ucp/interlock/deploy/';
	</script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/archive.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/stickyfill.min.js"></script>
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/metadata.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/glossary.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/collections_tocs.js"></script>
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/docs.js"></script>
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/toc.js"></script>
	<script language="javascript">
	jQuery(document).ready(function(){
				hookupTOCEvents();
			});
	</script>
</body>

</html>
