<!-- Page generated 2020-04-25 17:47:28 +0900 -->
<!-- Logic for 'edit this button'


    

    

    

    

    

    

    

    

-->
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <style type="text/css">
        @charset "UTF-8";
        [ng\:cloak],
        [ng-cloak],
        [data-ng-cloak],
        [x-ng-cloak],
        .ng-cloak,
        .x-ng-cloak,
        .ng-hide:not(.ng-hide-animate) {
            display: none !important;
        }

        ng\:form {
            display: block;
        }
    </style>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-WL2QLG5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- favicon -->
    <link rel="icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
    <meta name="msapplication-TileImage" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico">
    <link rel="apple-touch-icon" type="image/x-icon" href="/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
    <meta property="og:image" content="/docs.docker.jp.onthefly/favicons/docs@2x.ico"/>
    <!-- metadata -->
    <meta property="og:type" content="website"/>
    <meta property="og:updated_time" itemprop="dateUpdated" content="2020-04-25T17:47:28+09:00"/>
    <meta property="og:image" itemprop="image primaryImageOfPage" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:domain" content="docs.docker.com"/>
    <meta name="twitter:site" content="@docker_docs"/>
    <meta name="twitter:url" content="https://twitter.com/docker_docs"/>
    <meta name="twitter:title" itemprop="title name" content="DTR アーキテクチャー"/>
    <meta name="twitter:description" property="og:description" itemprop="description" content="This topic applies to Docker Enterprise. The Docker Enterprise platform business, including products, customers, and employees, has been acquired by Mirantis, inc., effective 13-November-2019. For more information on the acquisition..." />
    <meta name="twitter:image:src" content="/docs.docker.jp.onthefly/images/docs@2x.png"/>
    <meta name="twitter:image:alt" content="Docker ドキュメント"/>
    <meta property="article:published_time" itemprop="datePublished" content="2020-04-25T17:47:28+09:00"/>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="registry, dtr, architecture">
    <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/font-awesome.min.css">
    <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/bootstrap.min.css">
    <link id="pygments" rel="stylesheet" href="/docs.docker.jp.onthefly/css/pygments/perldoc.css">
    <link id="pagestyle" rel="stylesheet" href="/docs.docker.jp.onthefly/css/style.css">

    <!-- Go get "Open Sans" font from Google -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <!-- SEO stuff -->
    <title>DTR アーキテクチャー | Docker ドキュメント</title>
    <meta property="og:title" content="DTR アーキテクチャー" />
    <meta property="og:locale" content="ja_JP" />
    <meta name="description" content="Learn about the architecture of Docker Trusted Registry." />
    <meta property="og:description" content="Learn about the architecture of Docker Trusted Registry." />
    <link rel="canonical" href="/docs.docker.jp.onthefly/ee/dtr/architecture/" />
    <meta property="og:url" content="https://matsuand.github.io/docs.docker.jp.onthefly/ee/dtr/architecture/" />
    <meta property="og:site_name" content="Docker ドキュメント" />
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"WebPage","headline":"DTR アーキテクチャー","description":"Learn about the architecture of Docker Trusted Registry.","url":"https://docs.docker.com/ee/dtr/architecture/"}</script>
    <!-- END SEO STUFF -->
    
    <script>
    // Default to assuming this is an archive and hiding some stuff
    // See js/archive.js and js/docs.js for logic relating to this
    var isArchive = true;
    var dockerVersion = 'v19.03';
    </script>
</head>
<body ng-app="Docker" ng-controller="DockerController" class="colums">
    <header>
        
            <nav class="nav-secondary navbar navbar-fixed-top">
    <!-- <div class="fan"></div> -->
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="/docs.docker.jp.onthefly/"><img class="logo" src="/docs.docker.jp.onthefly/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs"></a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="search-form" id="search-div" style="visibility: hidden">
    <form class="search-form form-inline ng-pristine ng-valid" id="searchForm" action="/docs.docker.jp.onthefly/search/">
        <input class="search-field form-control ds-input" id="st-search-input" value="" name="q" placeholder="文書内検索" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteContainer">
            <div id="autocompleteResults"></div>
        </div>
        <!-- <button type="submit" class="search-submit btn btn-default">検索</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container">
    <div id="tabs">
        <ul class="tabs" id="jsTOCHorizontal">

        </ul>
    </div>
    <div class="ctrl-right hidden-xs hidden-sm">
        <a href="javascript:void(0)" id="menu-toggle"><i class="fa fa-indent" aria-hidden="true"></i></a>
        <div class="btn-group" style="visibility: hidden">
  <button type="button" class="btn btn-default dropdown-btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Docker v19.03 (最新)     <span class="caret"></span>
  </button>
  <ul class="dropdown-menu">
    <li><a href="/docs.docker.jp.onthefly/v18.09/">Docker v18.09</a></li><li><a href="/docs.docker.jp.onthefly/v18.03/">Docker v18.03</a></li><li><a href="/docs.docker.jp.onthefly/v17.06/">Docker v17.06</a></li>
  </ul>
</div>

    </div>
</div>

        </div>
    </div>
</nav>

        
    </header>
    <div class="wrapper right-open">
        <div class="container-fluid">
            <div class="row">
                <div class="col-body">
                    <main class="col-content content">
                        <section class="section">
                            
                                
                            <h1>DTR アーキテクチャー</h1>  <span class="reading-time" title="Estimated reading time">
  <span class="reading-time-label">読む時間の目安: </span>
  
  
    3 分
  
</span>

                            
                            
                            <blockquote>
  <!-- This text will be included on all Docker pages that document Enterprise products, features, and technologies that are transitioning to Mirantis. -->
  <p>This topic applies to Docker Enterprise.</p>

  <p>The Docker Enterprise platform business, including products, customers, and employees, has been acquired by Mirantis, inc., effective 13-November-2019. For more information on the acquisition and how it may affect you and your business, refer to the <a href="https://www.docker.com/faq-for-docker-enterprise-customers-and-partners">Docker Enterprise Customer FAQ</a>.</p>
</blockquote>

<p>Docker Trusted Registry (DTR) はコンテナー化されたアプリケーションであり、Docker Universal Control Plane によるクラスター上で動作します。</p>

<p><img src="images/architecture-1.svg" alt="" /></p>

<p>Once you have DTR deployed, you use your Docker CLI client to login, push, and
pull images.</p>

<h2 id="under-the-hood">Under the hood</h2>

<p>For high-availability you can deploy multiple DTR replicas, one on each UCP
worker node.</p>

<p><img src="images/architecture-2.svg" alt="" /></p>

<p>All DTR replicas run the same set of services and changes to their configuration
are automatically propagated to other replicas.</p>

<h2 id="dtr-internal-components">DTR の内部コンポーネント</h2>

<p>ノード上に DTR をインストールすると、以下に示すコンテナーが起動します。</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">名称</th>
      <th style="text-align: left">内容説明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">dtr-api-&lt;replica_id&gt;</td>
      <td style="text-align: left">Executes the DTR business logic. It serves the DTR web application, and API</td>
    </tr>
    <tr>
      <td style="text-align: left">dtr-garant-&lt;replica_id&gt;</td>
      <td style="text-align: left">Manages DTR authentication</td>
    </tr>
    <tr>
      <td style="text-align: left">dtr-jobrunner-&lt;replica_id&gt;</td>
      <td style="text-align: left">Runs cleanup jobs in the background</td>
    </tr>
    <tr>
      <td style="text-align: left">dtr-nginx-&lt;replica_id&gt;</td>
      <td style="text-align: left">Receives http and https requests and proxies them to other DTR components. By default it listens to ports 80 and 443 of the host</td>
    </tr>
    <tr>
      <td style="text-align: left">dtr-notary-server-&lt;replica_id&gt;</td>
      <td style="text-align: left">Receives, validates, and serves content trust metadata, and is consulted when pushing or pulling to DTR with content trust enabled</td>
    </tr>
    <tr>
      <td style="text-align: left">dtr-notary-signer-&lt;replica_id&gt;</td>
      <td style="text-align: left">Performs server-side timestamp and snapshot signing for content trust metadata</td>
    </tr>
    <tr>
      <td style="text-align: left">dtr-registry-&lt;replica_id&gt;</td>
      <td style="text-align: left">Implements the functionality for pulling and pushing Docker images. It also handles how images are stored</td>
    </tr>
    <tr>
      <td style="text-align: left">dtr-rethinkdb-&lt;replica_id&gt;</td>
      <td style="text-align: left">A database for persisting repository metadata</td>
    </tr>
    <tr>
      <td style="text-align: left">dtr-scanningstore-&lt;replica_id&gt;</td>
      <td style="text-align: left">セキュリティスキャニングデータを保持します。</td>
    </tr>
  </tbody>
</table>

<p>このコンポーネントはすべて DTR 内部で用いられるものです。
アプリケーションからこれらを利用しないでください。</p>

<h2 id="networks-used-by-dtr">DTR が利用するネットワーク</h2>

<p>コンテナーによるネットワーク通信を可能とするために、DTR のインストール時には以下のネットワークが生成されます。</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">名称</th>
      <th style="text-align: left">タイプ</th>
      <th style="text-align: left">内容説明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">dtr-ol</td>
      <td style="text-align: left">overlay</td>
      <td style="text-align: left">Allows DTR components running on different nodes to communicate, to replicate DTR data</td>
    </tr>
  </tbody>
</table>

<h2 id="volumes-used-by-dtr">DTR が利用するボリューム</h2>

<p>DTR はデータ保存のために以下の名前つきボリュームを利用します。</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">ボリューム名</th>
      <th style="text-align: left">内容説明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">dtr-ca-&lt;replica_id&gt;</td>
      <td style="text-align: left">Root key material for the DTR root CA that issues certificates</td>
    </tr>
    <tr>
      <td style="text-align: left">dtr-notary-&lt;replica_id&gt;</td>
      <td style="text-align: left">Certificate and keys for the Notary components</td>
    </tr>
    <tr>
      <td style="text-align: left">dtr-postgres-&lt;replica_id&gt;</td>
      <td style="text-align: left">Vulnerability scans data</td>
    </tr>
    <tr>
      <td style="text-align: left">dtr-registry-&lt;replica_id&gt;</td>
      <td style="text-align: left">Docker images data, if DTR is configured to store images on the local filesystem</td>
    </tr>
    <tr>
      <td style="text-align: left">dtr-rethink-&lt;replica_id&gt;</td>
      <td style="text-align: left">Repository metadata</td>
    </tr>
    <tr>
      <td style="text-align: left">dtr-nfs-registry-&lt;replica_id&gt;</td>
      <td style="text-align: left">Docker images data, if DTR is configured to store images on NFS</td>
    </tr>
  </tbody>
</table>

<p>You can customize the volume driver used for these volumes, by creating the
volumes before installing DTR. During the installation, DTR checks which volumes
don’t exist in the node, and creates them using the default volume driver.</p>

<p>By default, the data for these volumes can be found at
<code class="highlighter-rouge">/var/lib/docker/volumes/&lt;volume-name&gt;/_data</code>.</p>

<h2 id="image-storage">イメージストレージ</h2>

<p>By default, Docker Trusted Registry stores images on the filesystem of the node
where it is running, but you should configure it to use a centralized storage
backend.</p>

<p><img src="images/architecture-3.svg" alt="" /></p>

<p>DTR supports these storage backends:</p>

<ul>
  <li>NFS</li>
  <li>Amazon S3</li>
  <li>Cleversafe</li>
  <li>Google Cloud Storage</li>
  <li>OpenStack Swift</li>
  <li>Microsoft Azure</li>
</ul>

<h2 id="how-to-interact-with-dtr">How to interact with DTR</h2>

<p>DTR has a web UI where you can manage settings and user permissions.</p>

<p><img src="images/architecture-4.svg" alt="" /></p>

<p>You can push and pull images using the standard Docker CLI client or other tools
that can interact with a Docker registry.</p>

<h2 id="where-to-go-next">次に読むものは</h2>

<ul>
  <li><a href="/docs.docker.jp.onthefly/ee/dtr/admin/install/system-requirements/">システム要件</a></li>
  <li><a href="/docs.docker.jp.onthefly/ee/dtr/admin/install/">DTR のインストール</a></li>
</ul>

                            <!-- tags -->
                            
                                <span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span style="vertical-align: 2px"><a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=registry">registry</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=dtr">dtr</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/search/?q=architecture">architecture</a></span>
                                
                            
                            <div id="ratings-div" style="color:#b9c2cc; text-align: center; margin-top: 150px; visibility: hidden">
                                <div id="pd_rating_holder_8453675"></div>
                                <script type="text/javascript">
                                    PDRTJS_settings_8453675 = {
                                        "id": "8453675",
                                        "unique_id": "ee/dtr/architecture.md",
                                        "title": "DTR アーキテクチャー",
                                        "permalink": "https://github.com/docker/docker.github.io/blob/master/ee/dtr/architecture.md"
                                    };
                                    (function(d, c, j) {
                                        if (!document.getElementById(j)) {
                                            var pd = d.createElement(c),
                                                s;
                                            pd.id = j;
                                            pd.src = ('https:' == document.location.protocol) ? 'https://polldaddy.com/js/rating/rating.js' : 'http://i0.poll.fm/js/rating/rating.js';
                                            s = document.getElementsByTagName(c)[0];
                                            s.parentNode.insertBefore(pd, s);
                                        }
                                    }(document, 'script', 'pd-rating-js'));
                                </script>
                            </div>
                            
                        </section>
                    </main>
                    <nav class="col-nav">
                        <div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
                        <div id="navbar" class="nav-sidebar">
    <ul class="nav" id="jsTOCLeftNav">
    </ul>
</div>

                        </div>
                    </nav>
                    <div class="col-toc">
                        <div class="sidebar hidden-xs hidden-sm">
                            <div class="toc-nav">
                                <div class="feedback-links">
                                    <ul>
                                        
                                        <li style="visibility: hidden"><a href="https://github.com/docker/docker.github.io/edit/master/ee/dtr/architecture.md"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> このページの編集</a></li>
                                        <li><a href="https://github.com/docker/docker.github.io/issues/new?body=File: [ee/dtr/architecture.md](https://docs.docker.com/ee/dtr/architecture/)"
                                                            class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> 文書変更のリクエスト</a></li>
                                        <!-- toggle mode -->
                                        <li>
                                            <div class="toggle-mode">
                                                <div class="icon">
                                                    <i class="fa fa-sun-o" aria-hidden="true"></i>
                                                </div>
                                                <div class="toggle-switch">
                                                    <label class="switch">
                                                        <input type="checkbox" id="switch-style">
                                                        <div class="slider round"></div>
                                                </label>
                                                </div>
                                                <div class="icon">
                                                    <i class="fa fa-moon-o" aria-hidden="true"></i>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                                   
                                <div id="side-toc-title">本ページ内:</div>
                                    
<ul id="my_toc" class="inline_toc">
  <li><a href="#under-the-hood" class="nomunge">Under the hood</a></li>
  <li><a href="#dtr-internal-components" class="nomunge">DTR の内部コンポーネント</a></li>
  <li><a href="#networks-used-by-dtr" class="nomunge">DTR が利用するネットワーク</a></li>
  <li><a href="#volumes-used-by-dtr" class="nomunge">DTR が利用するボリューム</a></li>
  <li><a href="#image-storage" class="nomunge">イメージストレージ</a></li>
  <li><a href="#how-to-interact-with-dtr" class="nomunge">How to interact with DTR</a></li>
  <li><a href="#where-to-go-next" class="nomunge">次に読むものは</a></li>
</ul>


                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    
    <footer class="footer">
          
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/why-docker">Why Docker</a></b></li>
                        <li><a href="https://www.docker.com/what-container">What is a Container</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/overview">Products</a></b></li>
                        <li><a href="https://www.docker.com/products/docker-desktop">Docker Desktop</a></li>
                        <li><a href="https://www.docker.com/products/docker-hub">Docker Hub</a></li>
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Features</a></b></li>
                        <li><a href="https://www.docker.com/products/container-runtime">Container Runtime</a></li>
                        <li><a href="https://www.docker.com/products/developer-tools">Developer Tools</a></li>
                        <li><a href="https://www.docker.com/products/kubernetes">Kubernetes</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Developers</a></b></li>
                        <li><a href="https://www.docker.com/use-cases">Use Cases</a></li>
                        <li><a href="https://www.docker.com/play-with-docker">Play with Docker</a></li>
                        <li><a href="https://www.docker.com/docker-community">Community</a></li>
                        <li><a href="https://www.docker.com/open-source">Open Source</a></li>
                        <li><a href="https://www.docker.com/community/docker-captains">Docker Captains</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/company" target="_blank">Company</a></b></li>
                        <li><a href="https://www.docker.com/company">About Us</a></li>
                        <li><a href="https://www.docker.com/blog/" target="_blank">Blog</a></li>
                        <li><a href="https://www.docker.com/customers">Customers</a></li>
                        <li><a href="https://www.docker.com/partners">Partners</a></li>
                        <li><a href="https://www.docker.com/company/newsroom">Newsroom</a></li>
                        <li><a href="https://www.docker.com/careers">Careers</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact Us</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="http://status.docker.com/">Status</a></li>
                        <li><a href="https://www.docker.com/docker-security">Security</a></li>
                        <li><a href="https://www.docker.com/legal">Legal</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2013-2020 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="http://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="http://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker">GitHub</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-slideshare"><a href="https://www.slideshare.net/docker">Slideshare</a></li>
                    <li class="fa fa-reddit"><a href="https://www.reddit.com/r/docker">Reddit</a></li>
                </ul>
            </div>
        </div>
    </div>

    </footer>
    <link rel="stylesheet" href="/docs.docker.jp.onthefly/css/github.css">
    
    <script defer src="/docs.docker.jp.onthefly/js/anchorlinks.js"></script>
    <script defer src="/docs.docker.jp.onthefly/js/menu.js"></script>
    <script src="/docs.docker.jp.onthefly/js/jquery.js"></script>
    <script src="/docs.docker.jp.onthefly/js/bootstrap.min.js"></script>
    <!-- Always include the archive.js, but it doesn't do much unless we are an archive -->
    <script>
    // Default to assuming this is an archive and hiding some stuff
    // See js/archive.js and js/docs.js for logic relating to this
    var isArchive = true;
    var dockerVersion = 'v19.03';
    // In archives, we need to know the page root and we get it from JEKYLL_ENV in the jekyll build command
    var jekyllEnv = 'development';
    // If unset (in non-archive branches), defaults to "development". In that case, reset it to empty
    if (jekyllEnv === 'development') {
        jekyllEnv = '';
    }
    var pageURL = jekyllEnv + '/ee/dtr/architecture/';
    </script>
    <script src="/docs.docker.jp.onthefly/js/archive.js"></script>
    <script src="/docs.docker.jp.onthefly/js/stickyfill.min.js"></script>
    <script defer src="/docs.docker.jp.onthefly/js/metadata.js"></script>
    <script src="/docs.docker.jp.onthefly/js/glossary.js"></script>
    <script defer src="/docs.docker.jp.onthefly/js/docs.js"></script>
    <script defer src="/docs.docker.jp.onthefly/js/toc.js"></script>
    <script>
    jQuery(document).ready(function(){hookupTOCEvents();});
    </script>
</body>
</html>
