<p>Docker Hub can automatically test changes to your source code repositories
using containers. You can enable <code class="language-plaintext highlighter-rouge">Autotest</code> on <a href="/docker-hub/repos">any Docker Hub repository</a> to run tests on each pull request to the source code
repository to create a continuous integration testing service.</p>

<p>Enabling <code class="language-plaintext highlighter-rouge">Autotest</code> builds an image for testing purposes, but does <strong>not</strong>
automatically push the built image to the Docker repository. If you want to push
built images to your Docker Hub repository, enable <a href="/docs.docker.jp.onthefly/docker-hub/builds/">Automated Builds</a>.</p>

<h2 id="set-up-automated-test-files">Set up automated test files</h2>

<p>To set up your automated tests, create a <code class="language-plaintext highlighter-rouge">docker-compose.test.yml</code> file which
defines a <code class="language-plaintext highlighter-rouge">sut</code> service that lists the tests to be run.
The <code class="language-plaintext highlighter-rouge">docker-compose.test.yml</code> file should be located in the same directory that
contains the Dockerfile used to build the image.</p>

<p>For example:</p>

<pre><code class="language-none">sut:
  build: .
  command: run_tests.sh
</code></pre>

<p>The example above builds the repository, and runs the <code class="language-plaintext highlighter-rouge">run_tests.sh</code> file inside
a container using the built image.</p>

<p>You can define any number of linked services in this file. The only requirement
is that <code class="language-plaintext highlighter-rouge">sut</code> is defined. Its return code determines if tests passed or not.
Tests <strong>pass</strong> if the <code class="language-plaintext highlighter-rouge">sut</code> service returns <code class="language-plaintext highlighter-rouge">0</code>, and <strong>fail</strong> otherwise.</p>

<blockquote>
  <p><strong>Note</strong>: Only the <code class="language-plaintext highlighter-rouge">sut</code> service and all other services listed in <code class="language-plaintext highlighter-rouge">depends_on</code>
are started. For instance, if you have services that poll for changes in other
services, be sure to include the polling services in the <code class="language-plaintext highlighter-rouge">depends_on</code> list to
make sure all of your services start.</p>
</blockquote>

<p>You can define more than one <code class="language-plaintext highlighter-rouge">docker-compose.test.yml</code> file if needed. Any file
that ends in <code class="language-plaintext highlighter-rouge">.test.yml</code> is used for testing, and the tests run sequentially.
You can also use <a href="/docs.docker.jp.onthefly/docker-hub/builds/advanced/#override-build-test-or-push-commands">custom build hooks</a>
to further customize your test behavior.</p>

<blockquote>
  <p><strong>Note</strong>: If you enable Automated builds, they also run any tests defined
in the <code class="language-plaintext highlighter-rouge">test.yml</code> files.</p>
</blockquote>

<h2 id="enable-automated-tests-on-a-repository">Enable automated tests on a repository</h2>

<p>To enable testing on a source code repository, you must first create an
associated build-repository in Docker Hub.  Your <code class="language-plaintext highlighter-rouge">Autotest</code> settings are
configured on the same page as <a href="/docs.docker.jp.onthefly/docker-hub/builds/">automated builds</a>, however
you do not need to enable Autobuilds to use <code class="language-plaintext highlighter-rouge">Autotest</code>. Autobuild is enabled per
branch or tag, and you do not need to enable it at all.</p>

<p>Only branches that are configured to use <strong>Autobuild</strong> push images to the
Docker repository, regardless of the Autotest settings.</p>

<ol>
  <li>
    <p>Log in to Docker Hub and select <strong>Repositories</strong> in the top navigation.</p>
  </li>
  <li>
    <p>Select the repository you want to enable <code class="language-plaintext highlighter-rouge">Autotest</code> on.</p>
  </li>
  <li>
    <p>From the repository view, click the <strong>Builds</strong> tab.</p>
  </li>
  <li>
    <p>Click <strong>Configure automated builds</strong>.</p>
  </li>
  <li>
    <p>Configure the automated build settings as explained in <a href="/docs.docker.jp.onthefly/docker-hub/builds/">Automated Builds</a>.</p>

    <p>At minimum you must configure:</p>

    <ul>
      <li>The source code repository</li>
      <li>the build location</li>
      <li>at least one build rule</li>
    </ul>
  </li>
  <li>
    <p>Choose your <strong>Autotest</strong> option.</p>

    <p>The following options are available:</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">Off</code>: No additional test builds. Tests only run if they’re configured
 as part of an automated build.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">Internal pull requests</code>: Run a test build for any pull requests
 to branches that match a build rule, but only when the pull request comes
 from the same source repository.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">Internal and external pull requests</code>: Run a test build for any
 pull requests to branches that match a build rule, including when the
 pull request originated in an external source repository.</p>
      </li>
    </ul>

    <blockquote>
      <p><strong>Note</strong>: For security purposes, autotest on <em>external pull requests</em> is
 limited on public repositories. Private images are not pulled and
 environment variables defined in Docker Hub are not
 available. Automated builds continue to work as usual.</p>
    </blockquote>
  </li>
  <li>
    <p>Click <strong>Save</strong> to save the settings, or click <strong>Save and build</strong> to save and
run an initial test.</p>
  </li>
</ol>

<h2 id="check-your-test-results">Check your test results</h2>

<p>From the repository’s details page, click <strong>Timeline</strong>.</p>

<p>From this tab you can see any pending, in-progress, successful, and failed
builds and test runs for the repository.</p>

<p>You can click any timeline entry to view the logs for each test run.</p>
