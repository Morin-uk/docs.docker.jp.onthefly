
<p>Docker Hub のぜい弱性スキャン（Vulnerability Scanning）とは、Synk を利用して Docker イメージのぜい弱性を自動的にスキャンする機能です。
これは <a href="/docs.docker.jp.onthefly/engine/scan/">docker scan</a> コマンドと同様の技術を利用するものです。</p>

<p>ぜい弱性スキャン機能を有効にした上で Docker Hub へのイメージプッシュを行うと、Docker Hub ではイメージのスキャンが自動的に開始され、コンテナーイメージ内のぜい弱性をチェックします。
ぜい弱性スキャンを行うことで、開発者や開発チームはコンテナーイメージのセキュリティ状態をレビューできます。
そしてスキャンによって問題が検出された場合には、その対処を進めることができます。
つまり、よりセキュアな開発が実現できます。
スキャン結果には、OS パッケージやライブラリなどにおけるぜい弱性の存在場所、ぜい弱性が含まれるバージョン、（利用可能であれば）推奨する修正バージョンなどが示されます。
これを参考にして、発見されたぜい弱性を解消していきます。</p>

<blockquote>
  <p><strong>メモ</strong></p>

  <p>Docker Hub のぜい弱性スキャン機能は、プロプランまたはチームプランを購入したユーザーが利用できます。
有償プランの詳細については <a href="https://www.docker.com/pricing" target="_blank" rel="noopener" class="_">Docker Pricing</a>（Docker の料金体系）を参照してください。</p>
</blockquote>

<h2 id="scan-images">イメージのスキャン</h2>

<p>Docker Hub のぜい弱性スキャン機能は、プロプランまたはチームプランを購入している場合に、そのリポジトリの所有ユーザーあるいは管理ユーザーが、この機能の有効無効を設定することができます。</p>

<p>またプロプランのリポジトリ所有ユーザーやチームプランのチームメンバーであれば、詳細なスキャン結果を参照することができます。
特定のリポジトリにおいてスキャン機能が有効である場合、Docker Hub へのイメージプッシュが行われると、スキャンが開始されます。</p>

<blockquote>
  <p><strong>メモ</strong></p>

  <p>Docker Hub が現時点においてサポートするスキャン機能では、イメージが AMD64 アーキテクチャーであって、サイズが 10 GB 以下であるもののみを対象としています。</p>
</blockquote>

<h3 id="enable-vulnerability-scanning">ぜい弱性スキャンの有効化</h3>

<p>リポジトリの所有ユーザーあるいは管理ユーザーであれば、リポジトリ上でのぜい弱性スキャン機能の有効化を設定できます。
チームプランのメンバーである場合、スキャン機能の有効化を設定するリポジトリは、チームプランに属するリポジトリです。</p>

<p>ぜい弱性スキャン機能を有効にするには以下を行います。</p>

<ol>
  <li><a href="https://hub.docker.com" target="_blank" rel="noopener" class="_">Docker Hub</a> アカウントのログインします。</li>
  <li>メインメニューの <strong>Repositories</strong> をクリックして、一覧の中からリポジトリを選択します。</li>
  <li>デフォルトでリポジトリはすべて、スキャン機能が無効になっています。
リポジトリに対する有効化の設定は、リポジトリ個々に行っていきます。
<strong>Settings</strong> タブを開いて <strong>Enable Image Scanning</strong>（イメージスキャンの有効化）をクリックします。</li>
</ol>

<h3 id="scan-an-image-for-vulnerabilities">イメージのぜい弱性スキャン</h3>

<p>イメージのぜい弱性をスキャンするには、そのイメージを Docker Hub にプッシュします。</p>

<ol>
  <li>ローカル環境に Docker がインストールできていることを確認します。
<a href="/docs.docker.jp.onthefly/get-docker/">Docker の入手</a> を参照して、Docker のダウンロードとローカルマシンへのインストールを行ってください。</li>
  <li>コマンドラインから Docker アカウントを使ってログインします。
詳しくは <a href="/docs.docker.jp.onthefly/engine/reference/commandline/login/">docker login</a> を参照してください。</li>
  <li>
    <p>スキャンするイメージにタグをつけます。
たとえば Redis イメージにタグをつけるには、以下のようにします。</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> docker tag redis &lt;your-Docker-ID&gt;/&lt;your-repo-name&gt;:latest
</code></pre></div>    </div>
  </li>
  <li>
    <p>Docker Hub にイメージをプッシュします。
これによって、イメージのぜい弱性スキャンが開始されます。</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> docker push &lt;your-Docker-ID&gt;/&lt;your-repo-name&gt;:latest
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="ぜい弱性報告の参照">ぜい弱性報告の参照</h2>

<p>ぜい弱性報告（vulnerability report）を参照するには以下を行います。</p>

<ol>
  <li>
    <p><a href="https://hub.docker.com" target="_blank" rel="noopener" class="_">Docker Hub</a> にアクセスして、目的のリポジトリを開いて、ぜい弱性スキャン報告の概要を表示します。</p>

    <blockquote>
      <p><strong>メモ</strong></p>

      <p>リポジトリ画面にぜい弱性報告が表示されるまでには、数分を要します。</p>
    </blockquote>

    <p><img src="/docs.docker.jp.onthefly/docker-hub/images/vuln-scan-report.png" alt="ぜい弱性スキャン報告" width="700px" /></p>
  </li>
  <li>
    <p><strong>Tags</strong> タブ &gt; <strong>Digest</strong> &gt; <strong>Vulnerabilities</strong> をクリックして、スキャン報告の詳細を表示します。</p>

    <p>スキャン報告では、スキャンによって特定されたぜい弱性が表示されます。
 表示にあたってはその重要度に従って並べられ、最も重要度の高いものから順に表示されます。
 表示される情報として、ぜい弱性が存在するパッケージ、ぜい弱性が含まれるバージョン、最新バージョンによってぜい弱性が修正されているかどうか、といった内容が示されます。</p>

    <p><img src="/docs.docker.jp.onthefly/docker-hub/images/vuln-scan-details.png" alt="ぜい弱性スキャンの詳細" width="700px" /></p>

    <blockquote>
      <p><strong>メモ</strong></p>

      <p>一覧の各行にある「open in browser」アイコンをクリックすれば、Synk ウェブサイトが提供するぜい弱性の詳細情報を確認することができます。</p>
    </blockquote>
  </li>
</ol>

<h3 id="disable-vulnerability-scanning">ぜい弱性スキャンの無効化</h3>

<p>リポジトリの所有ユーザーまたは管理ユーザーであれば、リポジトリのぜい弱性スキャン機能を無効にすることができます。
無効化は以下を行います。</p>

<ol>
  <li><a href="https://hub.docker.com" target="_blank" rel="noopener" class="_">Docker Hub</a> アカウントにログインします。</li>
  <li>メインメニューの <strong>Repositories</strong> をクリックして、一覧の中からリポジトリを選択します。</li>
  <li><strong>Settings</strong> タブを開いて <strong>Disable Image Scanning</strong>（イメージスキャンの無効化）をクリックします。</li>
</ol>

<h3 id="inspect-the-vulnerabilities">ぜい弱性の確認</h3>

<p>ぜい弱性報告の一覧は、その重要度に従ってぜい弱性が並べられます。
表示される情報として、ぜい弱性が存在するパッケージ、ぜい弱性が含まれるバージョン、最新バージョンによってぜい弱性が修正されているかどうか、といった内容が示されます。</p>

<p>ぜい弱性スキャン報告を開発チームやセキュリティ担当が検証する際には、タグ全体のぜい弱性カウントを見ることで、時間の経過とともにぜい弱性がどのように増減したかを確認できます。</p>

<h3 id="fixing-vulnerabilities">ぜい弱性の解消作業</h3>

<p>ぜい弱性として検出され一覧表示されたものについては、そのぜい弱性解消のための手段をいくつか講じていきます。
たとえば以下を行います。</p>

<ol>
  <li>Dockerfile に指定されるベースイメージは最新のものを用います。
アプリケーションレベルの依存パッケージを確認して、Docker イメージを再ビルドします。
そして Docker Hub に新たなイメージをプッシュします。</li>
  <li>Docker イメージを再ビルドします。
OS が提供するパッケージを更新するコマンドを実行します。
そして Docker Hub に新たなイメージをプッシュします。</li>
  <li>Dockerfile 内にぜい弱性のある特定のライブラリが存在していたら、削除するか最新のものに更新します。
イメージを再ビルドして Docker Hub に新たなイメージをプッシュします。</li>
</ol>

<p>上に示す手順を実施した後に、新たなぜい弱性報告を開いて、更新されたスキャン結果を確認します。</p>

<h2 id="feedback">フィードバック</h2>

<p>Docker Hub のぜい弱性スキャン機能を利用していただきありがとうございます。
みなさんからのフィードバックを頂くことが重要です。
フィードバックは GitHub リポジトリ内の <a href="https://github.com/docker/hub-feedback/issues" target="_blank" rel="noopener" class="_">hub-feedback</a> において issue を生成してお知らせください。</p>
