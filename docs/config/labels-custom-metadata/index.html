
<p>ラベルとは Docker オブジェクトにメタデータを提供する仕組みのことです。
Docker オブジェクトには以下があります。</p>

<ul>
  <li>イメージ</li>
  <li>コンテナー</li>
  <li>ローカル実行されるデーモン</li>
  <li>ボリューム</li>
  <li>ネットワーク</li>
  <li>Swarm ノード</li>
  <li>Swarm サービス</li>
</ul>

<p>ラベルはさまざまな目的で利用することができます。
イメージを構成したり、ライセンス情報を記録したり、コンテナー、ボリューム、ネットワーク間の関係性を書きとめたりといったものです。
業務やアプリケーションにとって意義のあることなら、どのようなものでも含めて構いません。</p>

<h2 id="label-keys-and-values">ラベルのキーとバリュー</h2>

<p>ラベルはキーバリューペアの形式であり、文字列として保存されます。
オブジェクトに対しては複数のラベルを指定することができますが、各キーバリューペアは 1 つのオブジェクト内で一意である必要があります。
1 つのキーに対して複数の値が設定されていた場合、古い値は最後に書き込まれた値により上書きされます。</p>

<h3 id="key-format-recommendations">推奨されるキーの書式</h3>

<p>ラベルにおけるキーは、キーバリューペアの左側を指します。
キーに含めることができる文字は、英数字、ピリオド（<code class="language-plaintext highlighter-rouge">.</code>）、ハイフン（<code class="language-plaintext highlighter-rouge">-</code>）です。
Docker ユーザーが利用するイメージは、たいていは他の組織が作り出したものであるため、ここに示すガイドラインに従っていれば、オブジェクト間でのラベル定義を不用意に重複させるようなことがなくなります。
自動化の仕組みの中でラベルを利用する場合は、特にこのことが重要になります。</p>

<ul>
  <li>
    <p>サードパーティ製ツールの開発者は、各ラベルのプリフィックスとして、自身が所有するドメインの逆 DNS 記法を用いるようにします。
たとえば <code class="language-plaintext highlighter-rouge">com.example.some-label</code> といったものです。</p>
  </li>
  <li>
    <p>ドメイン所有者の許可なく、ラベルのキーにそのドメイン名を使ってはいけません。</p>
  </li>
  <li>
    <p>以下の名前空間 <code class="language-plaintext highlighter-rouge">com.docker.*</code>, <code class="language-plaintext highlighter-rouge">io.docker.*</code>, <code class="language-plaintext highlighter-rouge">org.dockerproject.*</code> は、Docker が内部利用のために予約しています。</p>
  </li>
  <li>
    <p>ラベルのキーの始まりと終わりの 1 文字は英小文字とします。
そして文字列全体は、英小文字と数字、ピリオド（<code class="language-plaintext highlighter-rouge">.</code>）、ハイフン（<code class="language-plaintext highlighter-rouge">-</code>）を用いるようにします。
そしてピリオドとハイフンは連続して用いないようにします。</p>
  </li>
  <li>
    <p>ピリオド（<code class="language-plaintext highlighter-rouge">.</code>）は名前空間の「項目」を区切るものです。
ラベルのキーに名前空間が指定されていないものは、CLI が用いるものとしています。
ユーザーにとって CLI 実行の際、Docker オブジェクトに対して入力しやすい短いラベル文字列を指定できるようにするためです。</p>
  </li>
</ul>

<p>上のようなガイドラインは現時点において強制されるものではありません。
特定の用途において、さらに追加のガイドラインが適用されるかもしれません。</p>

<h3 id="value-guidelines">バリューに関するガイドライン</h3>

<p>ラベルのバリューには、文字列として表現できるものであれば、どんな型のデータでも含めることができます。
たとえば JSON, XML, CSV, YAML があり、これ以外にもまだあります。
唯一必要になることは、そのデータ型の構造に従った形で、文字列としてシリアライズされたものであることです。
たとえば JSON データを文字列にシリアライズするには、JavaScript メソッドでは <code class="language-plaintext highlighter-rouge">JSON.stringify()</code> を利用するかもしれません。</p>

<p>Docker ではそのバリューをデシリアライズしないため、ラベルを用いた検索やフィルタリングをする際には、ネスト構造になっている JSON や XML ドキュメントを取り扱うことはできません。
これを実現するためにはサードパーティ製のツール類に、そういった機能を組み入れる必要があります。</p>

<h2 id="manage-labels-on-objects">オブジェクトにおけるラベルの管理</h2>

<p>ラベルがサポートされている各オブジェクトには、ラベルの追加や管理を行う機能が備わっていて、そのオブジェクトに関連づいたラベルとして取り扱うことができます。
以下に示すリンクは、Docker デプロイにおいて利用するラベルを学ぶ上で役立つものです。</p>

<p>イメージ、コンテナー、ローカルデーモン、ボリューム、ネットワークといったオブジェクトにおいては、そのオブジェクトが存在する間、ラベルは静的で不変なものです。
ラベルを変更するためにはオブジェクトを再生成する必要があります。
Swarm ノードと Swarm サービスにおけるラベルは動的に変更することができます。</p>

<ul>
  <li>イメージとコンテナー
    <ul>
      <li><a href="/docs.docker.jp.onthefly/engine/reference/builder/#label">イメージへのラベル追加</a></li>
      <li><a href="/docs.docker.jp.onthefly/engine/reference/commandline/run/#set-metadata-on-container--l---label---label-file">実行時のコンテナーラベルの書き換え</a></li>
      <li><a href="/docs.docker.jp.onthefly/engine/reference/commandline/inspect/">イメージやコンテナー上のラベル調査</a></li>
      <li><a href="/docs.docker.jp.onthefly/engine/reference/commandline/images/#filtering">ラベルによるイメージのフィルタリング</a></li>
      <li><a href="/docs.docker.jp.onthefly/engine/reference/commandline/ps/#filtering">ラベルによるコンテナーのフィルタリング</a></li>
    </ul>
  </li>
  <li>ローカルの Docker デーモン
    <ul>
      <li><a href="/docs.docker.jp.onthefly/engine/reference/commandline/dockerd/">Docker デーモンへの実行時のラベル追加</a></li>
      <li><a href="/docs.docker.jp.onthefly/engine/reference/commandline/info/">Docker デーモンのラベル調査</a></li>
    </ul>
  </li>
  <li>ボリューム
    <ul>
      <li><a href="/docs.docker.jp.onthefly/engine/reference/commandline/volume_create/">ボリュームへのラベル追加</a></li>
      <li><a href="/docs.docker.jp.onthefly/engine/reference/commandline/volume_inspect/">ボリュームのラベル調査</a></li>
      <li><a href="/docs.docker.jp.onthefly/engine/reference/commandline/volume_ls/#filtering">ラベルによるボリュームのフィルタリング</a></li>
    </ul>
  </li>
  <li>ネットワーク
    <ul>
      <li><a href="/docs.docker.jp.onthefly/engine/reference/commandline/network_create/">ネットワークへのラベル追加</a></li>
      <li><a href="/docs.docker.jp.onthefly/engine/reference/commandline/network_inspect/">ネットワークラベルの調査</a></li>
      <li><a href="/docs.docker.jp.onthefly/engine/reference/commandline/network_ls/#filtering">ラベルによるネットワークのフィルタリング</a></li>
    </ul>
  </li>
  <li>Swarm ノード
    <ul>
      <li><a href="/docs.docker.jp.onthefly/engine/reference/commandline/node_update/#add-label-metadata-to-a-node">Swarm ノードのラベル追加または更新</a></li>
      <li><a href="/docs.docker.jp.onthefly/engine/reference/commandline/node_inspect/">Swarm ノードのラベル調査</a></li>
      <li><a href="/docs.docker.jp.onthefly/engine/reference/commandline/node_ls/#filtering">ラベルによる Swarm ノードのフィルタリング</a></li>
    </ul>
  </li>
  <li>Swarm サービス
    <ul>
      <li><a href="/docs.docker.jp.onthefly/engine/reference/commandline/service_create/#set-metadata-on-a-service-l-label">Swarm サービス生成時のラベル追加</a></li>
      <li><a href="/docs.docker.jp.onthefly/engine/reference/commandline/service_update/">Swarm サービスのラベル更新</a></li>
      <li><a href="/docs.docker.jp.onthefly/engine/reference/commandline/service_inspect/">Swarm サービスのラベル調査</a></li>
      <li><a href="/docs.docker.jp.onthefly/engine/reference/commandline/service_ls/#filtering">ラベルによる Swarm サービスのフィルタリング</a></li>
    </ul>
  </li>
</ul>
