
<p><code class="language-plaintext highlighter-rouge">local</code> ログドライバーは、コンテナーの標準出力、標準エラー出力を取り込んで、内部ストレージへの書き込みを行います。
この内部ストレージは、性能やディスク利用が最適化されているものです。</p>

<p>デフォルトで <code class="language-plaintext highlighter-rouge">local</code> ドライバーは、1 つのコンテナーあたり 100MB のログメッセージ容量を確保します。
そして自動的に圧縮を行って、ディスク利用量を軽減します。
100 MB というデフォルト容量は、デフォルトサイズが 20 MB のファイルを、デフォルトで 5 つ用意するところからきています。
（5 つのファイルはログローテーションを行うためです。）</p>

<blockquote>
  <p><strong>メモ</strong></p>

  <p><code class="language-plaintext highlighter-rouge">local</code> ログドライバーは、ファイルベースのストレージを利用します。
そのファイルフォーマットやストレージのメカニズムは、Docker デーモンがアクセスする目的で設計されています。
したがって外部ツールが利用するものではないため、その実装は将来のリリースにおいて変更になる場合があります。</p>
</blockquote>

<h2 id="usage">利用方法</h2>

<p>デフォルトログドライバーとして <code class="language-plaintext highlighter-rouge">local</code> ドライバーを利用するには、<code class="language-plaintext highlighter-rouge">daemon.json</code> ファイル内において <code class="language-plaintext highlighter-rouge">log-driver</code> と <code class="language-plaintext highlighter-rouge">log-opt</code> キーを適切に設定します。
<code class="language-plaintext highlighter-rouge">daemon.json</code> ファイルは Linux ホストの場合は <code class="language-plaintext highlighter-rouge">/etc/docker/</code>、Windows Server の場合は <code class="language-plaintext highlighter-rouge">C:\ProgramData\docker\config\daemon.json</code> にあります。
<code class="language-plaintext highlighter-rouge">daemon.json</code> を利用して Docker を設定する方法については <a href="/docs.docker.jp.onthefly/engine/reference/commandline/dockerd/#daemon-configuration-file">daemon.json</a> を参照してください。</p>

<p>以下の例では、ログドライバーに <code class="language-plaintext highlighter-rouge">local</code> を設定し、<code class="language-plaintext highlighter-rouge">max-size</code> オプションを利用しています。</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"log-driver"</span><span class="p">:</span><span class="w"> </span><span class="s2">"local"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"log-opts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"max-size"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10m"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>コンテナーの設定を新たにしたら、その変更を有効にするために Docker を再起動してください。
すでに起動しているコンテナーは、新たなログ設定を利用しません。</p>

<p>特定のコンテナーにのみログドライバーを設定するには、<code class="language-plaintext highlighter-rouge">docker container create</code> や <code class="language-plaintext highlighter-rouge">docker run</code> に対して <code class="language-plaintext highlighter-rouge">--log-driver</code> フラグを指定して実行します。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="se">\</span>
      <span class="nt">--log-driver</span> <span class="nb">local</span> <span class="nt">--log-opt</span> max-size<span class="o">=</span>10m <span class="se">\</span>
      alpine <span class="nb">echo </span>hello world
</code></pre></div></div>

<h3 id="options">オプション</h3>

<p><code class="language-plaintext highlighter-rouge">local</code> ログドライバーでは、以下のオプションがサポートされます。</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">オプション</th>
      <th style="text-align: left">内容説明</th>
      <th style="text-align: left">利用例</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">max-size</code></td>
      <td style="text-align: left">ログファイルが切り替わるまでの最大サイズ。正の整数と単位（<code class="language-plaintext highlighter-rouge">k</code>、<code class="language-plaintext highlighter-rouge">m</code>、<code class="language-plaintext highlighter-rouge">g</code>）を記述します。デフォルトは 20m です。</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">--log-opt max-size=10m</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">max-file</code></td>
      <td style="text-align: left">許容するログファイルの最大数。ログファイルが切り替わることでファイル最大数を越えた場合、最も古いファイルが削除されます。正の整数を指定します。デフォルトは 5 です。</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">--log-opt max-file=3</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">compress</code></td>
      <td style="text-align: left">ローテートするログファイルの圧縮の有無を指定します。デフォルトは有効です。</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">--log-opt compress=false</code></td>
    </tr>
  </tbody>
</table>

<h3 id="examples">利用例</h3>

<p>以下の例は <code class="language-plaintext highlighter-rouge">alpine</code> コンテナーを起動して、ログファイルを最大 3 つ利用し、その個々について 10 MB を越えないように設定します。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">-it</span> <span class="nt">--log-driver</span> <span class="nb">local</span> <span class="nt">--log-opt</span> max-size<span class="o">=</span>10m <span class="nt">--log-opt</span> max-file<span class="o">=</span>3 alpine ash
</code></pre></div></div>
