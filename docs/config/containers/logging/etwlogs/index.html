<p>The ETW logging driver forwards container logs as ETW events.
ETW stands for Event Tracing in Windows, and is the common framework
for tracing applications in Windows. Each ETW event contains a message
with both the log and its context information. A client can then create
an ETW listener to listen to these events.</p>

<p>The ETW provider that this logging driver registers with Windows, has the
GUID identifier of: <code class="language-plaintext highlighter-rouge">{a3693192-9ed6-46d2-a981-f8226c8363bd}</code>. A client creates an
ETW listener and registers to listen to events from the logging driver’s provider.
It does not matter the order in which the provider and listener are created.
A client can create their ETW listener and start listening for events from the provider,
before the provider has been registered with the system.</p>

<h2 id="usage">Usage</h2>

<p>Here is an example of how to listen to these events using the logman utility program
included in most installations of Windows:</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">logman start -ets DockerContainerLogs -p {a3693192-9ed6-46d2-a981-f8226c8363bd} 0 0 -o trace.etl</code></li>
  <li>Run your container(s) with the etwlogs driver, by adding
<code class="language-plaintext highlighter-rouge">--log-driver=etwlogs</code> to the Docker run command, and generate log messages.</li>
  <li><code class="language-plaintext highlighter-rouge">logman stop -ets DockerContainerLogs</code></li>
  <li>This generates an etl file that contains the events. One way to convert this
file into human-readable form is to run: <code class="language-plaintext highlighter-rouge">tracerpt -y trace.etl</code>.</li>
</ol>

<p>Each ETW event contains a structured message string in this format:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>container_name: %s, image_name: %s, container_id: %s, image_id: %s, source: [stdout | stderr], log: %s
</code></pre></div></div>

<p>Details on each item in the message can be found below:</p>

<table>
  <thead>
    <tr>
      <th>Field</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">container_name</code></td>
      <td>The container name at the time it was started.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">image_name</code></td>
      <td>The name of the container’s image.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">container_id</code></td>
      <td>The full 64-character container ID.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">image_id</code></td>
      <td>The full ID of the container’s image.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">source</code></td>
      <td><code class="language-plaintext highlighter-rouge">stdout</code> or <code class="language-plaintext highlighter-rouge">stderr</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">log</code></td>
      <td>The container log message.</td>
    </tr>
  </tbody>
</table>

<p>Here is an example event message (output formatted for readability):</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">container_name</span><span class="pi">:</span> <span class="s">backstabbing_spence,</span>
<span class="na">image_name</span><span class="pi">:</span> <span class="s">windowsservercore,</span>
<span class="na">container_id</span><span class="pi">:</span> <span class="s">f14bb55aa862d7596b03a33251c1be7dbbec8056bbdead1da8ec5ecebbe29731,</span>
<span class="na">image_id</span><span class="pi">:</span> <span class="s">sha256:2f9e19bd998d3565b4f345ac9aaf6e3fc555406239a4fb1b1ba879673713824b,</span>
<span class="na">source</span><span class="pi">:</span> <span class="s">stdout,</span>
<span class="na">log</span><span class="pi">:</span> <span class="s">Hello world!</span>
</code></pre></div></div>

<p>A client can parse this message string to get both the log message, as well as its
context information. The timestamp is also available within the ETW event.</p>

<blockquote>
  <p><strong>Note</strong></p>

  <p>This ETW provider emits only a message string, and not a specially structured
ETW event. Therefore, it is not required to register a manifest file with the
system to read and interpret its ETW events.</p>
</blockquote>
