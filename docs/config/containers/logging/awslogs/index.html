<p>The <code class="language-plaintext highlighter-rouge">awslogs</code> logging driver sends container logs to
<a href="https://aws.amazon.com/cloudwatch/details/#log-monitoring">Amazon CloudWatch Logs</a>.
Log entries can be retrieved through the <a href="https://console.aws.amazon.com/cloudwatch/home#logs:">AWS Management
Console</a> or the <a href="https://docs.aws.amazon.com/cli/latest/reference/logs/index.html">AWS SDKs
and Command Line Tools</a>.</p>

<h2 id="usage">Usage</h2>

<p>To use the <code class="language-plaintext highlighter-rouge">awslogs</code> driver as the default logging driver, set the <code class="language-plaintext highlighter-rouge">log-driver</code>
and <code class="language-plaintext highlighter-rouge">log-opt</code> keys to appropriate values in the <code class="language-plaintext highlighter-rouge">daemon.json</code> file, which is
located in <code class="language-plaintext highlighter-rouge">/etc/docker/</code> on Linux hosts or
<code class="language-plaintext highlighter-rouge">C:\ProgramData\docker\config\daemon.json</code> on Windows Server. For more about
configuring Docker using <code class="language-plaintext highlighter-rouge">daemon.json</code>, see
<a href="/docs.docker.jp.onthefly/engine/reference/commandline/dockerd/#daemon-configuration-file">daemon.json</a>.
The following example sets the log driver to <code class="language-plaintext highlighter-rouge">awslogs</code> and sets the
<code class="language-plaintext highlighter-rouge">awslogs-region</code> option.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"log-driver"</span><span class="p">:</span><span class="w"> </span><span class="s2">"awslogs"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"log-opts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"awslogs-region"</span><span class="p">:</span><span class="w"> </span><span class="s2">"us-east-1"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Restart Docker for the changes to take effect.</p>

<p>You can set the logging driver for a specific container by using the
<code class="language-plaintext highlighter-rouge">--log-driver</code> option to <code class="language-plaintext highlighter-rouge">docker run</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">--log-driver</span><span class="o">=</span>awslogs ...
</code></pre></div></div>

<p>If you are using Docker Compose, set <code class="language-plaintext highlighter-rouge">awslogs</code> using the following declaration example:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">myservice</span><span class="pi">:</span>
  <span class="na">logging</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">awslogs</span>
    <span class="na">options</span><span class="pi">:</span>
      <span class="na">awslogs-region</span><span class="pi">:</span> <span class="s">us-east-1</span>
</code></pre></div></div>

<h2 id="amazon-cloudwatch-logs-options">Amazon CloudWatch Logs options</h2>

<p>You can add logging options to the <code class="language-plaintext highlighter-rouge">daemon.json</code> to set Docker-wide defaults,
or use the <code class="language-plaintext highlighter-rouge">--log-opt NAME=VALUE</code> flag to specify Amazon CloudWatch Logs
logging driver options when starting a container.</p>

<h3 id="awslogs-region">awslogs-region</h3>

<p>The <code class="language-plaintext highlighter-rouge">awslogs</code> logging driver sends your Docker logs to a specific region. Use
the <code class="language-plaintext highlighter-rouge">awslogs-region</code> log option or the <code class="language-plaintext highlighter-rouge">AWS_REGION</code> environment variable to set
the region. By default, if your Docker daemon is running on an EC2 instance
and no region is set, the driver uses the instance’s region.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">--log-driver</span><span class="o">=</span>awslogs <span class="nt">--log-opt</span> awslogs-region<span class="o">=</span>us-east-1 ...
</code></pre></div></div>

<h3 id="awslogs-endpoint">awslogs-endpoint</h3>

<p>By default, Docker uses either the <code class="language-plaintext highlighter-rouge">awslogs-region</code> log option or the
detected region to construct the remote CloudWatch Logs API endpoint.
Use the <code class="language-plaintext highlighter-rouge">awslogs-endpoint</code> log option to override the default endpoint
with the provided endpoint.</p>

<blockquote>
  <p><strong>Note</strong></p>

  <p>The <code class="language-plaintext highlighter-rouge">awslogs-region</code> log option or detected region controls the
region used for signing. You may experience signature errors if the
endpoint you’ve specified with <code class="language-plaintext highlighter-rouge">awslogs-endpoint</code> uses a different region.</p>
</blockquote>

<h3 id="awslogs-group">awslogs-group</h3>

<p>You must specify a
<a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/WhatIsCloudWatchLogs.html">log group</a>
for the <code class="language-plaintext highlighter-rouge">awslogs</code> logging driver. You can specify the log group with the
<code class="language-plaintext highlighter-rouge">awslogs-group</code> log option:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">--log-driver</span><span class="o">=</span>awslogs <span class="nt">--log-opt</span> awslogs-region<span class="o">=</span>us-east-1 <span class="nt">--log-opt</span> awslogs-group<span class="o">=</span>myLogGroup ...
</code></pre></div></div>

<h3 id="awslogs-stream">awslogs-stream</h3>

<p>To configure which
<a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/WhatIsCloudWatchLogs.html">log stream</a>
should be used, you can specify the <code class="language-plaintext highlighter-rouge">awslogs-stream</code> log option. If not
specified, the container ID is used as the log stream.</p>

<blockquote>
  <p><strong>Note</strong></p>

  <p>Log streams within a given log group should only be used by one container
at a time. Using the same log stream for multiple containers concurrently
can cause reduced logging performance.</p>
</blockquote>

<h3 id="awslogs-create-group">awslogs-create-group</h3>

<p>Log driver returns an error by default if the log group does not exist. However, you can set the
<code class="language-plaintext highlighter-rouge">awslogs-create-group</code> to <code class="language-plaintext highlighter-rouge">true</code> to automatically create the log group as needed.
The <code class="language-plaintext highlighter-rouge">awslogs-create-group</code> option defaults to <code class="language-plaintext highlighter-rouge">false</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="se">\</span>
    <span class="nt">--log-driver</span><span class="o">=</span>awslogs <span class="se">\</span>
    <span class="nt">--log-opt</span> awslogs-region<span class="o">=</span>us-east-1 <span class="se">\</span>
    <span class="nt">--log-opt</span> awslogs-group<span class="o">=</span>myLogGroup <span class="se">\</span>
    <span class="nt">--log-opt</span> awslogs-create-group<span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
    ...
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong></p>

  <p>Your AWS IAM policy must include the <code class="language-plaintext highlighter-rouge">logs:CreateLogGroup</code> permission before
you attempt to use <code class="language-plaintext highlighter-rouge">awslogs-create-group</code>.</p>
</blockquote>

<h3 id="awslogs-datetime-format">awslogs-datetime-format</h3>

<p>The <code class="language-plaintext highlighter-rouge">awslogs-datetime-format</code> option defines a multiline start pattern in <a href="https://strftime.org">Python
<code class="language-plaintext highlighter-rouge">strftime</code> format</a>. A log message consists of a line that
matches the pattern and any following lines that don’t match the pattern. Thus
the matched line is the delimiter between log messages.</p>

<p>One example of a use case for using
this format is for parsing output such as a stack dump, which might otherwise
be logged in multiple entries. The correct pattern allows it to be captured in a
single entry.</p>

<p>This option always takes precedence if both <code class="language-plaintext highlighter-rouge">awslogs-datetime-format</code> and
<code class="language-plaintext highlighter-rouge">awslogs-multiline-pattern</code> are configured.</p>

<blockquote>
  <p><strong>Note</strong></p>

  <p>Multiline logging performs regular expression parsing and matching of all log
messages, which may have a negative impact on logging performance.</p>
</blockquote>

<p>Consider the following log stream, where new log messages start with a
timestamp:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">[May 01, 2017 19:00:01] A message was logged
[May 01, 2017 19:00:04] Another multiline message was logged
Some random message
with some random words
[May 01, 2017 19:01:32] Another message was logged
</span></code></pre></div></div>

<p>The format can be expressed as a <code class="language-plaintext highlighter-rouge">strftime</code> expression of
<code class="language-plaintext highlighter-rouge">[%b %d, %Y %H:%M:%S]</code>, and the <code class="language-plaintext highlighter-rouge">awslogs-datetime-format</code> value can be set to
that expression:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="se">\</span>
    <span class="nt">--log-driver</span><span class="o">=</span>awslogs <span class="se">\</span>
    <span class="nt">--log-opt</span> awslogs-region<span class="o">=</span>us-east-1 <span class="se">\</span>
    <span class="nt">--log-opt</span> awslogs-group<span class="o">=</span>myLogGroup <span class="se">\</span>
    <span class="nt">--log-opt</span> awslogs-datetime-format<span class="o">=</span><span class="s1">'\[%b %d, %Y %H:%M:%S\]'</span> <span class="se">\</span>
    ...
</code></pre></div></div>

<p>This parses the logs into the following CloudWatch log events:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span><span class="w"> </span>First event
<span class="go">[May 01, 2017 19:00:01] A message was logged

</span><span class="gp">#</span><span class="w"> </span>Second event
<span class="go">[May 01, 2017 19:00:04] Another multiline message was logged
Some random message
with some random words

</span><span class="gp">#</span><span class="w"> </span>Third event
<span class="go">[May 01, 2017 19:01:32] Another message was logged
</span></code></pre></div></div>

<p>The following <code class="language-plaintext highlighter-rouge">strftime</code> codes are supported:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Code</th>
      <th style="text-align: left">Meaning</th>
      <th style="text-align: left">Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">%a</code></td>
      <td style="text-align: left">Weekday abbreviated name.</td>
      <td style="text-align: left">Mon</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">%A</code></td>
      <td style="text-align: left">Weekday full name.</td>
      <td style="text-align: left">Monday</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">%w</code></td>
      <td style="text-align: left">Weekday as a decimal number where 0 is Sunday and 6 is Saturday.</td>
      <td style="text-align: left">0</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">%d</code></td>
      <td style="text-align: left">Day of the month as a zero-padded decimal number.</td>
      <td style="text-align: left">08</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">%b</code></td>
      <td style="text-align: left">Month abbreviated name.</td>
      <td style="text-align: left">Feb</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">%B</code></td>
      <td style="text-align: left">Month full name.</td>
      <td style="text-align: left">February</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">%m</code></td>
      <td style="text-align: left">Month as a zero-padded decimal number.</td>
      <td style="text-align: left">02</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">%Y</code></td>
      <td style="text-align: left">Year with century as a decimal number.</td>
      <td style="text-align: left">2008</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">%y</code></td>
      <td style="text-align: left">Year without century as a zero-padded decimal number.</td>
      <td style="text-align: left">08</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">%H</code></td>
      <td style="text-align: left">Hour (24-hour clock) as a zero-padded decimal number.</td>
      <td style="text-align: left">19</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">%I</code></td>
      <td style="text-align: left">Hour (12-hour clock) as a zero-padded decimal number.</td>
      <td style="text-align: left">07</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">%p</code></td>
      <td style="text-align: left">AM or PM.</td>
      <td style="text-align: left">AM</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">%M</code></td>
      <td style="text-align: left">Minute as a zero-padded decimal number.</td>
      <td style="text-align: left">57</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">%S</code></td>
      <td style="text-align: left">Second as a zero-padded decimal number.</td>
      <td style="text-align: left">04</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">%L</code></td>
      <td style="text-align: left">Milliseconds as a zero-padded decimal number.</td>
      <td style="text-align: left">.123</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">%f</code></td>
      <td style="text-align: left">Microseconds as a zero-padded decimal number.</td>
      <td style="text-align: left">000345</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">%z</code></td>
      <td style="text-align: left">UTC offset in the form +HHMM or -HHMM.</td>
      <td style="text-align: left">+1300</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">%Z</code></td>
      <td style="text-align: left">Time zone name.</td>
      <td style="text-align: left">PST</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">%j</code></td>
      <td style="text-align: left">Day of the year as a zero-padded decimal number.</td>
      <td style="text-align: left">363</td>
    </tr>
  </tbody>
</table>

<h3 id="awslogs-multiline-pattern">awslogs-multiline-pattern</h3>

<p>The <code class="language-plaintext highlighter-rouge">awslogs-multiline-pattern</code> option defines a multiline start pattern using a
regular expression. A log message consists of a line that matches the pattern
and any following lines that don’t match the pattern. Thus the matched line is
the delimiter between log messages.</p>

<p>This option is ignored if <code class="language-plaintext highlighter-rouge">awslogs-datetime-format</code> is also configured.</p>

<blockquote>
  <p><strong>Note</strong>:
Multiline logging performs regular expression parsing and matching of all log
messages. This may have a negative impact on logging performance.</p>
</blockquote>

<p>For example, to process the following log stream where new log messages start with the pattern <code class="language-plaintext highlighter-rouge">INFO</code>:</p>

<p>Consider the following log stream, where each log message should start with the
patther <code class="language-plaintext highlighter-rouge">INFO</code>:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">INFO A message was logged
INFO Another multiline message was logged
     Some random message
INFO Another message was logged
</span></code></pre></div></div>

<p>You can use the regular expression of <code class="language-plaintext highlighter-rouge">^INFO</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="se">\</span>
    <span class="nt">--log-driver</span><span class="o">=</span>awslogs <span class="se">\</span>
    <span class="nt">--log-opt</span> awslogs-region<span class="o">=</span>us-east-1 <span class="se">\</span>
    <span class="nt">--log-opt</span> awslogs-group<span class="o">=</span>myLogGroup <span class="se">\</span>
    <span class="nt">--log-opt</span> awslogs-multiline-pattern<span class="o">=</span><span class="s1">'^INFO'</span> <span class="se">\</span>
    ...
</code></pre></div></div>

<p>This parses the logs into the following CloudWatch log events:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span><span class="w"> </span>First event
<span class="go">INFO A message was logged

</span><span class="gp">#</span><span class="w"> </span>Second event
<span class="go">INFO Another multiline message was logged
     Some random message

</span><span class="gp">#</span><span class="w"> </span>Third event
<span class="go">INFO Another message was logged
</span></code></pre></div></div>

<h3 id="tag">tag</h3>

<p>Specify <code class="language-plaintext highlighter-rouge">tag</code> as an alternative to the <code class="language-plaintext highlighter-rouge">awslogs-stream</code> option. <code class="language-plaintext highlighter-rouge">tag</code> interprets
Go template markup, such as <code class="language-plaintext highlighter-rouge">{{.ID}}</code>, <code class="language-plaintext highlighter-rouge">{{.FullID}}</code>
or <code class="language-plaintext highlighter-rouge">{{.Name}}</code> <code class="language-plaintext highlighter-rouge">docker.{{.ID}}</code>. See
the <a href="/docs.docker.jp.onthefly/config/containers/logging/log_tags/">tag option documentation</a> for details on supported template
substitutions.</p>

<p>When both <code class="language-plaintext highlighter-rouge">awslogs-stream</code> and <code class="language-plaintext highlighter-rouge">tag</code> are specified, the value supplied for
<code class="language-plaintext highlighter-rouge">awslogs-stream</code> overrides the template specified with <code class="language-plaintext highlighter-rouge">tag</code>.</p>

<p>If not specified, the container ID is used as the log stream.</p>

<blockquote>
  <p><strong>Note</strong></p>

  <p>The CloudWatch log API does not support <code class="language-plaintext highlighter-rouge">:</code> in the log name. This can cause
some issues when using the <code class="language-plaintext highlighter-rouge">{{ .ImageName }}</code> as a tag,
since a docker image has a format of <code class="language-plaintext highlighter-rouge">IMAGE:TAG</code>, such as <code class="language-plaintext highlighter-rouge">alpine:latest</code>.
Template markup can be used to get the proper format. To get the image name
and the first 12 characters of the container ID, you can use:</p>

  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">--log-opt</span> <span class="nv">tag</span><span class="o">=</span><span class="s1">'{{ with split .ImageName ":" }}{{join . "_"}}{{end}}-{{.ID}}'</span>
</code></pre></div>  </div>

  <p>the output is something like: <code class="language-plaintext highlighter-rouge">alpine_latest-bf0072049c76</code></p>
</blockquote>

<h2 id="credentials">Credentials</h2>

<p>You must provide AWS credentials to the Docker daemon to use the <code class="language-plaintext highlighter-rouge">awslogs</code>
logging driver. You can provide these credentials with the <code class="language-plaintext highlighter-rouge">AWS_ACCESS_KEY_ID</code>,
<code class="language-plaintext highlighter-rouge">AWS_SECRET_ACCESS_KEY</code>, and <code class="language-plaintext highlighter-rouge">AWS_SESSION_TOKEN</code> environment variables, the
default AWS shared credentials file (<code class="language-plaintext highlighter-rouge">~/.aws/credentials</code> of the root user), or
if you are running the Docker daemon on an Amazon EC2 instance, the Amazon EC2
instance profile.</p>

<p>Credentials must have a policy applied that allows the <code class="language-plaintext highlighter-rouge">logs:CreateLogStream</code>
and <code class="language-plaintext highlighter-rouge">logs:PutLogEvents</code> actions, as shown in the following example.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"logs:CreateLogStream"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"logs:PutLogEvents"</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
