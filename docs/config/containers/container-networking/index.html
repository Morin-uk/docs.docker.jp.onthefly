
<p>コンテナーが利用するネットワークの種類は、<a href="/docs.docker.jp.onthefly/network/bridge/">ブリッジ</a>、<a href="/docs.docker.jp.onthefly/network/overlay/">オーバーレイ</a>、<a href="/docs.docker.jp.onthefly/network/macvlan/">Macvlan ネットワーク</a>、カスタムネットワークプラグインとさまざまですが、コンテナーの内部から見ればどれも同じです。
コンテナーからすれば、ネットワークインターフェースに IP アドレスがあり、ゲートウェイ、ルーティングテーブル、DNS サービス、その他のネットワークリソースがあるだけのことです。
（もちろんコンテナーが <code class="language-plaintext highlighter-rouge">none</code> ネットワークドライバーを用いる場合は除きます。）
ここでは、コンテナーから見たネットワーク関連のもろもろについて示します。</p>

<h2 id="published-ports">公開ポート</h2>

<p><code class="language-plaintext highlighter-rouge">docker create</code>や<code class="language-plaintext highlighter-rouge">docker run</code>を使ってコンテナーを生成、実行した際には、デフォルトではどのポートも外部に向け公開はされません。
Docker 外部にあるサービスに向けて、あるいはコンテナーネットワークに接続していない別のコンテナーに向けてポートを利用可能とするには、<code class="language-plaintext highlighter-rouge">--publish</code>または<code class="language-plaintext highlighter-rouge">-p</code>フラグを用います。
これを行うと、コンテナーから外部にある Docker ホストに向けたポート割り当てを実現するファイアウォールルールが生成されます。
以下がその例です。</p>

<table>
  <thead>
    <tr>
      <th>フラグ値</th>
      <th>内容説明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-p 8080:80</code></td>
      <td>コンテナーの TCP ポート 80 を Docker ホスト上のポート 8080 に割り当てます。</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-p 192.168.1.100:8080:80</code></td>
      <td>コンテナーの TCP ポート 80 を Docker ホストの IP 192.168.1.100 への接続時のポート 8080 に割り当てます。</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-p 8080:80/udp</code></td>
      <td>コンテナーの UDP ポート 80 を Docker ホスト上のポート 8080 に割り当てます。</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-p 8080:80/tcp -p 8080:80/udp</code></td>
      <td>コンテナーの TCP ポート 80 を Docker ホスト上のポート 8080 に割り当てます。またコンテナーの UDP ポート 80 を Docker ホスト上のポート 8080 に割り当てます。</td>
    </tr>
  </tbody>
</table>

<h2 id="ip-address-and-hostname">IP アドレスとホスト名</h2>

<p>コンテナーが接続する Docker ネットワークのすべてに対して、デフォルトで個々に IP アドレスが割り振られます。
そしてその IP アドレスは、そのネットワークにある IP プールから割り振られます。
したがって Docker デーモンは各コンテナーに対して、実質的に DHCP サーバーとして振る舞うことになります。
各ネットワークには、デフォルトのサブネットマスクとゲートウェイがそれぞれに存在します。</p>

<p>コンテナーを起動する際に、ただ 1 つのネットワークに接続させるには <code class="language-plaintext highlighter-rouge">--network</code> フラグを使います。
実行中のコンテナーを複数ネットワークに接続するなら <code class="language-plaintext highlighter-rouge">docker network connect</code> を使います。
<code class="language-plaintext highlighter-rouge">--network</code> フラグを用いてコンテナーを起動すると、そのネットワーク上においてコンテナーに対する IP アドレスを指定することができます。
その場合には <code class="language-plaintext highlighter-rouge">--ip</code> または <code class="language-plaintext highlighter-rouge">--ip6</code> フラグを使います。</p>

<p>既存のコンテナーをそれまでとは違うネットワークに接続するには <code class="language-plaintext highlighter-rouge">docker network connect</code> を用いますが、
コマンド実行の際に <code class="language-plaintext highlighter-rouge">--ip</code> または <code class="language-plaintext highlighter-rouge">--ip6</code> フラグを用いれば、そのネットワーク上での IP アドレスを指定することができます。</p>

<p>同じような話として、コンテナーのホスト名にはコンテナー ID がデフォルトで割り当てられますが、<code class="language-plaintext highlighter-rouge">--hostname</code> を使えばホスト名をオーバーライドすることができます。
既存のネットワークに <code class="language-plaintext highlighter-rouge">docker network connect</code> を使って接続する際に <code class="language-plaintext highlighter-rouge">--alias</code> フラグを使うと、そのネットワーク上においてコンテナーの別名を指定することができます。</p>

<h2 id="dns-services">DNS サービス</h2>

<p>コンテナーなデフォルトで、ホスト上の設定ファイル <code class="language-plaintext highlighter-rouge">/etc/resolv.conf</code> によって定義された DNS 設定を受け継ぎます。
コンテナーがデフォルトの <code class="language-plaintext highlighter-rouge">bridge</code> ネットワークを利用する場合は、その設定ファイルがコピーされます。
この一方で <a href="/docs.docker.jp.onthefly/network/network-tutorial-standalone/#use-user-defined-bridge-networks">カスタムネットワーク</a> を利用するコンテナーの場合は、Docker の埋め込み DNS サーバーを利用します。
これはホスト上において設定された DNS サーバーに対して、外部 DNS ルックアップをフォワードします。</p>

<p><code class="language-plaintext highlighter-rouge">/etc/hosts</code> においてカスタムホストが定義されていても、これは受け継がれません。
追加的なホスト定義をコンテナーに受け渡すには、<code class="language-plaintext highlighter-rouge">docker run</code> のリファレンスドキュメント内にある、<a href="/docs.docker.jp.onthefly/engine/reference/commandline/run/#add-entries-to-container-hosts-file---add-host">コンテナーのホストファイルへのエントリー追加</a> を参照してください。
このような設定は、コンテナーごとにオーバーライドすることができます。</p>

<table>
  <thead>
    <tr>
      <th>フラグ</th>
      <th>内容説明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">--dns</code></td>
      <td>DNS サーバーの IP アドレス。複数の DNS サーバーを指定する場合は <code class="language-plaintext highlighter-rouge">--dns</code> フラグを複数回指定します。指定した IP アドレスにコンテナーから接続できない場合、Google の公開 DNS サーバー <code class="language-plaintext highlighter-rouge">8.8.8.8</code> を追加すれば、コンテナーがインターネットドメインを解決できるようになります。</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">--dns-search</code></td>
      <td>完全修飾ドメイン名でないホスト名を検索するための DNS 検索ドメイン。複数の DNS サーチプレフィックスを指定するする場合は、<code class="language-plaintext highlighter-rouge">--dns-search</code> フラグを複数回指定します。</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">--dns-opt</code></td>
      <td>DNS オプションとその値を表わすキーバリューペア。適用するオプションについては、オペレーティングシステムにおける <code class="language-plaintext highlighter-rouge">resolv.conf</code> のドキュメントを参照してください。</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">--hostname</code></td>
      <td>コンテナーそのものが利用するホスト名。特に指定がない場合は、デフォルトでコンテナーID がホスト名になります。</td>
    </tr>
  </tbody>
</table>

<h2 id="proxy-server">プロキシーサーバー</h2>

<p>コンテナーにおいてプロキシーサーバーを利用する必要がある場合は、<a href="/docs.docker.jp.onthefly/network/proxy/">プロキシーサーバーの利用</a> を参照してください。</p>
