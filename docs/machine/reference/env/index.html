
<p><code class="language-plaintext highlighter-rouge">docker</code> コマンドが、特定のマシン向けのコマンドを実行できるように、環境変数の設定を行います。</p>

<ul class="nav nav-tabs">
  <li class="active"><a data-toggle="tab" href="#origin">英語表記</a></li>
  <li><a data-toggle="tab" href="#japanese">日本語訳</a></li>
</ul>
<div class="tab-content">
  <div id="origin" class="tab-pane fade in active">
    <div class="language-bash highlighter-rouge">
      <div class="highlight">
        <div class="language-plaintext highlight highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker-machine env --help

Usage: docker-machine env [OPTIONS] [arg...]

Display the commands to set up the environment for the Docker client

Description:
   Argument is a machine name.

Options:

   --swarm	Display the Swarm config instead of the Docker daemon
   --shell 	Force environment to be configured for a specified shell: [fish, cmd, powershell, tcsh], default is sh/bash
   --unset, -u	Unset variables instead of setting them
   --no-proxy	Add machine IP to NO_PROXY environment variable
</code></pre></div>        </div>
      </div>
    </div>
  </div>
  <div id="japanese" class="tab-pane fade">

    <div class="language-bash highlighter-rouge">
      <div class="highlight">
        <div class="language-plaintext highlight highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker-machine env --help

利用方法: docker-machine env [オプション] [arg...]

Docker クライアントに対しての環境設定を行うコマンドを表示します。

内容説明:
   引数にはマシン名を指定します。

オプション:

   --swarm	Docker デーモンではなく Swarm の設定内容を表示します。
   --shell 	指定されたシェル向けに設定された環境表示とします。[fish, cmd, powershell, tcsh] デフォルトは sh/bash
   --unset, -u	環境設定を解除します。
   --no-proxy	マシン IP を環境変数 NO_PROXY に追加します。
</code></pre></div>        </div>
      </div>
    </div>

  </div>
</div>

<p><code class="language-plaintext highlighter-rouge">docker-machine env マシン名</code> は、サブシェル内で実行可能な <code class="language-plaintext highlighter-rouge">export</code> コマンドを表示します。
<code class="language-plaintext highlighter-rouge">docker-machine env -u</code> を実行すると、それとは逆に <code class="language-plaintext highlighter-rouge">unset</code> コマンドを表示します。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">env</span> | <span class="nb">grep </span>DOCKER
<span class="nv">$ </span><span class="nb">eval</span> <span class="s2">"</span><span class="si">$(</span>docker-machine <span class="nb">env </span>dev<span class="si">)</span><span class="s2">"</span>
<span class="nv">$ </span><span class="nb">env</span> | <span class="nb">grep </span>DOCKER

<span class="nv">DOCKER_HOST</span><span class="o">=</span>tcp://192.168.99.101:2376
<span class="nv">DOCKER_CERT_PATH</span><span class="o">=</span>/Users/nathanleclaire/.docker/machines/.client
<span class="nv">DOCKER_TLS_VERIFY</span><span class="o">=</span>1
<span class="nv">DOCKER_MACHINE_NAME</span><span class="o">=</span>dev
<span class="nv">$ </span><span class="c"># If you run a docker command, now it runs against that host.</span>
<span class="nv">$ </span><span class="nb">eval</span> <span class="s2">"</span><span class="si">$(</span>docker-machine <span class="nb">env</span> <span class="nt">-u</span><span class="si">)</span><span class="s2">"</span>
<span class="nv">$ </span><span class="nb">env</span> | <span class="nb">grep </span>DOCKER
<span class="nv">$ </span><span class="c"># The environment variables have been unset.</span>
</code></pre></div></div>

<p>上に示した出力結果は <code class="language-plaintext highlighter-rouge">bash</code> または <code class="language-plaintext highlighter-rouge">zsh</code> 向けのものです。
（どのシェルを使っているのかわからない場合であっても、たいていは <code class="language-plaintext highlighter-rouge">bash</code> である可能性が高いです。）
ただし Docker Machine がサポートするシェルは、これだけではありません。
Docker Machine は、利用環境内のシェルを検知して、結果を表示します。
Docker では <code class="language-plaintext highlighter-rouge">bash</code>、<code class="language-plaintext highlighter-rouge">cmd</code>、<code class="language-plaintext highlighter-rouge">powershell</code>、<code class="language-plaintext highlighter-rouge">emacs</code> がサポートされています。</p>

<p>利用しているシェルが <code class="language-plaintext highlighter-rouge">fish</code> であって、環境変数 <code class="language-plaintext highlighter-rouge">SHELL</code> に <code class="language-plaintext highlighter-rouge">fish</code> へのパスが正しく設定されていれば、<code class="language-plaintext highlighter-rouge">docker-machine env name</code> の実行によって、<code class="language-plaintext highlighter-rouge">fish</code> に適した書式により結果が表示されます。</p>

<pre><code class="language-fish">set -x DOCKER_TLS_VERIFY 1;
set -x DOCKER_CERT_PATH "/Users/nathanleclaire/.docker/machine/machines/overlay";
set -x DOCKER_HOST tcp://192.168.99.102:2376;
set -x DOCKER_MACHINE_NAME overlay
# Run this command to configure your shell:
# eval "$(docker-machine env overlay)"
</code></pre>

<p>Windows 上において PowerShell や <code class="language-plaintext highlighter-rouge">cmd.exe</code> を利用している場合は、<code class="language-plaintext highlighter-rouge">docker-machine env</code> によって Docker Machine はシェルを自動検出します。
この自動検出が動作しなかった場合は、<code class="language-plaintext highlighter-rouge">docker-machine env</code> において <code class="language-plaintext highlighter-rouge">--shell</code> フラグを使ってシェル指定をオーバーライドできます。</p>

<p>PowerShell 向けには以下を実行します。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker-machine.exe <span class="nb">env</span> <span class="nt">--shell</span> powershell dev

<span class="nv">$Env</span>:DOCKER_TLS_VERIFY <span class="o">=</span> <span class="s2">"1"</span>
<span class="nv">$Env</span>:DOCKER_HOST <span class="o">=</span> <span class="s2">"tcp://192.168.99.101:2376"</span>
<span class="nv">$Env</span>:DOCKER_CERT_PATH <span class="o">=</span> <span class="s2">"C:</span><span class="se">\U</span><span class="s2">sers</span><span class="se">\c</span><span class="s2">aptain</span><span class="se">\.</span><span class="s2">docker</span><span class="se">\m</span><span class="s2">achine</span><span class="se">\m</span><span class="s2">achines</span><span class="se">\d</span><span class="s2">ev"</span>
<span class="nv">$Env</span>:DOCKER_MACHINE_NAME <span class="o">=</span> <span class="s2">"dev"</span>
<span class="c"># Run this command to configure your shell:</span>
<span class="c"># docker-machine.exe env --shell=powershell dev | Invoke-Expression</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">cmd.exe</code> 向けには以下を実行します。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker-machine.exe <span class="nb">env</span> <span class="nt">--shell</span> cmd dev

<span class="nb">set </span><span class="nv">DOCKER_TLS_VERIFY</span><span class="o">=</span>1
<span class="nb">set </span><span class="nv">DOCKER_HOST</span><span class="o">=</span>tcp://192.168.99.101:2376
<span class="nb">set </span><span class="nv">DOCKER_CERT_PATH</span><span class="o">=</span>C:<span class="se">\U</span>sers<span class="se">\c</span>aptain<span class="se">\.</span>docker<span class="se">\m</span>achine<span class="se">\m</span>achines<span class="se">\d</span>ev
<span class="nb">set </span><span class="nv">DOCKER_MACHINE_NAME</span><span class="o">=</span>dev
<span class="c"># Run this command to configure your shell: copy and paste the above values into your command prompt</span>
</code></pre></div></div>

<blockquote>
  <p><strong>ヒント</strong></p>

  <p><a href="/docs.docker.jp.onthefly/machine/get-started/#unset-environment-variables-in-the-current-shell">カレントシェルの環境変数クリア</a> も参照してください。</p>
</blockquote>

<h2 id="excluding-the-created-machine-from-proxies">プロキシー設定における生成マシンの除外</h2>

<p>env コマンドには <code class="language-plaintext highlighter-rouge">--no-proxy</code> フラグがあります。
これは生成されるマシンの IP アドレスを <a href="https://wiki.archlinux.org/index.php/Proxy_settings">環境変数 <code class="language-plaintext highlighter-rouge">NO_PROXY</code>/<code class="language-plaintext highlighter-rouge">no_proxy</code></a> に追加します。</p>

<p>これが役に立つのは、<code class="language-plaintext highlighter-rouge">virtualbox</code> や <code class="language-plaintext highlighter-rouge">vmwarefusion</code> のようなローカル VM プロバイダーにおいて <code class="language-plaintext highlighter-rouge">docker-machine</code> を利用する場合です。
そのような環境では、インターネットアクセスにおいて HTTP プロキシーが必要になるからです。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker-machine <span class="nb">env</span> <span class="nt">--no-proxy</span> default

<span class="nb">export </span><span class="nv">DOCKER_TLS_VERIFY</span><span class="o">=</span><span class="s2">"1"</span>
<span class="nb">export </span><span class="nv">DOCKER_HOST</span><span class="o">=</span><span class="s2">"tcp://192.168.99.104:2376"</span>
<span class="nb">export </span><span class="nv">DOCKER_CERT_PATH</span><span class="o">=</span><span class="s2">"/Users/databus23/.docker/machine/certs"</span>
<span class="nb">export </span><span class="nv">DOCKER_MACHINE_NAME</span><span class="o">=</span><span class="s2">"default"</span>
<span class="nb">export </span><span class="nv">NO_PROXY</span><span class="o">=</span><span class="s2">"192.168.99.104"</span>
<span class="c"># Run this command to configure your shell:</span>
<span class="c"># eval "$(docker-machine env default)"</span>
</code></pre></div></div>

<p>生成済みのデーモンに対して <code class="language-plaintext highlighter-rouge">HTTP_PROXY</code> の設定を行う方法も、ドキュメントを確認することが必要でしょう。
その際には <a href="/docs.docker.jp.onthefly/machine/reference/create/#specifying-configuration-options-for-the-created-docker-engine"><code class="language-plaintext highlighter-rouge">docker-machine create</code></a> において <code class="language-plaintext highlighter-rouge">--engine-env</code> フラグを利用します。</p>
