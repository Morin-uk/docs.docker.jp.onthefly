
<p>クラウドプラットフォームに対応する Docker Machine ドライバープラグインが数多くあります。
このため Docker Machine を使ってクラウドホストへのプロビジョニングを行うことが可能です。
プロビジョニングに Docker Machine を利用すると、クラウドホスト上に Docker Engine をインストールしてホスト構築を行うことができます。</p>

<p>Docker Machine のインストールと起動を行って、クラウドプロバイダー上にアカウントを生成してください。</p>

<p>これによりアカウント検証、セキュリティ資格情報、などプロバイダーに対する設定オプションを<code class="language-plaintext highlighter-rouge">docker-machine create</code>のフラグとして指定します。
たとえば DigitalOcean 用のアクセストークンを指定するには<code class="language-plaintext highlighter-rouge">--digitalocean-access-token</code>フラグを用います。
以下の DigitalOcean と AWS に関する例を確認してください。</p>

<h2 id="examples">利用例</h2>

<h3 id="digitalocean">DigitalOcean</h3>

<p>DigitalOcean に対して、以下のコマンドにより「docker-sandbox」と呼ばれるドロップレット（クラウドホスト）が生成されます。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker-machine create <span class="nt">--driver</span> digitalocean <span class="nt">--digitalocean-access-token</span> xxxxx docker-sandbox
</code></pre></div></div>

<p>Machine を利用し Digital Ocean に対して Docker ホストを生成するガイドが <a href="/docs.docker.jp.onthefly/machine/examples/ocean/">DigitalOcean 利用例</a> にあるので参照してください。</p>

<h3 id="amazon-web-services-aws">Amazon ウェブサービス (Amazon Web Services; AWS)</h3>

<p>AWS EC2 に対しては、以下のコマンドにより「aws-sandbox」と呼ばれるインスタンスが生成されます。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker-machine create <span class="nt">--driver</span> amazonec2 <span class="nt">--amazonec2-access-key</span> AKI<span class="k">*******</span> <span class="nt">--amazonec2-secret-key</span> 8T93C<span class="k">*******</span>  aws-sandbox
</code></pre></div></div>

<p>Machine を利用し Docker 化した AWS インスタンス に対して Docker ホストを生成するガイドが <a href="/docs.docker.jp.onthefly/machine/examples/aws/">Amazon ウェブサービス (AWS) 利用例</a> にあるので参照してください。</p>

<h2 id="the-docker-machine-create-command">docker-machine create コマンド</h2>

<p><code class="language-plaintext highlighter-rouge">docker-machine create</code>コマンドは通常、以下に示すような指定が最低でも必要です。</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">--driver</code> - マシンを生成するためのプロバイダーを指定します。
（VirtualBox、DigitalOcean、AWS など）</p>
  </li>
  <li>
    <p>（クラウドプロバイダーに対して必要となる）アカウント検証やセキュリティ資格情報を指定します。
これは利用しているクラウドサービスに固有のものです。</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">&lt;マシン名&gt;</code> - 生成しようとするホスト名を指定します。</p>
  </li>
</ul>

<p>利用しやすさを考慮して、<code class="language-plaintext highlighter-rouge">docker-machine</code>コマンドには、適切なデフォルト値が用意されています。
たとえばサーバーが基づくイメージをどれにするかといった設定です。
こういったデフォルト値は、たとえば<code class="language-plaintext highlighter-rouge">--digitalocean-image</code>などを使ってオーバーライドすることができます。
これは、手軽なサーバー生成を行ってデフォルト動作を行う場合と違って、クラウドサーバー上でメモリや CPU をふんだんに利用するような場合に便利です。</p>

<p>利用可能なフラグや設定およびそのデフォルトについては、コマンドラインから<code class="language-plaintext highlighter-rouge">docker-machine create -h</code>を実行して得られる出力結果に一覧表示されます。
また Machine の <a href="/docs.docker.jp.onthefly/machine/reference/" target="_blank" rel="noopener" class="_">コマンドラインリファレンス</a> における <a href="/docs.docker.jp.onthefly/machine/reference/create/" target="_blank" rel="noopener" class="_">create</a> コマンドや、Machine ドライバーリファレンス内の <a href="/docs.docker.jp.onthefly/machine/drivers/os-base/" target="_blank" rel="noopener" class="_">ドライバーオプションと OS デフォルト</a> からも確認することができます。</p>

<h2 id="drivers-for-cloud-providers">クラウドプロバイダー用ドライバー</h2>

<p>Docker Machine をインストールすると、数々のクラウドプロバイダー（Amazon Web Services、DigitalOcean、Microsoft Azure）用や、ローカルプロバイダー（Oracle VirtualBox、VMWare Fusion、Microsoft Hyper-V）用のドライバーが同時にインストールされます。</p>

<p>各ドライバーの詳細は <a href="/docs.docker.jp.onthefly/machine/drivers/" target="_blank" rel="noopener" class="_">Docker Machine ドライバーリファレンス</a> を参照してください。
そこには必要となるフラグや設定オプションについて説明されています。
（これはプロバイダーによって異なります。）</p>

<h2 id="サードパーティ製のドライバープラグイン">サードパーティ製のドライバープラグイン</h2>

<p>その他のクラウドプラットフォーム用として、Docker Machine ドライバープラグインがサードパーティーから提供されています。
これは利用者の自己責任により利用するプラグインであり、Docker が開発するものでなく、また Docker に公式に連携するものではありません。</p>

<p><a href="https://github.com/docker/docker.github.io/blob/master/machine/AVAILABLE_DRIVER_PLUGINS.md" target="_blank" rel="noopener" class="_">利用可能なドライバープラグイン</a> を参照してください。</p>

<h2 id="add-a-host-without-a-driver">ドライバー指定のないホスト追加</h2>

<p>既存の Docker ホストは、デーモン URL を指定することで登録することができます。
これを利用すれば、同じ操作を docker-machine によってプロビジョニングされたホストに対しても適用することができます。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker-machine create --driver none --url=tcp://50.134.234.20:2376 custombox
$ docker-machine ls
NAME        ACTIVE   DRIVER    STATE     URL
custombox   *        none      Running   tcp://50.134.234.20:2376
</code></pre></div></div>

<h2 id="use-machine-to-provision-docker-swarm-clusters">Machine を使った Docker Swarm クラスターのプロビジョニング</h2>

<blockquote class="important">
  <p>Swarm mode supersedes Docker Machine provisioning of swarm clusters</p>

  <p>これまでのリリースにおいて Docker Machine は Swarm クラスターをプロビジョニングしていました。
これは今では古いものになっています。
Docker Engine においてビルドされている <a href="/docs.docker.jp.onthefly/engine/swarm/">Swarm モード</a> が、それまでの Machine の Swarm クラスタープロビジョニングに取って代わりました。
これ以降の説明においては、この新たな Swarm モードのはじめ方について説明しています。</p>
</blockquote>

<p>Docker Machine を使うと、ローカルに仮想ホストを生成することができます。
そのホスト上において、<a href="/docs.docker.jp.onthefly/engine/swarm/">Swarm モード</a> をデプロイしてテストすることができます。</p>

<p>Docker Machine において Swarm モードを使い始めるには、以下のようなわかりやすいドキュメントがあります。</p>

<ul>
  <li>
    <p><a href="/docs.docker.jp.onthefly/get-started/">Docker をはじめよう</a></p>
  </li>
  <li>
    <p><a href="/docs.docker.jp.onthefly/engine/swarm/swarm-tutorial/">Swarm モードをはじめよう</a></p>
  </li>
</ul>

<h2 id="where-to-go-next">次に読むものは</h2>

<ul>
  <li>利用例: Docker 化した <a href="/docs.docker.jp.onthefly/machine/examples/ocean/">DigitalOcean ドロップレット</a> のプロビジョニング。</li>
  <li>利用例: Docker 化した <a href="/docs.docker.jp.onthefly/machine/examples/aws/">AWS EC2 Instances</a> のプロビジョニング。</li>
  <li><a href="/docs.docker.jp.onthefly/machine/concepts/">Machine の考え方</a></li>
  <li><a href="/docs.docker.jp.onthefly/machine/drivers/">Docker Machine ドライバーリファレンス</a></li>
  <li><a href="/docs.docker.jp.onthefly/machine/reference/">Docker Machine サブコマンドリファレンス</a></li>
</ul>
