
<p>Docker Machine を利用すると、数多くの環境に Docker マシンをプロビジョニングすることができます。
それはローカルシステム内にある仮想マシン、クラウドプロバイダー、ベアメタルサーバー（物理サーバー）など、さまざまです。
Docker Machine からは Docker ホストが生成されます。
そして所定の Docker Engine クライアントを使って、ホスト上でのイメージビルドやコンテナー生成を行うことができます。</p>

<h2 id="drivers-for-creating-machines">マシン生成のためのドライバー</h2>

<p>仮想マシンを生成する際には、利用するドライバー名を Docker Machine に対して指示します。
このドライバー指定により仮想マシンの生成場所が決定されます。
たとえばローカルの Mac や Windows においては、通常そのドライバーは Oracle VirtualBox です。
物理マシンをプロビジョニングする場合は、汎用的なドライバーが用意されています。
クラウドプロバイダーに対しては、AWS、Microsoft Azure、DigitalOcean など多くのドライバーがサポートされています。
Docker Machine リファレンスには、<a href="/docs.docker.jp.onthefly/machine/drivers/">サポートドライバーの一覧</a> を示しています。</p>

<h2 id="default-base-operating-systems-for-local-and-cloud-hosts">ローカルおよびクラウドホストにおけるデフォルトのベース OS</h2>

<p>Docker は Linux 上において動作するものなので、Docker Machine がプロビジョニングする VM は、ベースとなるオペレーティングシステムに依存します。
そこで利便性を考慮し、デフォルトのベースオペレーティングシステムが用意されています。
Oracle Virtual Box ドライバーに対してのベースオペレーティングシステムは <a href="https://github.com/boot2docker/boot2docker">boot2docker</a> というものです。
クラウドプロバイダーへの接続に用いられるドライバーに対しては、ベースオペレーティングシステムは Ubuntu 12.04 以上としています。
このデフォルトは、マシンの生成時に変更することが可能です。
Docker Machine リファレンスには <a href="/docs.docker.jp.onthefly/machine/drivers/os-base/">サポートされているオペレーティングシステムの一覧</a> を示しています。</p>

<h2 id="ip-addresses-for-docker-hosts">Docker ホストの IP アドレス</h2>

<p>生成したマシンにおいて Docker ホストアドレスは、Linux VM の IP アドレスになります。
このアドレスは<code class="language-plaintext highlighter-rouge">docker-machine create</code>サブコマンドによって割り当てられます。
<code class="language-plaintext highlighter-rouge">docker-machine ls</code>コマンドを使うと、生成したマシンの一覧が表示されます。
<code class="language-plaintext highlighter-rouge">docker-machine ip &lt;マシン名&gt;</code>コマンドを実行すると、指定したホストの IP アドレスが返されます。</p>

<h2 id="configuring-cli-environment-variables-for-a-docker-host">Docker ホストに対する CLI 環境変数の設定</h2>

<p>マシン上において<code class="language-plaintext highlighter-rouge">docker</code>コマンドを実行するにあたっては、コマンドラインがマシンに向くような設定を行っておく必要があります。
<code class="language-plaintext highlighter-rouge">docker-machine env &lt;machine-name&gt;</code>サブコマンドが、利用すべき設定コマンドを出力してくれます。</p>

<p><code class="language-plaintext highlighter-rouge">docker-machine</code>サブコマンドの全一覧は <a href="/docs.docker.jp.onthefly/machine/reference/help/">Docker Machine サブコマンドリファレンス</a> を参照してください。</p>

<h2 id="custom-root-certificate-authority-for-registry">レジストリ用の独自のルート認証局</h2>

<p>利用しているレジストリを独自のルート認証局によって署名している場合であって、Docker Engine にまだ登録していない場合、以下のようなエラーメッセージが出力されることになります。</p>

<pre><code class="language-none">x509: certificate signed by unknown authority
</code></pre>

<p><a href="/docs.docker.jp.onthefly/engine/security/certificates/#understand-the-configuration">Docker Engine のドキュメント</a> に説明しているように、証明書を<code class="language-plaintext highlighter-rouge">/etc/docker/certs.d/hostname/ca.crt</code>に配置してください。
ここで<code class="language-plaintext highlighter-rouge">hostname</code>はレジストリサーバーのホスト名です。</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">docker-machine scp certfile default:ca.crt
docker-machine ssh default
sudo mv ~/ca.crt /etc/docker/certs.d/hostname/ca.crt
exit
docker-machine restart
</span></code></pre></div></div>

<h2 id="crash-reporting">クラッシュレポート</h2>

<p>ホストのプロビジョニングは複雑な処理であるため、さまざまな理由により失敗することがあります。
作業環境にはいろいろな状況があって、シェル、ネットワーク設定、VPN、プロキシー、ファイアーウォールの問題もあります。
ネットワークでつながった反対側にも理由となるものがあります。
クラウドプロバイダーや接続先のネットワークです。</p>

<p><code class="language-plaintext highlighter-rouge">docker-machine</code>コマンドができるだけ安定して実行されるように、ホストの<code class="language-plaintext highlighter-rouge">create</code>や<code class="language-plaintext highlighter-rouge">upgrade</code>を行う際には、クラッシュ監視の機能が加えられています。
この機能では HTTPS を介して Bugsnag への送信を行っています。
この送信情報には<code class="language-plaintext highlighter-rouge">docker-machine</code>のバージョン、ビルド、OS、アーキテクチャー、カレントシェルへのパス、<code class="language-plaintext highlighter-rouge">--debug</code>付与時に確認できる最終コマンド履歴が含まれます。
この情報が送信されれば、<code class="language-plaintext highlighter-rouge">docker-machine</code>を使って問題再現が確実にできます。
これは<code class="language-plaintext highlighter-rouge">docker-machine</code>においてクラッシュが発生した場合にのみ送信されます。</p>

<p>エラーリポートを行わないようにするには、<code class="language-plaintext highlighter-rouge">$HOME/.docker/machine</code>ディレクトリに<code class="language-plaintext highlighter-rouge">no-error-report</code>というファイルを生成します。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ mkdir -p ~/.docker/machine &amp;&amp; touch ~/.docker/machine/no-error-report
</code></pre></div></div>

<p>このファイルの内容には何も含めません。</p>

<h2 id="getting-help">ヘルプサポート</h2>

<p>Docker Machine はまだ開発初期にあって、活発に開発を続けています。
ヘルプが必要な場合、貢献したい場合、単に目的をともにしている開発者とプロジェクトについて語りたい場合、コミュニケーションを行うオープンな場所を数多く設けています。</p>

<ul>
  <li>バグ報告や機能リクエストを行いたい場合は <a href="https://github.com/docker/machine/issues">GitHub 上の issue トラッカー</a> を利用してください。</li>
  <li>リアルタイムに人々とプロジェクトについて語りたい場合は、IRC の<code class="language-plaintext highlighter-rouge">#docker-machine</code>チャネルに参加してください。</li>
  <li>コードやドキュメント変更に関する貢献を行う場合は、<a href="https://github.com/docker/machine/pulls">GitHub 上からプルリクエストを送信</a> してください。</li>
</ul>

<p>詳細な情報やリソースに関しては <a href="/docs.docker.jp.onthefly/opensource/ways/">ヘルプページ</a> を参照してください。</p>

<h2 id="where-to-go-next">次に読むものは</h2>

<ul>
  <li><a href="/docs.docker.jp.onthefly/machine/get-started/">VirtualBox 利用によるローカルシステム</a> に Docker ホストを生成して実行します。</li>
  <li><a href="/docs.docker.jp.onthefly/machine/get-started-cloud/">クラウドプロバイダー</a> 上に複数の Docker ホストをプロビジョニングします。</li>
  <li><a href="/docs.docker.jp.onthefly/machine/drivers/" target="_blank" rel="noopener" class="_">Docker Machine ドライバーリファレンス</a></li>
  <li><a href="/docs.docker.jp.onthefly/machine/reference/help/" target="_blank" rel="noopener" class="_">Docker Machine サブコマンドリファレンス</a></li>
</ul>
