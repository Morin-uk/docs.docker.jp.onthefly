
<p>Docker ではサービスの生成を行いますが、そこではタスクが起動されます。
サービスは期待される状態が記述されたものであり、タスクがそれを実行します。
Swarm ノードにおいては以下の順に動作がスケジュールされます。</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">docker service create</code> を使ってサービスを生成します。</li>
  <li>上の要求が Docker マネージャーノードに届きます。</li>
  <li>Docker マネージャーノードは、特定ノード上にて実行するサービスをスケジューリングします。</li>
  <li>各サービスは複数のタスクを起動します。</li>
  <li>各タスクにはライフサイクルがあり、<code class="language-plaintext highlighter-rouge">NEW</code>、<code class="language-plaintext highlighter-rouge">PENDING</code>、<code class="language-plaintext highlighter-rouge">COMPLETE</code> といった状態があります。</li>
</ol>

<p>タスクとは、一度実行されてから完了するまでの実行単位のことです。
タスクが停止すると、再度実行されることはありません。
別の新たなタスクにとって代わるかもしれません。</p>

<p>タスクは完了か失敗という結果に至るまでに、数種類の状態を経ていきます。
タスクは <code class="language-plaintext highlighter-rouge">NEW</code> という初期化状態から始まります。
タスクが数種類の状態を経るのは、常に次の状態へ向けて前進していくものであって、状態が戻るようなことはありません。
たとえばタスクが <code class="language-plaintext highlighter-rouge">COMPLETE</code> から <code class="language-plaintext highlighter-rouge">RUNNING</code> になることはありません。</p>

<p>タスクは以下に示す順に、状態を変化させていきます。</p>

<table>
  <thead>
    <tr>
      <th>タスクの状態</th>
      <th>日本語訳</th>
      <th>内容説明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">NEW</code></td>
      <td>初期化</td>
      <td>タスクが初期化されました。</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">PENDING</code></td>
      <td>保留</td>
      <td>タスクに対するリソースが割り当てられました。</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ASSIGNED</code></td>
      <td>割当済</td>
      <td>Docker がタスクをノードに割り当てました。</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ACCEPTED</code></td>
      <td>受付済</td>
      <td>タスクがワーカーノードによって受けつけられました。<br />ワーカーノードがタスクを拒否すると、状態は <code class="language-plaintext highlighter-rouge">REJECTED</code> に変わります。</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">PREPARING</code></td>
      <td>準備中</td>
      <td>Docker がタスクを準備しています。</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">STARTING</code></td>
      <td>起動中</td>
      <td>Docker がタスクを起動しています。</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">RUNNING</code></td>
      <td>実行中</td>
      <td>タスクが実行中です。</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">COMPLETE</code></td>
      <td>完了</td>
      <td>タスクがエラーコードなしに終了しました。</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">FAILED</code></td>
      <td>失敗</td>
      <td>タスクがエラーコードをともなって終了しました。</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SHUTDOWN</code></td>
      <td>停止</td>
      <td>Docker がタスクに対してシャットダウンを要求しました。</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">REJECTED</code></td>
      <td>拒否</td>
      <td>ワーカーノードがタスクを拒否しました。</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ORPHANED</code></td>
      <td>孤立</td>
      <td>ノードが長期間停止しています。</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">REMOVE</code></td>
      <td>削除</td>
      <td>タスクは終了していないが、関連サービスは削除またはスケールダウンしている。</td>
    </tr>
  </tbody>
</table>

<h2 id="view-task-state">タスク状態の確認</h2>

<p><code class="language-plaintext highlighter-rouge">docker service ps &lt;サービス名&gt;</code> を実行して、タスク状態を確認することができます。
<code class="language-plaintext highlighter-rouge">CURRENT STATE</code>（現在の状態）カラムは、そのタスクの状態およびどれだけ存在しているかを示しています。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker service ps webserver
ID             NAME              IMAGE    NODE        DESIRED STATE  CURRENT STATE            ERROR                              PORTS
owsz0yp6z375   webserver.1       nginx    UbuntuVM    Running        Running 44 seconds ago
j91iahr8s74p    <span class="se">\_</span> webserver.1   nginx    UbuntuVM    Shutdown       Failed 50 seconds ago    <span class="s2">"No such container: webserver.…"</span>
7dyaszg13mw2    <span class="se">\_</span> webserver.1   nginx    UbuntuVM    Shutdown       Failed 5 hours ago       <span class="s2">"No such container: webserver.…"</span>
</code></pre></div></div>

<h2 id="where-to-go-next">次に読むものは</h2>

<ul>
  <li><a href="https://github.com/docker/swarmkit/blob/master/design/task_model.md">Swarm タスクについて学ぶ</a></li>
</ul>
