
<p>このページではセキュリティぜい弱性一覧を示します。
Docker においては、バグに対する軽減対応がなされています。
もっとも Docker コンテナーにおいて起動するプロセスでは、たとえバグ修正されなくても、元からぜい弱性があるとは言えません。
ここではコンテナーの起動にあたって、ケーパビリティーは追加せず、あるいは <code class="language-plaintext highlighter-rouge">--privileged</code> としては起動していないことを前提とします。</p>

<p>以下は、バグ一覧とはとても言えないものです。
むしろこれは、ほんのわずかなバグの例にすぎず、セキュリティレビューやぜい弱性の公開を行うに至ったことから、バグとして気づいたものでしかありません。
おそらく報告されているバグよりも、報告されていないバグの方がはるかに多いはずです。
ただし Docker が採用するセキュアな手法は、デフォルトにおいて AppArmor や Seccomp の利用、そして限定的なケーパビリティーの利用を行っているため、既知のバグはもちろん、未知のバグを軽減できる可能性があります。</p>

<p>バグ（軽減対応あり）</p>

<ul>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-1956">CVE-2013-1956</a>,
<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-1957">1957</a>,
<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-1958">1958</a>,
<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-1959">1959</a>,
<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-1979">1979</a>,
<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-4014">CVE-2014-4014</a>,
<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-5206">5206</a>,
<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-5207">5207</a>,
<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-7970">7970</a>,
<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-7975">7975</a>,
<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-2925">CVE-2015-2925</a>,
<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-8543">8543</a>,
<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-3134">CVE-2016-3134</a>,
<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-3135">3135</a>, など:
非特権ユーザーによる名前空間が導入されたことにより、非特権ユーザーでもアクセス可能な場所への攻撃が大幅に増えることになりました。
<code class="language-plaintext highlighter-rouge">mount()</code> のように従来なら root 権限でしかアクセスできなかったシステムコールが、非特権ユーザーであっても正当にアクセスできるようになってしまったからです。
ここにあげた CVE はすべて、ユーザー名前空間の導入にともなうセキュリティぜい弱性の例です。
Docker ではコンテナーの設定時にユーザー名前空間を利用します。
しかしデフォルトの seccomp プロファイルを通じて、コンテナー内のプロセスにおいては、ネスト化した名前空間の生成ができなくなっており、そのぜい弱性は悪用できなくなっています。</li>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0181">CVE-2014-0181</a>,
<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-3339">CVE-2015-3339</a>:
これは setuid バイナリを必要とするバグです。
Docker ではコンテナー内において、<code class="language-plaintext highlighter-rouge">NO_NEW_PRIVS</code> プロセスフラグとその他の仕組みによって setuid バイナリを無効にします。</li>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-4699">CVE-2014-4699</a>:
<code class="language-plaintext highlighter-rouge">ptrace()</code> にあるバグであり、権限昇格を許してしまうものです。
Docker では、AppArmor、seccomp、そして <code class="language-plaintext highlighter-rouge">CAP_PTRACE</code> の削除により、コンテナー内での <code class="language-plaintext highlighter-rouge">ptrace()</code> を無効にしています。
ここでは三重の防御が行われているわけです。</li>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-9529">CVE-2014-9529</a>:
巧妙に仕掛けられた <code class="language-plaintext highlighter-rouge">keyctl()</code> 呼び出しを繰り返すことによって、カーネル DoS 攻撃やメモリ破壊を行います。
Docker では seccomp を利用して、コンテナー内部での <code class="language-plaintext highlighter-rouge">keyctl()</code> を無効にしています。</li>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-3214">CVE-2015-3214</a>,
<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-4036">4036</a>:
仮想ドライバーによく見られるバグであり、ゲスト OS のユーザーがホスト OS 上のコードを実行できてしまうものです。
これを悪用するには、ゲスト内の仮想デバイスにアクセスする必要があります。
Docker では <code class="language-plaintext highlighter-rouge">--privileged</code> の指定がない場合は、そういったデバイスへの直接アクセスを隠蔽します。
ここがおもしろいところで、このケースが、VM よりもコンテナーの方が「より安全」と言えるかもしれない点です。
つまりコンテナーよりも VM の方が「より安全」とされる常識に反している例です。</li>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-0728">CVE-2016-0728</a>:
巧妙な <code class="language-plaintext highlighter-rouge">keyctl()</code> 呼び出しによる開放メモリへの use-after-free 攻撃により、権限昇格を可能とします。
Docker ではデフォルトの seccomp プロファイルの利用により、コンテナー内部での <code class="language-plaintext highlighter-rouge">keyctl()</code> を無効にしています。</li>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-2383">CVE-2016-2383</a>:
eBPF におけるバグであり、seccomp フィルターのようなものを表現するために利用される特殊なカーネル内 DSL が、カーネルメモリの任意の読み込みを可能にします。
システムコール <code class="language-plaintext highlighter-rouge">bpf()</code> は、Docker コンテナー内部においては（皮肉なことに）seccomp を使ってブロックされます。</li>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-3134">CVE-2016-3134</a>,
<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-4997">4997</a>,
<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-4998">4998</a>:
setsockopt の <code class="language-plaintext highlighter-rouge">IPT_SO_SET_REPLACE</code>、<code class="language-plaintext highlighter-rouge">ARPT_SO_SET_REPLACE</code>、<code class="language-plaintext highlighter-rouge">ARPT_SO_SET_REPLACE</code> を利用することで、メモリ破壊、ローカル権限昇格を可能にしてしまうバグです。
これらの引数は <code class="language-plaintext highlighter-rouge">CAP_NET_ADMIN</code> によってブロックでき、Docker ではデフォルトで許可していません。</li>
</ul>

<p>バグ（対応 <strong>なし</strong>）</p>

<ul>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-3290">CVE-2015-3290</a>,
<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-5157">5157</a>:
カーネルのノンマスカブル割り込み処理におけるバグであり、権限昇格を可能にします。
Docker コンテナー内での悪用が可能です。
現時点においてシステムコール <code class="language-plaintext highlighter-rouge">modify_ldt()</code> が seccomp を使ってもブロックできないためです。</li>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-5195">CVE-2016-5195</a>:
Linux カーネルのメモリサブシステムがコピーオンライト（copy-on-write; COW）を扱う際に、競合状態が発生し、プライベートな読み込み専用メモリのマッピングが破損してしまうことがわかりました。
この際にローカルの非特権ユーザーが、読み込み専用メモリへの書き込み権限を有してしまうことが起こります。
これは 「Dirty COW」とも呼ばれます。
<strong>部分的なバグ軽減:</strong> オペレーティングシステムの中には、このぜい弱性を軽減できているものがあります。
そこでは seccomp の <code class="language-plaintext highlighter-rouge">ptrace</code> に対するフィルタリングと、<code class="language-plaintext highlighter-rouge">/proc/self/mem</code> が読み込み専用であることを利用して対処しています。</li>
</ul>
