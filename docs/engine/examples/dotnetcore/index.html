<h2 id="introduction">Introduction</h2>

<p>This example demonstrates how to dockerize an ASP.NET Core application.</p>

<h2 id="why-build-aspnet-core">Why build ASP.NET Core?</h2>

<ul>
  <li><a href="https://github.com/aspnet/home">Open-source</a></li>
  <li>Develop and run your ASP.NET Core apps cross-platform on Windows, MacOS, and
Linux</li>
  <li>Great for modern cloud-based apps, such as web apps, IoT apps, and mobile
backends</li>
  <li>ASP.NET Core apps can run on <a href="https://www.microsoft.com/net/core/platform">.NET
Core</a> or on the full <a href="https://www.microsoft.com/net/framework">.NET
Framework</a></li>
  <li>Designed to provide an optimized development framework for apps that are
deployed to the cloud or run on-premises</li>
  <li>Modular components with minimal overhead retain flexibility while
constructing your solutions</li>
</ul>

<h2 id="prerequisites">Prerequisites</h2>

<p>This example assumes you already have an ASP.NET Core app
on your machine. If you are new to ASP.NET you can follow a <a href="https://www.asp.net/get-started">simple
tutorial</a> to initialize a project or clone our <a href="https://github.com/dotnet/dotnet-docker/tree/master/samples/aspnetapp">ASP.NET Docker Sample</a>.</p>

<h2 id="create-a-dockerfile-for-an-aspnet-core-application">Create a Dockerfile for an ASP.NET Core application</h2>

<ol>
  <li>Create a <code class="language-plaintext highlighter-rouge">Dockerfile</code> in your project folder.</li>
  <li>Add the text below to your <code class="language-plaintext highlighter-rouge">Dockerfile</code> for either Linux or <a href="https://docs.microsoft.com/virtualization/windowscontainers/about/">Windows
   Containers</a>.
The tags below are multi-arch meaning they pull either Windows or
Linux containers depending on what mode is set in
<a href="/docs.docker.jp.onthefly/docker-for-windows/">Docker Desktop for Windows</a>. Read more on
<a href="/docs.docker.jp.onthefly/docker-for-windows/#switch-between-windows-and-linux-containers">switching containers</a>.</li>
  <li>The <code class="language-plaintext highlighter-rouge">Dockerfile</code> assumes that your application is called <code class="language-plaintext highlighter-rouge">aspnetapp</code>. Change
   the <code class="language-plaintext highlighter-rouge">Dockerfile</code> to use the DLL file of your project.</li>
</ol>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> mcr.microsoft.com/dotnet/core/sdk:3.1 AS build-env</span>
<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="c"># Copy csproj and restore as distinct layers</span>
<span class="k">COPY</span><span class="s"> *.csproj ./</span>
<span class="k">RUN </span>dotnet restore

<span class="c"># Copy everything else and build</span>
<span class="k">COPY</span><span class="s"> . ./</span>
<span class="k">RUN </span>dotnet publish <span class="nt">-c</span> Release <span class="nt">-o</span> out

<span class="c"># Build runtime image</span>
<span class="k">FROM</span><span class="s"> mcr.microsoft.com/dotnet/core/aspnet:3.1</span>
<span class="k">WORKDIR</span><span class="s"> /app</span>
<span class="k">COPY</span><span class="s"> --from=build-env /app/out .</span>
<span class="k">ENTRYPOINT</span><span class="s"> ["dotnet", "aspnetapp.dll"]</span>
</code></pre></div></div>

<ol>
  <li>To make your build context as small as possible add a <a href="/engine/reference/builder/#dockerignore-file"><code class="language-plaintext highlighter-rouge">.dockerignore</code>
   file</a>
   to your project folder and copy the following into it.</li>
</ol>

<pre><code class="language-dockerignore">bin/
obj/
</code></pre>

<h2 id="build-and-run-the-docker-image">Build and run the Docker image</h2>

<ol>
  <li>Open a command prompt and navigate to your project folder.</li>
  <li>Use the following commands to build and run your Docker image:</li>
</ol>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker build <span class="nt">-t</span> aspnetapp <span class="nb">.</span>
<span class="gp">$</span><span class="w"> </span>docker run <span class="nt">-d</span> <span class="nt">-p</span> 8080:80 <span class="nt">--name</span> myapp aspnetapp
</code></pre></div></div>

<h2 id="view-the-web-page-running-from-a-container">View the web page running from a container</h2>

<ul>
  <li>Go to <a href="http://localhost:8080">localhost:8080</a> to access your app in a web browser.</li>
  <li>If you are using the Nano <a href="/docs.docker.jp.onthefly/docker-for-windows/">Windows Container</a>
and have not updated to the Windows Creator Update there is a bug affecting how
<a href="https://github.com/Microsoft/Virtualization-Documentation/issues/181#issuecomment-252671828">Windows 10 talks to Containers via “NAT”</a>
(Network Address Translation). You must hit the IP of the container
directly. You can get the IP address of your container with the following
steps:
    <ol>
      <li>Run <code class="language-plaintext highlighter-rouge">docker inspect -f "{{ .NetworkSettings.Networks.nat.IPAddress }}" myapp</code></li>
      <li>Copy the container IP address and paste into your browser.
(For example, <code class="language-plaintext highlighter-rouge">172.16.240.197</code>)</li>
    </ol>
  </li>
</ul>

<h2 id="further-reading">Further reading</h2>

<ul>
  <li><a href="https://docs.microsoft.com/aspnet/core/">ASP.NET Core</a></li>
  <li><a href="https://hub.docker.com/r/microsoft/dotnet/">Microsoft ASP.NET Core on Docker Hub</a></li>
  <li><a href="https://docs.microsoft.com/aspnet/core/host-and-deploy/docker/building-net-docker-images">Building Docker Images for ASP.NET Core</a></li>
  <li><a href="https://docs.microsoft.com/dotnet/articles/core/docker/visual-studio-tools-for-docker">Docker Tools for Visual Studio</a></li>
</ul>
