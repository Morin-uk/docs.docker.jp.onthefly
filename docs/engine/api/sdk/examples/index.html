
<p><a href="/docs.docker.jp.onthefly/get-docker/">Docker のインストール</a> を行ったら、<a href="/docs.docker.jp.onthefly/engine/api/sdk/#install-the-sdks">Go または Python SDK のインストール</a> を行うことができます。
そして Docker Engine API にも挑戦してみましょう。</p>

<p>以下に示す利用例は、提示されている Docker 操作を、Go や Python の SDK や <code class="language-plaintext highlighter-rouge">curl</code> 利用による HTTP API を使って実現する方法を示すものです。</p>

<h2 id="run-a-container">コンテナーの実行</h2>

<p>1 つめの利用例は、Docker API を使ったコンテナーの実行方法です。
コマンドラインであれば <code class="language-plaintext highlighter-rouge">docker run</code> コマンドを実行します。
これはアプリケーションからであっても、ごく簡単に実現できます。</p>

<p>以下は、コマンドプロンプトからの <code class="language-plaintext highlighter-rouge">docker run alpine echo hello world</code> の実行と、まったく同じことを行います。</p>

<ul class="nav nav-tabs">
  <li class="active"><a data-toggle="tab" data-target="#tab-run-go" data-group="go">Go</a></li>
  <li><a data-toggle="tab" data-target="#tab-run-python" data-group="python">Python</a></li>
  <li><a data-toggle="tab" data-target="#tab-run-curl" data-group="curl">HTTP</a></li>
</ul>

<div class="tab-content">
  <div id="tab-run-go" class="tab-pane fade in active">

    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"context"</span>
	<span class="s">"io"</span>
	<span class="s">"os"</span>

	<span class="s">"github.com/docker/docker/api/types"</span>
	<span class="s">"github.com/docker/docker/api/types/container"</span>
	<span class="s">"github.com/docker/docker/client"</span>
	<span class="s">"github.com/docker/docker/pkg/stdcopy"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">ctx</span> <span class="o">:=</span> <span class="n">context</span><span class="o">.</span><span class="n">Background</span><span class="p">()</span>
	<span class="n">cli</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">client</span><span class="o">.</span><span class="n">NewClientWithOpts</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">FromEnv</span><span class="p">,</span> <span class="n">client</span><span class="o">.</span><span class="n">WithAPIVersionNegotiation</span><span class="p">())</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">reader</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cli</span><span class="o">.</span><span class="n">ImagePull</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="s">"docker.io/library/alpine"</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">ImagePullOptions</span><span class="p">{})</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="n">io</span><span class="o">.</span><span class="n">Copy</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">Stdout</span><span class="p">,</span> <span class="n">reader</span><span class="p">)</span>

	<span class="n">resp</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cli</span><span class="o">.</span><span class="n">ContainerCreate</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">container</span><span class="o">.</span><span class="n">Config</span><span class="p">{</span>
		<span class="n">Image</span><span class="o">:</span> <span class="s">"alpine"</span><span class="p">,</span>
		<span class="n">Cmd</span><span class="o">:</span>   <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"echo"</span><span class="p">,</span> <span class="s">"hello world"</span><span class="p">},</span>
		<span class="n">Tty</span><span class="o">:</span>   <span class="no">false</span><span class="p">,</span>
	<span class="p">},</span> <span class="no">nil</span><span class="p">,</span> <span class="no">nil</span><span class="p">,</span> <span class="no">nil</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cli</span><span class="o">.</span><span class="n">ContainerStart</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">ContainerStartOptions</span><span class="p">{});</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">statusCh</span><span class="p">,</span> <span class="n">errCh</span> <span class="o">:=</span> <span class="n">cli</span><span class="o">.</span><span class="n">ContainerWait</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">container</span><span class="o">.</span><span class="n">WaitConditionNotRunning</span><span class="p">)</span>
	<span class="k">select</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">err</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="n">errCh</span><span class="o">:</span>
		<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
			<span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="k">case</span> <span class="o">&lt;-</span><span class="n">statusCh</span><span class="o">:</span>
	<span class="p">}</span>

	<span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cli</span><span class="o">.</span><span class="n">ContainerLogs</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">ContainerLogsOptions</span><span class="p">{</span><span class="n">ShowStdout</span><span class="o">:</span> <span class="no">true</span><span class="p">})</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">stdcopy</span><span class="o">.</span><span class="n">StdCopy</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">Stdout</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">Stderr</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>    </div>

  </div>
  <div id="tab-run-python" class="tab-pane fade">

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">docker</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">docker</span><span class="p">.</span><span class="n">from_env</span><span class="p">()</span>
<span class="k">print</span> <span class="n">client</span><span class="p">.</span><span class="n">containers</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="s">"alpine"</span><span class="p">,</span> <span class="p">[</span><span class="s">"echo"</span><span class="p">,</span> <span class="s">"hello"</span><span class="p">,</span> <span class="s">"world"</span><span class="p">])</span>
</code></pre></div>    </div>

  </div>
  <div id="tab-run-curl" class="tab-pane fade">

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">--unix-socket</span> /var/run/docker.sock <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s1">'{"Image": "alpine", "Cmd": ["echo", "hello world"]}'</span> <span class="se">\</span>
  <span class="nt">-X</span> POST http:/v1.24/containers/create
<span class="o">{</span><span class="s2">"Id"</span>:<span class="s2">"1c6594faf5"</span>,<span class="s2">"Warnings"</span>:null<span class="o">}</span>

<span class="nv">$ </span>curl <span class="nt">--unix-socket</span> /var/run/docker.sock <span class="nt">-X</span> POST http:/v1.24/containers/1c6594faf5/start

<span class="nv">$ </span>curl <span class="nt">--unix-socket</span> /var/run/docker.sock <span class="nt">-X</span> POST http:/v1.24/containers/1c6594faf5/wait
<span class="o">{</span><span class="s2">"StatusCode"</span>:0<span class="o">}</span>

<span class="nv">$ </span>curl <span class="nt">--unix-socket</span> /var/run/docker.sock <span class="s2">"http:/v1.24/containers/1c6594faf5/logs?stdout=1"</span>
hello world
</code></pre></div>    </div>

  </div>
</div>
<!-- end tab-content -->

<h2 id="run-a-container-in-the-background">コンテナーのバックグラウンド実行</h2>

<p>コンテナーはバックグラウンド実行ができます。
<code class="language-plaintext highlighter-rouge">docker run -d bfirsh/reticulate-splines</code> と同じことは、以下のようにして実現できます。</p>

<ul class="nav nav-tabs">
  <li class="active"><a data-toggle="tab" data-target="#tab-rundetach-go" data-group="go">Go</a></li>
  <li><a data-toggle="tab" data-target="#tab-rundetach-python" data-group="python">Python</a></li>
  <li><a data-toggle="tab" data-target="#tab-rundetach-curl" data-group="curl">HTTP</a></li>
</ul>

<div class="tab-content">
  <div id="tab-rundetach-go" class="tab-pane fade in active">

    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"context"</span>
	<span class="s">"fmt"</span>
	<span class="s">"io"</span>
	<span class="s">"os"</span>

	<span class="s">"github.com/docker/docker/api/types"</span>
	<span class="s">"github.com/docker/docker/api/types/container"</span>
	<span class="s">"github.com/docker/docker/client"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">ctx</span> <span class="o">:=</span> <span class="n">context</span><span class="o">.</span><span class="n">Background</span><span class="p">()</span>
	<span class="n">cli</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">client</span><span class="o">.</span><span class="n">NewClientWithOpts</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">FromEnv</span><span class="p">,</span> <span class="n">client</span><span class="o">.</span><span class="n">WithAPIVersionNegotiation</span><span class="p">())</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">imageName</span> <span class="o">:=</span> <span class="s">"bfirsh/reticulate-splines"</span>

	<span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cli</span><span class="o">.</span><span class="n">ImagePull</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">imageName</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">ImagePullOptions</span><span class="p">{})</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="n">io</span><span class="o">.</span><span class="n">Copy</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">Stdout</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>

	<span class="n">resp</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cli</span><span class="o">.</span><span class="n">ContainerCreate</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">container</span><span class="o">.</span><span class="n">Config</span><span class="p">{</span>
		<span class="n">Image</span><span class="o">:</span> <span class="n">imageName</span><span class="p">,</span>
	<span class="p">},</span> <span class="no">nil</span><span class="p">,</span> <span class="no">nil</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cli</span><span class="o">.</span><span class="n">ContainerStart</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">ContainerStartOptions</span><span class="p">{});</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">ID</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>    </div>

  </div>
  <div id="tab-rundetach-python" class="tab-pane fade">

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">docker</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">docker</span><span class="p">.</span><span class="n">from_env</span><span class="p">()</span>
<span class="n">container</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">containers</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="s">"bfirsh/reticulate-splines"</span><span class="p">,</span> <span class="n">detach</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">print</span> <span class="n">container</span><span class="p">.</span><span class="nb">id</span>
</code></pre></div>    </div>

  </div>
  <div id="tab-rundetach-curl" class="tab-pane fade">

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">--unix-socket</span> /var/run/docker.sock <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s1">'{"Image": "bfirsh/reticulate-splines"}'</span> <span class="se">\</span>
  <span class="nt">-X</span> POST http:/v1.24/containers/create
<span class="o">{</span><span class="s2">"Id"</span>:<span class="s2">"1c6594faf5"</span>,<span class="s2">"Warnings"</span>:null<span class="o">}</span>

<span class="nv">$ </span>curl <span class="nt">--unix-socket</span> /var/run/docker.sock <span class="nt">-X</span> POST http:/v1.24/containers/1c6594faf5/start
</code></pre></div>    </div>

  </div>
</div>
<!-- end tab-content -->

<h2 id="list-and-manage-containers">コンテナー一覧と管理</h2>

<p>実行中コンテナーの一覧を得る <code class="language-plaintext highlighter-rouge">docker ps</code> は、API を使うと以下のようになります。</p>

<ul class="nav nav-tabs">
  <li class="active"><a data-toggle="tab" data-target="#tab-listcontainers-go" data-group="go">Go</a></li>
  <li><a data-toggle="tab" data-target="#tab-listcontainers-python" data-group="python">Python</a></li>
  <li><a data-toggle="tab" data-target="#tab-listcontainers-curl" data-group="curl">HTTP</a></li>
</ul>

<div class="tab-content">
  <div id="tab-listcontainers-go" class="tab-pane fade in active">

    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"context"</span>
	<span class="s">"fmt"</span>

	<span class="s">"github.com/docker/docker/api/types"</span>
	<span class="s">"github.com/docker/docker/client"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">ctx</span> <span class="o">:=</span> <span class="n">context</span><span class="o">.</span><span class="n">Background</span><span class="p">()</span>
	<span class="n">cli</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">client</span><span class="o">.</span><span class="n">NewClientWithOpts</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">FromEnv</span><span class="p">,</span> <span class="n">client</span><span class="o">.</span><span class="n">WithAPIVersionNegotiation</span><span class="p">())</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">containers</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cli</span><span class="o">.</span><span class="n">ContainerList</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">ContainerListOptions</span><span class="p">{})</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">container</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">containers</span> <span class="p">{</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">ID</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>

  </div>
  <div id="tab-listcontainers-python" class="tab-pane fade">

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">docker</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">docker</span><span class="p">.</span><span class="n">from_env</span><span class="p">()</span>
<span class="k">for</span> <span class="n">container</span> <span class="ow">in</span> <span class="n">client</span><span class="p">.</span><span class="n">containers</span><span class="p">.</span><span class="nb">list</span><span class="p">():</span>
  <span class="k">print</span> <span class="n">container</span><span class="p">.</span><span class="nb">id</span>
</code></pre></div>    </div>

  </div>
  <div id="tab-listcontainers-curl" class="tab-pane fade">

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">--unix-socket</span> /var/run/docker.sock http:/v1.24/containers/json
<span class="o">[{</span>
  <span class="s2">"Id"</span>:<span class="s2">"ae63e8b89a26f01f6b4b2c9a7817c31a1b6196acf560f66586fbc8809ffcd772"</span>,
  <span class="s2">"Names"</span>:[<span class="s2">"/tender_wing"</span><span class="o">]</span>,
  <span class="s2">"Image"</span>:<span class="s2">"bfirsh/reticulate-splines"</span>,
  ...
<span class="o">}]</span>
</code></pre></div>    </div>

  </div>
</div>
<!-- end tab-content -->

<h2 id="stop-all-runningccontainers">実行中コンテナーの全停止</h2>

<p>コンテナーとして何があるのかがわかったので、そのコンテナー上での操作を行います。
以下の例は、実行中コンテナーをすべて停止させます。</p>

<blockquote>
  <p><strong>メモ</strong>: この操作は、本番サーバー上では実行しないでください。
また Swarm サービスを利用している場合は、コンテナーを停止させても、Docker が新たなコンテナーを生成して、サービスを設定内容どおりに動作させようとします。</p>
</blockquote>

<ul class="nav nav-tabs">
  <li class="active"><a data-toggle="tab" data-target="#tab-stopcontainers-go" data-group="go">Go</a></li>
  <li><a data-toggle="tab" data-target="#tab-stopcontainers-python" data-group="python">Python</a></li>
  <li><a data-toggle="tab" data-target="#tab-stopcontainers-curl" data-group="curl">HTTP</a></li>
</ul>

<div class="tab-content">
  <div id="tab-stopcontainers-go" class="tab-pane fade in active">

    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"context"</span>
	<span class="s">"fmt"</span>

	<span class="s">"github.com/docker/docker/api/types"</span>
	<span class="s">"github.com/docker/docker/client"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">ctx</span> <span class="o">:=</span> <span class="n">context</span><span class="o">.</span><span class="n">Background</span><span class="p">()</span>
	<span class="n">cli</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">client</span><span class="o">.</span><span class="n">NewClientWithOpts</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">FromEnv</span><span class="p">,</span> <span class="n">client</span><span class="o">.</span><span class="n">WithAPIVersionNegotiation</span><span class="p">())</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">containers</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cli</span><span class="o">.</span><span class="n">ContainerList</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">ContainerListOptions</span><span class="p">{})</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">container</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">containers</span> <span class="p">{</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="s">"Stopping container "</span><span class="p">,</span> <span class="n">container</span><span class="o">.</span><span class="n">ID</span><span class="p">[</span><span class="o">:</span><span class="m">10</span><span class="p">],</span> <span class="s">"... "</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cli</span><span class="o">.</span><span class="n">ContainerStop</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">container</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="no">nil</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
			<span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
		<span class="p">}</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Success"</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>

  </div>
  <div id="tab-stopcontainers-python" class="tab-pane fade">

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">docker</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">docker</span><span class="p">.</span><span class="n">from_env</span><span class="p">()</span>
<span class="k">for</span> <span class="n">container</span> <span class="ow">in</span> <span class="n">client</span><span class="p">.</span><span class="n">containers</span><span class="p">.</span><span class="nb">list</span><span class="p">():</span>
  <span class="n">container</span><span class="p">.</span><span class="n">stop</span><span class="p">()</span>
</code></pre></div>    </div>

  </div>
  <div id="tab-stopcontainers-curl" class="tab-pane fade">

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">--unix-socket</span> /var/run/docker.sock http:/v1.24/containers/json
<span class="o">[{</span>
  <span class="s2">"Id"</span>:<span class="s2">"ae63e8b89a26f01f6b4b2c9a7817c31a1b6196acf560f66586fbc8809ffcd772"</span>,
  <span class="s2">"Names"</span>:[<span class="s2">"/tender_wing"</span><span class="o">]</span>,
  <span class="s2">"Image"</span>:<span class="s2">"bfirsh/reticulate-splines"</span>,
  ...
<span class="o">}]</span>

<span class="nv">$ </span>curl <span class="nt">--unix-socket</span> /var/run/docker.sock <span class="se">\</span>
  <span class="nt">-X</span> POST http:/v1.24/containers/ae63e8b89a26/stop
</code></pre></div>    </div>

  </div>
</div>
<!-- end tab-content -->

<h2 id="print-the-logs-of-a-specific-container">指定コンテナーのログ出力</h2>

<p>個別のコンテナーに対しても操作することができます。
以下の例では、指定された ID を持つコンテナーのログを出力します。
以下のコードを実行するにあたっては、コード内にハードコーディングされている ID を、ログ出力したいコンテナーの ID に置き換えてから実行してください。</p>

<ul class="nav nav-tabs">
  <li class="active"><a data-toggle="tab" data-target="#tab-containerlogs-go" data-group="go">Go</a></li>
  <li><a data-toggle="tab" data-target="#tab-containerlogs-python" data-group="python">Python</a></li>
  <li><a data-toggle="tab" data-target="#tab-containerlogs-curl" data-group="curl">HTTP</a></li>
</ul>

<div class="tab-content">
  <div id="tab-containerlogs-go" class="tab-pane fade in active">

    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"context"</span>
	<span class="s">"io"</span>
	<span class="s">"os"</span>

	<span class="s">"github.com/docker/docker/api/types"</span>
	<span class="s">"github.com/docker/docker/client"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">ctx</span> <span class="o">:=</span> <span class="n">context</span><span class="o">.</span><span class="n">Background</span><span class="p">()</span>
	<span class="n">cli</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">client</span><span class="o">.</span><span class="n">NewClientWithOpts</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">FromEnv</span><span class="p">,</span> <span class="n">client</span><span class="o">.</span><span class="n">WithAPIVersionNegotiation</span><span class="p">())</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">options</span> <span class="o">:=</span> <span class="n">types</span><span class="o">.</span><span class="n">ContainerLogsOptions</span><span class="p">{</span><span class="n">ShowStdout</span><span class="o">:</span> <span class="no">true</span><span class="p">}</span>
	<span class="c">// Replace this ID with a container that really exists</span>
	<span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cli</span><span class="o">.</span><span class="n">ContainerLogs</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="s">"f1064a8a4c82"</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">io</span><span class="o">.</span><span class="n">Copy</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">Stdout</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>    </div>

  </div>
  <div id="tab-containerlogs-python" class="tab-pane fade">

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">docker</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">docker</span><span class="p">.</span><span class="n">from_env</span><span class="p">()</span>
<span class="n">container</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">containers</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'f1064a8a4c82'</span><span class="p">)</span>
<span class="k">print</span> <span class="n">container</span><span class="p">.</span><span class="n">logs</span><span class="p">()</span>
</code></pre></div>    </div>

  </div>
  <div id="tab-containerlogs-curl" class="tab-pane fade">

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">--unix-socket</span> /var/run/docker.sock <span class="s2">"http:/v1.24/containers/ca5f55cdb/logs?stdout=1"</span>
Reticulating spline 1...
Reticulating spline 2...
Reticulating spline 3...
Reticulating spline 4...
Reticulating spline 5...
</code></pre></div>    </div>
  </div>
</div>
<!-- end tab-content -->

<h2 id="list-all-images">イメージの全一覧</h2>

<p>Engine 上のイメージ一覧を取得します。
これは <code class="language-plaintext highlighter-rouge">docker image ls</code> に相当するものです。</p>

<ul class="nav nav-tabs">
  <li class="active"><a data-toggle="tab" data-target="#tab-listimages-go" data-group="go">Go</a></li>
  <li><a data-toggle="tab" data-target="#tab-listimages-python" data-group="python">Python</a></li>
  <li><a data-toggle="tab" data-target="#tab-listimages-curl" data-group="curl">HTTP</a></li>
</ul>

<div class="tab-content">
  <div id="tab-listimages-go" class="tab-pane fade in active">

    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"context"</span>
	<span class="s">"fmt"</span>

	<span class="s">"github.com/docker/docker/api/types"</span>
	<span class="s">"github.com/docker/docker/client"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">ctx</span> <span class="o">:=</span> <span class="n">context</span><span class="o">.</span><span class="n">Background</span><span class="p">()</span>
	<span class="n">cli</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">client</span><span class="o">.</span><span class="n">NewClientWithOpts</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">FromEnv</span><span class="p">,</span> <span class="n">client</span><span class="o">.</span><span class="n">WithAPIVersionNegotiation</span><span class="p">())</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">images</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cli</span><span class="o">.</span><span class="n">ImageList</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">ImageListOptions</span><span class="p">{})</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">image</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">images</span> <span class="p">{</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">ID</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>

  </div>
  <div id="tab-listimages-python" class="tab-pane fade">

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">docker</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">docker</span><span class="p">.</span><span class="n">from_env</span><span class="p">()</span>
<span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">client</span><span class="p">.</span><span class="n">images</span><span class="p">.</span><span class="nb">list</span><span class="p">():</span>
  <span class="k">print</span> <span class="n">image</span><span class="p">.</span><span class="nb">id</span>
</code></pre></div>    </div>

  </div>
  <div id="tab-listimages-curl" class="tab-pane fade">

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">--unix-socket</span> /var/run/docker.sock http:/v1.24/images/json
<span class="o">[{</span>
  <span class="s2">"Id"</span>:<span class="s2">"sha256:31d9a31e1dd803470c5a151b8919ef1988ac3efd44281ac59d43ad623f275dcd"</span>,
  <span class="s2">"ParentId"</span>:<span class="s2">"sha256:ee4603260daafe1a8c2f3b78fd760922918ab2441cbb2853ed5c439e59c52f96"</span>,
  ...
<span class="o">}]</span>
</code></pre></div>    </div>

  </div>
</div>
<!-- end tab-content -->

<h2 id="pull-an-image">イメージのプル</h2>

<p><code class="language-plaintext highlighter-rouge">docker pull</code> のようにイメージをプルします。</p>

<ul class="nav nav-tabs">
  <li class="active"><a data-toggle="tab" data-target="#tab-pullimages-go" data-group="go">Go</a></li>
  <li><a data-toggle="tab" data-target="#tab-pullimages-python" data-group="python">Python</a></li>
  <li><a data-toggle="tab" data-target="#tab-pullimages-curl" data-group="curl">HTTP</a></li>
</ul>

<div class="tab-content">
  <div id="tab-pullimages-go" class="tab-pane fade in active">

    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"context"</span>
	<span class="s">"io"</span>
	<span class="s">"os"</span>

	<span class="s">"github.com/docker/docker/api/types"</span>
	<span class="s">"github.com/docker/docker/client"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">ctx</span> <span class="o">:=</span> <span class="n">context</span><span class="o">.</span><span class="n">Background</span><span class="p">()</span>
	<span class="n">cli</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">client</span><span class="o">.</span><span class="n">NewClientWithOpts</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">FromEnv</span><span class="p">,</span> <span class="n">client</span><span class="o">.</span><span class="n">WithAPIVersionNegotiation</span><span class="p">())</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cli</span><span class="o">.</span><span class="n">ImagePull</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="s">"alpine"</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">ImagePullOptions</span><span class="p">{})</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="k">defer</span> <span class="n">out</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>

	<span class="n">io</span><span class="o">.</span><span class="n">Copy</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">Stdout</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>    </div>

  </div>
  <div id="tab-pullimages-python" class="tab-pane fade">

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">docker</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">docker</span><span class="p">.</span><span class="n">from_env</span><span class="p">()</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">images</span><span class="p">.</span><span class="n">pull</span><span class="p">(</span><span class="s">"alpine"</span><span class="p">)</span>
<span class="k">print</span> <span class="n">image</span><span class="p">.</span><span class="nb">id</span>
</code></pre></div>    </div>

  </div>
  <div id="tab-pullimages-curl" class="tab-pane fade">

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">--unix-socket</span> /var/run/docker.sock <span class="se">\</span>
  <span class="nt">-X</span> POST <span class="s2">"http:/v1.24/images/create?fromImage=alpine"</span>
<span class="o">{</span><span class="s2">"status"</span>:<span class="s2">"Pulling from library/alpine"</span>,<span class="s2">"id"</span>:<span class="s2">"3.1"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"status"</span>:<span class="s2">"Pulling fs layer"</span>,<span class="s2">"progressDetail"</span>:<span class="o">{}</span>,<span class="s2">"id"</span>:<span class="s2">"8f13703509f7"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"status"</span>:<span class="s2">"Downloading"</span>,<span class="s2">"progressDetail"</span>:<span class="o">{</span><span class="s2">"current"</span>:32768,<span class="s2">"total"</span>:2244027<span class="o">}</span>,<span class="s2">"progress"</span>:<span class="s2">"[</span><span class="se">\u</span><span class="s2">003e                                                  ] 32.77 kB/2.244 MB"</span>,<span class="s2">"id"</span>:<span class="s2">"8f13703509f7"</span><span class="o">}</span>
...
</code></pre></div>    </div>

  </div>
</div>
<p><!-- end tab-content --></p>

<h2 id="pull-an-image-with-authentication">認証をともなうイメージのプル</h2>

<p><code class="language-plaintext highlighter-rouge">docker pull</code> と同じイメージのプルを、認証処理を含めて行います。</p>

<blockquote>
  <p><strong>メモ</strong>: 資格情報は平文で送信されます。
Docker の公式レジストリでは HTTPS が用いられています。
プライベートなレジストリも HTTPS を利用するように設定されるべきものです。</p>
</blockquote>

<ul class="nav nav-tabs">
  <li class="active"><a data-toggle="tab" data-target="#tab-pullimages-auth-go" data-group="go">Go</a></li>
  <li><a data-toggle="tab" data-target="#tab-pullimages-auth-python" data-group="python">Python</a></li>
  <li><a data-toggle="tab" data-target="#tab-pullimages-auth-curl" data-group="curl">HTTP</a></li>
</ul>

<div class="tab-content">
  <div id="tab-pullimages-auth-go" class="tab-pane fade in active">

    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"context"</span>
	<span class="s">"encoding/base64"</span>
	<span class="s">"encoding/json"</span>
	<span class="s">"io"</span>
	<span class="s">"os"</span>

	<span class="s">"github.com/docker/docker/api/types"</span>
	<span class="s">"github.com/docker/docker/client"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">ctx</span> <span class="o">:=</span> <span class="n">context</span><span class="o">.</span><span class="n">Background</span><span class="p">()</span>
	<span class="n">cli</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">client</span><span class="o">.</span><span class="n">NewClientWithOpts</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">FromEnv</span><span class="p">,</span> <span class="n">client</span><span class="o">.</span><span class="n">WithAPIVersionNegotiation</span><span class="p">())</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">authConfig</span> <span class="o">:=</span> <span class="n">types</span><span class="o">.</span><span class="n">AuthConfig</span><span class="p">{</span>
		<span class="n">Username</span><span class="o">:</span> <span class="s">"username"</span><span class="p">,</span>
		<span class="n">Password</span><span class="o">:</span> <span class="s">"password"</span><span class="p">,</span>
	<span class="p">}</span>
	<span class="n">encodedJSON</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">json</span><span class="o">.</span><span class="n">Marshal</span><span class="p">(</span><span class="n">authConfig</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="n">authStr</span> <span class="o">:=</span> <span class="n">base64</span><span class="o">.</span><span class="n">URLEncoding</span><span class="o">.</span><span class="n">EncodeToString</span><span class="p">(</span><span class="n">encodedJSON</span><span class="p">)</span>

	<span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cli</span><span class="o">.</span><span class="n">ImagePull</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="s">"alpine"</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">ImagePullOptions</span><span class="p">{</span><span class="n">RegistryAuth</span><span class="o">:</span> <span class="n">authStr</span><span class="p">})</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="k">defer</span> <span class="n">out</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
	<span class="n">io</span><span class="o">.</span><span class="n">Copy</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">Stdout</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>    </div>

  </div>
  <div id="tab-pullimages-auth-python" class="tab-pane fade">

    <p>Python SDK では、認証情報を <a href="/engine/reference/commandline/login/#credentials-store">認証情報ストア</a> ファイルから抽出し、<a href="https://github.com/docker/docker-credential-helpers" target="_blank" class="_">認証情報ヘルパー</a> を利用して統合します。
認証情報をオーバーライドすることは可能ですが、そのような処理はここに示す利用ガイドの説明範囲を超えます。
ここでは <code class="language-plaintext highlighter-rouge">docker login</code> を実行した後に、Python SDK により自動的にその認証情報を利用します。</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">docker</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">docker</span><span class="p">.</span><span class="n">from_env</span><span class="p">()</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">images</span><span class="p">.</span><span class="n">pull</span><span class="p">(</span><span class="s">"alpine"</span><span class="p">)</span>
<span class="k">print</span> <span class="n">image</span><span class="p">.</span><span class="nb">id</span>
</code></pre></div>    </div>

  </div>
  <div id="tab-pullimages-auth-curl" class="tab-pane fade">

    <p>この例において、資格情報はシェルの履歴に残ります。
したがって、内部での実装としてとどめるようにしてください。
資格情報は、Base-64-encoded の JSON 構造として送信されます。</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ JSON</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s1">'{"username": "string", "password": "string", "serveraddress": "string"}'</span> | <span class="nb">base64</span><span class="si">)</span>

<span class="nv">$ </span>curl <span class="nt">--unix-socket</span> /var/run/docker.sock <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"Content-Type: application/tar"</span>
  <span class="nt">-X</span> POST <span class="s2">"http:/v1.24/images/create?fromImage=alpine"</span>
  <span class="nt">-H</span> <span class="s2">"X-Registry-Auth"</span>
  <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$JSON</span><span class="s2">"</span>
<span class="o">{</span><span class="s2">"status"</span>:<span class="s2">"Pulling from library/alpine"</span>,<span class="s2">"id"</span>:<span class="s2">"3.1"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"status"</span>:<span class="s2">"Pulling fs layer"</span>,<span class="s2">"progressDetail"</span>:<span class="o">{}</span>,<span class="s2">"id"</span>:<span class="s2">"8f13703509f7"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"status"</span>:<span class="s2">"Downloading"</span>,<span class="s2">"progressDetail"</span>:<span class="o">{</span><span class="s2">"current"</span>:32768,<span class="s2">"total"</span>:2244027<span class="o">}</span>,<span class="s2">"progress"</span>:<span class="s2">"[</span><span class="se">\u</span><span class="s2">003e                                                  ] 32.77 kB/2.244 MB"</span>,<span class="s2">"id"</span>:<span class="s2">"8f13703509f7"</span><span class="o">}</span>
...
</code></pre></div>    </div>

  </div>
</div>
<p><!-- end tab-content --></p>

<h2 id="commit-a-container">コンテナーのコミット</h2>

<p>コンテナーをコミットして、その内容からイメージを生成します。</p>

<ul class="nav nav-tabs">
  <li class="active"><a data-toggle="tab" data-target="#tab-commit-go" data-group="go">Go</a></li>
  <li><a data-toggle="tab" data-target="#tab-commit-python" data-group="python">Python</a></li>
  <li><a data-toggle="tab" data-target="#tab-commit-curl" data-group="curl">HTTP</a></li>
</ul>

<div class="tab-content">
  <div id="tab-commit-go" class="tab-pane fade in active">

    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"context"</span>
	<span class="s">"fmt"</span>

	<span class="s">"github.com/docker/docker/api/types"</span>
	<span class="s">"github.com/docker/docker/api/types/container"</span>
	<span class="s">"github.com/docker/docker/client"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">ctx</span> <span class="o">:=</span> <span class="n">context</span><span class="o">.</span><span class="n">Background</span><span class="p">()</span>
	<span class="n">cli</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">client</span><span class="o">.</span><span class="n">NewClientWithOpts</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">FromEnv</span><span class="p">,</span> <span class="n">client</span><span class="o">.</span><span class="n">WithAPIVersionNegotiation</span><span class="p">())</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">createResp</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cli</span><span class="o">.</span><span class="n">ContainerCreate</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">container</span><span class="o">.</span><span class="n">Config</span><span class="p">{</span>
		<span class="n">Image</span><span class="o">:</span> <span class="s">"alpine"</span><span class="p">,</span>
		<span class="n">Cmd</span><span class="o">:</span>   <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"touch"</span><span class="p">,</span> <span class="s">"/helloworld"</span><span class="p">},</span>
	<span class="p">},</span> <span class="no">nil</span><span class="p">,</span> <span class="no">nil</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cli</span><span class="o">.</span><span class="n">ContainerStart</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">createResp</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">ContainerStartOptions</span><span class="p">{});</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">statusCh</span><span class="p">,</span> <span class="n">errCh</span> <span class="o">:=</span> <span class="n">cli</span><span class="o">.</span><span class="n">ContainerWait</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">createResp</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">container</span><span class="o">.</span><span class="n">WaitConditionNotRunning</span><span class="p">)</span>
	<span class="k">select</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">err</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="n">errCh</span><span class="o">:</span>
		<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
			<span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="k">case</span> <span class="o">&lt;-</span><span class="n">statusCh</span><span class="o">:</span>
	<span class="p">}</span>

	<span class="n">commitResp</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cli</span><span class="o">.</span><span class="n">ContainerCommit</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">createResp</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">ContainerCommitOptions</span><span class="p">{</span><span class="n">Reference</span><span class="o">:</span> <span class="s">"helloworld"</span><span class="p">})</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">commitResp</span><span class="o">.</span><span class="n">ID</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>    </div>

  </div>
  <div id="tab-commit-python" class="tab-pane fade">

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">docker</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">docker</span><span class="p">.</span><span class="n">from_env</span><span class="p">()</span>
<span class="n">container</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">containers</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="s">"alpine"</span><span class="p">,</span> <span class="p">[</span><span class="s">"touch"</span><span class="p">,</span> <span class="s">"/helloworld"</span><span class="p">],</span> <span class="n">detach</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">container</span><span class="p">.</span><span class="n">wait</span><span class="p">()</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">container</span><span class="p">.</span><span class="n">commit</span><span class="p">(</span><span class="s">"helloworld"</span><span class="p">)</span>
<span class="k">print</span> <span class="n">image</span><span class="p">.</span><span class="nb">id</span>
</code></pre></div>    </div>

  </div>
  <div id="tab-commit-curl" class="tab-pane fade">

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">-d</span> alpine <span class="nb">touch</span> /helloworld
0888269a9d584f0fa8fc96b3c0d8d57969ceea3a64acf47cd34eebb4744dbc52
<span class="nv">$ </span>curl <span class="nt">--unix-socket</span> /var/run/docker.sock<span class="se">\</span>
  <span class="nt">-X</span> POST <span class="s2">"http:/v1.24/commit?container=0888269a9d&amp;repo=helloworld"</span>
<span class="o">{</span><span class="s2">"Id"</span>:<span class="s2">"sha256:6c86a5cd4b87f2771648ce619e319f3e508394b5bfc2cdbd2d60f59d52acda6c"</span><span class="o">}</span>
</code></pre></div>    </div>

  </div>
</div>
<!-- end tab-content -->
