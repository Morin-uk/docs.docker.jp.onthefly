<p>Some applications, especially legacy applications or applications which monitor
network traffic, expect to be directly connected to the physical network. In
this type of situation, you can use the <code class="language-plaintext highlighter-rouge">macvlan</code> network driver to assign a MAC
address to each container’s virtual network interface, making it appear to be
a physical network interface directly connected to the physical network. In this
case, you need to designate a physical interface on your Docker host to use for
the <code class="language-plaintext highlighter-rouge">macvlan</code>, as well as the subnet and gateway of the <code class="language-plaintext highlighter-rouge">macvlan</code>. You can even
isolate your <code class="language-plaintext highlighter-rouge">macvlan</code> networks using different physical network interfaces.
Keep the following things in mind:</p>

<ul>
  <li>
    <p>It is very easy to unintentionally damage your network due to IP address
exhaustion or to “VLAN spread”, which is a situation in which you have an
inappropriately large number of unique MAC addresses in your network.</p>
  </li>
  <li>
    <p>Your networking equipment needs to be able to handle “promiscuous mode”,
where one physical interface can be assigned multiple MAC addresses.</p>
  </li>
  <li>
    <p>If your application can work using a bridge (on a single Docker host) or
overlay (to communicate across multiple Docker hosts), these solutions may be
better in the long term.</p>
  </li>
</ul>

<h2 id="create-a-macvlan-network">Create a macvlan network</h2>

<p>When you create a <code class="language-plaintext highlighter-rouge">macvlan</code> network, it can either be in bridge mode or 802.1q
trunk bridge mode.</p>

<ul>
  <li>
    <p>In bridge mode, <code class="language-plaintext highlighter-rouge">macvlan</code> traffic goes through a physical device on the host.</p>
  </li>
  <li>
    <p>In 802.1q trunk bridge mode, traffic goes through an 802.1q sub-interface
which Docker creates on the fly. This allows you to control routing and
filtering at a more granular level.</p>
  </li>
</ul>

<h3 id="bridge-mode">Bridge mode</h3>

<p>To create a <code class="language-plaintext highlighter-rouge">macvlan</code> network which bridges with a given physical network
interface, use <code class="language-plaintext highlighter-rouge">--driver macvlan</code> with the <code class="language-plaintext highlighter-rouge">docker network create</code> command. You
also need to specify the <code class="language-plaintext highlighter-rouge">parent</code>, which is the interface the traffic will
physically go through on the Docker host.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker network create <span class="nt">-d</span> macvlan <span class="se">\</span>
  <span class="nt">--subnet</span><span class="o">=</span>172.16.86.0/24 <span class="se">\</span>
  <span class="nt">--gateway</span><span class="o">=</span>172.16.86.1 <span class="se">\</span>
  <span class="nt">-o</span> <span class="nv">parent</span><span class="o">=</span>eth0 pub_net
</code></pre></div></div>

<p>If you need to exclude IP addresses from being used in the <code class="language-plaintext highlighter-rouge">macvlan</code> network, such
as when a given IP address is already in use, use <code class="language-plaintext highlighter-rouge">--aux-addresses</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker network create <span class="nt">-d</span> macvlan <span class="se">\</span>
  <span class="nt">--subnet</span><span class="o">=</span>192.168.32.0/24 <span class="se">\</span>
  <span class="nt">--ip-range</span><span class="o">=</span>192.168.32.128/25 <span class="se">\</span>
  <span class="nt">--gateway</span><span class="o">=</span>192.168.32.254 <span class="se">\</span>
  <span class="nt">--aux-address</span><span class="o">=</span><span class="s2">"my-router=192.168.32.129"</span> <span class="se">\</span>
  <span class="nt">-o</span> <span class="nv">parent</span><span class="o">=</span>eth0 macnet32
</code></pre></div></div>

<h3 id="8021q-trunk-bridge-mode">802.1q trunk bridge mode</h3>

<p>If you specify a <code class="language-plaintext highlighter-rouge">parent</code> interface name with a dot included, such as <code class="language-plaintext highlighter-rouge">eth0.50</code>,
Docker interprets that as a sub-interface of <code class="language-plaintext highlighter-rouge">eth0</code> and creates the sub-interface
automatically.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker network create <span class="nt">-d</span> macvlan <span class="se">\</span>
    <span class="nt">--subnet</span><span class="o">=</span>192.168.50.0/24 <span class="se">\</span>
    <span class="nt">--gateway</span><span class="o">=</span>192.168.50.1 <span class="se">\</span>
    <span class="nt">-o</span> <span class="nv">parent</span><span class="o">=</span>eth0.50 macvlan50
</code></pre></div></div>

<h3 id="use-an-ipvlan-instead-of-macvlan">Use an ipvlan instead of macvlan</h3>

<p>In the above example, you are still using a L3 bridge. You can use <code class="language-plaintext highlighter-rouge">ipvlan</code>
instead, and get an L2 bridge. Specify <code class="language-plaintext highlighter-rouge">-o ipvlan_mode=l2</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker network create <span class="nt">-d</span> ipvlan <span class="se">\</span>
    <span class="nt">--subnet</span><span class="o">=</span>192.168.210.0/24 <span class="se">\</span>
    <span class="nt">--subnet</span><span class="o">=</span>192.168.212.0/24 <span class="se">\</span>
    <span class="nt">--gateway</span><span class="o">=</span>192.168.210.254 <span class="se">\</span>
    <span class="nt">--gateway</span><span class="o">=</span>192.168.212.254 <span class="se">\</span>
     <span class="nt">-o</span> <span class="nv">ipvlan_mode</span><span class="o">=</span>l2 ipvlan210
</code></pre></div></div>

<h2 id="use-ipv6">Use IPv6</h2>

<p>If you have <a href="/docs.docker.jp.onthefly/config/daemon/ipv6/">configured the Docker daemon to allow IPv6</a>,
you can use dual-stack IPv4/IPv6 <code class="language-plaintext highlighter-rouge">macvlan</code> networks.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker network create <span class="nt">-d</span> macvlan <span class="se">\</span>
    <span class="nt">--subnet</span><span class="o">=</span>192.168.216.0/24 <span class="nt">--subnet</span><span class="o">=</span>192.168.218.0/24 <span class="se">\</span>
    <span class="nt">--gateway</span><span class="o">=</span>192.168.216.1 <span class="nt">--gateway</span><span class="o">=</span>192.168.218.1 <span class="se">\</span>
    <span class="nt">--subnet</span><span class="o">=</span>2001:db8:abc8::/64 <span class="nt">--gateway</span><span class="o">=</span>2001:db8:abc8::10 <span class="se">\</span>
     <span class="nt">-o</span> <span class="nv">parent</span><span class="o">=</span>eth0.218 <span class="se">\</span>
     <span class="nt">-o</span> <span class="nv">macvlan_mode</span><span class="o">=</span>bridge macvlan216
</code></pre></div></div>

<h2 id="next-steps">Next steps</h2>

<ul>
  <li>Go through the <a href="/docs.docker.jp.onthefly/network/network-tutorial-macvlan/">macvlan networking tutorial</a></li>
  <li>Learn about <a href="/docs.docker.jp.onthefly/config/containers/container-networking/">networking from the container’s point of view</a></li>
  <li>Learn about <a href="/docs.docker.jp.onthefly/network/bridge/">bridge networks</a></li>
  <li>Learn about <a href="/docs.docker.jp.onthefly/network/overlay/">overlay networks</a></li>
  <li>Learn about <a href="/docs.docker.jp.onthefly/network/host/">host networking</a></li>
  <li>Learn about <a href="/docs.docker.jp.onthefly/network/macvlan/">Macvlan networks</a></li>
</ul>
