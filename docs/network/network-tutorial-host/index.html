
<p>このチュートリアルでは、スタンドアロンコンテナーのネットワークを取り扱います。
Docker ホストのネットワークに直接割り当てられ、ネットワークの分離は行われません。
これ以外のネットワークに関することは <a href="/docs.docker.jp.onthefly/network/">ネットワーク概要</a> を参照してください。</p>

<h2 id="goal">目指すこと</h2>

<p>本チュートリアルの目標は、<code class="language-plaintext highlighter-rouge">nginx</code> コンテナーを起動させ、Docker ホスト上のポート 80 に直接割り当てることです。
ネットワークの観点からは <code class="language-plaintext highlighter-rouge">nginx</code> のプロセスが、コンテナー内でなく Docker ホスト上で直接稼動している場合と同じレベルの分離が実現されていると言えます。
ただしこれ以外の点、つまりストレージ、プロセス名前空間、ユーザー名前空間などから見ると、<code class="language-plaintext highlighter-rouge">nginx</code> のプロセスはホストから分離されています。</p>

<h2 id="prerequisites">前提条件</h2>

<ul>
  <li>
    <p>以下の手順においては、Docker ホスト上のポート 80 が利用できることが必要です。
Nginx が別のポートを利用できるようにするには <a href="https://hub.docker.com/_/nginx/"><code class="language-plaintext highlighter-rouge">nginx</code> イメージのドキュメント</a> を参照してください。</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">host</code> ネットワークドライバーは Linux ホスト上においてのみ動作します。
一方、Docker Desktop for Mac、Docker Desktop for Windows、Docker EE for Windows Server ではサポートされていません。</p>
  </li>
</ul>

<h2 id="procedure">手順</h2>

<ol>
  <li>
    <p>コンテナーを生成し、デタッチモードで起動します。
<code class="language-plaintext highlighter-rouge">--rm</code> オプションは、コンテナーが終了または停止したときにコンテナーを削除するものです。
<code class="language-plaintext highlighter-rouge">-d</code> フラグは、コンテナーをデタッチモード（バックグラウンド）で起動します。</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--rm</span> <span class="nt">-d</span> <span class="nt">--network</span> host <span class="nt">--name</span> my_nginx nginx
</code></pre></div>    </div>
  </li>
  <li>
    <p>ブラウザーから <a href="http://localhost:80/">http://localhost:80/</a> を入力して Nginx にアクセスします。</p>
  </li>
  <li>
    <p>以下のコマンドを実行して、ネットワークの状況を確認します。</p>

    <ul>
      <li>
        <p>ネットワークインターフェースをすべて確認します。
そして新しいインターフェースは生成されていないことを確認します。</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ip addr show
</code></pre></div>        </div>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">netstat</code> コマンドを使って、どのプロセスがポート 80 に割り当てられているかを確認します。
実行にあたっては <code class="language-plaintext highlighter-rouge">sudo</code> が必要です。
プロセスが Docker デーモンユーザーの所有になっているからであり、これを用いないとプロセス名やプロセス ID を確認することができません。</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>netstat <span class="nt">-tulpn</span> | <span class="nb">grep</span> :80
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>コンテナーを停止します。
<code class="language-plaintext highlighter-rouge">--rm</code> オプションを指定して起動しているので、コンテナーは自動的に削除されます。</p>

    <pre><code class="language-basn">docker container stop my_nginx
</code></pre>
  </li>
</ol>

<h2 id="other-networking-tutorials">その他のネットワークチュートリアル</h2>

<p>ホストネットワークのチュートリアルを終えたので、以下に示すような別のネットワークチュートリアルも見てください。</p>

<ul>
  <li><a href="/docs.docker.jp.onthefly/network/network-tutorial-standalone/">スタンドアロンネットワークのチュートリアル</a></li>
  <li><a href="/docs.docker.jp.onthefly/network/network-tutorial-overlay/">オーバーレイネットワークのチュートリアル</a></li>
  <li><a href="/docs.docker.jp.onthefly/network/network-tutorial-macvlan/">Macvlan ネットワークのチュートリアル</a></li>
</ul>

