
<p>コンテナーが HTTP、HTTPS、FTP によるプロキシーサーバーを必要とする場合、さまざまな方法により設定を行うことができます。</p>

<ul>
  <li>
    <p>Docker 17.07 またはそれ以降においては、<a href="#configure-the-docker-client">Docker クライアントの設定</a> を行って、プロキシー情報をコンテナーに自動的に設定することができます。</p>
  </li>
  <li>
    <p>Docker 17.06 またはそれ以前においては、コンテナー内部にて <a href="#use-environment-variables">環境変数の適切な設定</a> を行うを必要があります。
これを行うタイミングは、イメージビルド時（この場合は可搬性が劣ることになります）、生成時、実行時のいずれかになります。</p>
  </li>
</ul>

<h2 id="configure-the-docker-client">Docker クライアントの設定</h2>

<ol>
  <li>
    <p>Docker クライアント上において、コンテナーを起動するユーザーのホームディレクトリ内に<code class="language-plaintext highlighter-rouge">~/.docker/config.json</code>を新規生成するか、これを編集します。
そして以下のような JSON 記述を追加します。
この記述において、プロキシータイプとして必要であれば<code class="language-plaintext highlighter-rouge">httpsProxy</code>または<code class="language-plaintext highlighter-rouge">ftpProxy</code>を指定します。
またプロキシーサーバーのアドレスとポートを指定します。
プロキシーサーバーは、同時に複数設定することができます。</p>

    <p>プロキシーサーバーを介したくないホストや IP 範囲の指定が必要な場合は、<code class="language-plaintext highlighter-rouge">noProxy</code>キーにおいて IP アドレスまたはホスト名をカンマ区切りにより設定します。
アスタリスク<code class="language-plaintext highlighter-rouge">*</code>を用いたワイルドカード指定がサポートされています。
たとえば以下に例を示します。</p>

    <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
 </span><span class="nl">"proxies"</span><span class="p">:</span><span class="w">
 </span><span class="p">{</span><span class="w">
   </span><span class="nl">"default"</span><span class="p">:</span><span class="w">
   </span><span class="p">{</span><span class="w">
     </span><span class="nl">"httpProxy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://127.0.0.1:3001"</span><span class="p">,</span><span class="w">
     </span><span class="nl">"httpsProxy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://127.0.0.1:3001"</span><span class="p">,</span><span class="w">
     </span><span class="nl">"noProxy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*.test.example.com,.example2.com"</span><span class="w">
   </span><span class="p">}</span><span class="w">
 </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>

    <p>ファイルを保存します。</p>
  </li>
  <li>
    <p>コンテナーの新規生成時や起動時には、コンテナー内に環境変数が自動的に生成されます。</p>
  </li>
</ol>

<h2 id="use-environment-variables">環境変数の利用</h2>

<h3 id="set-the-environment-variables-manually">環境変数の手動設定</h3>

<p>イメージをビルドした場合、あるいはコンテナーの生成、実行時に<code class="language-plaintext highlighter-rouge">--env</code>フラグを利用した場合、以下に示すような環境変数を使って、値を設定して利用することができます。
この方法ではイメージの可搬性が損なわれます。
したがって Docker 17.07 またはそれ以降を利用している場合は、代わりに <a href="#configure-the-docker-client">Docker クライアントの設定</a> を行ってください。</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">変数</th>
      <th style="text-align: left">Dockerfile 例</th>
      <th style="text-align: left"><code class="language-plaintext highlighter-rouge">docker run</code> 実行例</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">HTTP_PROXY</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">ENV HTTP_PROXY="http://127.0.0.1:3001"</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">--env HTTP_PROXY="http://127.0.0.1:3001"</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">HTTPS_PROXY</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">ENV HTTPS_PROXY="https://127.0.0.1:3001"</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">--env HTTPS_PROXY="https://127.0.0.1:3001"</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">FTP_PROXY</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">ENV FTP_PROXY="ftp://127.0.0.1:3001"</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">--env FTP_PROXY="ftp://127.0.0.1:3001"</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">NO_PROXY</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">ENV NO_PROXY="*.test.example.com,.example2.com"</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">--env NO_PROXY="*.test.example.com,.example2.com"</code></td>
    </tr>
  </tbody>
</table>

