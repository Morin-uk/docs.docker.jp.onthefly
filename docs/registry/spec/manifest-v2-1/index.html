<h1 id="image-manifest-version-2-schema-1">Image Manifest Version 2, Schema 1</h1>

<p>This document outlines the format of the V2 image manifest. The image
manifest described herein was introduced in the Docker daemon in the <a href="https://github.com/docker/docker/commit/9f482a66ab37ec396ac61ed0c00d59122ac07453">v1.3.0
release</a>.
It is a provisional manifest to provide a compatibility with the <a href="https://github.com/docker/docker/blob/master/image/spec/v1.md">V1 Image
format</a>, as the
requirements are defined for the <a href="https://github.com/docker/distribution/pull/62">V2 Schema 2
image</a>.</p>

<p>Image manifests describe the various constituents of a docker image.  Image
manifests can be serialized to JSON format with the following media types:</p>

<table>
  <thead>
    <tr>
      <th>Manifest Type</th>
      <th>Media Type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>manifest</td>
      <td>“application/vnd.docker.distribution.manifest.v1+json”</td>
    </tr>
    <tr>
      <td>signed manifest</td>
      <td>“application/vnd.docker.distribution.manifest.v1+prettyjws”</td>
    </tr>
  </tbody>
</table>

<p><em>Note that “application/json” will also be accepted for schema 1.</em></p>

<p>References:</p>

<ul>
  <li><a href="https://github.com/docker/docker/issues/9015">Proposal: JSON Registry API V2.1</a></li>
  <li><a href="https://github.com/docker/docker/issues/8093">Proposal: Provenance step 1 - Transform images for validation and verification</a></li>
</ul>

<h2 id="manifest-field-descriptions"><em>Manifest</em> Field Descriptions</h2>

<p>Manifest provides the base accessible fields for working with V2 image format
 in the registry.</p>

<ul>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">name</code></strong> <em>string</em></p>

    <p>name is the name of the image’s repository</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">tag</code></strong> <em>string</em></p>

    <p>tag is the tag of the image</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">architecture</code></strong> <em>string</em></p>

    <p>architecture is the host architecture on which this image is intended to
 run.  This is for information purposes and not currently used by the engine</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">fsLayers</code></strong> <em>array</em></p>

    <p>fsLayers is a list of filesystem layer blob sums contained in this image.</p>

    <p>An fsLayer is a struct consisting of the following fields
    - <strong><code class="language-plaintext highlighter-rouge">blobSum</code></strong> <em>digest.Digest</em></p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>blobSum is the digest of the referenced filesystem image layer. A
digest must be a sha256 hash.
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">history</code></strong> <em>array</em></p>

    <p>history is a list of unstructured historical data for v1 compatibility. It
 contains ID of the image layer and ID of the layer’s parent layers.</p>

    <p>history is a struct consisting of the following fields</p>
    <ul>
      <li>
        <p><strong><code class="language-plaintext highlighter-rouge">v1Compatibility</code></strong> string</p>

        <p>V1Compatibility is the raw V1 compatibility information. This will
 contain the JSON object describing the V1 of this image.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">schemaVersion</code></strong> <em>int</em></p>

    <p>SchemaVersion is the image manifest schema that this image follows.</p>
  </li>
</ul>

<blockquote>
  <p><strong>Note</strong>:the length of <code class="language-plaintext highlighter-rouge">history</code> must be equal to the length of <code class="language-plaintext highlighter-rouge">fsLayers</code> and
entries in each are correlated by index.</p>
</blockquote>

<h2 id="signed-manifests">Signed Manifests</h2>

<p>Signed manifests provides an envelope for a signed image manifest.  A signed
manifest consists of an image manifest along with an additional field
containing the signature of the manifest.</p>

<p>The docker client can verify signed manifests and displays a message to the user.</p>

<h3 id="signing-manifests">Signing Manifests</h3>

<p>Image manifests can be signed in two different ways: with a <em>libtrust</em> private
 key or an x509 certificate chain.  When signing with an x509 certificate chain,
 the public key of the first element in the chain must be the public key
 corresponding with the sign key.</p>

<h3 id="signed-manifest-field-description">Signed Manifest Field Description</h3>

<p>Signed manifests include an image manifest and a list of signatures generated
by <em>libtrust</em>.  A signature consists of the following fields:</p>

<ul>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">header</code></strong> <em><a href="http://tools.ietf.org/html/draft-ietf-jose-json-web-signature-31#section-2">JOSE</a></em></p>

    <p>A <a href="http://self-issued.info/docs/draft-ietf-jose-json-web-signature.html">JSON Web Signature</a></p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">signature</code></strong> <em>string</em></p>

    <p>A signature for the image manifest, signed by a <em>libtrust</em> private key</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">protected</code></strong> <em>string</em></p>

    <p>The signed protected header</p>
  </li>
</ul>

<h2 id="example-manifest">Example Manifest</h2>

<p><em>Example showing the official ‘hello-world’ image manifest.</em></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
   "name": "hello-world",
   "tag": "latest",
   "architecture": "amd64",
   "fsLayers": [
      {
         "blobSum": "sha256:5f70bf18a086007016e948b04aed3b82103a36bea41755b6cddfaf10ace3c6ef"
      },
      {
         "blobSum": "sha256:5f70bf18a086007016e948b04aed3b82103a36bea41755b6cddfaf10ace3c6ef"
      },
      {
         "blobSum": "sha256:cc8567d70002e957612902a8e985ea129d831ebe04057d88fb644857caa45d11"
      },
      {
         "blobSum": "sha256:5f70bf18a086007016e948b04aed3b82103a36bea41755b6cddfaf10ace3c6ef"
      }
   ],
   "history": [
      {
         "v1Compatibility": "{\"id\":\"e45a5af57b00862e5ef5782a9925979a02ba2b12dff832fd0991335f4a11e5c5\",\"parent\":\"31cbccb51277105ba3ae35ce33c22b69c9e3f1002e76e4c736a2e8ebff9d7b5d\",\"created\":\"2014-12-31T22:57:59.178729048Z\",\"container\":\"27b45f8fb11795b52e9605b686159729b0d9ca92f76d40fb4f05a62e19c46b4f\",\"container_config\":{\"Hostname\":\"8ce6509d66e2\",\"Domainname\":\"\",\"User\":\"\",\"Memory\":0,\"MemorySwap\":0,\"CpuShares\":0,\"Cpuset\":\"\",\"AttachStdin\":false,\"AttachStdout\":false,\"AttachStderr\":false,\"PortSpecs\":null,\"ExposedPorts\":null,\"Tty\":false,\"OpenStdin\":false,\"StdinOnce\":false,\"Env\":[\"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"],\"Cmd\":[\"/bin/sh\",\"-c\",\"#(nop) CMD [/hello]\"],\"Image\":\"31cbccb51277105ba3ae35ce33c22b69c9e3f1002e76e4c736a2e8ebff9d7b5d\",\"Volumes\":null,\"WorkingDir\":\"\",\"Entrypoint\":null,\"NetworkDisabled\":false,\"MacAddress\":\"\",\"OnBuild\":[],\"SecurityOpt\":null,\"Labels\":null},\"docker_version\":\"1.4.1\",\"config\":{\"Hostname\":\"8ce6509d66e2\",\"Domainname\":\"\",\"User\":\"\",\"Memory\":0,\"MemorySwap\":0,\"CpuShares\":0,\"Cpuset\":\"\",\"AttachStdin\":false,\"AttachStdout\":false,\"AttachStderr\":false,\"PortSpecs\":null,\"ExposedPorts\":null,\"Tty\":false,\"OpenStdin\":false,\"StdinOnce\":false,\"Env\":[\"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"],\"Cmd\":[\"/hello\"],\"Image\":\"31cbccb51277105ba3ae35ce33c22b69c9e3f1002e76e4c736a2e8ebff9d7b5d\",\"Volumes\":null,\"WorkingDir\":\"\",\"Entrypoint\":null,\"NetworkDisabled\":false,\"MacAddress\":\"\",\"OnBuild\":[],\"SecurityOpt\":null,\"Labels\":null},\"architecture\":\"amd64\",\"os\":\"linux\",\"Size\":0}\n"
      },
      {
         "v1Compatibility": "{\"id\":\"e45a5af57b00862e5ef5782a9925979a02ba2b12dff832fd0991335f4a11e5c5\",\"parent\":\"31cbccb51277105ba3ae35ce33c22b69c9e3f1002e76e4c736a2e8ebff9d7b5d\",\"created\":\"2014-12-31T22:57:59.178729048Z\",\"container\":\"27b45f8fb11795b52e9605b686159729b0d9ca92f76d40fb4f05a62e19c46b4f\",\"container_config\":{\"Hostname\":\"8ce6509d66e2\",\"Domainname\":\"\",\"User\":\"\",\"Memory\":0,\"MemorySwap\":0,\"CpuShares\":0,\"Cpuset\":\"\",\"AttachStdin\":false,\"AttachStdout\":false,\"AttachStderr\":false,\"PortSpecs\":null,\"ExposedPorts\":null,\"Tty\":false,\"OpenStdin\":false,\"StdinOnce\":false,\"Env\":[\"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"],\"Cmd\":[\"/bin/sh\",\"-c\",\"#(nop) CMD [/hello]\"],\"Image\":\"31cbccb51277105ba3ae35ce33c22b69c9e3f1002e76e4c736a2e8ebff9d7b5d\",\"Volumes\":null,\"WorkingDir\":\"\",\"Entrypoint\":null,\"NetworkDisabled\":false,\"MacAddress\":\"\",\"OnBuild\":[],\"SecurityOpt\":null,\"Labels\":null},\"docker_version\":\"1.4.1\",\"config\":{\"Hostname\":\"8ce6509d66e2\",\"Domainname\":\"\",\"User\":\"\",\"Memory\":0,\"MemorySwap\":0,\"CpuShares\":0,\"Cpuset\":\"\",\"AttachStdin\":false,\"AttachStdout\":false,\"AttachStderr\":false,\"PortSpecs\":null,\"ExposedPorts\":null,\"Tty\":false,\"OpenStdin\":false,\"StdinOnce\":false,\"Env\":[\"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"],\"Cmd\":[\"/hello\"],\"Image\":\"31cbccb51277105ba3ae35ce33c22b69c9e3f1002e76e4c736a2e8ebff9d7b5d\",\"Volumes\":null,\"WorkingDir\":\"\",\"Entrypoint\":null,\"NetworkDisabled\":false,\"MacAddress\":\"\",\"OnBuild\":[],\"SecurityOpt\":null,\"Labels\":null},\"architecture\":\"amd64\",\"os\":\"linux\",\"Size\":0}\n"
      },
   ],
   "schemaVersion": 1,
   "signatures": [
      {
         "header": {
            "jwk": {
               "crv": "P-256",
               "kid": "OD6I:6DRK:JXEJ:KBM4:255X:NSAA:MUSF:E4VM:ZI6W:CUN2:L4Z6:LSF4",
               "kty": "EC",
               "x": "3gAwX48IQ5oaYQAYSxor6rYYc_6yjuLCjtQ9LUakg4A",
               "y": "t72ge6kIA1XOjqjVoEOiPPAURltJFBMGDSQvEGVB010"
            },
            "alg": "ES256"
         },
         "signature": "XREm0L8WNn27Ga_iE_vRnTxVMhhYY0Zst_FfkKopg6gWSoTOZTuW4rK0fg_IqnKkEKlbD83tD46LKEGi5aIVFg",
         "protected": "eyJmb3JtYXRMZW5ndGgiOjY2MjgsImZvcm1hdFRhaWwiOiJDbjAiLCJ0aW1lIjoiMjAxNS0wNC0wOFQxODo1Mjo1OVoifQ"
      }
   ]
}

</code></pre></div></div>
