
<blockquote>
  <p><strong>Compose ファイルリファレンスをお探しですか？</strong></p>

  <p>その場合は<a href="/docs.docker.jp.onthefly/compose/compose-file/">最新版がこちら</a>。</p>
</blockquote>

<p>Compose とは、複数のコンテナーを定義し実行する Docker アプリケーションのためのツールです。
Compose においては YAML ファイルを使ってアプリケーションサービスの設定を行います。
コマンドを 1 つ実行するだけで、設定内容に基づいたアプリケーションサービスの生成、起動を行います。
Compose の機能に関する詳細は、<a href="#features">機能一覧</a> を参照してください。</p>

<p>Compose は本番環境、ステージング環境、開発環境において動作し、CI ワークフローとしても利用することができます。
それぞれの使い方については、<a href="#common-use-cases">一般的な利用例</a>を確認してください。</p>

<p>Compose を使うには、基本的に 3 つのステップを踏みます。</p>

<ol>
  <li>
    <p>アプリケーション環境を <code class="language-plaintext highlighter-rouge">Dockerfile</code> に定義します。
これによりその環境は再構築が可能となります。</p>
  </li>
  <li>
    <p>アプリケーションを構成するサービスを <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> ファイル内に定義します。
各サービスは独立した環境において起動することになります。</p>
  </li>
  <li>
    <p>最後に <code class="language-plaintext highlighter-rouge">docker-compose up</code> を実行したら、Compose はアプリケーション全体を起動、実行します。</p>
  </li>
</ol>

<p><code class="language-plaintext highlighter-rouge">docker-compose.yml</code> は次のように記述します。</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.8"</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">.</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">5000:5000"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">.:/code</span>
      <span class="pi">-</span> <span class="s">logvolume01:/var/log</span>
    <span class="na">links</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">redis</span>
  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis</span>
<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">logvolume01</span><span class="pi">:</span> <span class="pi">{}</span>
</code></pre></div></div>

<p>Compose ファイルに関するさらに詳しい情報は、<a href="/docs.docker.jp.onthefly/compose/compose-file/">Compose ファイルリファレンス</a> をご覧ください。</p>

<p>Compose には、アプリケーションのライフサイクルを管理するコマンドがあります。</p>

<ul>
  <li>サービスの開始、停止、再構築</li>
  <li>実行中のサービスの状態を表示</li>
  <li>実行中のサービスのストリームログ出力</li>
  <li>サービス上で１回限りのコマンドを実行</li>
</ul>

<h2 id="compose-documentation">Compose のドキュメント</h2>

<ul>
  <li><a href="/docs.docker.jp.onthefly/compose/install/">Compose のインストール</a></li>
  <li><a href="/docs.docker.jp.onthefly/compose/gettingstarted/">Compose を使ってはじめよう</a></li>
  <li><a href="/docs.docker.jp.onthefly/compose/django/">Django を使ってはじめよう</a></li>
  <li><a href="/docs.docker.jp.onthefly/compose/rails/">Rails を使ってはじめよう</a></li>
  <li><a href="/docs.docker.jp.onthefly/compose/wordpress/">WordPress を使ってはじめよう</a></li>
  <li><a href="/docs.docker.jp.onthefly/compose/faq/">よくたずねられる質問</a></li>
  <li><a href="/docs.docker.jp.onthefly/compose/reference/">コマンドラインリファレンス</a></li>
  <li><a href="/docs.docker.jp.onthefly/compose/compose-file/">Compose ファイルリファレンス</a></li>
</ul>

<h2 id="features">機能</h2>

<p>Compose には特徴的な以下の機能があります。</p>

<ul>
  <li><a href="#multiple-isolated-environments-on-a-single-host">1 つのホスト上で分離された環境を複数実現</a></li>
  <li><a href="#preserve-volume-data-when-containers-are-created">コンテナー生成時はボリュームデータを維持</a></li>
  <li><a href="#only-recreate-containers-that-have-changed">変更のあったコンテナーのみ再作成</a></li>
  <li><a href="#variables-and-moving-a-composition-between-environments">変数と環境間の移行</a></li>
</ul>

<h3 id="multiple-isolated-environments-on-a-single-host">1 つのホスト上で分離された環境を複数実現</h3>

<p>Compose はプロジェクト名というものを用いて各環境を分離します。
このプロジェクト名はさまざまに異なる用途に利用することができます。</p>

<ul>
  <li>開発ホスト上では 1 つの環境に対して複数のコピー作成に使います（例：プロジェクトの機能ブランチごとに、安定版のコピーを実行したい場合）。</li>
  <li>CI サーバー上では、お互いのビルドが干渉しないようにするため、プロジェクト名にユニークなビルド番号をセットできます。</li>
  <li>共有ホストまたは開発ホスト上では、異なるプロジェクトが同じサービス名を使わないようにし、お互いを干渉しないようにします。</li>
</ul>

<p>プロジェクト名はデフォルトでは、プロジェクトが存在するディレクトリ名となります。
プロジェクト名を指定するには、<a href="/docs.docker.jp.onthefly/compose/reference/overview/">コマンドラインオプション</a> の <code class="language-plaintext highlighter-rouge">-p</code> を指定するか、<a href="/docs.docker.jp.onthefly/compose/reference/envvars/#compose_project_name">環境変数 <code class="language-plaintext highlighter-rouge">COMPOSE_PROJECT_NAME</code></a> を使って指定します。</p>

<h3 id="preserve-volume-data-when-containers-are-created">コンテナー生成時はボリュームデータを維持</h3>

<p>Compose は、サービスによって利用されているボリュームをすべて維持します。
<code class="language-plaintext highlighter-rouge">docker-compose up</code> が実行されたときに、コンテナーがそれ以前に実行されていれば、以前のコンテナーから現在のコンテナーに向けてボリュームをコピーします。
この処理において、ボリューム内に作り出されていたデータは失われることはありません。</p>

<p>Windows 上において <code class="language-plaintext highlighter-rouge">docker-compose</code> を利用している場合には、<a href="/docs.docker.jp.onthefly/compose/reference/envvars/">環境変数のページ</a>を参考にし、状況に応じて必要となる環境変数を定めてください。</p>

<h3 id="only-recreate-containers-that-have-changed">変更のあったコンテナーのみ再作成</h3>

<p>Compose はコンテナーが生成されたときの設定情報をキャッシュに保存します。
設定内容に変更のないサービスが再起動された場合、Compose はすでにあるコンテナーを再利用します。
再利用されるということは、全体として環境への変更がすばやくできることを意味します。</p>

<h3 id="variables-and-moving-a-composition-between-environments">変数と環境間の移行</h3>

<p>Compose は Compose ファイル内での変数の利用をサポートしています。
環境変数を使い、さまざまな環境、さまざまなユーザー向けに構成をカスタマイズできます。
詳細は <a href="/docs.docker.jp.onthefly/compose/compose-file/#variable-substitution">環境変数のページ</a> をご覧ください。</p>

<p>Compose ファイルは <code class="language-plaintext highlighter-rouge">extends</code> フィールドを使うことで、複数の Compose ファイルを作成できるように拡張できます。
<a href="/docs.docker.jp.onthefly/compose/extends/">extends</a> をご覧ください。</p>

<h2 id="common-use-cases">一般的な利用例</h2>

<p>Compose はさまざまな使い方があります。
一般的な利用例は、以下のとおりです。</p>

<h3 id="development-environments">開発環境</h3>

<p>ソフトウェアを開発する上で、アプリケーションを分離された環境内にて実行させ、しかも正しくアクセスできるようにすることが極めて重要です。
Compose のコマンドラインツールを用いることで、環境生成と環境へのアクセスを行うことができます。</p>

<p><a href="/docs.docker.jp.onthefly/compose/compose-file/">Compose ファイル</a> は、アプリケーションにおけるサービスの依存関係（データベース、キュー、キャッシュ、ウェブ・サービス API など）を設定するものです。
Compose コマンドラインツールを使うと、いくつでもコンテナーを生成、起動でき、しかもコマンド（<code class="language-plaintext highlighter-rouge">docker-compose up</code>）を１つ実行するだけで、依存関係も正しく考慮してくれます。</p>

<p>さらにこういった機能は、プロジェクトに取りかかろうとしている開発者にとっても便利なものです。
Compose は、分厚く仕上がっている「開発者向け導入手順書」のページ数を減らすものになり、ただ 1 つの Compose ファイルと数えるほどのコマンドだけになります。</p>

<h3 id="automated-testing-environments">自動テスト環境</h3>

<p>継続的デプロイや継続的インテグレーションのプロセスにおいて、自動テストスイートは極めて重要です。
もれることなくテストを自動化させるためには、そのためのテスト環境が必要になるものです。
Compose ではテストスイートに対応して、分離されたテスト環境の生成とデプロイを便利に行う機能を提供しています。
<a href="/docs.docker.jp.onthefly/compose/compose-file/">Compose ファイル</a> 内に必要な環境定義を行っておけば、テスト環境の生成と削除は、ごく簡単なコマンドだけで実現できます。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker-compose up <span class="nt">-d</span>
<span class="nv">$ </span>./run_tests
<span class="nv">$ </span>docker-compose down
</code></pre></div></div>

<h3 id="single-host-deployments">ただ 1 つのホストからのデプロイ</h3>

<p>Compose はこれまで、開発環境やテスト環境でのワークフローに注目してきました。
しかしリリースを重ねるにつれて、本番環境を意識した機能を充実させるように進化しています。</p>

<p>本番環境向け機能の使い方については、<a href="/docs.docker.jp.onthefly/compose/production/">本番環境における Compose</a> をご覧ください。</p>

<h2 id="release-notes">リリースノート</h2>

<p>Docker Compose のこれまでのリリースにおける変更点の一覧は <a href="https://github.com/docker/compose/blob/master/CHANGELOG.md">CHANGELOG</a> から確認することができます。</p>

<h2 id="getting-help">ヘルプを得るには</h2>

<p>Docker Compose は活発に開発中です。
ヘルプが必要な場合、貢献したい場合、あるいはプロジェクトの仲間と話をしたい場合、コミュニケーションができるオープンチャネルがたくさんあｒます。</p>

<ul>
  <li>
    <p>バグ報告や機能リクエストは <a href="https://github.com/docker/compose/issues">GitHub の issue トラッカー</a>をご利用ください。</p>
  </li>
  <li>
    <p>プロジェクトのメンバーとリアルタイムに会話したければ、Docker Community Slack の <code class="language-plaintext highlighter-rouge">#docker-compose</code> チャネルに参加してください。</p>
  </li>
  <li>
    <p>コードやドキュメントの変更に貢献したい場合は、<a href="https://github.com/docker/compose/pulls">GitHub にプルリクエスト</a>を送ってください。</p>
  </li>
</ul>
