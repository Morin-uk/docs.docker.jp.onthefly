
<p>Docker Compose を使うと、Docker コンテナーとして生成される独立した環境内にて WordPress を簡単に実現することができます。
このクイックスタートガイドは、Docker Compose を使った WordPress の設定と実行方法を示すものです。
はじめるには <a href="/docs.docker.jp.onthefly/compose/install/">Compose のインストール</a> が必要です。</p>

<h3 id="define-the-project">プロジェクトの定義</h3>

<ol>
  <li>
    <p>プロジェクト用の空のディレクトリを生成します。</p>

    <p>ディレクトリ名は覚えやすいものにします。
このディレクトリはアプリケーションイメージのコンテキストディレクトリとなります。
このディレクトリには、イメージをビルドするために必要となるものだけを含めるようにします。</p>

    <p>このプロジェクトディレクトリに <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> ファイルを置きます。
このファイルそのものが、WordPress プロジェクトを開始するための内容をすべて含むものとなります。</p>

    <blockquote>
      <p><strong>ヒント</strong>: このファイルの拡張子は<code class="language-plaintext highlighter-rouge">.yml</code>と<code class="language-plaintext highlighter-rouge">.yaml</code>のどちらでも構いません。
いずれであっても動作します。</p>
    </blockquote>
  </li>
  <li>
    <p>プロジェクトディレクトリに移動します。</p>

    <p>そのディレクトリをたとえば <code class="language-plaintext highlighter-rouge">my_wordpress</code> としていた場合、以下のようになります。</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd my_wordpress/
</code></pre></div>    </div>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">docker-compose.yml</code> ファイルを生成します。
このファイルが <code class="language-plaintext highlighter-rouge">WordPress</code> ブログを起動します。
それとは別に、データ保存のためにボリュームマウントを使った <code class="language-plaintext highlighter-rouge">MySQL</code> インスタンスを生成します。</p>

    <pre><code class="language-none">version: '3.3'

services:
   db:
     image: mysql:5.7
     volumes:
       - db_data:/var/lib/mysql
     restart: always
     environment:
       MYSQL_ROOT_PASSWORD: somewordpress
       MYSQL_DATABASE: wordpress
       MYSQL_USER: wordpress
       MYSQL_PASSWORD: wordpress

   wordpress:
     depends_on:
       - db
     image: wordpress:latest
     ports:
       - "8000:80"
     restart: always
     environment:
       WORDPRESS_DB_HOST: db:3306
       WORDPRESS_DB_USER: wordpress
       WORDPRESS_DB_PASSWORD: wordpress
       WORDPRESS_DB_NAME: wordpress
volumes:
    db_data: {}
</code></pre>
  </li>
</ol>

<blockquote class="note-vanilla">
  <p><strong>メモ</strong>:</p>

  <ul>
    <li>
      <p>Docker ボリューム <code class="language-plaintext highlighter-rouge">db_data</code> は、WordPress 上から実行されるデータ更新をデータベースに保存します。
詳細は <a href="/docs.docker.jp.onthefly/storage/volumes/">Docker ボリューム</a> を参照してください。</p>
    </li>
    <li>
      <p>WordPress のマルチサイトは、ポート <code class="language-plaintext highlighter-rouge">80</code> と <code class="language-plaintext highlighter-rouge">443</code> 上においてのみ動作します。</p>
    </li>
  </ul>
</blockquote>

<h3 id="build-the-project">プロジェクトのビルド</h3>

<p>プロジェクトディレクトリ上にて <code class="language-plaintext highlighter-rouge">docker-compose up -d</code> を実行します。</p>

<p>これはデタッチモードにより <a href="/docs.docker.jp.onthefly/compose/reference/up/"><code class="language-plaintext highlighter-rouge">docker-compose up</code></a> を実行し、必要な Docker イメージがあれば取得します。
そして WordPress と データベースの両コンテナーを起動します。
たとえば以下のようになります。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker-compose up -d
Creating network "my_wordpress_default" with the default driver
Pulling db (mysql:5.7)...
5.7: Pulling from library/mysql
efd26ecc9548: Pull complete
a3ed95caeb02: Pull complete
...
Digest: sha256:34a0aca88e85f2efa5edff1cea77cf5d3147ad93545dbec99cfe705b03c520de
Status: Downloaded newer image for mysql:5.7
Pulling wordpress (wordpress:latest)...
latest: Pulling from library/wordpress
efd26ecc9548: Already exists
a3ed95caeb02: Pull complete
589a9d9a7c64: Pull complete
...
Digest: sha256:ed28506ae44d5def89075fd5c01456610cd6c64006addfe5210b8c675881aff6
Status: Downloaded newer image for wordpress:latest
Creating my_wordpress_db_1
Creating my_wordpress_wordpress_1
</code></pre></div></div>

<blockquote>
  <p><strong>メモ</strong>: WordPress のマルチサイトは、ポート <code class="language-plaintext highlighter-rouge">80</code> と <code class="language-plaintext highlighter-rouge">443</code> 上においてのみ動作します。
<code class="language-plaintext highlighter-rouge">0.0.0.0</code> の <code class="language-plaintext highlighter-rouge">80</code> や <code class="language-plaintext highlighter-rouge">443</code> （あるいは設定したポート） へのバインディングに関するエラーが発生したら、WordPress に割り当てたポートが、すでに別のサービスによって利用されていることが考えられます。</p>
</blockquote>

<h3 id="bring-up-wordpress-in-a-web-browser">ウェブブラウザー上での WordPress の起動</h3>

<p>この時点で WordPress は Docker ホスト上のポート <code class="language-plaintext highlighter-rouge">8000</code> 番を使って稼動しています。
そこで WordPress の管理者となって「よく知られた 5 分インストール」を行うことができます。</p>

<blockquote>
  <p><strong>メモ</strong>: WordPress サイトはポート <code class="language-plaintext highlighter-rouge">8000</code> を使って稼動していると述べましたが、即座に利用できるわけではありません。コンテナーは初期化を行っている最中であり、初回の読み込み処理には数分の時間を要するからです。</p>
</blockquote>

<p><a href="/docs.docker.jp.onthefly/machine/">Docker Machine</a> を利用している場合は、<code class="language-plaintext highlighter-rouge">docker-machine ip MACHINE_VM</code> を実行してマシンの IP アドレスを取得できます。
そこでウェブブラウザーから <code class="language-plaintext highlighter-rouge">http://MACHINE_VM_IP:8000</code> にアクセスしてください。</p>

<p>Docker Desktop for Mac や Docker Desktop for Windows を利用している場合、IP アドレスとしては <code class="language-plaintext highlighter-rouge">http://localhost</code> を利用し、ウェブブラウザーから <code class="language-plaintext highlighter-rouge">http://localhost:8000</code> にアクセスしてください。</p>

<p><img src="/docs.docker.jp.onthefly/compose/images/wordpress-lang.png" alt="WordPress インストール時の言語選択" /></p>

<p><img src="/docs.docker.jp.onthefly/compose/images/wordpress-welcome.png" alt="WordPress へようこそ" /></p>

<h3 id="shutdown-and-cleanup">シャットダウンとクリーンアップ</h3>

<p><a href="/docs.docker.jp.onthefly/compose/reference/down/"><code class="language-plaintext highlighter-rouge">docker-compose down</code></a> コマンドを実行すると、コンテナーとデフォルトネットワークが削除されます。
ただし WordPress データベースは残ります。</p>

<p><code class="language-plaintext highlighter-rouge">docker-compose down --volumes</code> コマンドを実行すると、コンテナーとデフォルトネットワーク、さらに WordPress データベースも削除します。</p>

<h2 id="more-compose-documentation">Compose ドキュメント</h2>

<ul>
  <li><a href="/docs.docker.jp.onthefly/compose/">ユーザーガイド</a></li>
  <li><a href="/docs.docker.jp.onthefly/compose/install/">Compose のインストール</a></li>
  <li><a href="/docs.docker.jp.onthefly/compose/gettingstarted/">はじめよう</a></li>
  <li><a href="/docs.docker.jp.onthefly/compose/reference/">コマンドラインリファレンス</a></li>
  <li><a href="/docs.docker.jp.onthefly/compose/compose-file/">Compose ファイルリファレンス</a></li>
  <li><a href="/docs.docker.jp.onthefly/compose/samples-for-compose/">Compose を使ったサンプルアプリ</a></li>
</ul>
