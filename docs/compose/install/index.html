
<p>Docker Compose は macOS、Windows、64 ビット Linux で動作します。</p>

<h2 id="prerequisites">前提条件</h2>

<p>Docker Compose は重要な処理を Docker Engine に委ねています。
したがって Docker Engine がインストールされていることを確認します。
それはローカル、リモートいずれでも、設定次第で可能です。</p>

<ul>
  <li>
    <p>Docker Desktop for Mac、Docker Desktop for Windows のようなデスクトップシステムにおいては、インストールの一部として Docker Compose が含まれています。</p>
  </li>
  <li>
    <p>Linux システムではまず、 Docker 入手のページに説明されている各 OS 向けの <a href="/docs.docker.jp.onthefly/engine/install/#server" target="_blank" rel="noopener" class="_">Docker Engine</a> をインストールします。
そしてこのページに戻り、Linux システム上での Compose のインストール手順に従います。</p>
  </li>
</ul>

<p>Compose をルートユーザー以外で起動するには、<a href="/docs.docker.jp.onthefly/engine/install/linux-postinstall/">ルートユーザー以外による Docker の管理</a> を参照してください。</p>

<h2 id="install-compose">Compose のインストール</h2>

<p>以下に示す手順を通して Mac、Windows、Windows Server 2016、Linux に Compose をインストールします。
またその他の方法として Python パッケージマネージャー <code class="language-plaintext highlighter-rouge">pip</code> を使う方法や、コンテナーとして Compose をインストール方法もあります。</p>

<blockquote>
  <p>別バージョンのインストール</p>

  <p>以降に示す手順は Compose の現時点での最新安定版（<strong>v1.27.4</strong>）に基づいたものです。
これ以外のバージョンをインストールする場合は、記述されているリリース番号を、目的とするものに置き換えてください。
Compose のリリースは <a href="https://github.com/docker/compose/releases" target="_blank" rel="noopener" class="_">GitHub 上の Compose リポジトリのリリースページ</a> においても一覧が示され利用可能です。
Compose の<strong>プレリリース版</strong>をインストールする場合は、<a href="#install-pre-release-builds">プレリリース版のインストール</a>の説明を参照してください。</p>
</blockquote>

<ul class="nav nav-tabs">
  <li class="active"><a data-toggle="tab" data-target="#macOS">Mac</a></li>
  <li><a data-toggle="tab" data-target="#windows">Windows</a></li>
  <li><a data-toggle="tab" data-target="#windows-server">Windows Server</a></li>
  <li><a data-toggle="tab" data-target="#linux">Linux</a></li>
  <li><a data-toggle="tab" data-target="#alternatives">その他のインストール</a></li>
</ul>
<div class="tab-content">
  <div id="macOS" class="tab-pane fade in active">

    <h3 id="install-compose-on-macos">macOS への Compose インストール</h3>

    <p><strong>Docker Desktop for Mac</strong> には他の Docker アプリとともに Compose が含まれています。
したがって Mac ユーザーは Compose を個別にインストールする必要はありません。
インストール手順については <a href="/docs.docker.jp.onthefly/docker-for-mac/install/">Docker Desktop on Mac のインストール</a> を参照してください。</p>

  </div>
  <div id="windows" class="tab-pane fade">

    <h3 id="install-compose-on-windows-desktop-systems">Windows デスクトップへの Compose インストール</h3>

    <p><strong>Docker Desktop for Windows</strong> には他の Docker アプリとともに Compose が含まれています。
したがって Windows ユーザーは Compose を個別にインストールする必要はありません。
インストール手順については <a href="/docs.docker.jp.onthefly/docker-for-windows/install/">Install Docker Desktop on Windows</a> を参照してください。</p>

    <p>Docker デーモンや Docker クライアントを Windows Server 上で直接起動している場合は、Windows Server のタブ内にある手順に従ってください。</p>

  </div>
  <div id="windows-server" class="tab-pane fade in active">

    <h3 id="install-compose-on-windows-server">Windows Server への Compose インストール</h3>

    <p>Docker デーモンや Docker クライアントを Microsoft Windows Server 上で直接起動している場合、および Docker Compose をインストールしたい場合は、以下の手順に従ってください。</p>

    <ol>
      <li>
        <p>PowerShell を管理者権限で実行。
PowerShell アイコンを見つけ、右クリックメニューから<strong>管理者として実行</strong>を選びます。
このアプリによるデバイスへの変更の許可を問われたら<strong>はい</strong>をクリックします。</p>
      </li>
      <li>
        <p>GitHub では TLS1.2 が必要となるので、PowerShell において以下を実行します。</p>

        <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="no">Net.</span><span class="kt">ServicePointManager</span><span class="p">]::</span><span class="nf">SecurityProtocol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="no">Net.</span><span class="kt">SecurityProtocolType</span><span class="p">]::</span><span class="nf">Tls12</span><span class="w">
</span></code></pre></div>        </div>

        <p>そして以下のコマンドを実行して Compose の現時点での最新版（v1.27.4）をダウンロードします。</p>

        <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">Invoke-WebRequest</span><span class="w"> </span><span class="s2">"https://github.com/docker/compose/releases/download/1.27.4/docker-compose-Windows-x86_64.exe"</span><span class="w"> </span><span class="nt">-UseBasicParsing</span><span class="w"> </span><span class="nt">-OutFile</span><span class="w"> </span><span class="nv">$</span><span class="nn">Env</span><span class="p">:</span><span class="nv">ProgramFiles</span><span class="nx">\Docker\docker-compose.exe</span><span class="w">
</span></code></pre></div>        </div>

        <p><strong>メモ</strong>: Windows Server 2019 の場合は、Compose の実行パスとして <code class="language-plaintext highlighter-rouge">$Env:ProgramFiles\Docker</code> を加えます。
 このディレクトリはシステムの <code class="language-plaintext highlighter-rouge">PATH</code> に登録されるので、この後の手順における <code class="language-plaintext highlighter-rouge">docker-compose --version</code> コマンドが、他になにも設定せずに実行できるようになります。</p>

        <blockquote>
          <p>別バージョンの Compose をインストールする場合は、<code class="language-plaintext highlighter-rouge">1.27.4</code> の部分を、目的とするバージョンに置き換えてください。</p>
        </blockquote>
      </li>
      <li>
        <p>インストール結果をテストします。</p>

        <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">docker-compose</span><span class="w"> </span><span class="nt">--version</span><span class="w">

</span><span class="nf">docker-compose</span><span class="w"> </span><span class="nx">version</span><span class="w"> </span><span class="nx">1.27.4</span><span class="p">,</span><span class="w"> </span><span class="nx">build</span><span class="w"> </span><span class="nx">01110ad01</span><span class="w">
</span></code></pre></div>        </div>
      </li>
    </ol>

  </div>
  <div id="linux" class="tab-pane fade">

    <h3 id="install-compose-on-linux-systems">Linux システムへの Compose インストール</h3>

    <p>Linux の場合は、<a href="https://github.com/docker/compose/releases" target="_blank" rel="noopener" class="_">GitHub 上の Compose リポジトリのリリースページ</a> から Docker Compose の実行バイナリをダウンロードします。
リンク先の手順では、端末画面上から <code class="language-plaintext highlighter-rouge">curl</code> コマンドを使ってダウンロードを行います。
その手順は以下にも示します。</p>

    <blockquote class="important">
      <p><code class="language-plaintext highlighter-rouge">alpine</code> では、以下に示す依存パッケージが必要です。
<code class="language-plaintext highlighter-rouge">py-pip</code>, <code class="language-plaintext highlighter-rouge">python-dev</code>, <code class="language-plaintext highlighter-rouge">libffi-dev</code>, <code class="language-plaintext highlighter-rouge">openssl-dev</code>, <code class="language-plaintext highlighter-rouge">gcc</code>, <code class="language-plaintext highlighter-rouge">libc-dev</code>,  <code class="language-plaintext highlighter-rouge">make</code></p>
    </blockquote>

    <ol>
      <li>
        <p>以下のコマンドを実行して Docker Compose の現時点での最新安定版をダウンロードします。</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>curl <span class="nt">-L</span> <span class="s2">"https://github.com/docker/compose/releases/download/1.27.4/docker-compose-</span><span class="si">$(</span><span class="nb">uname</span> <span class="nt">-s</span><span class="si">)</span><span class="s2">-</span><span class="si">$(</span><span class="nb">uname</span> <span class="nt">-m</span><span class="si">)</span><span class="s2">"</span> <span class="nt">-o</span> /usr/local/bin/docker-compose
</code></pre></div>        </div>

        <blockquote>
          <p>別バージョンの Compose をインストールする場合は、<code class="language-plaintext highlighter-rouge">1.27.4</code> の部分を、目的とするバージョンに置き換えてください。</p>
        </blockquote>

        <p><code class="language-plaintext highlighter-rouge">curl</code> を使ったインストールに問題がある場合は、上のタブにある <a href="/docs.docker.jp.onthefly/compose/install/#alternative-install-options">その他のインストール</a> を確認してください。</p>
      </li>
      <li>
        <p>実行バイナリに対して実行権限を与えます。</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo chmod</span> +x /usr/local/bin/docker-compose
</code></pre></div>        </div>

        <blockquote>
          <p><strong>メモ</strong>: インストールした後に <code class="language-plaintext highlighter-rouge">docker-compose</code> の実行に失敗する場合は、パスを確認してください。
<code class="language-plaintext highlighter-rouge">/usr/bin</code>、あるいはパス設定されているディレクトリへのシンボリックリンクを作る方法もあります。</p>
        </blockquote>

        <p>たとえば以下のとおりです。</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo ln</span> <span class="nt">-s</span> /usr/local/bin/docker-compose /usr/bin/docker-compose
</code></pre></div>        </div>
      </li>
      <li>
        <p>必要に応じて <code class="language-plaintext highlighter-rouge">bash</code> や <code class="language-plaintext highlighter-rouge">zsh</code> シェルに対する<a href="/docs.docker.jp.onthefly/compose/completion/">コマンド補完</a>をインストールします。</p>
      </li>
      <li>
        <p>インストール結果をテストします。</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker-compose <span class="nt">--version</span>
docker-compose version 1.27.4, build 1110ad01
</code></pre></div>        </div>
      </li>
    </ol>
  </div>
  <div id="alternatives" class="tab-pane fade">

    <h3 id="alternative-install-options">その他のインストール</h3>

    <ul>
      <li><a href="#install-using-pip">pip を用いたインストール</a></li>
      <li><a href="#install-as-a-container">コンテナーとしてインストール</a></li>
    </ul>

    <h4 id="install-using-pip">pip を用いたインストール</h4>

    <blockquote class="important">
      <p><code class="language-plaintext highlighter-rouge">alpine</code> では、以下に示す依存パッケージが必要です。
<code class="language-plaintext highlighter-rouge">py-pip</code>, <code class="language-plaintext highlighter-rouge">python-dev</code>, <code class="language-plaintext highlighter-rouge">libffi-dev</code>, <code class="language-plaintext highlighter-rouge">openssl-dev</code>, <code class="language-plaintext highlighter-rouge">gcc</code>, <code class="language-plaintext highlighter-rouge">libc-dev</code>,  <code class="language-plaintext highlighter-rouge">make</code></p>
    </blockquote>

    <p>Compose は <code class="language-plaintext highlighter-rouge">pip</code> を使って <a href="https://pypi.python.org/pypi/docker-compose">pypi</a> からインストールすることができます。
<code class="language-plaintext highlighter-rouge">pip</code> を使ったインストールでは <a href="https://virtualenv.pypa.io/en/latest/">virtualenv</a> を用いることをお勧めします。
これは多くのオペレーティングシステムにおいて、python パッケージが docker-compose の依存パッケージと不整合を起こすことがあるからです。
<a href="https://docs.python-guide.org/dev/virtualenvs/">virtualenv チュートリアル</a> から始めてみてください。</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>docker-compose
</code></pre></div>    </div>

    <p>virtualenv を使わない場合は以下のようにします。</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>pip <span class="nb">install </span>docker-compose
</code></pre></div>    </div>

    <blockquote>
      <p>pip のバージョンは 6.0 またはそれ以上が必要です。</p>
    </blockquote>

    <h4 id="install-as-a-container">コンテナーとしてインストール</h4>

    <p>Compose は 簡易な bash のラッパースクリプトを用いて、コンテナー内部にて実行することもできます。
コンテナーとして Compose をインストールするには、以下のコマンドを実行します。</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>curl <span class="nt">-L</span> <span class="nt">--fail</span> https://github.com/docker/compose/releases/download/1.27.4/run.sh <span class="nt">-o</span> /usr/local/bin/docker-compose
<span class="nb">sudo chmod</span> +x /usr/local/bin/docker-compose
</code></pre></div>    </div>

  </div>
</div>

<hr />

<h2 id="install-pre-release-builds">プレリリース版のインストール</h2>

<p>プレリリース版を試してみたい方は <a href="https://github.com/docker/compose/releases" target="_blank" rel="noopener" class="_">GitHub 上の Compose リポジトリのリリースページ</a> からリリース候補（release candidate）をダウンロードしてください。
リンク先の手順では、端末画面上から <code class="language-plaintext highlighter-rouge">curl</code> コマンドを使って実行バイナリをダウンロードします。</p>

<p>マスターブランチからビルドされたプレリリース版もあります。
<a href="https://dl.bintray.com/docker-compose/master/" target="_blank" rel="noopener" class="_">https://dl.bintray.com/docker-compose/master/</a> からダウンロードしてください。</p>

<blockquote class="important">
  <p>プレリリース版では、正式リリース前に新機能を試すことができます。
ただし安定しているかどうかはわかりません。</p>
</blockquote>

<h2 id="upgrading">アップグレード</h2>

<p>Compose のバージョン 1.2 またはそれ以前からアップグレードを行う場合、アップグレードした後に既存のコンテナーは削除するか移行する必要があります。
Compose 1.3 からは Docker ラベルが導入されたためです。
このラベルとはコンテナーの追跡を行うものであり、古いコンテナーはこのラベルをつけて再生成する必要があります。</p>

<p>Docker ラベルを持っていないコンテナーであることが検出されると、Compose はそのようなコンテナーの実行を拒否するため利用することができません。
それまで使っていたコンテナーを引き続き利用したい場合（たとえばデータボリュームを用いてデータ保存をしている場合）、Compose 1.5.x を使って、以下のようなコマンドによりデータ移行を行うことができます。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose migrate-to-labels
</code></pre></div></div>

<p>コンテナーを維持しておく必要がないのであれば、削除するだけで構いません。
Compose は新しくコンテナーを生成してくれます。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker container <span class="nb">rm</span> <span class="nt">-f</span> <span class="nt">-v</span> myapp_web_1 myapp_db_1 ...
</code></pre></div></div>

<h2 id="uninstallation">アンインストール</h2>

<p><code class="language-plaintext highlighter-rouge">curl</code> を使って Docker Compose をインストールしていた場合は、次のようにしてアンインストールします。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo rm</span> /usr/local/bin/docker-compose
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">pip</code> を使って Docker Compose をインストールしていた場合は、次のようにしてアンインストールします。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip uninstall docker-compose
</code></pre></div></div>

<blockquote>
  <p>“Permission denied” エラーが出たときは</p>

  <p>上のコマンドのいずれかを実行したときに “Permission denied” エラーが発生したら、それは <code class="language-plaintext highlighter-rouge">docker-compose</code> を削除するための適切な権限がないことが考えられます。
どうしても削除したいときは、上のコマンドの先頭に <code class="language-plaintext highlighter-rouge">sudo</code> をつけて、もう一度コマンドを実行してください。</p>
</blockquote>

<h2 id="where-to-go-next">次に読むものは</h2>

<ul>
  <li><a href="/docs.docker.jp.onthefly/compose/">ユーザーガイド</a></li>
  <li><a href="/docs.docker.jp.onthefly/compose/install/">Compose のインストール</a></li>
  <li><a href="/docs.docker.jp.onthefly/compose/gettingstarted/">Compose をはじめよう</a></li>
  <li><a href="/docs.docker.jp.onthefly/compose/reference/">コマンドラインリファレンス</a></li>
  <li><a href="/docs.docker.jp.onthefly/compose/compose-file/">Compose ファイルリファレンス</a></li>
  <li><a href="/docs.docker.jp.onthefly/compose/samples-for-compose/">Compose を使ったサンプルアプリ</a></li>
</ul>
