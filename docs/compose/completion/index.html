
<p>Compose には bash 用あるいは zsh 用の <a href="https://en.wikipedia.org/wiki/Command-line_completion">コマンド補完</a>（command completion）が用意されています。</p>

<h2 id="install-command-completion">コマンド補完のインストール</h2>

<h3 id="bash">Bash</h3>

<p>bash 補完がインストールされていることを確認します。</p>

<h4 id="linux">Linux</h4>

<ol>
  <li>
    <p>利用している Linux OSであれば（最小インストールではない）、bash 補完が利用できるはずです。</p>
  </li>
  <li>
    <p>補完スクリプトを <code class="language-plaintext highlighter-rouge">/etc/bash_completion.d/</code> に置きます。</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>curl <span class="nt">-L</span> https://raw.githubusercontent.com/docker/compose/1.27.4/contrib/completion/bash/docker-compose <span class="nt">-o</span> /etc/bash_completion.d/docker-compose
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="mac">Mac</h3>

<h5 id="install-via-homebrew">Homebrew によるインストール</h5>

<ol>
  <li><code class="language-plaintext highlighter-rouge">brew install bash-completion</code> によりインストールします。</li>
  <li>
    <p>インストール後に Brew がインストール先のパスを表示します。
補完スクリプトをそのパスに置きます。</p>

    <p>たとえば Mac 10.13.2 を利用している場合、補完スクリプトを <code class="language-plaintext highlighter-rouge">/usr/local/etc/bash_completion.d/</code> に置きます。</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nb">sudo </span>curl <span class="nt">-L</span> https://raw.githubusercontent.com/docker/compose/1.27.4/contrib/completion/bash/docker-compose <span class="nt">-o</span> /usr/local/etc/bash_completion.d/docker-compose
</code></pre></div>    </div>
  </li>
  <li>
    <p>以下を <code class="language-plaintext highlighter-rouge">~/.bash_profile</code> に追加します。</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">if</span> <span class="o">[</span> <span class="nt">-f</span> <span class="si">$(</span>brew <span class="nt">--prefix</span><span class="si">)</span>/etc/bash_completion <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
 <span class="nb">.</span> <span class="si">$(</span>brew <span class="nt">--prefix</span><span class="si">)</span>/etc/bash_completion
 <span class="k">fi</span>
</code></pre></div>    </div>
  </li>
  <li>補完を利用するため <code class="language-plaintext highlighter-rouge">~/.bash_profile</code> を source で取り込むか、あるいは新たな端末画面を起動します。</li>
</ol>

<h5 id="install-via-macports">MacPorts によるインストール</h5>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">sudo port install bash-completion</code> を実行して bash 補完をインストールします。</p>
  </li>
  <li>
    <p>以下を <code class="language-plaintext highlighter-rouge">~/.bash_profile</code> に追加します。</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">if</span> <span class="o">[</span> <span class="nt">-f</span> /opt/local/etc/profile.d/bash_completion.sh <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
 <span class="nb">.</span> /opt/local/etc/profile.d/bash_completion.sh
 <span class="k">fi</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>補完を利用するため <code class="language-plaintext highlighter-rouge">~/.bash_profile</code> を source で取り込むか、あるいは新たな端末画面を起動します。</p>
  </li>
</ol>

<h3 id="zsh">Zsh</h3>

<p><a href="https://ohmyz.sh/"><code class="language-plaintext highlighter-rouge">oh-my-zsh</code></a> がインストールされているかどうかを確認します。</p>

<h4 id="with-oh-my-zsh-shell">oh-my-zsh シェルがある場合</h4>

<p><code class="language-plaintext highlighter-rouge">~/.zshrc</code> 内のプラグインリストに <code class="language-plaintext highlighter-rouge">docker</code> と <code class="language-plaintext highlighter-rouge">docker-compose</code> を加えます。
これにより oh-my-zsh シェル内での自動補完機能を有効にします。
以下の例において <code class="language-plaintext highlighter-rouge">...</code> の部分は、以前からインストールされている Zsh プラグインを表わします。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">plugins</span><span class="o">=(</span>... docker docker-compose
<span class="o">)</span>
</code></pre></div></div>

<h4 id="without-oh-my-zsh-shell">oh-my-zsh シェルがない場合</h4>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">/path/to/zsh/completion</code>（通常は <code class="language-plaintext highlighter-rouge">~/.zsh/completion/</code>）に補完スクリプトを置きます。</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">mkdir</span> <span class="nt">-p</span> ~/.zsh/completion
<span class="nv">$ </span>curl <span class="nt">-L</span> https://raw.githubusercontent.com/docker/compose/1.27.4/contrib/completion/zsh/_docker-compose <span class="o">&gt;</span> ~/.zsh/completion/_docker-compose
</code></pre></div>    </div>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">~/.zshrc</code> 内にて <code class="language-plaintext highlighter-rouge">$fpath</code> にディレクトリを追加します。</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">fpath</span><span class="o">=(</span>~/.zsh/completion <span class="nv">$fpath</span><span class="o">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">compinit</code> がロードされているか、あるいは <code class="language-plaintext highlighter-rouge">~/.zshrc</code> 内への追加によりそれが行われるかを確認します。</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> autoload <span class="nt">-Uz</span> compinit <span class="o">&amp;&amp;</span> compinit <span class="nt">-i</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>その後にシェルをリロードします。</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nb">exec</span> <span class="nv">$SHELL</span> <span class="nt">-l</span>
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="available-completions">利用できる補完機能</h2>

<p>コマンドラインにどこまで入力しているかによって、補完される内容はさまざまです。</p>

<ul>
  <li>利用可能な docker-compose コマンド。</li>
  <li>特定のコマンドにて利用可能なオプション。</li>
  <li>指定されているコンテキストにおいて用いられるサービス名。
たとえば実行中サービス、停止中のインスタンス、イメージに基づくサービス、Dockerfile に基づくサービスなどです。
<code class="language-plaintext highlighter-rouge">docker-compose scale</code> では、サービス名が補完されると自動的に “=” が追加されます。</li>
  <li>指定されたオプションへの引数。
たとえば <code class="language-plaintext highlighter-rouge">docker-compose kill -s</code> に対して、シグナル名、たとえば SIGHUP や SIGUSR1 が補完されます。</li>
</ul>

<p>Compose での作業を、入力は速くミスは少なく！</p>

<h2 id="compose-documentation">Compose ドキュメント</h2>

<ul>
  <li><a href="/docs.docker.jp.onthefly/compose/">ユーザーガイド</a></li>
  <li><a href="/docs.docker.jp.onthefly/compose/install/">Compose のインストール</a></li>
  <li><a href="/docs.docker.jp.onthefly/compose/reference/">コマンドラインリファレンス</a></li>
  <li><a href="/docs.docker.jp.onthefly/compose/compose-file/">Compose ファイルリファレンス</a></li>
  <li><a href="/docs.docker.jp.onthefly/compose/samples-for-compose/">Compose を使ったサンプルアプリ</a></li>
</ul>
