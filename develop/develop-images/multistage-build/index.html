<!-- Page generated 2019-04-29 17:33:18 +0900 -->
<!-- relative link basehrefs -->

	
	
	
		
			
		
	
		
			
		
	
		
			
			


<!-- Logic for 'edit this button' -->


	

	

	

	

	

	

	

	

	


<!-- End of logic for 'edit this button' -->


<!DOCTYPE html>
<html lang="ja">

<head>
	<base href="https://matsuand.github.io/docs.docker.jp.onthefly/develop/develop-images/" />
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<style type="text/css">
		@charset "UTF-8";
		[ng\:cloak],
		[ng-cloak],
		[data-ng-cloak],
		[x-ng-cloak],
		.ng-cloak,
		.x-ng-cloak,
		.ng-hide:not(.ng-hide-animate) {
			display: none !important;
		}

		ng\:form {
			display: block;
		}
	</style>
	<script type="text/javascript">
	  !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="4.0.0";
	  analytics.load("IWj9D0UpZHZdZUZX9jl98PcpBFWBnBMy");
	  analytics.page();
	  }}();
	</script>
	
	<!-- favicon -->
	<link rel="icon" type="image/x-icon" href="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
	<meta name="msapplication-TileImage" content="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico">
	<link rel="apple-touch-icon" type="image/x-icon" href="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
	<meta property="og:image" content="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico"/>
	<!-- metadata -->
	<meta property="og:type" content="website"/>
	<meta property="og:updated_time" itemprop="dateUpdated" content="2019-04-29T17:33:18+09:00"/>
	<meta property="og:image" itemprop="image primaryImageOfPage" content="https://matsuand.github.io/docs.docker.jp.onthefly/images/docs@2x.png"/>
	<meta name="twitter:card" content="summary"/>
	<meta name="twitter:domain" content="docs.docker.jp"/>
	<meta name="twitter:site" content="@docker_docs"/>
	<meta name="twitter:url" content="https://twitter.com/docker_docs"/>
	<meta name="twitter:title" itemprop="title name" content="Use multi-stage builds"/>
	<meta name="twitter:description" property="og:description" itemprop="description" content="Multi-stage builds are a new feature requiring Docker 17.05 or higher on the daemon and client. Multistage builds are useful to anyone who has struggled to optimize Dockerfiles while keeping..." />
	<meta name="twitter:image:src" content="https://matsuand.github.io/docs.docker.jp.onthefly/images/docs@2x.png"/>
	<meta name="twitter:image:alt" content="Docker Documentation"/>
	<meta property="article:published_time" itemprop="datePublished" content="2019-04-29T17:33:18+09:00"/>

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="keywords" content="images, containers, best practices, multi-stage, multistage">
	<link rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/bootstrap.min.css">
	<link id="pygments" rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/pygments/perldoc.css">
	<link id="pagestyle" rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/style.css">

	<!-- Go get "Open Sans" font from Google -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
	<!-- SEO stuff -->
	<title>Use multi-stage builds | Docker Documentation</title>
<meta property="og:title" content="Use multi-stage builds" />
<meta property="og:locale" content="ja_JP" />
<meta name="description" content="Keeping your images small with multi-stage images" />
<meta property="og:description" content="Keeping your images small with multi-stage images" />
<link rel="canonical" href="https://matsuand.github.io/docs.docker.jp.onthefly/develop/develop-images/multistage-build/" />
<meta property="og:url" content="https://matsuand.github.io/docs.docker.jp.onthefly/develop/develop-images/multistage-build/" />
<meta property="og:site_name" content="Docker Documentation" />
<script type="application/ld+json">
{"@context":"http://schema.org","@type":"WebPage","headline":"Use multi-stage builds","description":"Keeping your images small with multi-stage images","url":"https://matsuand.github.io/docs.docker.jp.onthefly/develop/develop-images/multistage-build/"}</script>
	<!-- END SEO STUFF -->
	
	<script language="javascript">
	// Default to assuming this is an archive and hiding some stuff
	// See js/archive.js and js/docs.js for logic relating to this
	var isArchive = true;
	var dockerVersion = 'v18.09';
	</script>
</head>
<body ng-app="Docker" ng-controller="DockerController" class="colums">
	<header>
		 <nav class="nav-secondary navbar navbar-fixed-top">
    <!-- <div class="fan"></div> -->
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="https://matsuand.github.io/docs.docker.jp.onthefly/"><img class="logo" src="https://matsuand.github.io/docs.docker.jp.onthefly/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs"></a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="search-form" id="search-div" style="visibility: hidden">
    <form class="search-form form-inline ng-pristine ng-valid" /id="searchForm" action="/docs.docker.jp.onthefly/search/">
        <input class="search-field form-control ds-input" id="st-search-input" value="" name="q" placeholder="文書内検索" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteContainer">
            <div id="autocompleteResults"></div>
        </div>
        <!-- <button type="submit" class="search-submit btn btn-default">検索</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container">
    <div id="tabs">
        <ul class="tabs" id="jsTOCHorizontal">

        </ul>
    </div>
    <div class="ctrl-right hidden-xs hidden-sm">
        <a href="javascript:void(0)" id="menu-toggle"><i class="fa fa-indent" aria-hidden="true"></i></a>
        <div class="btn-group" style="visibility: hidden">
  <button type="button" class="btn btn-default dropdown-btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Docker v18.09 (current)        <span class="caret"></span>
  </button>
  <ul class="dropdown-menu">
    <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/edge/">Docker edge</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v18.03/">Docker v18.03</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.12/">Docker v17.12</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.09/">Docker v17.09</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.06/">Docker v17.06</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.03/">Docker v17.03</a></li>
  </ul>
</div>

    </div>
</div>

        </div>
    </div>
</nav>

	</header>

	<div class="wrapper right-open">
		<div class="container-fluid">
			<div class="row">
				<div class="col-body">
					<main class="col-content content">
						<section class="section">
							
								
							<h1>Use multi-stage builds</h1>  <span class="reading-time" title="Estimated reading time">
  <span class="reading-time-label">読む時間の目安: </span>
  
  
    6 分
  
</span>

							
							
							<p>Multi-stage builds are a new feature requiring Docker 17.05 or higher on the
daemon and client. Multistage builds are useful to anyone who has struggled to
optimize Dockerfiles while keeping them easy to read and maintain.</p>

<blockquote>
  <p><strong>Acknowledgment</strong>:
Special thanks to <a href="https://twitter.com/alexellisuk">Alex Ellis</a> for granting
permission to use his blog post
<a href="http://blog.alexellis.io/mutli-stage-docker-builds/">Builder pattern vs. Multi-stage builds in Docker</a>
as the basis of the examples below.</p>
</blockquote>

<h2 id="before-multi-stage-builds">Before multi-stage builds</h2>

<p>One of the most challenging things about building images is keeping the image
size down. Each instruction in the Dockerfile adds a layer to the image, and you
need to remember to clean up any artifacts you don’t need before moving on to
the next layer. To write a really efficient Dockerfile, you have traditionally
needed to employ shell tricks and other logic to keep the layers as small as
possible and to ensure that each layer has the artifacts it needs from the
previous layer and nothing else.</p>

<p>It was actually very common to have one Dockerfile to use for development (which
contained everything needed to build your application), and a slimmed-down one
to use for production, which only contained your application and exactly what
was needed to run it. This has been referred to as the “builder
pattern”. Maintaining two Dockerfiles is not ideal.</p>

<p>Here’s an example of a <code class="highlighter-rouge">Dockerfile.build</code> and <code class="highlighter-rouge">Dockerfile</code> which adhere to the
builder pattern above:</p>

<p><strong><code class="highlighter-rouge">Dockerfile.build</code></strong>:</p>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">FROM</span> <span class="n">golang</span>:<span class="m">1</span>.<span class="m">7</span>.<span class="m">3</span>
<span class="n">WORKDIR</span> /<span class="n">go</span>/<span class="n">src</span>/<span class="n">github</span>.<span class="n">com</span>/<span class="n">alexellis</span>/<span class="n">href</span>-<span class="n">counter</span>/
<span class="n">COPY</span> <span class="n">app</span>.<span class="n">go</span> .
<span class="n">RUN</span> <span class="n">go</span> <span class="n">get</span> -<span class="n">d</span> -<span class="n">v</span> <span class="n">golang</span>.<span class="n">org</span>/<span class="n">x</span>/<span class="n">net</span>/<span class="n">html</span> \
  &amp;&amp; <span class="n">CGO_ENABLED</span>=<span class="m">0</span> <span class="n">GOOS</span>=<span class="n">linux</span> <span class="n">go</span> <span class="n">build</span> -<span class="n">a</span> -<span class="n">installsuffix</span> <span class="n">cgo</span> -<span class="n">o</span> <span class="n">app</span> .
</code></pre></div></div>

<p>Notice that this example also artificially compresses two <code class="highlighter-rouge">RUN</code> commands together
using the Bash <code class="highlighter-rouge">&amp;&amp;</code> operator, to avoid creating an additional layer in the image.
This is failure-prone and hard to maintain. It’s easy to insert another command
and forget to continue the line using the <code class="highlighter-rouge">\</code> character, for example.</p>

<p><strong><code class="highlighter-rouge">Dockerfile</code></strong>:</p>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">FROM</span> <span class="n">alpine</span>:<span class="n">latest</span>
<span class="n">RUN</span> <span class="n">apk</span> --<span class="n">no</span>-<span class="n">cache</span> <span class="n">add</span> <span class="n">ca</span>-<span class="n">certificates</span>
<span class="n">WORKDIR</span> /<span class="n">root</span>/
<span class="n">COPY</span> <span class="n">app</span> .
<span class="n">CMD</span> [<span class="s2">"./app"</span>]
</code></pre></div></div>

<p><strong><code class="highlighter-rouge">build.sh</code></strong>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/sh</span>
<span class="nb">echo </span>Building alexellis2/href-counter:build

docker build <span class="nt">--build-arg</span> <span class="nv">https_proxy</span><span class="o">=</span><span class="nv">$https_proxy</span> <span class="nt">--build-arg</span> <span class="nv">http_proxy</span><span class="o">=</span><span class="nv">$http_proxy</span> <span class="se">\</span>
    <span class="nt">-t</span> alexellis2/href-counter:build <span class="nb">.</span> <span class="nt">-f</span> Dockerfile.build

docker container create <span class="nt">--name</span> extract alexellis2/href-counter:build
docker container cp extract:/go/src/github.com/alexellis/href-counter/app ./app
docker container rm <span class="nt">-f</span> extract

<span class="nb">echo </span>Building alexellis2/href-counter:latest

docker build <span class="nt">--no-cache</span> <span class="nt">-t</span> alexellis2/href-counter:latest <span class="nb">.</span>
rm ./app
</code></pre></div></div>

<p>When you run the <code class="highlighter-rouge">build.sh</code> script, it needs to build the first image, create
a container from it to copy the artifact out, then build the second
image. Both images take up room on your system and you still have the <code class="highlighter-rouge">app</code>
artifact on your local disk as well.</p>

<p>Multi-stage builds vastly simplify this situation!</p>

<h2 id="use-multi-stage-builds">Use multi-stage builds</h2>

<p>With multi-stage builds, you use multiple <code class="highlighter-rouge">FROM</code> statements in your Dockerfile.
Each <code class="highlighter-rouge">FROM</code> instruction can use a different base, and each of them begins a new
stage of the build. You can selectively copy artifacts from one stage to
another, leaving behind everything you don’t want in the final image. To show
how this works, let’s adapt the Dockerfile from the previous section to use
multi-stage builds.</p>

<p><strong><code class="highlighter-rouge">Dockerfile</code></strong>:</p>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">FROM</span> <span class="n">golang</span>:<span class="m">1</span>.<span class="m">7</span>.<span class="m">3</span>
<span class="n">WORKDIR</span> /<span class="n">go</span>/<span class="n">src</span>/<span class="n">github</span>.<span class="n">com</span>/<span class="n">alexellis</span>/<span class="n">href</span>-<span class="n">counter</span>/
<span class="n">RUN</span> <span class="n">go</span> <span class="n">get</span> -<span class="n">d</span> -<span class="n">v</span> <span class="n">golang</span>.<span class="n">org</span>/<span class="n">x</span>/<span class="n">net</span>/<span class="n">html</span>
<span class="n">COPY</span> <span class="n">app</span>.<span class="n">go</span> .
<span class="n">RUN</span> <span class="n">CGO_ENABLED</span>=<span class="m">0</span> <span class="n">GOOS</span>=<span class="n">linux</span> <span class="n">go</span> <span class="n">build</span> -<span class="n">a</span> -<span class="n">installsuffix</span> <span class="n">cgo</span> -<span class="n">o</span> <span class="n">app</span> .

<span class="n">FROM</span> <span class="n">alpine</span>:<span class="n">latest</span>
<span class="n">RUN</span> <span class="n">apk</span> --<span class="n">no</span>-<span class="n">cache</span> <span class="n">add</span> <span class="n">ca</span>-<span class="n">certificates</span>
<span class="n">WORKDIR</span> /<span class="n">root</span>/
<span class="n">COPY</span> --<span class="n">from</span>=<span class="m">0</span> /<span class="n">go</span>/<span class="n">src</span>/<span class="n">github</span>.<span class="n">com</span>/<span class="n">alexellis</span>/<span class="n">href</span>-<span class="n">counter</span>/<span class="n">app</span> .
<span class="n">CMD</span> [<span class="s2">"./app"</span>]
</code></pre></div></div>

<p>You only need the single Dockerfile. You don’t need a separate build script,
either. Just run <code class="highlighter-rouge">docker build</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker build <span class="nt">-t</span> alexellis2/href-counter:latest <span class="nb">.</span>
</code></pre></div></div>

<p>The end result is the same tiny production image as before, with a
significant reduction in complexity. You don’t need to create any intermediate
images and you don’t need to extract any artifacts to your local system at all.</p>

<p>How does it work? The second <code class="highlighter-rouge">FROM</code> instruction starts a new build stage with
the <code class="highlighter-rouge">alpine:latest</code> image as its base. The <code class="highlighter-rouge">COPY --from=0</code> line copies just the
built artifact from the previous stage into this new stage. The Go SDK and any
intermediate artifacts are left behind, and not saved in the final image.</p>

<h2 id="name-your-build-stages">Name your build stages</h2>

<p>By default, the stages are not named, and you refer to them by their integer
number, starting with 0 for the first <code class="highlighter-rouge">FROM</code> instruction. However, you can
name your stages, by adding an <code class="highlighter-rouge">as &lt;NAME&gt;</code> to the <code class="highlighter-rouge">FROM</code> instruction. This
example improves the previous one by naming the stages and using the name in
the <code class="highlighter-rouge">COPY</code> instruction. This means that even if the instructions in your
Dockerfile are re-ordered later, the <code class="highlighter-rouge">COPY</code> doesn’t break.</p>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">FROM</span> <span class="n">golang</span>:<span class="m">1</span>.<span class="m">7</span>.<span class="m">3</span> <span class="n">as</span> <span class="n">builder</span>
<span class="n">WORKDIR</span> /<span class="n">go</span>/<span class="n">src</span>/<span class="n">github</span>.<span class="n">com</span>/<span class="n">alexellis</span>/<span class="n">href</span>-<span class="n">counter</span>/
<span class="n">RUN</span> <span class="n">go</span> <span class="n">get</span> -<span class="n">d</span> -<span class="n">v</span> <span class="n">golang</span>.<span class="n">org</span>/<span class="n">x</span>/<span class="n">net</span>/<span class="n">html</span>
<span class="n">COPY</span> <span class="n">app</span>.<span class="n">go</span>    .
<span class="n">RUN</span> <span class="n">CGO_ENABLED</span>=<span class="m">0</span> <span class="n">GOOS</span>=<span class="n">linux</span> <span class="n">go</span> <span class="n">build</span> -<span class="n">a</span> -<span class="n">installsuffix</span> <span class="n">cgo</span> -<span class="n">o</span> <span class="n">app</span> .

<span class="n">FROM</span> <span class="n">alpine</span>:<span class="n">latest</span>
<span class="n">RUN</span> <span class="n">apk</span> --<span class="n">no</span>-<span class="n">cache</span> <span class="n">add</span> <span class="n">ca</span>-<span class="n">certificates</span>
<span class="n">WORKDIR</span> /<span class="n">root</span>/
<span class="n">COPY</span> --<span class="n">from</span>=<span class="n">builder</span> /<span class="n">go</span>/<span class="n">src</span>/<span class="n">github</span>.<span class="n">com</span>/<span class="n">alexellis</span>/<span class="n">href</span>-<span class="n">counter</span>/<span class="n">app</span> .
<span class="n">CMD</span> [<span class="s2">"./app"</span>]
</code></pre></div></div>

<h2 id="stop-at-a-specific-build-stage">Stop at a specific build stage</h2>

<p>When you build your image, you don’t necessarily need to build the entire
Dockerfile including every stage. You can specify a target build stage. The
following command assumes you are using the previous <code class="highlighter-rouge">Dockerfile</code> but stops at
the stage named <code class="highlighter-rouge">builder</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker build <span class="nt">--target</span> builder <span class="nt">-t</span> alexellis2/href-counter:latest <span class="nb">.</span>
</code></pre></div></div>

<p>A few scenarios where this might be very powerful are:</p>

<ul>
  <li>Debugging a specific build stage</li>
  <li>Using a <code class="highlighter-rouge">debug</code> stage with all debugging symbols or tools enabled, and a
lean <code class="highlighter-rouge">production</code> stage</li>
  <li>Using a <code class="highlighter-rouge">testing</code> stage in which your app gets populated with test data, but
building for production using a different stage which uses real data</li>
</ul>

<h2 id="use-an-external-image-as-a-stage">Use an external image as a “stage”</h2>

<p>When using multi-stage builds, you are not limited to copying from stages you
created earlier in your Dockerfile. You can use the <code class="highlighter-rouge">COPY --from</code> instruction to
copy from a separate image, either using the local image name, a tag available
locally or on a Docker registry, or a tag ID. The Docker client pulls the image
if necessary and copies the artifact from there. The syntax is:</p>

<pre><code class="language-Dockerfile">COPY --from=nginx:latest /etc/nginx/nginx.conf /nginx.conf
</code></pre>


							<!-- tags -->
							
							
							
							<span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span style="vertical-align: 2px"><a href="https://matsuand.github.io/docs.docker.jp.onthefly/glossary/?term=images">images</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/glossary/?term=containers">containers</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/glossary/?term=best practices">best practices</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/glossary/?term=multi-stage">multi-stage</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/glossary/?term=multistage">multistage</a></span>
							
							<!-- link corrections -->
              <script language="JavaScript">
							var x = document.links.length;
							var baseHref = document.getElementsByTagName('base')[0].href
							for (i = 0; i < x; i++) {
							  var munged = false;
							  var thisHREF = document.links[i].href;
							  var originalURL = "/develop/develop-images/multistage-build/";
							  if (thisHREF.indexOf(baseHref + "#") > -1) {
							    // hash fix
							    //console.log('BEFORE: base:',baseHref,'thisHREF:',thisHREF,'originalURL:',originalURL);
							    thisHREF = originalURL + thisHREF.replace(baseHref, "");
							    //console.log('AFTER: base:',baseHref,'thisHREF:',thisHREF,'originalURL:',originalURL);
							  }
							  if ((thisHREF.indexOf(window.location.hostname) > -1 || thisHREF.indexOf('http') == -1) && document.links[i].className.indexOf("nomunge") < 0) {
							    munged = true;
							    thisHREF = thisHREF.replace(".md", "/").replace("/index/", "/");
							    document.links[i].setAttribute('href', thisHREF);
							  }
							}
							</script>
							
						  <div id="ratings-div" style="color:#b9c2cc; text-align: center; margin-top: 150px; visibility: hidden">
								<div id="pd_rating_holder_8453675"></div>
								<script type="text/javascript">
									PDRTJS_settings_8453675 = {
										"id": "8453675",
										"unique_id": "develop/develop-images/multistage-build.md",
										"title": "Use multi-stage builds",
										"permalink": "https://github.com/docker/docker.github.io/blob/master/develop/develop-images/multistage-build.md"
									};
									(function(d, c, j) {
										if (!document.getElementById(j)) {
											var pd = d.createElement(c),
												s;
											pd.id = j;
											pd.src = ('https:' == document.location.protocol) ? 'https://polldaddy.com/js/rating/rating.js' : 'http://i0.poll.fm/js/rating/rating.js';
											s = document.getElementsByTagName(c)[0];
											s.parentNode.insertBefore(pd, s);
										}
									}(document, 'script', 'pd-rating-js'));
								</script>
							</div>
							
						</section>
					</main>
					<nav class="col-nav">
						<div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
						<div id="navbar" class="nav-sidebar">
    <ul class="nav" id="jsTOCLeftNav">
    </ul>
</div>

						</div>
					</nav>
					<div class="col-toc">
							<div class="sidebar hidden-xs hidden-sm">
							<div class="toc-nav">
								<div class="feedback-links">
									<ul>
										
										<li style="visibility: hidden"><a href="https://github.com/matsuand/docs.docker.jp/edit/v18.09.local/develop/develop-images/multistage-build.md"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> このページの編集</a></li>
										<li><a href="https://github.com/matsuand/docs.docker.jp.onthefly/issues/new?body=File: [develop/develop-images/multistage-build.md](https://matsuand.github.io/docs.docker.jp.onthefly/develop/develop-images/multistage-build/)"
															class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> 文書変更のリクエスト</a></li>
										<li><a href="https://success.docker.com/support"><i class="fa fa-question" aria-hidden="true"></i> サポート依頼</a></li>
										<!-- toggle mode -->
										<li>
											<div class="toggle-mode">
												<div class="icon">
													<i class="fa fa-sun-o" aria-hidden="true"></i>
												</div>
												<div class="toggle-switch">
													<label class="switch">
														<input type="checkbox" id="switch-style">
														<div class="slider round"></div>
												</label>
												</div>
												<div class="icon">
													<i class="fa fa-moon-o" aria-hidden="true"></i>
												</div>
											</div>
										</li>
									</ul>
								</div>
								   
									<div id="side-toc-title">本ページ内</div>
									
<ul id="my_toc" class="inline_toc">
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/develop/develop-images/multistage-build/#before-multi-stage-builds" class="nomunge">Before multi-stage builds</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/develop/develop-images/multistage-build/#use-multi-stage-builds" class="nomunge">Use multi-stage builds</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/develop/develop-images/multistage-build/#name-your-build-stages" class="nomunge">Name your build stages</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/develop/develop-images/multistage-build/#stop-at-a-specific-build-stage" class="nomunge">Stop at a specific build stage</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/develop/develop-images/multistage-build/#use-an-external-image-as-a-stage" class="nomunge">Use an external image as a “stage”</a></li>
</ul>


								</div>
								
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	
	<footer class="footer">
		  
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/what-docker">What is Docker</a></li>
                        <li><a href="https://www.docker.com/what-container">What is a Container</a></li>
                        <li><a href="https://www.docker.com/use-cases">Use Cases</a></li>
                        <li><a href="https://www.docker.com/customers">Customers</a></li>
                        <li><a href="https://www.docker.com/partners/partner-program">Partners</a></li>
                        <li class="break"><a href="https://www.docker.com/industry-government">For Government</a></li>
                        <li><a href="https://www.docker.com/company">About Docker</a></li>
                        <li><a href="https://www.docker.com/company/management">Management</a></li>
                        <li><a href="https://www.docker.com/company/news-and-press">Press &amp; News</a></li>
                        <li><a href="https://www.docker.com/careers">Careers</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/products/overview">Product</a></li>
                        <li><a href="https://www.docker.com/pricing">Pricing</a></li>
                        <li><a href="https://www.docker.com/docker-community">Community Edition</a></li>
                        <li class="break"><a href="https://www.docker.com/enterprise">Enterprise Edition </a></li>
                        <li><a href="https://www.docker.com/products/docker-datacenter">Docker Datacenter</a></li>
                        <li><a href="https://hub.docker.com/">Docker Hub</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/">Documentation</a></li>
                        <li><a href="https://www.docker.com/docker">Learn</a></li>
                        <li><a href="https://blog.docker.com" target="_blank">Blog</a></li>
                        <li><a href="https://engineering.docker.com" target="_blank">Engineering Blog</a></li>
                        <li><a href="https://training.docker.com/" target="_blank">Training</a></li>
                        <li><a href="https://success.docker.com/support">Support</a></li>
                        <li><a href="https://success.docker.com/kbase">Knowledge Base</a></li>
                        <li><a href="https://www.docker.com/products/resources">Resources</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/docker-community">Community</a></li>
                        <li><a href="https://www.docker.com/technologies/overview">Open Source</a></li>
                        <li><a href="https://www.docker.com/community/events">Events</a></li>
                        <li><a href="https://forums.docker.com/" target="_blank">Forums</a></li>
                        <li><a href="https://www.docker.com/community/docker-captains">Docker Captains</a></li>
                        <li><a href="https://www.docker.com/docker-community/scholarships">Scholarships</a></li>
                        <li><a href="https://blog.docker.com/curated/">Community News</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="http://status.docker.com/">Status</a></li>
                        <li><a href="https://www.docker.com/docker-security">Security</a></li>
                        <li><a href="https://www.docker.com/legal">Legal</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2019 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="http://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="http://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-google-plus"><a href="https://plus.google.com/u/0/communities/108146856671494713993">Google</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker/docker">Github</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-reddit"><a href="http://www.reddit.com/r/docker">Reddit</a></li>
                    <li class="fa fa-slideshare"><a href="http://www.slideshare.net/docker">Slideshare</a></li>
                </ul>
            </div>
        </div>
    </div>

	</footer>
	<link rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/github.css">
	
	<!-- <script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/anchorlinks.js"></script> -->
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/menu.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/jquery.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/bootstrap.min.js"></script>
	<!-- Always include the archive.js, but it doesn't do much unless we are an archive -->
	<script language="javascript">
	// Default to assuming this is an archive and hiding some stuff
	// See js/archive.js and js/docs.js for logic relating to this
	var isArchive = true;
	var dockerVersion = 'v18.09';
	// In archives, we need to know the page root and we get it from JEKYLL_ENV in the jekyll build command
	var jekyllEnv = 'development';
	// If unset (in non-archive branches), defaults to "development". In that case, reset it to empty
	if (jekyllEnv == 'development') {
		jekyllEnv = '';
	}
	var pageURL = jekyllEnv + '/develop/develop-images/multistage-build/';
	</script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/archive.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/stickyfill.min.js"></script>
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/metadata.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/glossary.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/collections_tocs.js"></script>
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/docs.js"></script>
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/toc.js"></script>
	<script language="javascript">
	jQuery(document).ready(function(){
				hookupTOCEvents();
			});
	</script>
</body>

</html>
