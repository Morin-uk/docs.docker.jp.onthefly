<!-- Page generated 2019-07-14 17:21:52 +0900 -->
<!-- relative link basehrefs -->

	
	
	
		
			
		
	
		
			
		
	
		
			
			


<!-- Logic for 'edit this button' -->


	

	

	

	

	

	

	

	

	


<!-- End of logic for 'edit this button' -->


<!DOCTYPE html>
<html lang="ja">

<head>
	<base href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/" />
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<style type="text/css">
		@charset "UTF-8";
		[ng\:cloak],
		[ng-cloak],
		[data-ng-cloak],
		[x-ng-cloak],
		.ng-cloak,
		.x-ng-cloak,
		.ng-hide:not(.ng-hide-animate) {
			display: none !important;
		}

		ng\:form {
			display: block;
		}
	</style>
	<script type="text/javascript">
	  !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="4.0.0";
	  analytics.load("IWj9D0UpZHZdZUZX9jl98PcpBFWBnBMy");
	  analytics.page();
	  }}();
	</script>
	
	<!-- favicon -->
	<link rel="icon" type="image/x-icon" href="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
	<meta name="msapplication-TileImage" content="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico">
	<link rel="apple-touch-icon" type="image/x-icon" href="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico" sizes="129x128">
	<meta property="og:image" content="https://matsuand.github.io/docs.docker.jp.onthefly/favicons/docs@2x.ico"/>
	<!-- metadata -->
	<meta property="og:type" content="website"/>
	<meta property="og:updated_time" itemprop="dateUpdated" content="2019-07-14T17:21:52+09:00"/>
	<meta property="og:image" itemprop="image primaryImageOfPage" content="https://matsuand.github.io/docs.docker.jp.onthefly/images/docs@2x.png"/>
	<meta name="twitter:card" content="summary"/>
	<meta name="twitter:domain" content="docs.docker.jp"/>
	<meta name="twitter:site" content="@docker_docs"/>
	<meta name="twitter:url" content="https://twitter.com/docker_docs"/>
	<meta name="twitter:title" itemprop="title name" content="Compose ファイル バージョン 2 リファレンス"/>
	<meta name="twitter:description" property="og:description" itemprop="description" content="リファレンスとガイドライン ここに示す内容は Compose ファイルフォーマット、バージョン 2 です。 Compose と Docker の互換マトリックス Compose ファイルフォーマットには 1、2、2.x、3.x という複数のバージョンがあります。 その様子は以下の一覧表に見ることができます。 各バージョンにて何が増えたのか、どのようにアップグレードしたのか、といった詳細については バージョンとアップグレードについてを参照してください。 以下の一覧表は、Compose ファイルのどのバージョンが Docker リリースをサポートしているかを示すものです。 Compose ファイルフォーマット Docker Engine リリース 3.7 18.06.0 以上 3.6..." />
	<meta name="twitter:image:src" content="https://matsuand.github.io/docs.docker.jp.onthefly/images/docs@2x.png"/>
	<meta name="twitter:image:alt" content="Docker Documentation"/>
	<meta property="article:published_time" itemprop="datePublished" content="2019-07-14T17:21:52+09:00"/>

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="keywords" content="fig, composition, compose version 3, docker">
	<link rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/bootstrap.min.css">
	<link id="pygments" rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/pygments/perldoc.css">
	<link id="pagestyle" rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/style.css">

	<!-- Go get "Open Sans" font from Google -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
	<!-- SEO stuff -->
	<title>Compose ファイル バージョン 2 リファレンス | Docker Documentation</title>
<meta property="og:title" content="Compose ファイル バージョン 2 リファレンス" />
<meta property="og:locale" content="ja_JP" />
<meta name="description" content="Compose ファイルリファレンス" />
<meta property="og:description" content="Compose ファイルリファレンス" />
<link rel="canonical" href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/" />
<meta property="og:url" content="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/" />
<meta property="og:site_name" content="Docker Documentation" />
<script type="application/ld+json">
{"@context":"http://schema.org","@type":"WebPage","headline":"Compose ファイル バージョン 2 リファレンス","description":"Compose ファイルリファレンス","url":"https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/"}</script>
	<!-- END SEO STUFF -->
	
	<script language="javascript">
	// Default to assuming this is an archive and hiding some stuff
	// See js/archive.js and js/docs.js for logic relating to this
	var isArchive = true;
	var dockerVersion = 'v18.09';
	</script>
</head>
<body ng-app="Docker" ng-controller="DockerController" class="colums">
	<header>
		 <nav class="nav-secondary navbar navbar-fixed-top">
    <!-- <div class="fan"></div> -->
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="https://matsuand.github.io/docs.docker.jp.onthefly/"><img class="logo" src="https://matsuand.github.io/docs.docker.jp.onthefly/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs"></a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="search-form" id="search-div" style="visibility: hidden">
    <form class="search-form form-inline ng-pristine ng-valid" /id="searchForm" action="/docs.docker.jp.onthefly/search/">
        <input class="search-field form-control ds-input" id="st-search-input" value="" name="q" placeholder="文書内検索" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteContainer">
            <div id="autocompleteResults"></div>
        </div>
        <!-- <button type="submit" class="search-submit btn btn-default">検索</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container">
    <div id="tabs">
        <ul class="tabs" id="jsTOCHorizontal">

        </ul>
    </div>
    <div class="ctrl-right hidden-xs hidden-sm">
        <a href="javascript:void(0)" id="menu-toggle"><i class="fa fa-indent" aria-hidden="true"></i></a>
        <div class="btn-group" style="visibility: hidden">
  <button type="button" class="btn btn-default dropdown-btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Docker v18.09 (current)        <span class="caret"></span>
  </button>
  <ul class="dropdown-menu">
    <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/edge/">Docker edge</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v18.03/">Docker v18.03</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.12/">Docker v17.12</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.09/">Docker v17.09</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.06/">Docker v17.06</a></li><li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/v17.03/">Docker v17.03</a></li>
  </ul>
</div>

    </div>
</div>

        </div>
    </div>
</nav>

	</header>

	<div class="wrapper right-open">
		<div class="container-fluid">
			<div class="row">
				<div class="col-body">
					<main class="col-content content">
						<section class="section">
							
								
							<h1>Compose ファイル バージョン 2 リファレンス</h1>  <span class="reading-time" title="Estimated reading time">
  <span class="reading-time-label">読む時間の目安: </span>
  
  
    24 分
  
</span>

							
							
							
<h2 id="reference-and-guidelines">リファレンスとガイドライン</h2>

<p>ここに示す内容は Compose ファイルフォーマット、バージョン 2 です。</p>

<h2 id="compose-and-docker-compatibility-matrix">Compose と Docker の互換マトリックス</h2>

<p>Compose ファイルフォーマットには 1、2、2.x、3.x という複数のバージョンがあります。
その様子は以下の一覧表に見ることができます。
各バージョンにて何が増えたのか、どのようにアップグレードしたのか、といった詳細については <strong><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/">バージョンとアップグレードについて</a></strong>を参照してください。</p>

<p>以下の一覧表は、Compose ファイルのどのバージョンが Docker リリースをサポートしているかを示すものです。</p>

<table>
  <thead>
    <tr>
      <th><strong>Compose ファイルフォーマット</strong></th>
      <th><strong>Docker Engine リリース</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>3.7</td>
      <td>18.06.0 以上</td>
    </tr>
    <tr>
      <td>3.6</td>
      <td>18.02.0 以上</td>
    </tr>
    <tr>
      <td>3.5</td>
      <td>17.12.0 以上</td>
    </tr>
    <tr>
      <td>3.4</td>
      <td>17.09.0 以上</td>
    </tr>
    <tr>
      <td>3.3</td>
      <td>17.06.0 以上</td>
    </tr>
    <tr>
      <td>3.2</td>
      <td>17.04.0 以上</td>
    </tr>
    <tr>
      <td>3.1</td>
      <td>1.13.1 以上</td>
    </tr>
    <tr>
      <td>3.0</td>
      <td>1.13.0 以上</td>
    </tr>
    <tr>
      <td>2.4</td>
      <td>17.12.0 以上</td>
    </tr>
    <tr>
      <td>2.3</td>
      <td>17.06.0 以上</td>
    </tr>
    <tr>
      <td>2.2</td>
      <td>1.13.0 以上</td>
    </tr>
    <tr>
      <td>2.1</td>
      <td>1.12.0 以上</td>
    </tr>
    <tr>
      <td>2.0</td>
      <td>1.10.0 以上</td>
    </tr>
    <tr>
      <td>1.0</td>
      <td>1.9.1. 以上</td>
    </tr>
  </tbody>
</table>

<p>この表に示している Compose のファイルフォーマットバージョンに加えて、Compose そのもののリリーススケジュールがあります。
詳しくは <a href="https://github.com/docker/compose/releases/">Compose リリース</a>に示されています。
しかしファイルフォーマットのバージョンは、個々のリリースに合わせてバージョンアップする必要がありません。
たとえば Compose ファイルフォーマット 3.0 が初めて導入されたのは  <a href="https://github.com/docker/compose/releases/tag/1.10.0">Compose リリース 1.10.0</a> ですが、その後のリリースの中で、徐々にバージョンアップを行ってきています。</p>

<h2 id="service-configuration-reference">サービス設定リファレンス</h2>

<p>Compose ファイルは <a href="http://yaml.org/">YAML</a> 形式のファイルであり、<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#service-configuration-reference">サービス（services）</a>、<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#network-configuration-reference">ネットワーク（networks）</a>、<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#volume-configuration-reference">ボリューム（volumes）</a>を定義します。
Compose ファイルのデフォルトパスは <code class="highlighter-rouge">./docker-compose.yml</code> です。</p>

<blockquote>
  <p><strong>ヒント</strong>: このファイルの拡張子は <code class="highlighter-rouge">.yml</code> と <code class="highlighter-rouge">.yaml</code> のどちらでも構いません。
いずれでも動作します。</p>
</blockquote>

<p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/glossary.md#container">コンテナー</a> の定義とは、対応するサービスを起動する各コンテナーに適用される設定を行うことです。
コマンドラインから <code class="highlighter-rouge">docker run</code> のパラメーターを受け渡すことと、非常によく似ています。
同様に、ネットワークの定義、ボリュームの定義は、それぞれ <code class="highlighter-rouge">docker network create</code> と <code class="highlighter-rouge">docker volume create</code> のコマンドに対応づくものです。</p>

<p><code class="highlighter-rouge">docker run</code> に関しても同じことが言えますが、Dockerfile にて指定された <code class="highlighter-rouge">CMD</code>、<code class="highlighter-rouge">EXPOSE</code>、<code class="highlighter-rouge">VOLUME</code>、<code class="highlighter-rouge">ENV</code> のようなオプションはデフォルトでは維持されます。したがって <code class="highlighter-rouge">docker-compose.yml</code> の中で再度設定する必要はありません。</p>

<p>設定を記述する際には環境変数を用いることができます。
環境変数は Bash 風に <code class="highlighter-rouge">${VARIABLE}</code> のように記述します。
詳しくは<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#variable-substitution">変数の置換</a>を参照してください。</p>

<p>このセクションでは、バージョン 2 のサービス定義においてサポートされている設定オプションをすべて説明しています。</p>

<h3 id="blkio_config">blkio_config</h3>

<p>サービスのブロック IO に対する制限を行う設定オプションです。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: "2.4"
services:
  foo:
    image: busybox
    blkio_config:
      weight: 300
      weight_device:
        - path: /dev/sda
          weight: 400
      device_read_bps:
        - path: /dev/sdb
          rate: '12mb'
      device_read_iops:
        - path: /dev/sdb
          rate: 120
      device_write_bps:
        - path: /dev/sdb
          rate: '1024k'
      device_write_iops:
        - path: /dev/sdb
          rate: 30
</code></pre></div></div>

<h4 id="device_read_bps-device_write_bps">device_read_bps, device_write_bps</h4>

<p>指定されたデバイス上での読み書き操作に対して、秒ごとのバイト上限値を設定します。
設定するリストの各項目には、以下の 2 つのキーが必要です。</p>

<ul>
  <li><code class="highlighter-rouge">path</code>, 影響を受けるデバイスへのシンボリックパスを指定します。</li>
  <li><code class="highlighter-rouge">rate</code>, バイト数を表わす整数値、または <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#specifying-byte-values">バイト値</a> を表現する文字列を指定します。</li>
</ul>

<h4 id="device_read_iops-device_write_iops">device_read_iops, device_write_iops</h4>

<p>指定されたデバイス上での読み書き操作に対して、秒ごとの操作上限値を設定します。
設定するリストの各項目には、以下の 2 つのキーが必要です。</p>

<ul>
  <li><code class="highlighter-rouge">path</code>, 影響を受けるデバイスへのシンボリックパスを指定します。</li>
  <li><code class="highlighter-rouge">rate</code>, 許容する操作数を表わす整数値を指定します。</li>
</ul>

<h4 id="weight">weight</h4>

<p>他のサービスと比べたときの、当サービスに割り当てる処理性能比を設定します。
10 から 1000 までの整数値を割り当てるもので、デフォルト値は 500 です。</p>

<h4 id="weight_device">weight_device</h4>

<p>デバイスへの処理割り当て量を調整します。
設定するリストの各項目には、以下の 2 つのキーが必要です。</p>

<ul>
  <li><code class="highlighter-rouge">path</code>, 影響を受けるデバイスへのシンボリックパスを指定します。</li>
  <li><code class="highlighter-rouge">weight</code>, 10 から 1000 までの整数値を指定します。</li>
</ul>

<h3 id="build">build</h3>

<p>この設定オプションはビルド時に適用されます。</p>

<p><code class="highlighter-rouge">build</code> の指定は 1 つには、ビルドコンテキストへのパスを表わす文字列を指定します。
あるいは <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#context">context</a> の指定のもとにパスを指定し、オプションとして <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#dockerfile">Dockerfile</a> や <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#args">args</a> を記述する方法をとります。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>build: ./dir

build:
  context: ./dir
  dockerfile: Dockerfile-alternate
  args:
    buildno: 1
</code></pre></div></div>

<p><code class="highlighter-rouge">build</code> に加えて <code class="highlighter-rouge">image</code> も指定した場合、Compose はビルドイメージに名前をつけます。
たとえば以下のように <code class="highlighter-rouge">image</code> を指定すると、イメージ名を <code class="highlighter-rouge">webapp</code>、オプションのタグを <code class="highlighter-rouge">tag</code> という名前にします。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>build: ./dir
image: webapp:tag
</code></pre></div></div>

<p>結果としてイメージ名は <code class="highlighter-rouge">webapp</code> であり <code class="highlighter-rouge">tag</code> というタグづけが行われます。
そしてこのイメージは <code class="highlighter-rouge">./dir</code> から作り出されます。</p>

<h4 id="cache_from">cache_from</h4>

<blockquote>
  <p>ファイルフォーマット<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-22">バージョン 2.2</a> において追加されました。</p>
</blockquote>

<p>エンジンがキャッシュ解決のために利用するイメージを設定します。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>build:
  context: .
  cache_from:
    - alpine:latest
    - corp/web_app:3.14
</code></pre></div></div>

<h4 id="context">context</h4>

<blockquote>
  <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-2">ファイルフォーマットバージョン 2</a> またはそれ以降。
バージョン 1 の場合は <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#build">build</a> を用いてください。</p>
</blockquote>

<p>Dockerfile を含むディレクトリへのパスか、あるいは git リポジトリの URL を設定します。</p>

<p>設定された記述が相対パスを表わしている場合、Compose ファイルのあるディレクトリからの相対パスとして解釈されます。
このディレクトリはビルドコンテキストでもあり、Docker デーモンへ送信されるディレクトリです。</p>

<p>Compose は指定された名前により、イメージのビルドとタグづけを行い、後々これを利用します。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>build:
  context: ./dir
</code></pre></div></div>

<h4 id="dockerfile">dockerfile</h4>

<p>別の Dockerfile を指定します。</p>

<p>Compose は指定された別の Dockerfile を使ってビルドを行います。
このときは、ビルドパスを同時に指定しなければなりません。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>build:
  context: .
  dockerfile: Dockerfile-alternate
</code></pre></div></div>

<h4 id="args">args</h4>

<blockquote>
  <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-2">ファイルフォーマットバージョン 2</a> またはそれ以降。</p>
</blockquote>

<p>ビルド引数を追加します。
これは環境変数であり、ビルド処理の間だけ利用可能なものです。</p>

<p>Dockerfile 内にてはじめにビルド引数を指定します。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ARG buildno
ARG gitcommithash

RUN echo "Build number: $buildno"
RUN echo "Based on commit: $gitcommithash"
</code></pre></div></div>

<p>そして <code class="highlighter-rouge">build</code> キーのもとにその引数を指定します。
指定は個々をマッピングする形式か、リストとする形式が可能です。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>build:
  context: .
  args:
    buildno: 1
    gitcommithash: cdc3b19

build:
  context: .
  args:
    - buildno=1
    - gitcommithash=cdc3b19
</code></pre></div></div>

<blockquote>
  <p><strong>メモ</strong>: Dockerfile にて <code class="highlighter-rouge">FROM</code> 命令の前に <code class="highlighter-rouge">ARG</code> 命令を指定した場合、<code class="highlighter-rouge">FROM</code> 以降のビルド命令において <code class="highlighter-rouge">ARG</code> の値は利用することができません。
<code class="highlighter-rouge">FROM</code> の前後どこでも、そして特に <code class="highlighter-rouge">FROM</code> 命令の後でもその値を利用したい場合は、<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/builder/#understand-how-arg-and-from-interact">ARG と FROM の関連について</a>を参照してください。</p>
</blockquote>

<p>ビルド引数の指定にあたって、その値設定を省略することができます。
この場合、ビルド時におけるその値は、Compose を起動している環境での値になります。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>args:
  - buildno
  - gitcommithash
</code></pre></div></div>

<blockquote>
  <p><strong>メモ</strong>: YAML のブール値 (<code class="highlighter-rouge">true</code>, <code class="highlighter-rouge">false</code>, <code class="highlighter-rouge">yes</code>, <code class="highlighter-rouge">no</code>, <code class="highlighter-rouge">on</code>, <code class="highlighter-rouge">off</code>) を用いる場合は、クォートで囲む必要があります。
そうすることで、これらの値は文字列として解釈されます。</p>
</blockquote>

<h4 id="extra_hosts">extra_hosts</h4>

<p>ビルド時におけるホスト名のマッピングを追加します。
Docker Client の <code class="highlighter-rouge">--add-host</code> パラメーターと同じ値を設定してください。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>extra_hosts:
 - "somehost:162.242.195.82"
 - "otherhost:50.31.209.229"
</code></pre></div></div>

<p>ホスト名と IP アドレスによるこの設定内容は、サービスコンテナー内の <code class="highlighter-rouge">/etc/hosts</code> に追加されます。
たとえば以下のとおりです。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>162.242.195.82  somehost
50.31.209.229   otherhost
</code></pre></div></div>

<h4 id="isolation">isolation</h4>

<blockquote>
  <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-21">ファイルフォーマットバージョン 2.1</a> において追加されました。</p>
</blockquote>

<p>ビルドにおけるコンテナーの分離技術（isolation technology）を設定します。
Linux においてサポートされるのは <code class="highlighter-rouge">default</code> のみです。
Windows では <code class="highlighter-rouge">default</code>, <code class="highlighter-rouge">process</code>, <code class="highlighter-rouge">hyperv</code> の設定が可能です。
詳しくは <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/commandline/run.md#specify-isolation-technology-for-container---isolation">Docker Engine ドキュメント</a> を参照してください。</p>

<p>設定されていない場合、Compose は service 定義の中から <code class="highlighter-rouge">isolation</code> 値を見つけて、これをビルド時に利用する値とします。</p>

<h4 id="labels">labels</h4>

<blockquote>
  <p>ファイルフォーマット<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-21">バージョン 2.1</a> において追加されました。</p>
</blockquote>

<p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/userguide/labels-custom-metadata.md">Docker labels</a> を使ってビルドされるイメージにメタデータを追加します。
配列形式と辞書形式のいずれかにより指定します。</p>

<p>他のソフトウェアが用いるラベルとの競合を避けるため、逆 DNS 記法とすることをお勧めします。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>build:
  context: .
  labels:
    com.example.description: "Accounting webapp"
    com.example.department: "Finance"
    com.example.label-with-empty-value: ""


build:
  context: .
  labels:
    - "com.example.description=Accounting webapp"
    - "com.example.department=Finance"
    - "com.example.label-with-empty-value"
</code></pre></div></div>

<h4 id="network">network</h4>

<blockquote>
  <p>ファイルフォーマット<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-22">バージョン 2.2</a> において追加されました。</p>
</blockquote>

<p>ビルド時の <code class="highlighter-rouge">RUN</code> 命令において接続するネットワークコンテナーを設定します。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>build:
  context: .
  network: host


build:
  context: .
  network: custom_network_1
</code></pre></div></div>

<h4 id="shm_size">shm_size</h4>

<blockquote>
  <p>ファイルフォーマット<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-23">バージョン 2.3</a> において追加されました。</p>
</blockquote>

<p>このビルドコンテナーにおける <code class="highlighter-rouge">/dev/shm</code> パーティションのサイズを設定します。
指定する値は、バイト数を表わす整数値か、あるいは<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#specifying-byte-values">バイト表現</a>によって表わされる文字列とします。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>build:
  context: .
  shm_size: '2gb'


build:
  context: .
  shm_size: 10000000
</code></pre></div></div>

<h4 id="target">target</h4>

<blockquote>
  <p>ファイルフォーマット<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-23">バージョン 2.3</a> において追加されました。</p>
</blockquote>

<p><code class="highlighter-rouge">Dockerfile</code> 内部に定義されている特定のステージをビルドする方法は、<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/userguide/eng-image/multistage-build.md">マルチステージビルド</a>を参照してください。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  build:
    context: .
    target: prod
</code></pre></div></div>

<h3 id="cap_add-cap_drop">cap_add, cap_drop</h3>

<p>コンテナーケーパビリティーの機能を追加または削除します。
詳細な一覧は <code class="highlighter-rouge">man 7 capabilities</code> を参照してください。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cap_add:
  - ALL

cap_drop:
  - NET_ADMIN
  - SYS_ADMIN
</code></pre></div></div>

<h3 id="command">command</h3>

<p>デフォルトコマンドを上書きします。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>command: bundle exec thin -p 3000
</code></pre></div></div>

<p>このコマンドは <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/builder.md#cmd">dockerfile</a> の場合と同じように、リスト形式により指定することもできます。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>command: ["bundle", "exec", "thin", "-p", "3000"]
</code></pre></div></div>

<h3 id="cgroup_parent">cgroup_parent</h3>

<p>コンテナーに対して、オプションで指定する親の cgroup を指定します。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cgroup_parent: m-executor-abcd
</code></pre></div></div>

<h3 id="container_name">container_name</h3>

<p>デフォルトのコンテナー名ではない、独自のコンテナー名を設定します。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>container_name: my-web-container
</code></pre></div></div>

<p>Docker コンテナー名はユニークである必要があります。
そこで独自のコンテナー名を設定したときは、サービスをスケールアップして複数コンテナーとすることはできません。
これを行うとエラーが発生します。</p>

<h3 id="cpu_rt_runtime-cpu_rt_period">cpu_rt_runtime, cpu_rt_period</h3>

<blockquote>
  <p>ファイルフォーマット<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-22">バージョン 2.2</a> において追加されました。</p>
</blockquote>

<p>Docker デーモンのリアルタイムスケジューラーが利用する CPU 割り当てパラメーターを設定します。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cpu_rt_runtime: '400ms'
cpu_rt_period: '1400us'

# マイクロ秒単位で整数値を指定します。
cpu_rt_runtime: 95000
cpu_rt_period: 11000
</code></pre></div></div>

<h3 id="device_cgroup_rules">device_cgroup_rules</h3>

<blockquote>
  <p>ファイルフォーマット<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-23">バージョン 2.3</a> において追加されました。</p>
</blockquote>

<p>cgroup としてアクセス許可されているデバイスリストにルールを追加します。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>device_cgroup_rules:
  - 'c 1:3 mr'
  - 'a 7:* rmw'
</code></pre></div></div>

<h3 id="devices">devices</h3>

<p>デバイスのマッピングをリスト形式で設定します。
Docker クライアントの create オプションの <code class="highlighter-rouge">--device</code> と同じ書式にします。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>devices:
  - "/dev/ttyUSB0:/dev/ttyUSB0"
</code></pre></div></div>

<h3 id="depends_on">depends_on</h3>

<blockquote>
  <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-2">ファイルフォーマットバージョン 2</a> またはそれ以降。</p>
</blockquote>

<p>サービス間の依存関係を表わします。
これにより以下の 2 つの効果が表れます。</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">docker-compose up</code> は依存関係の順にサービスを起動します。
以下の例において <code class="highlighter-rouge">db</code> と <code class="highlighter-rouge">redis</code> は <code class="highlighter-rouge">web</code> の後に起動します。</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">docker-compose up SERVICE</code> を実行すると <code class="highlighter-rouge">SERVICE</code> における依存関係をもとに動作します。
以下の例において <code class="highlighter-rouge">docker-compose up web</code> を実行すると <code class="highlighter-rouge">db</code> と <code class="highlighter-rouge">redis</code> を生成して起動します。</p>
  </li>
</ul>

<p>以下がその簡単な例です。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: "2.4"
services:
  web:
    build: .
    depends_on:
      - db
      - redis
  redis:
    image: redis
  db:
    image: postgres
</code></pre></div></div>

<blockquote>
  <p><strong>メモ</strong>: <code class="highlighter-rouge">depends_on</code> では <code class="highlighter-rouge">db</code> や <code class="highlighter-rouge">redis</code> が「準備」状態になるのを待たずに、つまりそれらを開始したらすぐに <code class="highlighter-rouge">web</code> を起動します。
  準備状態になるのを待ってから次のサービスを起動することが必要な場合は、<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/startup-order.md">Compose における起動順の制御</a>にて示す内容と解決方法を確認してください。</p>
</blockquote>

<h3 id="healthcheck">healthcheck</h3>

<blockquote>
  <p>ファイルフォーマット<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-21">バージョン 2.1</a> において追加されました。</p>
</blockquote>

<p>ヘルスチェックは、依存するコンテナーが起動する場合には、別のコンテナーが「健康」（healthy）となることを待って起動するようにチェックすることを指します。
（「健康」であることは、ヘルスチェックによって正常な状態であることが示されたことを表わします。）</p>

<p>以下がその例です。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: "2.4"
services:
  web:
    build: .
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_started
  redis:
    image: redis
  db:
    image: redis
    healthcheck:
      test: "exit 0"
</code></pre></div></div>

<p>上の例において Compose は <code class="highlighter-rouge">redis</code> サービスが起動するのを待ちます（従来からの動作）。
さらに <code class="highlighter-rouge">db</code> サービスが「健康」になることを待って <code class="highlighter-rouge">web</code> サービスを起動します。</p>

<p>さらなる情報については <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#healthcheck">ヘルスチェックの節</a> を参照してください。</p>

<h3 id="dns">dns</h3>

<p>DNS サーバーを設定します。
設定は 1 つだけとするか、リストにすることができます。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dns: 8.8.8.8
dns:
  - 8.8.8.8
  - 9.9.9.9
</code></pre></div></div>

<h3 id="dns_opt">dns_opt</h3>

<p>コンテナーの <code class="highlighter-rouge">resolv.conf</code> ファイルに追加する独自の DNS オプションを、リスト形式で設定します。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dns_opt:
  - use-vc
  - no-tld-query
</code></pre></div></div>

<h3 id="dns_search">dns_search</h3>

<p>DNS 検索ドメインを設定します。
設定は 1 つだけとするか、リストにすることができます。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dns_search: example.com
dns_search:
  - dc1.example.com
  - dc2.example.com
</code></pre></div></div>

<h3 id="tmpfs">tmpfs</h3>

<p>コンテナー内においてテンポラリファイルシステムをマウントします。
設定は 1 つだけとするか、リストにすることができます。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tmpfs: /run
tmpfs:
  - /run
  - /tmp
</code></pre></div></div>

<h3 id="entrypoint">entrypoint</h3>

<p>デフォルトのエントリーポイントを上書きします。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>entrypoint: /code/entrypoint.sh
</code></pre></div></div>

<p>エントリーポイントはリスト形式で設定することができます。
その指定方法は <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/builder.md#entrypoint">Dockerfile</a> と同様です。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>entrypoint:
    - php
    - -d
    - zend_extension=/usr/local/lib/php/extensions/no-debug-non-zts-20100525/xdebug.so
    - -d
    - memory_limit=-1
    - vendor/bin/phpunit
</code></pre></div></div>

<blockquote>
  <p><strong>メモ</strong>: <code class="highlighter-rouge">entrypoint</code> を設定すると、サービスイメージ内に Dockerfile 命令の <code class="highlighter-rouge">ENTRYPOINT</code> によって設定されているデフォルトのエントリーポイントは上書きされ、<strong>さらに</strong>イメージ内のあらゆるデフォルトコマンドもクリアされます。
これはつまり、Dockerfile に <code class="highlighter-rouge">CMD</code> 命令があったとしたら無視されるということです。</p>
</blockquote>

<h3 id="env_file">env_file</h3>

<p>ファイルを用いて環境変数を追加します。
設定は 1 つだけとするか、リストにすることができます。</p>

<p>Compose ファイルを <code class="highlighter-rouge">docker-compose -f FILE</code> という起動により指定している場合、<code class="highlighter-rouge">env_file</code> におけるパスは、Compose ファイルがあるディレクトリからの相対パスとします。</p>

<p>環境変数が <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#environment">environment</a> の項に宣言されていれば、ここでの設定を<strong>オーバーライド</strong>します。
たとえ設定値が空や未定義であっても、これは変わりません。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>env_file: .env

env_file:
  - ./common.env
  - ./apps/web.env
  - /opt/secrets.env
</code></pre></div></div>

<p>env ファイルの各行は <code class="highlighter-rouge">VAR=VAL</code> の書式とします。
行先頭に <code class="highlighter-rouge">#</code> があると、コメント行となり無視されます。
空行も無視されます。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Set Rails/Rack environment
RACK_ENV=development
</code></pre></div></div>

<blockquote>
  <p><strong>メモ</strong>: サービスに <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#build">build</a> オプションを指定している場合、env ファイル内に定義された変数は、ビルド時にこのままでは自動的に参照されません。
その場合は <code class="highlighter-rouge">build</code> のサブオプション <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#args">args</a> を利用して、ビルド時の環境変数を設定してください。</p>
</blockquote>

<p><code class="highlighter-rouge">VAL</code> の値は記述されたとおりに用いられ、一切修正はされません。
たとえば値がクォートにより囲まれている（よくシェル変数に対して行う）場合、クォートもそのまま値として Compose に受け渡されます。</p>

<p>ファイルを複数用いる場合の順番には気をつけてください。
特に何度も出現する変数に対して、値がどのように決定されるかです。
ファイルが複数指定された場合、その処理は上から順に行われます。
たとえば <code class="highlighter-rouge">a.env</code> ファイルに変数が指定されていて、<code class="highlighter-rouge">b.env</code> ファイルには同じ変数が異なる値で定義されていたとします。
ここで <code class="highlighter-rouge">b.env</code> ファイルが下に（後に）指定されているとします。
このとき変数の値は <code class="highlighter-rouge">b.env</code> のものが採用されます。
さらに例として <code class="highlighter-rouge">docker-compose.yml</code> に以下のような宣言があったとします。</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">some-service</span><span class="pi">:</span>
    <span class="na">env_file</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">a.env</span>
      <span class="pi">-</span> <span class="s">b.env</span>
</code></pre></div></div>

<p>ファイルの内容は以下であるとします。</p>

<pre><code class="language-none"># a.env
VAR=1
</code></pre>

<pre><code class="language-none"># b.env
VAR=hello
</code></pre>

<p>この結果 <code class="highlighter-rouge">$VAR</code> は <code class="highlighter-rouge">hello</code> になります。</p>

<h3 id="environment">environment</h3>

<p>環境変数を追加します。
配列形式または辞書形式での指定が可能です。
ブール値 <code class="highlighter-rouge">true</code>, <code class="highlighter-rouge">false</code>, <code class="highlighter-rouge">yes</code>, <code class="highlighter-rouge">no</code> を用いる場合は、クォートで囲むことで YML パーサーによって True や False に変換されてしまうのを防ぐ必要があります。</p>

<p>環境変数だけが記述されている場合は、Compose が起動しているマシン上にて定義されている値が設定されます。
これは機密情報やホスト固有の値を設定する場合に利用できます。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>environment:
  RACK_ENV: development
  SHOW: 'true'
  SESSION_SECRET:

environment:
  - RACK_ENV=development
  - SHOW=true
  - SESSION_SECRET
</code></pre></div></div>

<blockquote>
  <p><strong>メモ</strong>: サービスに <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#build">build</a> オプションを指定している場合、env ファイル内に定義された変数は、ビルド時にこのままでは自動的に参照されません。
その場合は <code class="highlighter-rouge">build</code> のサブオプション <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#args">args</a> を利用して、ビルド時の環境変数を設定してください。</p>
</blockquote>

<h3 id="expose">expose</h3>

<p>ホストマシンにはポートを公開せずに、ポートを expose します。
これはリンクされたサービスのみアクセスが可能になります。
内部ポートのみが指定できます。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>expose:
 - "3000"
 - "8000"
</code></pre></div></div>

<h3 id="extends">extends</h3>

<p>現ファイルや別のファイルにある他のサービスを拡張します。
必要に応じて設定を上書きすることもできます。</p>

<p>別のサービスを <code class="highlighter-rouge">extends</code> により拡張する際には、合わせて他の設定キーを指定することができます。
<code class="highlighter-rouge">extends</code> に設定する値は辞書形式であり、<code class="highlighter-rouge">service</code> キーが必須です。
また必要に応じて指定する <code class="highlighter-rouge">file</code> キーがあります。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>extends:
  file: common.yml
  service: webapp
</code></pre></div></div>

<p><code class="highlighter-rouge">service</code> は拡張するサービスの名前を指定します。
たとえば <code class="highlighter-rouge">web</code> や <code class="highlighter-rouge">database</code> です。
<code class="highlighter-rouge">file</code> は、サービスを定義する Compose 設定ファイルのパスを指定します。</p>

<p><code class="highlighter-rouge">file</code> の指定を省略した場合、Compose はそのサービス設定を現ファイルの中から探します。
<code class="highlighter-rouge">file</code> に指定する値は絶対パス、相対パスのいずれでも構いません。
相対パスを指定した場合、Compose は現ファイルのあるディレクトリからの相対パスとして扱います。</p>

<p>拡張するサービスそのものが、他のサービスを拡張したものも指定可能です。
拡張の繰り返しはいくらでもできます。
ただし Compose は循環参照をサポートしていないため、そのような状況が発生した場合は <code class="highlighter-rouge">docker-compose</code> がエラーを返します。</p>

<p><code class="highlighter-rouge">extends</code> に関する詳細は <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/extends.md#extending-services">extends ドキュメント</a> を参照してください。</p>

<h3 id="external_links">external_links</h3>

<p>今の <code class="highlighter-rouge">docker-compose.yml</code> からではない別のところから起動されたコンテナーをリンクします。
あるいは Compose の外から、特に共有サービスや汎用サービスとして提供されるコンテナーをリンクします。
<code class="highlighter-rouge">external_links</code> の文法は、オプション <code class="highlighter-rouge">links</code> と同様です。
つまりコンテナー名とリンクのエイリアス名（<code class="highlighter-rouge">CONTAINER:ALIAS</code>）を同時に指定します。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>external_links:
 - redis_1
 - project_db_1:mysql
 - project_db_1:postgresql
</code></pre></div></div>

<blockquote>
  <p><strong>メモ</strong>: ファイルフォーマットバージョン 2 を利用しているときに、外部にて生成されたコンテナーをネットワークに接続する場合は、そのコンテナーがサービスとしてリンクしているネットワークのうちの 1 つでなければなりません。</p>
</blockquote>

<h3 id="extra_hosts-1">extra_hosts</h3>

<p>ホスト名のマッピングを追加します。
Docker Client の <code class="highlighter-rouge">--add-host</code> パラメーターと同じ値を設定してください。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>extra_hosts:
 - "somehost:162.242.195.82"
 - "otherhost:50.31.209.229"
</code></pre></div></div>

<p>ホスト名と IP アドレスによるこの設定内容は、サービスコンテナー内の <code class="highlighter-rouge">/etc/hosts</code> に追加されます。
たとえば以下のとおりです。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>162.242.195.82  somehost
50.31.209.229   otherhost
</code></pre></div></div>

<h3 id="group_add">group_add</h3>

<p>コンテナー内部のユーザーを所属させたい追加のグループを（グループ名か ID により）指定します。
追加のグループは、コンテナーとホストシステムの双方に存在している必要があります。
これが必要になるのは、たとえば複数コンテナーが別々のユーザーによって起動していて、しかもホストシステム上の同一のファイルへの読み書きを行いたいような場合です。
そのファイルが、コンテナーすべてに共通するグループにより所有されているようにすればよく、これを <code class="highlighter-rouge">group_add</code> により実現できます。
詳しくは <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/run.md#additional-groups">Docker ドキュメント</a> を参照してください。</p>

<p>全体的な例として以下です。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: "2.4"
services:
  myservice:
    image: alpine
    group_add:
      - mail
</code></pre></div></div>

<p>生成されたコンテナー内において <code class="highlighter-rouge">id</code> を実行すると、ユーザーが <code class="highlighter-rouge">mail</code> グループに所属していることがわかります。
<code class="highlighter-rouge">group_add</code> がなかったとしたら、このようにはなりません。</p>

<h3 id="healthcheck-1">healthcheck</h3>

<blockquote>
  <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-21">ファイルフォーマットバージョン 2.1</a> またはそれ以降。</p>
</blockquote>

<p>このサービスを起動させているコンテナーが「健康」（healthy）かどうかを確認する処理を設定します。
ヘルスチェックがどのように動作するのかの詳細は <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/builder.md#healthcheck">Dockerfile の HEALTHCHECK 命令</a> を参照してください。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>healthcheck:
  test: ["CMD", "curl", "-f", "http://localhost"]
  interval: 1m30s
  timeout: 10s
  retries: 3
  start_period: 40s
</code></pre></div></div>

<p><code class="highlighter-rouge">interval</code>, <code class="highlighter-rouge">timeout</code>, <code class="highlighter-rouge">start_period</code> は <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#specifying-durations">時間</a> を設定します。</p>

<p><code class="highlighter-rouge">test</code> は 1 つの文字列かリスト形式である必要があります。
リスト形式の場合、第 1 要素は必ず <code class="highlighter-rouge">NONE</code>, <code class="highlighter-rouge">CMD</code>, <code class="highlighter-rouge">CMD-SHELL</code> のいずれかとします。
文字列の場合は、<code class="highlighter-rouge">CMD-SHELL</code> に続けてその文字列を指定することと同じになります。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># ローカルのウェブアプリにアクセスします。
test: ["CMD", "curl", "-f", "http://localhost"]

# 上と同様。ただし /bin/sh によりラップ。両書式は同等。
test: ["CMD-SHELL", "curl -f http://localhost &amp;&amp; echo 'cool, it works'"]
test: curl -f https://localhost &amp;&amp; echo 'cool, it works'
</code></pre></div></div>

<p>イメージが設定するデフォルトのヘルスチェックを無効にするには、<code class="highlighter-rouge">disable: true</code> を指定します。
これは <code class="highlighter-rouge">test: ["NONE"]</code> と指定することと同じです。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>healthcheck:
  disable: true
</code></pre></div></div>

<blockquote>
  <p><strong>メモ</strong>: <code class="highlighter-rouge">start_period</code> オプションは最新の機能であり、<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-23">ファイルフォーマット 2.3</a> においてのみ利用可能です。</p>
</blockquote>

<h3 id="image">image</h3>

<p>コンテナーを起動させるイメージを設定します。
リポジトリ/タグの形式か、あるいは部分イメージ ID により指定します。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>image: redis
image: ubuntu:14.04
image: tutum/influxdb
image: example-registry.com:4000/postgresql
image: a4bc65fd
</code></pre></div></div>

<p>イメージが存在しなかった場合、<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#build">build</a> を指定していなければ Compose はイメージを取得しようとします。
取得する際には、指定されたオプションを使ってビルドを行い、指定されたタグ名によりタグづけを行います。</p>

<h3 id="init">init</h3>

<blockquote>
  <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-22">ファイルフォーマットバージョン 2.2</a> において追加。</p>
</blockquote>

<p>コンテナー内にて init を実行し、シグナルを送信してプロセスを停止させます。
このオプションに <code class="highlighter-rouge">true</code> を設定することで、サービスに対するこの機能を有効にします。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: "2.4"
services:
  web:
    image: alpine:latest
    init: true
</code></pre></div></div>

<blockquote>
  <p>利用されるデフォルトの init の実行モジュールは <a href="https://github.com/krallin/tini">Tini</a> であり、デーモンホストの <code class="highlighter-rouge">/usr/libexec/docker-init</code> にインストールされています。
デーモンに対して独自の init 実行モジュールを設定するには、<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/commandline/dockerd/#daemon-configuration-file"><code class="highlighter-rouge">init-path</code> 設定オプション</a> を利用します。</p>
</blockquote>

<h3 id="isolation-1">isolation</h3>

<blockquote>
  <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-21">ファイルフォーマットバージョン 2.1</a> において追加。</p>
</blockquote>

<p>コンテナーの分離技術（isolation technology）を設定します。
Linux においてサポートされるのは <code class="highlighter-rouge">default</code> のみです。
Windows では <code class="highlighter-rouge">default</code>, <code class="highlighter-rouge">process</code>, <code class="highlighter-rouge">hyperv</code> の設定が可能です。
詳しくは <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/commandline/run.md#specify-isolation-technology-for-container---isolation">Docker Engine ドキュメント</a> を参照してください。</p>

<h3 id="labels-1">labels</h3>

<p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/userguide/labels-custom-metadata.md">Docker labels</a> を使ってコンテナーにメタデータを追加します。
配列形式と辞書形式のいずれかにより指定します。</p>

<p>他のソフトウェアが用いるラベルとの競合を避けるため、逆 DNS 記法とすることをお勧めします。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>labels:
  com.example.description: "Accounting webapp"
  com.example.department: "Finance"
  com.example.label-with-empty-value: ""

labels:
  - "com.example.description=Accounting webapp"
  - "com.example.department=Finance"
  - "com.example.label-with-empty-value"
</code></pre></div></div>

<h3 id="links">links</h3>

<p>他サービスのコンテナーをリンクします。
サービス名とリンクのエイリアス名（<code class="highlighter-rouge">"SERVICE:ALIAS"</code>）を指定するか、直接サービス名を指定します。</p>

<blockquote>
  <p>links は古いオプションです。
この代わりに <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#networks">networks</a> オプションを用いることをお勧めします。</p>
</blockquote>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>web:
  links:
   - "db"
   - "db:database"
   - "redis"
</code></pre></div></div>

<p>リンクされたサービスのコンテナーは、エイリアスと同等のホスト名により到達可能になります。
エイリアスが設定されていない場合はサービス名により到達可能です。</p>

<p>Links は <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#depends_on">depends_on</a> と同様にサービス間の依存関係を表わします。
したがってサービスの起動順を設定するものになります。</p>

<blockquote>
  <p><strong>メモ</strong>： links と <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#networks">networks</a> をともに設定する場合、リンクするサービスは、少なくとも 1 つのネットワークが共有され通信ができるようにする必要があります。
このオプションではなく networks オプションを用いることをお勧めします。</p>
</blockquote>

<h3 id="logging">logging</h3>

<p>サービスに対するログ記録の設定をします。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>logging:
  driver: syslog
  options:
    syslog-address: "tcp://192.168.0.42:123"
</code></pre></div></div>

<p><code class="highlighter-rouge">driver</code> 名にはサービスコンテナーにおけるロギングドライバーを指定します。
これは docker run コマンドに対する <code class="highlighter-rouge">--log-driver</code> オプションと同じです。
（<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/admin/logging/overview.md">ドキュメントはこちら</a>）</p>

<p>デフォルトは json-file です。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>driver: "json-file"
driver: "syslog"
driver: "none"
</code></pre></div></div>

<blockquote>
  <p><strong>メモ</strong>: ドライバーのうち <code class="highlighter-rouge">json-file</code> と <code class="highlighter-rouge">journald</code> だけが、<code class="highlighter-rouge">docker-compose up</code> と <code class="highlighter-rouge">docker-compose logs</code> によって直接ログ参照ができます。
その他のドライバーではログ表示は行われません。</p>
</blockquote>

<p>ロギングドライバーへのロギングオプションの設定は <code class="highlighter-rouge">options</code> キーにより行います。
これは <code class="highlighter-rouge">docker run</code> コマンドの <code class="highlighter-rouge">--log-opt</code> オプションと同じです。</p>

<p>ロギングオプションはキーバリューのペアで指定します。
たとえば <code class="highlighter-rouge">syslog</code> オプションは以下のようになります。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>driver: "syslog"
options:
  syslog-address: "tcp://192.168.0.42:123"
</code></pre></div></div>

<h3 id="network_mode">network_mode</h3>

<blockquote>
  <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-2">ファイルフォーマットバージョン 2</a> またはそれ以降。
バージョン 1 の <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v1/#net">net</a> オプションに置き換わるものです。</p>
</blockquote>

<p>ネットワークモードを設定します。
Docker クライアントの <code class="highlighter-rouge">--net</code> パラメーターと同じ値を設定します。
これに加えて <code class="highlighter-rouge">service:[service name]</code> という特別な書式も指定可能です。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>network_mode: "bridge"
network_mode: "host"
network_mode: "none"
network_mode: "service:[service name]"
network_mode: "container:[container name/id]"
</code></pre></div></div>

<h3 id="networks">networks</h3>

<blockquote>
  <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-2">ファイルフォーマットバージョン 2</a> またはそれ以降。
バージョン 1 の <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v1/#net">net</a> オプションに置き換わるものです。</p>
</blockquote>

<p>ネットワークへの参加を設定します。
設定には <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#network-configuration-reference">最上位の <code class="highlighter-rouge">networks</code> キー</a> に設定された値を用います。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>services:
  some-service:
    networks:
     - some-network
     - other-network
</code></pre></div></div>

<h4 id="aliases">aliases</h4>

<p>ネットワーク上のサービスに対して、ホスト名の別名となるエイリアスを設定します。
同じネットワーク上にある他のコンテナーは、この 1 つのサービスコンテナーに対して、サービス名か、あるいはそのエイリアスを使ってアクセスすることができます。</p>

<p><code class="highlighter-rouge">aliases</code> はネットワーク範囲内において有効です。
ネットワークが異なれば、同一サービスに違うエイリアスを持たせることができます。</p>

<blockquote>
  <p><strong>メモ</strong>: ネットワーク全体にわたってのエイリアスを複数コンテナー間で共有することができます。
それは複数サービス間でも可能です。
ただしこの場合、名前解決がどのコンテナーに対して行われるかは保証されません。</p>
</blockquote>

<p>一般的な書式は以下のとおりです。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>services:
  some-service:
    networks:
      some-network:
        aliases:
         - alias1
         - alias3
      other-network:
        aliases:
         - alias2
</code></pre></div></div>

<p>以下の例では 3 つのサービス（<code class="highlighter-rouge">web</code>, <code class="highlighter-rouge">worker</code>, <code class="highlighter-rouge">db</code>）と 2 つのネットワーク（<code class="highlighter-rouge">new</code> と <code class="highlighter-rouge">legacy</code>）を提供します。
<code class="highlighter-rouge">db</code> サービスは <code class="highlighter-rouge">new</code> ネットワーク上では、ホスト名 <code class="highlighter-rouge">db</code> あるいは <code class="highlighter-rouge">database</code> としてアクセスできます。
一方 <code class="highlighter-rouge">legacy</code> ネットワーク上では <code class="highlighter-rouge">db</code> あるいは <code class="highlighter-rouge">mysql</code> としてアクセスできます。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: "2.4"

services:
  web:
    build: ./web
    networks:
      - new

  worker:
    build: ./worker
    networks:
      - legacy

  db:
    image: mysql
    networks:
      new:
        aliases:
          - database
      legacy:
        aliases:
          - mysql

networks:
  new:
  legacy:
</code></pre></div></div>

<h4 id="ipv4_address-ipv6_address">ipv4_address, ipv6_address</h4>

<p>サービスをネットワークに参加させる際、そのコンテナーに対してスタティック IP アドレスを設定します。</p>

<p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#network-configuration-reference">最上位の networks セクション</a> の対応するネットワーク設定においては、<code class="highlighter-rouge">ipam</code> ブロックが必要です。
そこでは各スタティックアドレスに応じたサブネットの設定が必要になります。
IPv6 アドレスが必要である場合は、<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#enableipv6"><code class="highlighter-rouge">enable_ipv6</code></a> オプションの設定が必要になります。</p>

<p>以下に例を示します。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: "2.4"

services:
  app:
    image: busybox
    command: ifconfig
    networks:
      app_net:
        ipv4_address: 172.16.238.10
        ipv6_address: 2001:3984:3989::10

networks:
  app_net:
    driver: bridge
    enable_ipv6: true
    ipam:
      driver: default
      config:
      - subnet: 172.16.238.0/24
        gateway: 172.16.238.1
      - subnet: 2001:3984:3989::/64
        gateway: 2001:3984:3989::1
</code></pre></div></div>

<h4 id="link_local_ips">link_local_ips</h4>

<blockquote>
  <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-21">ファイルフォーマットバージョン 2.1</a> において追加されました。</p>
</blockquote>

<p>リンクローカル IP（link-local IP） のリストを設定します。
リンクローカル IP とは特別な IP アドレスのことであり、よく知られた（well known）サブネットに属し、ユーザーが自由に管理するものを指します。
普通、このアドレスはデプロイされたアーキテクチャーとはまったく関係のないものです。
したがって Docker（IPAM ドライバー）によって管理されるものではありません。</p>

<p>利用例を以下に示します。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: "2.4"
services:
  app:
    image: busybox
    command: top
    networks:
      app_net:
        link_local_ips:
          - 57.123.22.11
          - 57.123.22.13
networks:
  app_net:
    driver: bridge
</code></pre></div></div>

<h4 id="priority">priority</h4>

<p>Compose がサービスのコンテナーをネットワークに接続する際に、その接続の優先順位を設定します。
設定されていない場合のデフォルト値は <code class="highlighter-rouge">0</code> です。</p>

<p>以下の例において <code class="highlighter-rouge">app</code> サービスは初めに <code class="highlighter-rouge">app_net_1</code> に接続します。
そこに一番高い優先順位が設定されているためです。
次に接続されるのは <code class="highlighter-rouge">app_net_3</code> です。
最後に、デフォルトの優先順位である <code class="highlighter-rouge">0</code> が用いられている <code class="highlighter-rouge">app_net_2</code> に接続します。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: "2.4"
services:
  app:
    image: busybox
    command: top
    networks:
      app_net_1:
        priority: 1000
      app_net_2:

      app_net_3:
        priority: 100
networks:
  app_net_1:
  app_net_2:
  app_net_3:
</code></pre></div></div>

<blockquote>
  <p><strong>メモ</strong>: 複数のネットワークに同一の優先順位が設定された場合、接続順は定義されません。</p>
</blockquote>

<h3 id="pid">pid</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pid: "host"
pid: "container:custom_container_1"
pid: "service:foobar"
</code></pre></div></div>

<p>これが <code class="highlighter-rouge">container:&lt;container_name&gt;</code>、または <code class="highlighter-rouge">service:&lt;service_name&gt;</code> の形で設定された場合は、そのサービスは、指定されたコンテナーまたはサービスの PID アドレス空間を共有します。</p>

<p>これが “host” に設定された場合は、サービスの PID モードをホスト PID モードに設定します。
これはコンテナーとホストオペレーティングシステムとの間で、PID アドレス空間の共有を開始します。
このフラグを使って起動したコンテナーは、ベアメタルマシンの名前空間にあるコンテナーにアクセスし、操作することが可能になります。
逆もまた可能です。</p>

<blockquote>
  <p><strong>メモ</strong>: <code class="highlighter-rouge">service:</code> と <code class="highlighter-rouge">container:</code> の書式を利用するには <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-21">バージョン 2.1</a> またはそれ以降である必要があります。</p>
</blockquote>

<h3 id="pids_limit">pids_limit</h3>

<blockquote>
  <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-21">ファイルフォーマットバージョン 2.1</a> において追加されました。</p>
</blockquote>

<p>コンテナーの PID 上限を設定します。
<code class="highlighter-rouge">-1</code> に設定すると無制限になります。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pids_limit: 10
</code></pre></div></div>

<h3 id="platform">platform</h3>

<blockquote>
  <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-24">ファイルフォーマットバージョン 2.4</a> において追加されました。</p>
</blockquote>

<p>サービスのコンテナーが稼動することになるプラットフォームを設定します。
その記述は <code class="highlighter-rouge">os[/arch[/variant]]</code> といった書式で行います。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>platform: osx
platform: windows/amd64
platform: linux/arm64/v8
</code></pre></div></div>

<p>このパラメーターは、どのバージョンのイメージを取得するのか、あるいはサービスがどのプラットフォームでビルドされるかを決定します。</p>

<h3 id="ports">ports</h3>

<p>公開用ポートを設定します。
設定は両側のポートを指定するか（<code class="highlighter-rouge">HOST:CONTAINER</code>）、あるいはコンテナー側のポートのみを指定します（その場合、ホスト側はエフェメラルポートが採用されます）。</p>

<blockquote>
  <p><strong>メモ</strong>: <code class="highlighter-rouge">HOST:CONTAINER</code> の書式によってポートをマッピングした場合に、コンテナー側のポートが 60 番未満であるとエラーになることがあります。
これは YAML パーサーが <code class="highlighter-rouge">xx:yy</code> の書式内にある数値を 60 進数値として解釈するからです。
このことからポートマッピングを指定する際には、常に文字列として設定することをお勧めします。</p>
</blockquote>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ports:
 - "3000"
 - "3000-3005"
 - "8000:8000"
 - "9090-9091:8080-8081"
 - "49100:22"
 - "127.0.0.1:8001:8001"
 - "127.0.0.1:5000-5010:5000-5010"
 - "6060:6060/udp"
 - "12400-12500:1240"
</code></pre></div></div>

<h3 id="runtime">runtime</h3>

<blockquote>
  <p>ファイルフォーマット<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-23">バージョン 2.3</a> において追加されました。</p>
</blockquote>

<p>サービスのコンテナーにおいてどのランタイム（runtime）を用いるかを設定します。
デフォルトのランタイムおよび利用可能なランタイムは、<code class="highlighter-rouge">docker info</code> 出力から確認できます。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>web:
  image: busybox:latest
  command: true
  runtime: runc
</code></pre></div></div>

<h3 id="scale">scale</h3>

<blockquote>
  <p>ファイルフォーマット<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-22">バージョン 2.2</a> において追加されました。</p>
</blockquote>

<p>本サービスに対して、デプロイするコンテナーのデフォルト数を設定します。
<code class="highlighter-rouge">docker-compose up</code> を実行したとき、Compose はこの設定数に従ってコンテナーの生成や削除を行います。
この値は <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/reference/up.md"><code class="highlighter-rouge">--scale</code></a> フラグを使って上書きすることができます。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>web:
  image: busybox:latest
  command: echo 'scaled'
  scale: 3
</code></pre></div></div>

<h3 id="security_opt">security_opt</h3>

<p>各コンテナーにおけるデフォルトのラベリングスキーム（labeling scheme）を上書きします。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>security_opt:
  - label:user:USER
  - label:role:ROLE
</code></pre></div></div>

<h3 id="stop_grace_period">stop_grace_period</h3>

<p>コンテナーが SIGKILL を送信するまでに、SIGTERM（あるいは <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#stopsignal"><code class="highlighter-rouge">stop_signal</code></a> によって設定されたストップシグナル）をどれだけ待つかを設定します。
指定には <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#specifying-durations">時間</a> を用います。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>stop_grace_period: 1s
stop_grace_period: 1m30s
</code></pre></div></div>

<p>デフォルトで、コンテナーが SIGKILL を送信する前に <code class="highlighter-rouge">stop</code> は 10 秒待ちます。</p>

<h3 id="stop_signal">stop_signal</h3>

<p>コンテナーに対して別の停止シグナルを設定します。
デフォルトにおいて <code class="highlighter-rouge">stop</code> は SIGTERM を用います。
<code class="highlighter-rouge">stop_signal</code> を使って別のシグナルを設定すると <code class="highlighter-rouge">stop</code> にはそのシグナルが代わりに送信されます。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>stop_signal: SIGUSR1
</code></pre></div></div>

<h3 id="storage_opt">storage_opt</h3>

<blockquote>
  <p>ファイルフォーマット<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-21">バージョン 2.1</a> において追加されました。</p>
</blockquote>

<p>本サービスに対するストレージドライバーのオプションを設定します。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>storage_opt:
  size: '1G'
</code></pre></div></div>

<h3 id="sysctls">sysctls</h3>

<blockquote>
  <p>ファイルフォーマット<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-21">バージョン 2.1</a> において追加されました。</p>
</blockquote>

<p>コンテナーに設定するカーネルパラメーターを設定します。
配列または辞書形式での指定ができます。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sysctls:
  net.core.somaxconn: 1024
  net.ipv4.tcp_syncookies: 0

sysctls:
  - net.core.somaxconn=1024
  - net.ipv4.tcp_syncookies=0
</code></pre></div></div>

<h3 id="ulimits">ulimits</h3>

<p>コンテナーにおけるデフォルトの ulimits を上書きします。
1 つの limit を整数値として指定するか、ソフト、ハードの limit をマッピングとして指定することができます。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ulimits:
  nproc: 65535
  nofile:
    soft: 20000
    hard: 40000
</code></pre></div></div>

<h3 id="userns_mode">userns_mode</h3>

<blockquote>
  <p>ファイルフォーマット<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-21">バージョン 2.1</a> において追加されました。</p>
</blockquote>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>userns_mode: "host"
</code></pre></div></div>

<p>Docker デーモンにおいてユーザー名前空間が設定されていても、サービスに対してユーザー名前空間を無効にします。
詳しくは <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/commandline/dockerd.md#disable-user-namespace-for-a-container">dockerd</a> を参照してください。</p>

<h3 id="volumes">volumes</h3>

<p>マウントホストフォルダーや名前つきボリュームをマウントします。
名前つきボリュームは <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#volume-configuration-reference">最上位の <code class="highlighter-rouge">volumes</code> キー</a> として設定する必要があります。</p>

<p>ホスト上の相対パスをマウントすることができます。
これは、用いられている Compose 設定ファイルのディレクトリからの相対パスとして展開されます。
相対パスは <code class="highlighter-rouge">.</code> または <code class="highlighter-rouge">..</code> で書き始める必要があります。</p>

<h4 id="short-syntax">短い文法</h4>

<p>短い文法では汎用的な <code class="highlighter-rouge">[SOURCE:]TARGET[:MODE]</code> という書式を用います。
ここで <code class="highlighter-rouge">SOURCE</code> はホストパスまたはボリューム名のどちらでも可です。
<code class="highlighter-rouge">TARGET</code> はボリュームがマウントされるコンテナーパスです。
標準的なモードは、読み込み専用の場合 <code class="highlighter-rouge">ro</code>、読み書き可能の場合 <code class="highlighter-rouge">rw</code>（デフォルト）です。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volumes:
  # パス指定のみ。Engine にボリュームを生成させます。
  - /var/lib/mysql

  # 絶対パスのマッピングを指定。
  - /opt/data:/var/lib/mysql

  # ホストからのパス指定。Compose ファイルからの相対パス。
  - ./cache:/tmp/cache

  # ユーザーディレクトリからの相対パス。
  - ~/configs:/etc/configs/:ro

  # 名前つきボリューム。
  - datavolume:/var/lib/mysql
</code></pre></div></div>

<h4 id="long-syntax">長い文法</h4>

<blockquote>
  <p>ファイルフォーマット<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-23">バージョン 2.3</a> において追加されました。</p>
</blockquote>

<p>長い文法は追加の設定項目が加えられていて、短い文法では表現できないものです。</p>

<ul>
  <li><code class="highlighter-rouge">type</code>: マウントタイプを表わす <code class="highlighter-rouge">volume</code>, <code class="highlighter-rouge">bind</code>, <code class="highlighter-rouge">tmpfs</code>, <code class="highlighter-rouge">npipe</code> のいずれかを指定します。</li>
  <li><code class="highlighter-rouge">source</code>: マウント元。バインドマウントにおいてはホスト上のパスを指定します。
また <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#volume-configuration-reference">最上位の <code class="highlighter-rouge">volumes</code> キー</a> で定義したボリューム名を指定します。
tmpfs マウントはできません。</li>
  <li><code class="highlighter-rouge">target</code>: ボリュームがマウントされるコンテナー内のパスを指定します。</li>
  <li><code class="highlighter-rouge">read_only</code>: ボリュームを読み込み専用に設定します。</li>
  <li><code class="highlighter-rouge">bind</code>: 追加のバインドオプションを設定します。
    <ul>
      <li><code class="highlighter-rouge">propagation</code>: バインドにおいて伝播モード（propagation mode）を利用します。</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">volume</code>: 追加のボリュームオプションを設定します。
    <ul>
      <li><code class="highlighter-rouge">nocopy</code>: ボリュームの生成時にはコンテナーからのデータコピーを無効にします。</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">tmpfs</code>: 追加の tmpfs オプションを設定します。
    <ul>
      <li><code class="highlighter-rouge">size</code>: tmpfs マウントのサイズをバイト数で指定します。</li>
    </ul>
  </li>
</ul>

<pre><code class="language-none">version: "2.4"
services:
  web:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - type: volume
        source: mydata
        target: /data
        volume:
          nocopy: true
      - type: bind
        source: ./static
        target: /opt/app/static

networks:
  webnet:

volumes:
  mydata:
</code></pre>

<blockquote>
  <p><strong>Note</strong>: 長い文法を使ってバインドマウントを生成する際には、参照されるフォルダーをあらかじめ生成しておく必要があります。
短い文法を利用する場合、そのフォルダーが存在しなければ生成されます。
詳しくは <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/admin/volumes/bind-mounts.md/#differences-between--v-and---mount-behavior">バインドマウントのドキュメント</a> を参照してください。</p>
</blockquote>

<h3 id="volume_driver">volume_driver</h3>

<p>本サービス上に宣言されているボリュームすべてに対して、利用するデフォルトのボリュームドライバーを設定します。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volume_driver: mydriver
</code></pre></div></div>

<blockquote>
  <p><strong>メモ</strong>: <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-2">ファイルフォーマットバージョン 2</a> においてこのオプションは、無名ボリューム（anonymous volume）に対してのみ適用されます。
（これはイメージ内で無名として設定されるか、あるいは <code class="highlighter-rouge">volumes</code> キー配下において明示的な名前やホストパスが指定されずに設定されるものです。）
名前つきボリュームに対してドライバーを設定するには、<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#volume-configuration-reference">最上位の <code class="highlighter-rouge">volumes</code> オプション</a> の配下にて <code class="highlighter-rouge">driver</code> キーを使ってください。</p>
</blockquote>

<p>詳しくは <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/userguide/dockervolumes.md">Docker ボリューム</a> や <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/extend/plugins_volume.md">ボリュームプラグイン</a> を参照してください。</p>

<h3 id="volumes_from">volumes_from</h3>

<p>別のサービスやコンテナーのボリュームをすべてマウントします。
任意の設定として、アクセスを読み込み専用（<code class="highlighter-rouge">ro</code>）とするか、読み書き可能（<code class="highlighter-rouge">rw</code>）とするかを指定できます。
アクセスレベルが何も設定されていないときは、読み書き可能として設定されます。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volumes_from:
 - service_name
 - service_name:ro
 - container:container_name
 - container:container_name:rw
</code></pre></div></div>

<blockquote>
  <p><strong>メモ</strong></p>

  <ul>
    <li>
      <p><code class="highlighter-rouge">container:...</code> という書式は <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-2">ファイルフォーマットバージョン 2</a> においてのみサポートされます。</p>
    </li>
    <li>
      <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-1">バージョン 1</a> の場合、コンテナー名は以下のように <code class="highlighter-rouge">container:</code> をつけずに設定することができます。</p>

      <ul>
        <li><code class="highlighter-rouge">service_name</code></li>
        <li><code class="highlighter-rouge">service_name:ro</code></li>
        <li><code class="highlighter-rouge">container_name</code></li>
        <li><code class="highlighter-rouge">container_name:rw</code></li>
      </ul>
    </li>
  </ul>
</blockquote>

<h3 id="restart">restart</h3>

<p>再起動ポリシー（restart policy）のデフォルトは <code class="highlighter-rouge">no</code> です。
この場合はどういう状況であってもコンテナーは再起動しません。
<code class="highlighter-rouge">always</code> を指定した場合、コンテナーは常に再起動することになります。
また <code class="highlighter-rouge">on-failure</code> ポリシーでは、終了コードが on-failure エラーを表わしている場合にコンテナーが再起動します。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  - restart: no
  - restart: always
  - restart: on-failure
</code></pre></div></div>

<h3 id="cpu-and-other-resources">cpu_count, cpu_percent, cpu_shares, cpu_period, cpu_quota, cpus, cpuset, domainname, hostname, ipc, mac_address, mem_limit, memswap_limit, mem_swappiness, mem_reservation, oom_kill_disable, oom_score_adj, privileged, read_only, shm_size, stdin_open, tty, user, working_dir</h3>

<p>ここに示すオプションはいずれも、値 1 つを設定するものであり、<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/run.md">docker run</a> のオプションに対応づいています。</p>

<blockquote>
  <p><strong>Note</strong>: <code class="highlighter-rouge">cpu_count</code>, <code class="highlighter-rouge">cpu_percent</code>, <code class="highlighter-rouge">cpus</code> の各オプションは <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-22">バージョン 2.2</a> において追加されました。
また <code class="highlighter-rouge">oom_kill_disable</code>, <code class="highlighter-rouge">cpu_period</code> のオプションは <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-21">バージョン 2.1</a> において追加されました。</p>
</blockquote>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cpu_count: 2
cpu_percent: 50
cpus: 0.5
cpu_shares: 73
cpu_quota: 50000
cpu_period: 20ms
cpuset: 0,1

user: postgresql
working_dir: /code

domainname: foo.com
hostname: foo
ipc: host
mac_address: 02:42:ac:11:65:43

mem_limit: 1000000000
memswap_limit: 2000000000
mem_reservation: 512m
privileged: true

oom_score_adj: 500
oom_kill_disable: true

read_only: true
shm_size: 64M
stdin_open: true
tty: true
</code></pre></div></div>

<h2 id="specifying-durations">時間の指定</h2>

<p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#healthcheck"><code class="highlighter-rouge">healthcheck</code></a> のサブオプション <code class="highlighter-rouge">interval</code>、<code class="highlighter-rouge">timeout</code> のように、時間を設定するオプションがあります。
これは以下のような書式による文字列を時間として受け付けるものです。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2.5s
10s
1m30s
2h32m
5h34m56s
</code></pre></div></div>

<p>サポートされる単位は <code class="highlighter-rouge">us</code>, <code class="highlighter-rouge">ms</code>, <code class="highlighter-rouge">s</code>, <code class="highlighter-rouge">m</code>, <code class="highlighter-rouge">h</code> です。</p>

<h2 id="specifying-byte-values">バイト値の表現</h2>

<p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#blkioconfig"><code class="highlighter-rouge">blkio_config</code></a> のサブオプション <code class="highlighter-rouge">device_read_bps</code> のようにバイト値を設定するオプションがあります。
バイト値は文字列として指定するものであり、以下のようになります。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2b
1024kb
2048k
300m
1gb
</code></pre></div></div>

<p>サポートされる単位は <code class="highlighter-rouge">b</code>, <code class="highlighter-rouge">k</code>, <code class="highlighter-rouge">m</code>, <code class="highlighter-rouge">g</code> とそれに応じた <code class="highlighter-rouge">kb</code>, <code class="highlighter-rouge">mb</code>, <code class="highlighter-rouge">gb</code> です。
現時点にて 10 進数値の指定はサポートされていません。</p>

<h2 id="volume-configuration-reference">ボリューム設定リファレンス</h2>

<p>サービスの宣言の一部として、ファイル上に <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#volumes">ボリューム</a> を宣言することが可能ですが、このセクションでは（<code class="highlighter-rouge">volumes_from</code> を利用せずに）名前つきボリュームを生成する方法を説明します。
このボリュームは、複数のサービスにわたっての再利用が可能であり、docker コマンドラインや API を使って簡単に抽出したり確認したりすることができます。
詳しくは <a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/reference/commandline/volume_create.md">docker volume</a> のサブコマンドを確認してください。</p>

<p>以下の例では 2 つのサービスを用います。
データベースのデータディレクトリは、もう一方のサービスに対してボリュームとして共有させます。
これによりデータが定期的に反映されます。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: "2.4"

services:
  db:
    image: db
    volumes:
      - data-volume:/var/lib/db
  backup:
    image: backup-service
    volumes:
      - data-volume:/var/lib/backup/data

volumes:
  data-volume:
</code></pre></div></div>

<p>最上位の <code class="highlighter-rouge">volumes</code> キーは指定しないようにすることもできます。
その場合は Engine によってデフォルトで設定されているドライバーが用いられます。
（たいていは <code class="highlighter-rouge">local</code> ドライバーとなります。）
さらに追加で、以下のようなキーを設定することができます。</p>

<h3 id="driver">driver</h3>

<p>どのボリュームドライバーを現在のボリュームに対して用いるかを指定します。
デフォルトは Docker Engine が利用するものとして設定されているドライバーになります。
たいていは <code class="highlighter-rouge">local</code> です。
ドライバーが利用できない場合、<code class="highlighter-rouge">docker-compose up</code> によってボリューム生成が行われる際に Engine がエラーを返します。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> driver: foobar
</code></pre></div></div>

<h3 id="driver_opts">driver_opts</h3>

<p>このボリュームが利用するドライバーに対して、受け渡したいオプションをキーバリューペアのリストとして設定します。
このオプションは各ドライバーによって異なります。
詳しくは各ドライバーのドキュメントを参照してください。
設定は任意です。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> driver_opts:
   foo: "bar"
   baz: 1
</code></pre></div></div>

<h3 id="external">external</h3>

<p>このオプションを <code class="highlighter-rouge">true</code> に設定することにより、Compose の外部において生成されているボリュームを設定します。
<code class="highlighter-rouge">docker-compose up</code> はボリュームを生成しないようになりますが、ボリュームが存在しなければエラーとなります。</p>

<p>バージョン 2.0 にて、<code class="highlighter-rouge">external</code> は他のボリューム設定キー（<code class="highlighter-rouge">driver</code>, <code class="highlighter-rouge">driver_opts</code>, <code class="highlighter-rouge">labels</code>）と同時に用いることはできませんでした。
この制約は <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-21">バージョン 2.1</a> 以降においてはなくなりました。</p>

<p>以下の例では <code class="highlighter-rouge">[projectname]_data</code> というボリュームは生成されることはなく、Compose はすでに存在している <code class="highlighter-rouge">data</code> という単純な名前のボリュームを探しにいきます。
そしてこれを <code class="highlighter-rouge">db</code> サービスコンテナー内にマウントします。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: "2.4"

services:
  db:
    image: postgres
    volumes:
      - data:/var/lib/postgresql/data

volumes:
  data:
    external: true
</code></pre></div></div>

<p>ボリューム名として指定する名前は、Compose ファイル内で参照されている名前以外でも指定することができます。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volumes:
  data:
    external:
      name: actual-name-of-volume
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong>: 最近の Compose バージョンでは、<code class="highlighter-rouge">external.name</code> プロパティは廃止予定となり、単純に <code class="highlighter-rouge">name</code> プロパティを用いるものになっています。</p>
</blockquote>

<h3 id="labels-2">labels</h3>

<blockquote>
  <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-21">ファイルフォーマットバージョン 2.1</a> において追加されました。</p>
</blockquote>

<p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/userguide/labels-custom-metadata.md">Docker labels</a> を使ってコンテナーにメタデータを追加します。
配列形式と辞書形式のいずれかにより指定します。</p>

<p>ここでは逆 DNS 記法とすることをお勧めします。
この記法にしておけば、他のソフトウェアが用いるラベルとの競合が避けられるからです。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>labels:
  com.example.description: "Database volume"
  com.example.department: "IT/Ops"
  com.example.label-with-empty-value: ""

labels:
  - "com.example.description=Database volume"
  - "com.example.department=IT/Ops"
  - "com.example.label-with-empty-value"
</code></pre></div></div>

<h3 id="name">name</h3>

<blockquote>
  <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-21">ファイルフォーマットバージョン 2.1</a> において追加されました。</p>
</blockquote>

<p>ボリュームに対して独自の名前を設定します。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: "2.4"
volumes:
  data:
    name: my-app-data
</code></pre></div></div>

<p>これは <code class="highlighter-rouge">external</code> プロパティと同時に利用することができます。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: "2.4"
volumes:
  data:
    external: true
    name: my-app-data
</code></pre></div></div>

<h2 id="network-configuration-reference">ネットワーク設定リファレンス</h2>

<p>最上位の <code class="highlighter-rouge">networks</code> キーは、生成するネットワークを指定します。
Compose が利用する Docker ネットワーク機能に関して、詳細は <a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/networking.md">ネットワークガイド</a> を参照してください。</p>

<h3 id="driver-1">driver</h3>

<p>現在のネットワークにおいて利用するドライバーを設定します。</p>

<p>デフォルトとなるドライバーは、Docker Engine においてどのドライバーを用いているかによって変わります。
たいていの場合、単一ホストであれば <code class="highlighter-rouge">bridge</code>、スウォーム上では <code class="highlighter-rouge">overlay</code> となります。</p>

<p>ドライバーが利用できない場合、Docker Engine はエラーを返します。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>driver: overlay
</code></pre></div></div>

<p>Compose ファイルフォーマット 2.1 から、オーバーレイネットワークは、必ず「アタッチ可能」（attachable）として生成されます。
そしてこれは変更できません。</p>

<p>This means that standalone
containers can connect to overlay networks.</p>

<h3 id="driver_opts-1">driver_opts</h3>

<p>Specify a list of options as key-value pairs to pass to the driver for this
network. Those options are driver-dependent - consult the driver’s
documentation for more information. Optional.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  driver_opts:
    foo: "bar"
    baz: 1
</code></pre></div></div>

<h3 id="enable_ipv6">enable_ipv6</h3>

<blockquote>
  <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-21">Added in version 2.1 file format</a>.</p>
</blockquote>

<p>Enable IPv6 networking on this network.</p>

<h3 id="ipam">ipam</h3>

<p>Specify custom IPAM config. This is an object with several properties, each of
which is optional:</p>

<ul>
  <li><code class="highlighter-rouge">driver</code>: Custom IPAM driver, instead of the default.</li>
  <li><code class="highlighter-rouge">config</code>: A list with zero or more config blocks, each containing any of
the following keys:
    <ul>
      <li><code class="highlighter-rouge">subnet</code>: Subnet in CIDR format that represents a network segment</li>
      <li><code class="highlighter-rouge">ip_range</code>: Range of IPs from which to allocate container IPs</li>
      <li><code class="highlighter-rouge">gateway</code>: IPv4 or IPv6 gateway for the master subnet</li>
      <li><code class="highlighter-rouge">aux_addresses</code>: Auxiliary IPv4 or IPv6 addresses used by Network driver,
as a mapping from hostname to IP</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">options</code>: Driver-specific options as a key-value mapping.</li>
</ul>

<p>A full example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ipam:
  driver: default
  config:
    - subnet: 172.28.0.0/16
      ip_range: 172.28.5.0/24
      gateway: 172.28.5.254
      aux_addresses:
        host1: 172.28.1.5
        host2: 172.28.1.6
        host3: 172.28.1.7
  options:
    foo: bar
    baz: "0"
</code></pre></div></div>

<h3 id="internal">internal</h3>

<p>By default, Docker also connects a bridge network to it to provide external
connectivity. If you want to create an externally isolated overlay network,
you can set this option to <code class="highlighter-rouge">true</code>.</p>

<h3 id="labels-3">labels</h3>

<blockquote>
  <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-21">Added in version 2.1 file format</a>.</p>
</blockquote>

<p>Add metadata to containers using
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/engine/userguide/labels-custom-metadata.md">Docker labels</a>. You can use either
an array or a dictionary.</p>

<p>It’s recommended that you use reverse-DNS notation to prevent your labels from
conflicting with those used by other software.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>labels:
  com.example.description: "Financial transaction network"
  com.example.department: "Finance"
  com.example.label-with-empty-value: ""

labels:
  - "com.example.description=Financial transaction network"
  - "com.example.department=Finance"
  - "com.example.label-with-empty-value"
</code></pre></div></div>

<h3 id="external-1">external</h3>

<p>If set to <code class="highlighter-rouge">true</code>, specifies that this network has been created outside of
Compose. <code class="highlighter-rouge">docker-compose up</code> does not attempt to create it, and raises
an error if it doesn’t exist.</p>

<p>For version 2.0 of the format, <code class="highlighter-rouge">external</code> cannot be used in conjunction with
other network configuration keys (<code class="highlighter-rouge">driver</code>, <code class="highlighter-rouge">driver_opts</code>, <code class="highlighter-rouge">ipam</code>, <code class="highlighter-rouge">internal</code>).
This limitation no longer exists for
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-21">version 2.1</a> and above.</p>

<p>In the example below, <code class="highlighter-rouge">proxy</code> is the gateway to the outside world. Instead of
attempting to create a network called <code class="highlighter-rouge">[projectname]_outside</code>, Compose
looks for an existing network simply called <code class="highlighter-rouge">outside</code> and connect the <code class="highlighter-rouge">proxy</code>
service’s containers to it.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: "2.4"

services:
  proxy:
    build: ./proxy
    networks:
      - outside
      - default
  app:
    build: ./app
    networks:
      - default

networks:
  outside:
    external: true
</code></pre></div></div>

<p>You can also specify the name of the network separately from the name used to
refer to it within the Compose file:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>networks:
  outside:
    external:
      name: actual-name-of-network
</code></pre></div></div>

<p>Not supported for version 2 <code class="highlighter-rouge">docker-compose</code> files. Use
<a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#network_mode">network_mode</a> instead.</p>

<h3 id="name-1">name</h3>

<blockquote>
  <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-21">Added in version 2.1 file format</a></p>
</blockquote>

<p>Set a custom name for this network.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: "2.4"
networks:
  network1:
    name: my-app-net
</code></pre></div></div>

<p>It can also be used in conjunction with the <code class="highlighter-rouge">external</code> property:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: "2.4"
networks:
  network1:
    external: true
    name: my-app-net
</code></pre></div></div>

<h2 id="variable-substitution">Variable substitution</h2>

<p>設定オプションには環境変数を含めることができます。
Compose は <code class="highlighter-rouge">docker-compose</code> が実行されたシェル環境から変数値を取得します。
たとえばシェル環境に <code class="highlighter-rouge">POSTGRES_VERSION=9.3</code> が定義されているとして、以下のような設定を行ったとします。</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">db</span><span class="pi">:</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">postgres:${POSTGRES_VERSION}"</span>
</code></pre></div></div>

<p>上の設定を使って <code class="highlighter-rouge">docker-compose up</code> を実行すると、Compose はシェル環境内の環境変数 <code class="highlighter-rouge">POSTGRES_VERSION</code> を見にいき、その値を使って設定を置換します。
この例では <code class="highlighter-rouge">image</code> が <code class="highlighter-rouge">postgres:9.3</code> と置換された上で、設定に関する処理へ進みます。</p>

<p>その環境変数が何も設定されていなかった場合、Compose は空文字に置換します。
上の例でいうと <code class="highlighter-rouge">POSTGRES_VERSION</code> が設定されていなかったとき、<code class="highlighter-rouge">image</code> オプションの値は <code class="highlighter-rouge">postgres:</code> になります。</p>

<p>環境変数のデフォルト値を <a href="../env-file.md"><code class="highlighter-rouge">.env</code> ファイル</a>に設定しておくことができます。
Compose はこのファイルを自動的に探しにいきます。
<code class="highlighter-rouge">.env</code> ファイルで定義されたものよりも、シェル環境で設定された値が優先されます。</p>

<blockquote class="important">
  <p><strong>重要</strong>： <code class="highlighter-rouge">.env</code> ファイルによる機能は <code class="highlighter-rouge">docker-compose up</code> コマンドを使うときだけ動作します。
<code class="highlighter-rouge">docker stack deploy</code> コマンドでは動作しません。</p>
</blockquote>

<p><code class="highlighter-rouge">$VARIABLE</code> と <code class="highlighter-rouge">${VARIABLE}</code> という 2 つの文法がともにサポートされます。
さらに <a href="compose-versioning.md#version-21">2.1 ファイルフォーマット</a>を利用している場合は、シェル上でも利用されているインラインのデフォルト指定方法を行うことができます。</p>

<ul>
  <li><code class="highlighter-rouge">${VARIABLE:-default}</code> は <code class="highlighter-rouge">VARIABLE</code> がセットされていないか空文字であるときに <code class="highlighter-rouge">default</code> として評価されます。</li>
  <li><code class="highlighter-rouge">${VARIABLE-default}</code> は <code class="highlighter-rouge">VARIABLE</code> がセットされていないときのみ <code class="highlighter-rouge">default</code> として評価されます。</li>
</ul>

<p>同様に以下の文法により、変数を必須とする扱いができます。</p>

<ul>
  <li><code class="highlighter-rouge">${VARIABLE:?err}</code> は <code class="highlighter-rouge">VARIABLE</code> がセットされていないか空文字であるときに、<code class="highlighter-rouge">err</code> を含むエラーメッセージを表示して終了します。</li>
  <li><code class="highlighter-rouge">${VARIABLE?err}</code> は <code class="highlighter-rouge">VARIABLE</code> がセットされていないときに、<code class="highlighter-rouge">err</code> を含むエラーメッセージを表示して終了します。</li>
</ul>

<p>シェル風のこの他の機能、たとえば <code class="highlighter-rouge">${VARIABLE/foo/bar}</code> などはサポートされていません。</p>

<p>設定ファイル内にドル記号そのものが必要な場合は <code class="highlighter-rouge">$$</code>（ドル記号 2 つ）を書きます。
この記述は Compose が値を取り違えないようにします。
つまり <code class="highlighter-rouge">$$</code> と書くことで、環境変数を参照しつつ Compose には処理させないようにすることができます。</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">web</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span> <span class="s">.</span>
  <span class="na">command</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$$VAR_NOT_INTERPOLATED_BY_COMPOSE"</span>
</code></pre></div></div>

<p>このことを忘れてドル記号 1 つ（<code class="highlighter-rouge">$</code>）を用いてしまうと、Compose は環境変数として値を解釈し、以下の警告を出します。</p>

<p>The VAR_NOT_INTERPOLATED_BY_COMPOSE is not set. Substituting an empty string.
（VAR_NOT_INTERPOLATED_BY_COMPOSE は設定されていません。空文字として置換します。）</p>

<h2 id="extension-fields">Extension fields</h2>

<blockquote>
  <p><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/#version-21">Added in version 2.1 file format</a>.</p>
</blockquote>

<p>拡張項目（extension fields）を利用することで、設定内容の再利用が可能になります。
この特別な項目は Compose ファイルの最上位項目として位置していれば、どのような書式であっても構いません。
このとき項目名の先頭は <code class="highlighter-rouge">x-</code> で書き始めます。</p>

<blockquote>
  <p><strong>メモ</strong></p>

  <p>（3.x シリーズにおいては）バージョン 3.7 から、また（2.x シリーズにおいては）バージョン 2.4 から、この拡張項目は、service、volume、network、config、secret それぞれの最上位に記述できることになりました。</p>
</blockquote>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.4'</span>
<span class="na">x-custom</span><span class="pi">:</span>
  <span class="na">items</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">a</span>
    <span class="pi">-</span> <span class="s">b</span>
  <span class="na">options</span><span class="pi">:</span>
    <span class="na">max-size</span><span class="pi">:</span> <span class="s1">'</span><span class="s">12m'</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">custom"</span>
</code></pre></div></div>

<p>この項目に記述された内容は Compose からは無視されます。
そして <a href="http://www.yaml.org/spec/1.2/spec.html#id2765878">YAML アンカー</a> を利用して、この項目をリソース定義内に挿入します。
たとえば複数のサービスに対して、同様のロギング設定を行いたいとします。</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">logging</span><span class="pi">:</span>
  <span class="na">options</span><span class="pi">:</span>
    <span class="na">max-size</span><span class="pi">:</span> <span class="s1">'</span><span class="s">12m'</span>
    <span class="na">max-file</span><span class="pi">:</span> <span class="s1">'</span><span class="s">5'</span>
  <span class="na">driver</span><span class="pi">:</span> <span class="s">json-file</span>
</code></pre></div></div>

<p>その場合、以下のようにして Compose ファイルを書くことができます。</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.4'</span>
<span class="na">x-logging</span><span class="pi">:</span>
  <span class="nl">&amp;default-logging</span>
  <span class="na">options</span><span class="pi">:</span>
    <span class="na">max-size</span><span class="pi">:</span> <span class="s1">'</span><span class="s">12m'</span>
    <span class="na">max-file</span><span class="pi">:</span> <span class="s1">'</span><span class="s">5'</span>
  <span class="na">driver</span><span class="pi">:</span> <span class="s">json-file</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">myapp/web:latest</span>
    <span class="na">logging</span><span class="pi">:</span> <span class="nv">*default-logging</span>
  <span class="na">db</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">mysql:latest</span>
    <span class="na">logging</span><span class="pi">:</span> <span class="nv">*default-logging</span>
</code></pre></div></div>

<p>また <a href="http://yaml.org/type/merge.html">YAML マージタイプ</a> を利用すれば、拡張項目内にて部分的に値を上書きすることもできます。
たとえば以下のとおりです。</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.4'</span>
<span class="na">x-volumes</span><span class="pi">:</span>
  <span class="nl">&amp;default-volume</span>
  <span class="na">driver</span><span class="pi">:</span> <span class="s">foobar-storage</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">myapp/web:latest</span>
    <span class="na">volumes</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">vol1"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">vol2"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">vol3"</span><span class="pi">]</span>
<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">vol1</span><span class="pi">:</span> <span class="nv">*default-volume</span>
  <span class="na">vol2</span><span class="pi">:</span>
    <span class="s">&lt;&lt;</span> <span class="pi">:</span> <span class="nv">*default-volume</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">volume02</span>
  <span class="na">vol3</span><span class="pi">:</span>
    <span class="s">&lt;&lt;</span> <span class="pi">:</span> <span class="nv">*default-volume</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">default</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">volume-local</span>
</code></pre></div></div>

<h2 id="compose-documentation">Compose documentation</h2>

<ul>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/index.md">User guide</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/install.md">Installing Compose</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-versioning/">Compose file versions and upgrading</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/django.md">Get started with Django</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/rails.md">Get started with Rails</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/wordpress.md">Get started with WordPress</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/reference/">Command line reference</a></li>
</ul>

							<!-- tags -->
							
							
							
							<span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span style="vertical-align: 2px"><a href="https://matsuand.github.io/docs.docker.jp.onthefly/glossary/?term=fig">fig</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/glossary/?term=composition">composition</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/glossary/?term=compose version 3">compose version 3</a>, <a href="https://matsuand.github.io/docs.docker.jp.onthefly/glossary/?term=docker">docker</a></span>
							
							<!-- link corrections -->
              <script language="JavaScript">
							var x = document.links.length;
							var baseHref = document.getElementsByTagName('base')[0].href
							for (i = 0; i < x; i++) {
							  var munged = false;
							  var thisHREF = document.links[i].href;
							  var originalURL = "/compose/compose-file/compose-file-v2/";
							  if (thisHREF.indexOf(baseHref + "#") > -1) {
							    // hash fix
							    //console.log('BEFORE: base:',baseHref,'thisHREF:',thisHREF,'originalURL:',originalURL);
							    thisHREF = originalURL + thisHREF.replace(baseHref, "");
							    //console.log('AFTER: base:',baseHref,'thisHREF:',thisHREF,'originalURL:',originalURL);
							  }
							  if ((thisHREF.indexOf(window.location.hostname) > -1 || thisHREF.indexOf('http') == -1) && document.links[i].className.indexOf("nomunge") < 0) {
							    munged = true;
							    thisHREF = thisHREF.replace(".md", "/").replace("/index/", "/");
							    document.links[i].setAttribute('href', thisHREF);
							  }
							}
							</script>
							
						  <div id="ratings-div" style="color:#b9c2cc; text-align: center; margin-top: 150px; visibility: hidden">
								<div id="pd_rating_holder_8453675"></div>
								<script type="text/javascript">
									PDRTJS_settings_8453675 = {
										"id": "8453675",
										"unique_id": "compose/compose-file/compose-file-v2.md",
										"title": "Compose ファイル バージョン 2 リファレンス",
										"permalink": "https://github.com/docker/docker.github.io/blob/master/compose/compose-file/compose-file-v2.md"
									};
									(function(d, c, j) {
										if (!document.getElementById(j)) {
											var pd = d.createElement(c),
												s;
											pd.id = j;
											pd.src = ('https:' == document.location.protocol) ? 'https://polldaddy.com/js/rating/rating.js' : 'http://i0.poll.fm/js/rating/rating.js';
											s = document.getElementsByTagName(c)[0];
											s.parentNode.insertBefore(pd, s);
										}
									}(document, 'script', 'pd-rating-js'));
								</script>
							</div>
							
						</section>
					</main>
					<nav class="col-nav">
						<div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
						<div id="navbar" class="nav-sidebar">
    <ul class="nav" id="jsTOCLeftNav">
    </ul>
</div>

						</div>
					</nav>
					<div class="col-toc">
							<div class="sidebar hidden-xs hidden-sm">
							<div class="toc-nav">
								<div class="feedback-links">
									<ul>
										
										<li style="visibility: hidden"><a href="https://github.com/matsuand/docs.docker.jp/edit/v18.09.local/compose/compose-file/compose-file-v2.md"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> このページの編集</a></li>
										<li><a href="https://github.com/matsuand/docs.docker.jp.onthefly/issues/new?body=File: [compose/compose-file/compose-file-v2.md](https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/)"
															class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> 文書変更のリクエスト</a></li>
										<li><a href="https://success.docker.com/support"><i class="fa fa-question" aria-hidden="true"></i> サポート依頼</a></li>
										<!-- toggle mode -->
										<li>
											<div class="toggle-mode">
												<div class="icon">
													<i class="fa fa-sun-o" aria-hidden="true"></i>
												</div>
												<div class="toggle-switch">
													<label class="switch">
														<input type="checkbox" id="switch-style">
														<div class="slider round"></div>
												</label>
												</div>
												<div class="icon">
													<i class="fa fa-moon-o" aria-hidden="true"></i>
												</div>
											</div>
										</li>
									</ul>
								</div>
								   
									<div id="side-toc-title">本ページ内</div>
									
<ul id="my_toc" class="inline_toc">
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#reference-and-guidelines" class="nomunge">リファレンスとガイドライン</a>
    <ul>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#compose-and-docker-compatibility-matrix" class="nomunge">Compose と Docker の互換マトリックス</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#service-configuration-reference" class="nomunge">サービス設定リファレンス</a>
        <ul>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#blkio_config" class="nomunge">blkio_config</a>
            <ul>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#device_read_bps-device_write_bps" class="nomunge">device_read_bps, device_write_bps</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#device_read_iops-device_write_iops" class="nomunge">device_read_iops, device_write_iops</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#weight" class="nomunge">weight</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#weight_device" class="nomunge">weight_device</a></li>
            </ul>
          </li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#build" class="nomunge">build</a>
            <ul>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#cache_from" class="nomunge">cache_from</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#context" class="nomunge">context</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#dockerfile" class="nomunge">dockerfile</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#args" class="nomunge">args</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#extra_hosts" class="nomunge">extra_hosts</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#isolation" class="nomunge">isolation</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#labels" class="nomunge">labels</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#network" class="nomunge">network</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#shm_size" class="nomunge">shm_size</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#target" class="nomunge">target</a></li>
            </ul>
          </li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#cap_add-cap_drop" class="nomunge">cap_add, cap_drop</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#command" class="nomunge">command</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#cgroup_parent" class="nomunge">cgroup_parent</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#container_name" class="nomunge">container_name</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#cpu_rt_runtime-cpu_rt_period" class="nomunge">cpu_rt_runtime, cpu_rt_period</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#device_cgroup_rules" class="nomunge">device_cgroup_rules</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#devices" class="nomunge">devices</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#depends_on" class="nomunge">depends_on</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#healthcheck" class="nomunge">healthcheck</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#dns" class="nomunge">dns</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#dns_opt" class="nomunge">dns_opt</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#dns_search" class="nomunge">dns_search</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#tmpfs" class="nomunge">tmpfs</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#entrypoint" class="nomunge">entrypoint</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#env_file" class="nomunge">env_file</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#environment" class="nomunge">environment</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#expose" class="nomunge">expose</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#extends" class="nomunge">extends</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#external_links" class="nomunge">external_links</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#extra_hosts-1" class="nomunge">extra_hosts</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#group_add" class="nomunge">group_add</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#healthcheck-1" class="nomunge">healthcheck</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#image" class="nomunge">image</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#init" class="nomunge">init</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#isolation-1" class="nomunge">isolation</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#labels-1" class="nomunge">labels</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#links" class="nomunge">links</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#logging" class="nomunge">logging</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#network_mode" class="nomunge">network_mode</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#networks" class="nomunge">networks</a>
            <ul>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#aliases" class="nomunge">aliases</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#ipv4_address-ipv6_address" class="nomunge">ipv4_address, ipv6_address</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#link_local_ips" class="nomunge">link_local_ips</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#priority" class="nomunge">priority</a></li>
            </ul>
          </li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#pid" class="nomunge">pid</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#pids_limit" class="nomunge">pids_limit</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#platform" class="nomunge">platform</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#ports" class="nomunge">ports</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#runtime" class="nomunge">runtime</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#scale" class="nomunge">scale</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#security_opt" class="nomunge">security_opt</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#stop_grace_period" class="nomunge">stop_grace_period</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#stop_signal" class="nomunge">stop_signal</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#storage_opt" class="nomunge">storage_opt</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#sysctls" class="nomunge">sysctls</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#ulimits" class="nomunge">ulimits</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#userns_mode" class="nomunge">userns_mode</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#volumes" class="nomunge">volumes</a>
            <ul>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#short-syntax" class="nomunge">短い文法</a></li>
              <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#long-syntax" class="nomunge">長い文法</a></li>
            </ul>
          </li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#volume_driver" class="nomunge">volume_driver</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#volumes_from" class="nomunge">volumes_from</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#restart" class="nomunge">restart</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#cpu-and-other-resources" class="nomunge">cpu_count, cpu_percent, cpu_shares, cpu_period, cpu_quota, cpus, cpuset, domainname, hostname, ipc, mac_address, mem_limit, memswap_limit, mem_swappiness, mem_reservation, oom_kill_disable, oom_score_adj, privileged, read_only, shm_size, stdin_open, tty, user, working_dir</a></li>
        </ul>
      </li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#specifying-durations" class="nomunge">時間の指定</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#specifying-byte-values" class="nomunge">バイト値の表現</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#volume-configuration-reference" class="nomunge">ボリューム設定リファレンス</a>
        <ul>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#driver" class="nomunge">driver</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#driver_opts" class="nomunge">driver_opts</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#external" class="nomunge">external</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#labels-2" class="nomunge">labels</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#name" class="nomunge">name</a></li>
        </ul>
      </li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#network-configuration-reference" class="nomunge">ネットワーク設定リファレンス</a>
        <ul>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#driver-1" class="nomunge">driver</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#driver_opts-1" class="nomunge">driver_opts</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#enable_ipv6" class="nomunge">enable_ipv6</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#ipam" class="nomunge">ipam</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#internal" class="nomunge">internal</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#labels-3" class="nomunge">labels</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#external-1" class="nomunge">external</a></li>
          <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#name-1" class="nomunge">name</a></li>
        </ul>
      </li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#variable-substitution" class="nomunge">Variable substitution</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#extension-fields" class="nomunge">Extension fields</a></li>
      <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v2/#compose-documentation" class="nomunge">Compose documentation</a></li>
    </ul>
  </li>
</ul>


								</div>
								
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	
	<footer class="footer">
		  
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/what-docker">What is Docker</a></li>
                        <li><a href="https://www.docker.com/what-container">What is a Container</a></li>
                        <li><a href="https://www.docker.com/use-cases">Use Cases</a></li>
                        <li><a href="https://www.docker.com/customers">Customers</a></li>
                        <li><a href="https://www.docker.com/partners/partner-program">Partners</a></li>
                        <li class="break"><a href="https://www.docker.com/industry-government">For Government</a></li>
                        <li><a href="https://www.docker.com/company">About Docker</a></li>
                        <li><a href="https://www.docker.com/company/management">Management</a></li>
                        <li><a href="https://www.docker.com/company/news-and-press">Press &amp; News</a></li>
                        <li><a href="https://www.docker.com/careers">Careers</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/products/overview">Product</a></li>
                        <li><a href="https://www.docker.com/pricing">Pricing</a></li>
                        <li><a href="https://www.docker.com/docker-community">Community Edition</a></li>
                        <li class="break"><a href="https://www.docker.com/enterprise">Enterprise Edition </a></li>
                        <li><a href="https://www.docker.com/products/docker-datacenter">Docker Datacenter</a></li>
                        <li><a href="https://hub.docker.com/">Docker Hub</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/">Documentation</a></li>
                        <li><a href="https://www.docker.com/docker">Learn</a></li>
                        <li><a href="https://blog.docker.com" target="_blank">Blog</a></li>
                        <li><a href="https://engineering.docker.com" target="_blank">Engineering Blog</a></li>
                        <li><a href="https://training.docker.com/" target="_blank">Training</a></li>
                        <li><a href="https://success.docker.com/support">Support</a></li>
                        <li><a href="https://success.docker.com/kbase">Knowledge Base</a></li>
                        <li><a href="https://www.docker.com/products/resources">Resources</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><a href="https://www.docker.com/docker-community">Community</a></li>
                        <li><a href="https://www.docker.com/technologies/overview">Open Source</a></li>
                        <li><a href="https://www.docker.com/community/events">Events</a></li>
                        <li><a href="https://forums.docker.com/" target="_blank">Forums</a></li>
                        <li><a href="https://www.docker.com/community/docker-captains">Docker Captains</a></li>
                        <li><a href="https://www.docker.com/docker-community/scholarships">Scholarships</a></li>
                        <li><a href="https://blog.docker.com/curated/">Community News</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="http://status.docker.com/">Status</a></li>
                        <li><a href="https://www.docker.com/docker-security">Security</a></li>
                        <li><a href="https://www.docker.com/legal">Legal</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2019 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="http://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="http://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker">GitHub</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-reddit"><a href="http://www.reddit.com/r/docker">Reddit</a></li>
                    <li class="fa fa-slideshare"><a href="http://www.slideshare.net/docker">Slideshare</a></li>
                </ul>
            </div>
        </div>
    </div>

	</footer>
	<link rel="stylesheet" href="https://matsuand.github.io/docs.docker.jp.onthefly/css/github.css">
	
	<!-- <script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/anchorlinks.js"></script> -->
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/menu.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/jquery.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/bootstrap.min.js"></script>
	<!-- Always include the archive.js, but it doesn't do much unless we are an archive -->
	<script language="javascript">
	// Default to assuming this is an archive and hiding some stuff
	// See js/archive.js and js/docs.js for logic relating to this
	var isArchive = true;
	var dockerVersion = 'v18.09';
	// In archives, we need to know the page root and we get it from JEKYLL_ENV in the jekyll build command
	var jekyllEnv = 'development';
	// If unset (in non-archive branches), defaults to "development". In that case, reset it to empty
	if (jekyllEnv == 'development') {
		jekyllEnv = '';
	}
	var pageURL = jekyllEnv + '/compose/compose-file/compose-file-v2/';
	</script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/archive.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/stickyfill.min.js"></script>
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/metadata.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/glossary.js"></script>
	<script src="https://matsuand.github.io/docs.docker.jp.onthefly/js/collections_tocs.js"></script>
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/docs.js"></script>
	<script defer src="https://matsuand.github.io/docs.docker.jp.onthefly/js/toc.js"></script>
	<script language="javascript">
	jQuery(document).ready(function(){
				hookupTOCEvents();
			});
	</script>
</body>

</html>
